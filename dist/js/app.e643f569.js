(function(e){function t(t){for(var r,a,c=t[0],d=t[1],u=t[2],s=0,p=[];s<c.length;s++)a=c[s],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in d)Object.prototype.hasOwnProperty.call(d,r)&&(e[r]=d[r]);l&&l(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var d=n[c];0!==o[d]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=d;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0659":function(e,t,n){"use strict";n("53fe")},"35cf":function(e,t,n){},"53fe":function(e,t,n){},"6e6f":function(e,t,n){"use strict";n("35cf")},"6fb8":function(e,t,n){"use strict";var r=n("7499"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},7499:function(e,t,n){e.exports={wrapper:"Index_wrapper_1nXRC"}},"805e":function(e,t,n){e.exports=n.p+"img/discord-icon-svgrepo-com.147f41c9.svg"},8794:function(e,t,n){"use strict";n("ecf0")},aa20:function(e,t){},b4e7:function(e,t,n){},b658:function(e,t,n){"use strict";n("b4e7")},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function o(e,t,n,o,i,a){var c=Object(r["C"])("router-view");return Object(r["u"])(),Object(r["g"])(c)}n("a4d3"),n("e01a"),n("99af"),n("4160"),n("d81d"),n("d3b7"),n("159b");var i,a,c,d=n("2909"),u=(n("96cf"),n("1da1")),l=n("ade3"),s=n("3835"),p=n("5502"),f=(n("c975"),n("a434"),n("b85c")),b={SET_PINS:"SET_PINS",ADD_TO_PINS:"ADD_TO_PINS",REMOVE_PIN:"REMOVE_PIN",ADD_TO_PINS_REVERSE:"ADD_TO_PINS_REVERSE"},O={AddPin:"AddPin",RemovePin:"RemovePin"},v={namespaced:!0,state:{pins:{},pinsReverse:{}},actions:(i={},Object(l["a"])(i,O.AddPin,(function(e,t){var n=e.commit,r=e.rootState,o=r.tree.nodeRecord[t.nodeId].parent;if(o){var i=[];while(o&&o.id!=t.parentId)i.push(o.id),o=r.tree.nodeRecord[o.id].parent;i.push(t.parentId),n(b.ADD_TO_PINS,{nodeId:t.nodeId,parentIds:i});for(var a=0,c=i;a<c.length;a++){var d=c[a];n(b.ADD_TO_PINS_REVERSE,{nodeId:d,pinId:t.nodeId})}}})),Object(l["a"])(i,O.RemovePin,(function(e,t){var n=e.commit;n(b.REMOVE_PIN,t)})),i),mutations:(a={},Object(l["a"])(a,b.SET_PINS,(function(e,t){for(var n in e.pins=t,e.pinsReverse={},t){var r,o=Object(f["a"])(t[n]);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.pinsReverse[i]||(e.pinsReverse[i]=[]),e.pinsReverse[i].push(n)}}catch(a){o.e(a)}finally{o.f()}}})),Object(l["a"])(a,b.ADD_TO_PINS,(function(e,t){e.pins[t.nodeId]=t.parentIds})),Object(l["a"])(a,b.ADD_TO_PINS_REVERSE,(function(e,t){e.pinsReverse[t.nodeId]||(e.pinsReverse[t.nodeId]=[]),e.pinsReverse[t.nodeId].push(t.pinId)})),Object(l["a"])(a,b.REMOVE_PIN,(function(e,t){var n,r=Object(f["a"])(e.pins[t]);try{for(r.s();!(n=r.n()).done;){var o=n.value,i=e.pinsReverse[o].indexOf(t);e.pinsReverse[o].splice(i,1)}}catch(a){r.e(a)}finally{r.f()}delete e.pins[t]})),a)},m={SET_PRECONDITIONS:"SET_PRECONDITIONS",UPDATE_PRECONDITIONS:"UPDATE_PRECONDITIONS"},h={namespaced:!0,state:{preconditions:{}},mutations:(c={},Object(l["a"])(c,m.SET_PRECONDITIONS,(function(e,t){e.preconditions=t})),Object(l["a"])(c,m.UPDATE_PRECONDITIONS,(function(e,t){e.preconditions[t.nodeID]||(e.preconditions[t.nodeID]=[]),e.preconditions[t.nodeID]=t.preconditionIDs})),c)},g=(n("4de4"),n("c740"),n("caad"),n("b0c0"),n("2532"),n("3ca3"),n("ddb0"),n("53ca")),j=(n("a15b"),n("13d5"),n("a9e3"),n("b64b"),n("595b")),y=function(e,t,n){var r=new Error(e);return{error:r,kv:t,code:n}},N=n("9fe2"),I=n("dcbe"),x=n.n(I),T=n("2ef0"),E=0;function D(e,t){return(e%t+t)%t}function C(e){var t=Math.pow(10,E);return Math.round(e*t)/t}function w(e){return Object(T["cloneDeep"])(e)}function k(e,t){var n;t||console.error(e);var r=[];for(var o in t)r.push(o,t[o]);(n=console).error.apply(n,[e].concat(r))}var R=n("ec26");function _(e,t){for(var n in t){var r=t[Number(n)];if(r&&r[e])return[r[e],Number(n)]}return[null,null]}function S(e,t){var n,r=[],o=Object(f["a"])(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i){var a,c=Object(f["a"])(e);try{for(c.s();!(a=c.n()).done;){var d=a.value;i[d]&&r.push(i[d])}}catch(u){c.e(u)}finally{c.f()}}}}catch(u){o.e(u)}finally{o.f()}return r}function P(e,t){return{id:Object(R["a"])(),position:t,title:e,children:[]}}function M(e,t,n){var r=_(e.id,t),o=Object(s["a"])(r,1),i=o[0];if(null===i)return[null,null,y("getNewNodeCenter: cannot find mapNode for parent",{parentId:e.id,mapNodeLayers:t})];if(0===e.children.length){var a,c=i.border.map((function(e){return{from:i.center,to:e}})),d=c[0],u=Object(f["a"])(c);try{for(u.s();!(a=u.n()).done;){var l=a.value;X(l)>X(d)&&(d=l)}}catch(U){u.e(U)}finally{u.f()}var p=.5;return n&&(p=.5*Math.random()+1/4),[{x:d.from.x+p*(d.to.x-d.from.x),y:d.from.y+p*(d.to.y-d.from.y)},null,null]}var b=e.children[0],O=_(b.id,t),v=Object(s["a"])(O,1),m=v[0];if(null===m)return[null,null,y("getNewNodeCenter: cannot find maxDiagChild in layers",{maxDiagChildId:b.id,mapNodeLayers:t})];var h,g=Object(f["a"])(e.children);try{for(g.s();!(h=g.n()).done;){var j=h.value,N=_(j.id,t),I=Object(s["a"])(N,1),x=I[0];if(null===x)return[null,null,y("getNewNodeCenter: cannot find child in layers",{childId:j.id,mapNodeLayers:t})];var T=be(x.border),E=Object(s["a"])(T,2),D=E[0],C=E[1];if(C)return[null,null,y("getNewNodeCenter: error getMaxDiagonal",{childMapNode:x,err1:C})];var k=be(m.border),R=Object(s["a"])(k,2),S=R[0],P=R[1];if(P)return[null,null,y("getNewNodeCenter: error getMaxDiagonal",{maxDiagChildMapNode:m,err2:P})];X(D)>X(S)&&(m=x)}}catch(U){g.e(U)}finally{g.f()}var M=3/4;n&&(M=Math.random()*(1/4)+.625);var L=be(m.border),A=Object(s["a"])(L,1),B=A[0],H=ue(B,M).to,z=w(b);return z.position=ue(B,1/4).to,[H,z,null]}function L(e,t){if(null==e.tree)return y("state.tree == null",{});var n=e.nodeRecord[t.nodeId];if(!n)return y("updateNodePosition: cannot find node in nodeRecord",{"v.nodeId":t.nodeId,"state.nodeRecord":e.nodeRecord});if(!n.parent)return y("updateNodePosition: cannot move root of tree",{"v.nodeId":t.nodeId});var r=Oe("normalize",t.position,n.parent.id,e.mapNodeLayers),o=Object(s["a"])(r,1),i=o[0];n.node.position=i;var a=_(n.parent.id,e.mapNodeLayers),c=Object(s["a"])(a,2),d=c[0],u=c[1];if(!d||null===u)return y("updateNodePosition: cannot find mapNode for parent",{id:n.parent.id,"state.mapNodeLayers":e.mapNodeLayers});var l=ve(n.parent,d.border,d.center),p=Object(s["a"])(l,2),f=p[0],b=p[1];return null==f||null!=b?y("updateNodePosition: create layers for parent",{id:n.parent.id,parentMapNode:d}):me(e.mapNodeLayers,f,u)}n("25f0");var A=n("2591"),B=n("bc3a"),H=n.n(B);n("07ac");function z(e){var t;return e?Array.isArray(e)?(t=e.filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):(t=Object.values(e).filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):t=[],t}function U(e){var t={id:e["0"].id.toString(),title:e["0"].name,position:e["0"].position,children:[]},n=[t];while(n.length>0){var r=n.pop();if(r){if(!e[r.id])return[null,y("Cannot find id in dbNodes",{"node.id":r.id,dbNodes:e})];if(e[r.id].children=z(e[r.id].children),e[r.id].children.length){var o,i=[],a=Object(f["a"])(e[r.id].children);try{for(a.s();!(o=a.n()).done;){var c=o.value;if(!e[c])return[null,y("Cannot find child id in dbNodes",{childID:c,parentID:r.id})];i.push({id:c.toString(),title:e[c].name,position:e[c].position,children:[]})}}catch(d){a.e(d)}finally{a.f()}r.children=i,n.push.apply(n,i)}}}return[t,null]}n("d6b6");var V,G="https://us-central1-sci-map-1982.cloudfunctions.net/",F=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A["a"].database().ref().update(t);case 3:return e.abrupt("return",null);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",y("api: error in update",{err:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),q=Object(T["debounce"])(F,400),W={ROOT_WIDTH:window.innerWidth,ROOT_HEIGHT:window.innerHeight-window.innerHeight/100,ST_WIDTH:1e3,ST_HEIGHT:1e3,initFirebase:function(){var e={apiKey:"AIzaSyCP50k-WOkTeG8BYvRtu4Bo_x3T2RnVsxU",authDomain:"sci-map-1982.firebaseapp.com",databaseURL:"https://sci-map-1982.firebaseio.com",projectId:"sci-map-1982",storageBucket:"sci-map-1982.appspot.com",messagingSenderId:"340899060236",appId:"1:340899060236:web:b136e9289e342a8bb62c29",measurementId:"G-TV74Q61H9P"};A["a"].initializeApp(e),A["a"].analytics()},callFunction:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=A["a"].auth().currentUser,r){n.next=3;break}return n.abrupt("return",["",y("callFunction: cannot determine current user",{})]);case 3:return n.next=5,r.getIdToken(!0);case 5:return o=n.sent,t.idToken=o,n.prev=7,n.next=10,H.a.get(G+e,{params:t});case 10:return i=n.sent,n.abrupt("return",[i.data,null]);case 14:return n.prev=14,n.t0=n["catch"](7),n.abrupt("return",["",y("Error in callFunction",{method:e,params:t,e:n.t0})]);case 17:case"end":return n.stop()}}),n,null,[[7,14]])})))()},getMapFromDB:function(){return Object(u["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,A["a"].database().ref("map").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[null,y("!snapshot.exists",{})]);case 5:return n=t.val(),e.abrupt("return",[n,null]);case 7:case"end":return e.stop()}}),e)})))()},getMapFromStorage:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=A["a"].storage().ref(),o=r.child("/map.json"),e&&(o=r.child("/user/".concat(e.uid,"/map.json"))),n.next=5,o.getDownloadURL();case 5:return i=n.sent,n.next=8,H.a.get(i);case 8:return a=n.sent,n.abrupt("return",[{id:"0",title:"",position:{x:t.ROOT_WIDTH/2,y:t.ROOT_HEIGHT/2},children:a.data},null]);case 10:case"end":return n.stop()}}),n)})))()},getMap:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getMapFromDB();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",[null,y(e.t0.message,{e:e.t0})]);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},getPins:function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=A["a"].storage().ref(),r=n.child("/pins.json"),e&&(r=n.child("/user/".concat(e.uid,"/pins.json"))),t.next=6,r.getDownloadURL();case 6:return o=t.sent,t.next=9,H.a.get(o);case 9:return i=t.sent,t.abrupt("return",[i.data,null]);case 13:return t.prev=13,t.t0=t["catch"](0),t.abrupt("return",[null,y(t.t0.message,{e:t.t0})]);case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},savePins:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return r=A["a"].storage().ref(),o=r.child("/user/".concat(e.uid,"/pins.json")),n.next=6,o.putString(btoa(unescape(encodeURIComponent(JSON.stringify(t)))),"base64");case 6:case"end":return n.stop()}}),n)})))()},getPreconditions:function(e){return Object(u["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A["a"].database().ref("precondition").get();case 3:if(t=e.sent,t.exists()){e.next=6;break}return e.abrupt("return",[null,y("!snapshot.exists",{})]);case 6:return n=t.val(),e.abrupt("return",[n,null]);case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",[null,y(e.t0.message,{e:e.t0})]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},savePreconditions:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,A["a"].database().ref("precondition/"+t.nodeId).set(t.preconditionIds);case 4:case"end":return n.stop()}}),n)})))()},subscribeMapNodeChange:function(e,t){this.subscribeDBChange("map/".concat(e),(function(e){if(e.exists()){var n=e.val();console.log("got update for map node",n),n.id=n.id.toString(),n.children=z(n.children),t(n)}}))},subscribeNodeContentChange:function(e,t){this.subscribeDBChange("node_content/".concat(e),(function(e){if(e.exists()){var n=e.val();console.log("got update for node content",n),t(n)}}))},subscribePreconditionNodeChange:function(e,t){this.subscribeDBChange("precondition/".concat(e),(function(n){if(n.exists()){var r=n.val();console.log("got update for node precondition","nodeID",e,"preconditionIDs",r),t(e,r)}}))},unsubscribeMapNodeChange:function(e){A["a"].database().ref("map/".concat(e)).off("value")},subscribeDBChange:function(e,t){A["a"].database().ref(e).on("value",t)},unsubscribeDBChange:function(e,t){A["a"].database().ref(e).off("value",t)},transaction:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,A["a"].database().ref("map/"+e).transaction(t,(function(){}),!1);case 2:case"end":return n.stop()}}),n)})))()},setNode:function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,A["a"].database().ref("map/"+e.id).set(e);case 2:case"end":return t.stop()}}),t)})))()},getNode:function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,A["a"].database().ref("map/"+e).get();case 2:return n=t.sent,r=n.val(),r.id=r.id.toString(),r.children=z(r.children),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})))()},generateKey:function(){return A["a"].database().ref().push().key},findKeyInList:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,A["a"].database().ref(e).orderByValue().equalTo(t).limitToFirst(1).get();case 2:return r=n.sent,n.abrupt("return",r.key);case 4:case"end":return n.stop()}}),n)})))()},findKeyOfChild:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,A["a"].database().ref("map/"+e).get();case 2:if(r=n.sent,o=r.val(),o.children){n.next=6;break}return n.abrupt("return",null);case 6:n.t0=regeneratorRuntime.keys(o.children);case 7:if((n.t1=n.t0()).done){n.next=13;break}if(i=n.t1.value,o.children[i].toString()!==t){n.next=11;break}return n.abrupt("return",i);case 11:n.next=7;break;case 13:return n.abrupt("return",null);case 14:case"end":return n.stop()}}),n)})))()},update:F,debouncedUpdate:q,getUserComments:function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.uid,t.next=3,A["a"].database().ref("user_data/".concat(n,"/comment")).get();case 3:if(r=t.sent,r.exists()){t.next=6;break}return t.abrupt("return",[null,y("!snapshot.exists",{})]);case 6:return o=r.val(),t.abrupt("return",[o,null]);case 8:case"end":return t.stop()}}),t)})))()},getNodeContent:function(){return Object(u["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,A["a"].database().ref("node_content").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[{},null]);case 5:return e.abrupt("return",[t.val(),null]);case 6:case"end":return e.stop()}}),e)})))()}},Y=[{x:0,y:0},{x:0,y:W.ST_HEIGHT},{x:W.ST_WIDTH,y:W.ST_HEIGHT},{x:W.ST_WIDTH,y:0}];function X(e){return Math.sqrt(Math.pow(e.from.x-e.to.x,2)+Math.pow(e.from.y-e.to.y,2))}function K(e){if(!e)throw new Error("polygonToTurf: p is empty");var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),j["polygon"]([t])}function Z(e,t){return j["booleanPointInPolygon"](j["point"]([e.x,e.y]),K(t))}function J(e){var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),[t]}function $(e){return Math.abs(Object(N["a"])(e.map((function(e){return[e.x,e.y]}))))}function Q(e,t){var n=w(e),r=w(t),o=1;while($(n)<1e3&&$(r)<1e3)o*=10,n=e.map((function(e){return{x:e.x*o,y:e.y*o}})),r=t.map((function(e){return{x:e.x*o,y:e.y*o}}));n=n.map((function(e){return{x:C(e.x),y:C(e.y)}})),r=r.map((function(e){return{x:C(e.x),y:C(e.y)}}));var i=J(n),a=J(r);if(null==i||null==a)return[null,y("intersect: error in polygonToPCPolygon",{p1:e,p2:t})];var c=x.a.intersection(i,a);if(null==c||!c.length)return[[],null];var d,u=[],l=Object(f["a"])(c[0]);try{for(l.s();!(d=l.n()).done;){var s,p=d.value,b=[],O=Object(f["a"])(p);try{for(O.s();!(s=O.n()).done;){var v=s.value;b.push({x:v[0]/o,y:v[1]/o})}}catch(m){O.e(m)}finally{O.f()}b.pop(),u.push(b)}}catch(m){l.e(m)}finally{l.f()}return[u,null]}function ee(e){e||console.error("bad border",e);var t=e.reduce((function(e,t){return e.x>t.x?t:e})).x,n=e.reduce((function(e,t){return e.y>t.y?t:e})).y,r=e.reduce((function(e,t){return e.x<t.x?t:e})).x,o=e.reduce((function(e,t){return e.y<t.y?t:e})).y;return{leftBottom:{x:t,y:n},rightTop:{x:r,y:o}}}function te(e,t,n){var r,o=e.map((function(e){return j["point"]([e.x,e.y])})),i=j["featureCollection"](o),a=j["voronoi"](i,{bbox:[t.x,t.y,n.x,n.y]}),c={},d=0,u=Object(f["a"])(a.features);try{for(u.s();!(r=u.n()).done;){var l=r.value;if(!l)return[{},y("getVoronoiCellsInSquare: undefined cell",{centers:e,leftBottom:t,rightTop:n,cells:a})];var s=l.geometry.coordinates[0].map((function(e){return{x:e[0],y:e[1]}}));s.pop(),c[d]=s,d++}}catch(p){u.e(p)}finally{u.f()}return[c,null]}function ne(e,t){if(!e)return[[],y("getVoronoiCells: bad outerBorder",{outerBorder:e,centers:t})];var n=ee(e),r=te(t,n.leftBottom,n.rightTop),o=Object(s["a"])(r,2),i=o[0],a=o[1];if(a)return[[],y("getVoronoiCells: error in getVoronoiCellsInSquare",{err:a,bb:n,centers:t})];var c=[];for(var d in t){if(!i[d])return[[],y("Cannot find index in cellMap",{index:d,centers:t,cellMap:i,BoundingBorders:n,outerBorder:e})];var u=Q(i[d],e),l=Object(s["a"])(u,2),p=l[0],f=l[1];if(null==p||null!=f)return[[],y("getVoronoiCells error",{err:f,cellBorder:i[d],outerBorder:e})];if(p==[])return[[],y("Voronoi cell has no intersection with outerBorder",{point:t[d]})];if(p.length>1)return[[],y("Voronoi cell has more than one intersection with outerBorder",{point:t[d]})];c.push({border:p[0],center:t[d]})}return[c,null]}function re(e,t,n){return e&&e==t?"#f3afaf":n&&-1!=n.indexOf(t)?"#62f363":"transparent"}function oe(e,t,n){return e&&e==t||n&&-1!=n.indexOf(t)?"0.2":"0"}function ie(e){return e.map((function(e){return"".concat(e.x," ").concat(e.y)})).join(",")}function ae(e){var t={},n=[{node:e,parent:null}],r=function(){var e=n.pop();if(!e)return"break";t[e.node.id]=e,n.push.apply(n,Object(d["a"])(e.node.children.map((function(t){return{node:t,parent:e.node}}))))};while(n.length){var o=r();if("break"===o)break}return t}function ce(e,t){return{from:{x:t.x,y:t.y},to:{x:t.x+(e.to.x-e.from.x),y:t.y+(e.to.y-e.from.y)}}}function de(e,t){var n=ce(t,e.to);return{from:{x:e.from.x,y:e.from.y},to:{x:n.to.x,y:n.to.y}}}function ue(e,t){var n=ce(e,{x:0,y:0});return ce({from:{x:0,y:0},to:{x:n.to.x*t,y:n.to.y*t}},e.from)}function le(e,t){return ce(t,e).to}function se(e,t){var n=e.from.x,r=e.from.y,o=e.to.x,i=e.to.y,a=t.from.x,c=t.from.y,d=t.to.x,u=t.to.y,l=(u-c)*(o-n)-(d-a)*(i-r),s=(d-a)*(r-c)-(u-c)*(n-a),p=(o-n)*(r-c)-(i-r)*(n-a);if(0==l)return null;var f=s/l,b=p/l;return f>=0&&f<=1&&b>=0&&b<=1?{x:n+f*(o-n),y:r+f*(i-r)}:null}function pe(e,t,n){var r=j["centerOfMass"](K(e)).geometry;if(null==r)return[null,y("morphChildrenPoints oldBorder centerOfMass error",{oldBorder:e,oldPoints:n})];var o=j["centerOfMass"](K(t)).geometry;if(null==o)return[null,y("morphChildrenPoints newBorder centerOfMass error",{newBorder:t,oldPoints:n})];var i={x:r.coordinates[0],y:r.coordinates[1]},a={x:o.coordinates[0],y:o.coordinates[1]};for(var c in e=e.map((function(e){return le(e,{from:i,to:a})})),n)n[c]=le(n[c],{from:i,to:a});var d=Math.max(X({from:ee(e).leftBottom,to:ee(e).rightTop}),X({from:ee(t).leftBottom,to:ee(t).rightTop})),u={};for(var l in n){var s=n[l];if(a.x!=s.x||a.y!=s.y){var p={from:a,to:n[l]};p=ue(p,d/X(p));var f=null;for(var b in e){var O={from:e[b],to:e[(Number(b)+1)%e.length]},v=se(p,O);if(null!=v){f=v;break}}if(null==f)return[null,y("morphChildrenPoints cannot find intersection with oldBorder",{centerToPoint:p,oldBorder:e})];var m=null;for(var h in t){var g={from:t[h],to:t[(Number(h)+1)%t.length]},N=se(p,g);if(null!=N){m=N;break}}if(null==m)return[null,y("morphChildrenPoints cannot find intersection with newBorder",{centerToPoint:p,newBorder:t})];if(f.x!=m.x||f.y!=m.y){var I=X({from:a,to:m})/X({from:a,to:f});u[l]=ue({from:a,to:s},I).to}else u[l]=s}else u[l]=s}return[u,null]}function fe(){return{from:{x:0,y:0},to:{x:0,y:0}}}function be(e){if(!e||e.length<3)return[fe(),y("getMaxDiagonal: bad polygon",{polygon:e})];var t=[];if(3==e.length)for(var n in e){var r=ue({from:e[D(Number(n)-1,e.length)],to:e[D(Number(n)+1,e.length)]},.5);t.push({from:e[n],to:r.to})}else for(var o in e)for(var i in e)Number(i)!=D(Number(o)-1,e.length)&&Number(i)!=Number(o)&&Number(i)!=D(Number(o)+1,e.length)&&t.push({from:e[o],to:e[i]});for(var a=t[0],c=0,d=t;c<d.length;c++){var u=d[c];X(u)>X(a)&&(a=u)}return[a,null]}function Oe(e,t,n,r){var o;if(n){var i,a,c=_(n,r),d=Object(s["a"])(c,1),u=d[0];if(!u)return[null,y("UPDATE_NODE: Cannot findMapNode",{id:n})];if("denormalize"===e){if(!Z(t,Y))return[null,y("convertPosition: position outside NORMALIZED_BORDER",{normalizedBorder:Y,position:t,parentID:n})];var l=pe(Y,u.border,{tmp:t}),p=Object(s["a"])(l,2);i=p[0],a=p[1]}else{if(!Z(t,u.border))return[null,y("convertPosition: position outside parentMapNode.border",{"parentMapNode.border":u.border,"parentMapNode.center":u.center,position:t,parentID:n})];var f=pe(u.border,Y,{tmp:t}),b=Object(s["a"])(f,2);if(i=b[0],a=b[1],null!==a)return[null,y("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:Y,"parentMapNode.border":u.border,"dbNode.position":t})];i["tmp"].x<0&&(i["tmp"].x=1),i["tmp"].x>W.ST_WIDTH&&(i["tmp"].x=W.ST_WIDTH-1),i["tmp"].y<0&&(i["tmp"].y=1),i["tmp"].y>W.ST_HEIGHT&&(i["tmp"].y=W.ST_HEIGHT-1)}if(null!==a)return[null,y("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:Y,"parentMapNode.border":u.border,"dbNode.position":t})];o=i["tmp"]}else o="denormalize"===e?{x:W.ROOT_WIDTH/2,y:W.ROOT_HEIGHT/2}:{x:W.ST_WIDTH/2,y:W.ST_HEIGHT/2};return[o,null]}function ve(e,t,n){if(0==Object.keys(e).length)return[[],null];var r=[[e]],o=[Object(l["a"])({},e.id,{id:e.id,border:t,title:e.title,center:n})];while(1){var i,a=r[r.length-1],c=o[r.length-1],u=[],p={},b=Object(f["a"])(a);try{for(b.s();!(i=b.n()).done;){var O=i.value;if(!O.children)return[null,y("treeToMapNodeLayers: treeNode with children undefined",{treeNode:O})];if(O.children.length){var v={},m="";for(var h in O.children){if(m=JSON.stringify(O.children[h].position),v[m]&&v[m].length>0)return[null,y("two children has the same center",{firstId:v[m],secondId:O.children[h].id})];v[m]=O.children[h].id}if(u.push.apply(u,Object(d["a"])(O.children)),!c[O.id])return[null,y("Cannot find node in mapNodeLayers",{layer:o[o.length-1],treeNode:O})];var g,j=w(O.children),N=Object(f["a"])(j);try{for(N.s();!(g=N.n()).done;){var I=g.value,x=Oe("denormalize",I.position,O.id,[c]),T=Object(s["a"])(x,2),E=T[0],D=T[1];if(D)return[null,D];I.position=E}}catch(H){N.e(H)}finally{N.f()}var C=ne(c[O.id].border,j.map((function(e){return{x:e.position.x,y:e.position.y}}))),k=Object(s["a"])(C,2),R=k[0],_=k[1];if(null!=_)return[null,_];var S,P=Object(f["a"])(R);try{for(P.s();!(S=P.n()).done;){var M,L=S.value,A=Object(f["a"])(j);try{for(A.s();!(M=A.n()).done;){var B=M.value;B.position.x==L.center.x&&B.position.y==L.center.y&&(p[B.id]={id:B.id,title:B.title,center:B.position,border:L.border})}}catch(H){A.e(H)}finally{A.f()}}}catch(H){P.e(H)}finally{P.f()}}}}catch(H){b.e(H)}finally{b.f()}if(!u.length)return[o,null];r.push(u),o.push(p)}}function me(e,t,n){if(n>=e.length||n<0)return y("startFromLevel >= recipientLayers.length or startFromLevel < 0",{startFromLevel:n,"recipientLayers.length":e.length});var r=n;while(r<n+t.length){for(var o in t[r-n])e[r][o]=t[r-n][o];r++}return null}var he,ge,je,ye,Ne=W.ROOT_WIDTH/7,Ie=[{x:Ne,y:0},{x:0,y:.3*W.ROOT_HEIGHT},{x:0,y:.7*W.ROOT_HEIGHT},{x:Ne,y:W.ROOT_HEIGHT},{x:.3*(W.ROOT_WIDTH-2*Ne)+Ne,y:1.1*W.ROOT_HEIGHT},{x:.6*(W.ROOT_WIDTH-2*Ne)+Ne,y:1.1*W.ROOT_HEIGHT},{x:W.ROOT_WIDTH-2*Ne+Ne,y:W.ROOT_HEIGHT},{x:W.ROOT_WIDTH,y:.7*W.ROOT_HEIGHT},{x:W.ROOT_WIDTH,y:.3*W.ROOT_HEIGHT},{x:W.ROOT_WIDTH-Ne,y:0},{x:W.ROOT_WIDTH-Ne-.3*(W.ROOT_WIDTH-2*Ne),y:-.1*W.ROOT_HEIGHT},{x:W.ROOT_WIDTH-Ne-.7*(W.ROOT_WIDTH-2*Ne),y:-.1*W.ROOT_HEIGHT}],xe={x:W.ROOT_WIDTH/2,y:W.ROOT_HEIGHT/2},Te={SET_SELECTED_NODE_ID:"SET_SELECTED_NODE_ID",SET_TREE:"SET_TREE",UPDATE_NODE_POSITION:"UPDATE_NODE_POSITION",REMOVE_NODE:"REMOVE_NODE"},Ee={handleMapNodeUpdate:"handleMapNodeUpdate"},De={namespaced:!0,state:function(){return{tree:null,nodeRecord:{},mapNodeLayers:[],selectedNodeId:null}},getters:{selectedNode:function(e){return e.selectedNodeId&&e.nodeRecord[e.selectedNodeId]?e.nodeRecord[e.selectedNodeId].node:null}},actions:Object(l["a"])({},Ee.handleMapNodeUpdate,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a,c,d,u,l,p,b,O,v,m,h,j,y,N,I,x,T,E,D,w,R,S,P;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,o=e.state,i=e.dispatch,a=o.nodeRecord[t.id],a){n.next=5;break}return k("UPDATE_NODE: Cannot find dbNode in dbNodeRecord",{"dbNode.id":t.id}),n.abrupt("return");case 5:if(c={id:a.node.id,parentID:a.parent?a.parent.id:null,name:a.node.title,children:a.node.children.map((function(e){return e.id})).sort(),position:a.node.position},d=t.children.filter((function(e){return!c.children.includes(e)})),u=c.children.filter((function(e){return!t.children.includes(e)})),!d.length){n.next=30;break}l=Object(f["a"])(d),n.prev=10,b=regeneratorRuntime.mark((function e(){var n,a,c,d,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=p.value,o.nodeRecord[n]&&(console.log("actions.handleDBUpdate: remove node for cut-and-paste",o.nodeRecord[n]),a={nodeID:n,returnError:null},r(Te.REMOVE_NODE,{nodeID:n,returnError:null}),a.returnError&&k("handleDBUpdate: cannot cut node",{err:a.returnError})),e.next=4,W.getNode(n);case 4:if(c=e.sent,console.log("actions.handleDBUpdate: add node for cut-and-paste",c),d=[c],c){e.next=11;break}return t.children=t.children.filter((function(e){return e!=n})),k("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 11:u=regeneratorRuntime.mark((function e(){var t,n,r,a,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=d.pop(),t){e.next=3;break}return e.abrupt("return","continue");case 3:if(n={id:t.id,title:t.name,position:t.position,children:[]},o.nodeRecord[t.parentID]){e.next=7;break}return k("Cannot find nodeID in nodeRecord",{nodeID:t.parentID}),e.abrupt("return",{v:{v:void 0}});case 7:o.nodeRecord[t.parentID].node.children=o.nodeRecord[t.parentID].node.children.filter((function(e){return e.id!=n.id})),o.nodeRecord[t.parentID].node.children.push(n),o.nodeRecord[n.id]={parent:o.nodeRecord[t.parentID].node,node:n},W.subscribeMapNodeChange(n.id,(function(e){return i(Ee.handleMapNodeUpdate,e)})),r=Object(f["a"])(t.children),e.prev=12,c=regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.value,e.next=3,W.getNode(n);case 3:if(r=e.sent,r){e.next=8;break}return t.children=t.children.filter((function(e){return e!=n})),k("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 8:d.push(r);case 9:case"end":return e.stop()}}),e)})),r.s();case 15:if((a=r.n()).done){e.next=22;break}return e.delegateYield(c(),"t0",17);case 17:if(u=e.t0,"continue"!==u){e.next=20;break}return e.abrupt("continue",20);case 20:e.next=15;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e["catch"](12),r.e(e.t1);case 27:return e.prev=27,r.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[12,24,27,30]])}));case 12:if(!d.length){e.next=21;break}return e.delegateYield(u(),"t0",14);case 14:if(l=e.t0,"continue"!==l){e.next=17;break}return e.abrupt("continue",12);case 17:if("object"!==Object(g["a"])(l)){e.next=19;break}return e.abrupt("return",l.v);case 19:e.next=12;break;case 21:case"end":return e.stop()}}),e)})),l.s();case 13:if((p=l.n()).done){n.next=22;break}return n.delegateYield(b(),"t0",15);case 15:if(O=n.t0,"continue"!==O){n.next=18;break}return n.abrupt("continue",20);case 18:if("object"!==Object(g["a"])(O)){n.next=20;break}return n.abrupt("return",O.v);case 20:n.next=13;break;case 22:n.next=27;break;case 24:n.prev=24,n.t1=n["catch"](10),l.e(n.t1);case 27:return n.prev=27,l.f(),n.finish(27);case 30:if(!u.length){n.next=55;break}v=Object(f["a"])(u),n.prev=32,v.s();case 34:if((m=v.n()).done){n.next=47;break}if(h=m.value,o.nodeRecord[h]&&o.nodeRecord[h].parent){n.next=38;break}return n.abrupt("continue",45);case 38:if(!o.nodeRecord[h]||o.nodeRecord[h].parent.id===t.id){n.next=40;break}return n.abrupt("continue",45);case 40:console.log("actions.handleDBUpdate: removing children",o.nodeRecord[h]),j={nodeID:h,returnError:null},r(Te.REMOVE_NODE,j),j.returnError&&k("actions.handleDBUpdate: cannot remove node",{err:j.returnError,id:h}),W.unsubscribeMapNodeChange(h);case 45:n.next=34;break;case 47:n.next=52;break;case 49:n.prev=49,n.t2=n["catch"](32),v.e(n.t2);case 52:return n.prev=52,v.f(),n.finish(52);case 55:if(!u.length&&!d.length){n.next=61;break}if(y=ve(o.tree,Ie,xe),N=Object(s["a"])(y,2),I=N[0],x=N[1],!x){n.next=60;break}return k("Cannot treeToMapNodeLayers",{err:x}),n.abrupt("return");case 60:o.mapNodeLayers=I;case 61:if(C(t.position.x)===C(c.position.x)&&C(t.position.y)===C(c.position.y)){n.next=69;break}if(T=Oe("denormalize",t.position,a.parent?a.parent.id:null,o.mapNodeLayers),E=Object(s["a"])(T,1),D=E[0],c.parentID!=t.parentID){n.next=69;break}if(w={nodeId:t.id,newCenter:D,returnError:null},r(Te.UPDATE_NODE_POSITION,w),null===w.returnError){n.next=69;break}return k("actions.handleDBUpdate: cannot update node's position",{dbNode:t,err:w.returnError}),n.abrupt("return");case 69:if(c.name===t.name){n.next=75;break}if(a.node.title=t.name,R=_(c.id,o.mapNodeLayers),S=Object(s["a"])(R,1),P=S[0],P){n.next=74;break}return n.abrupt("return");case 74:P.title=t.name;case 75:case"end":return n.stop()}}),n,null,[[10,24,27,30],[32,49,52,55]])})))()})),mutations:(V={},Object(l["a"])(V,Te.REMOVE_NODE,(function(e,t){if(null!==e.tree)if(e.nodeRecord[t.nodeID]){var n=e.nodeRecord[t.nodeID].parent;if(n){var r=[t.nodeID];while(r.length){var o=r.pop();o&&(r.push.apply(r,Object(d["a"])(e.nodeRecord[o].node.children.map((function(e){return e.id})))),delete e.nodeRecord[o])}var i=n.children.findIndex((function(e){return e.id===t.nodeID}));n.children.splice(i,1)}else t.returnError=y("REMOVE_NODE: cannot remove root node",{nodeId:t.nodeID})}else t.returnError=y("REMOVE_NODE: cannot find nodeId in nodeRecord",{nodeID:t.nodeID,nodeRecord:e.nodeRecord});else t.returnError=y("state.tree === null",{})})),Object(l["a"])(V,Te.SET_SELECTED_NODE_ID,(function(e,t){e.selectedNodeId=t})),Object(l["a"])(V,Te.SET_TREE,(function(e,t){if(null==t)return e.tree=null,e.nodeRecord={},void(e.mapNodeLayers=[]);e.tree=t,e.nodeRecord=ae(t);var n=ve(t,Ie,xe),r=Object(s["a"])(n,2),o=r[0],i=r[1];null!=o&&null==i?e.mapNodeLayers=o:console.error(i)})),Object(l["a"])(V,Te.UPDATE_NODE_POSITION,(function(e,t){var n=e.nodeRecord[t.nodeId].parent;if(null!==n){var r=_(n.id,e.mapNodeLayers),o=Object(s["a"])(r,1),i=o[0];if(!i)return void(t.returnError=y("UPDATE_NODE_POSITION: cannot find parent mapNode",{"parent.id":n.id,"state.mapNodeLayers":e.mapNodeLayers}));if(!Z(t.newCenter,i.border))return void(t.returnError=y("!isInside",{newCenter:t.newCenter,"parentMapNode.border":i.border}))}t.returnError=L(e,{nodeId:t.nodeId,position:t.newCenter})})),V)},Ce={ADD_ZOOM:"ADD_ZOOM",ADD_PAN:"ADD_PAN",SET_PAN:"SET_PAN",SET_ZOOM_CENTER:"SET_ZOOM_CENTER"},we=Object(T["debounce"])((function(e,t){e.debouncedZoom=t}),100),ke=Object(T["debounce"])((function(e,t){e.debouncedPan=t}),100),Re=.002,_e=1,Se={namespaced:!0,state:{zoom:1,pan:{x:0,y:0},debouncedZoom:1,debouncedPan:{x:0,y:0},zoomCenter:{x:0,y:0}},mutations:(he={},Object(l["a"])(he,Ce.SET_ZOOM_CENTER,(function(e,t){e.zoomCenter=t})),Object(l["a"])(he,Ce.ADD_ZOOM,(function(e,t){var n=e.zoom*Math.pow(2,t*Re);n<.5||(e.zoom=n,we(e,e.zoom))})),Object(l["a"])(he,Ce.ADD_PAN,(function(e,t){e.pan=de({from:{x:0,y:0},to:e.pan},ue(t,_e)).to,ke(e,e.pan)})),Object(l["a"])(he,Ce.SET_PAN,(function(e,t){e.pan=t,ke(e,e.pan)})),he)},Pe={SET_USER:"SET_USER"},Me={signIn:"signIn",signOut:"signOut"},Le={namespaced:!0,state:{user:null},mutations:Object(l["a"])({},Pe.SET_USER,(function(e,t){e.user=t})),actions:(ge={},Object(l["a"])(ge,Me.signIn,(function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.commit,t.next=3,A["a"].auth().signInWithPopup(new A["a"].auth.GoogleAuthProvider);case 3:case"end":return t.stop()}}),t)})))()})),Object(l["a"])(ge,Me.signOut,(function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.next=3,A["a"].auth().signOut();case 3:n(Pe.SET_USER,null);case 4:case"end":return t.stop()}}),t)})))()})),ge)},Ae={ADD_CUT_PASTE:"ADD_CUT_PASTE",ADD_CREATE:"ADD_CREATE",ADD_REMOVE:"ADD_REMOVE",ADD_POSITION_CHANGE:"ADD_POSITION_CHANGE"};(function(e){e["CUT_PASTE"]="CUT_PASTE",e["CREATE"]="CREATE",e["REMOVE"]="REMOVE",e["POSITION_CHANGE"]="POSITION_CHANGE"})(ye||(ye={}));var Be,He,ze={CUT_PASTE:"CUT_PASTE",CREATE:"CREATE",REMOVE:"REMOVE",POSITION_CHANGE:"POSITION_CHANGE"},Ue={namespaced:!0,state:{stableChangeList:{},localChangeList:{}},mutations:(je={},Object(l["a"])(je,Ae.ADD_CUT_PASTE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][ze.CREATE]?e.localChangeList[t.nodeID][ze.CREATE].parentID=t.newParentID:e.localChangeList[t.nodeID][ze.CUT_PASTE]=t})),Object(l["a"])(je,Ae.ADD_CREATE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][ze.CREATE]=t})),Object(l["a"])(je,Ae.ADD_REMOVE,(function(e,t){e.localChangeList[t.nodeID]={},e.localChangeList[t.nodeID][ze.REMOVE]=t})),Object(l["a"])(je,Ae.ADD_POSITION_CHANGE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={});var n=t.oldPosition;e.localChangeList[t.nodeID][ze.POSITION_CHANGE]&&(n=e.localChangeList[t.nodeID][ze.POSITION_CHANGE].oldPosition),e.localChangeList[t.nodeID][ze.POSITION_CHANGE]={nodeID:t.nodeID,oldPosition:n,newPosition:t.newPosition}})),je),actions:{}},Ve={SET_CONTENTS:"SET_CONTENTS",SET_USER_COMMENTS:"SET_USER_COMMENTS",SET_NODE_CONTENT:"SET_NODE_CONTENT",SET_NODE_COMMENT:"SET_NODE_COMMENT"},Ge={getNodeContent:"getNodeContent",setNodeContent:"setNodeContent",setNodeComment:"setNodeComment"},Fe={nodeID:"",content:""};function qe(e,t){e[t]||(e[t]=w(Fe),e[t].nodeID=t)}var We={nodeID:"",comment:""};function Ye(e,t){e[t]||(e[t]=w(We),e[t].nodeID=t)}var Xe,Ke,Ze={namespaced:!0,state:{nodeContents:{},userNodeComments:{}},actions:(Be={},Object(l["a"])(Be,Ge.getNodeContent,(function(e,t){var n=e.state;return n.nodeContents[t]})),Object(l["a"])(Be,Ge.setNodeComment,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,i=e.rootState,i.user.user&&!i.user.user.isAnonymous){n.next=3;break}return n.abrupt("return",null);case 3:return n.next=5,W.debouncedUpdate((r={},Object(l["a"])(r,"user_data/".concat(i.user.user.uid,"/comment/").concat(t.nodeID,"/nodeID"),t.nodeID),Object(l["a"])(r,"user_data/".concat(i.user.user.uid,"/comment/").concat(t.nodeID,"/comment"),t.comment),r));case 5:if(a=n.sent,!a){n.next=8;break}return n.abrupt("return",a);case 8:return o("".concat(Ve.SET_NODE_COMMENT),t),n.abrupt("return",null);case 10:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Be,Ge.setNodeContent,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,e.state,o("".concat(Ve.SET_NODE_CONTENT),t),n.next=4,W.debouncedUpdate((r={},Object(l["a"])(r,"node_content/".concat(t.nodeID,"/nodeID"),t.nodeID),Object(l["a"])(r,"node_content/".concat(t.nodeID,"/content"),t.content),r));case 4:if(i=n.sent,!i){n.next=7;break}return n.abrupt("return",i);case 7:return n.abrupt("return",null);case 8:case"end":return n.stop()}}),n)})))()})),Be),mutations:(He={},Object(l["a"])(He,Ve.SET_CONTENTS,(function(e,t){e.nodeContents=t})),Object(l["a"])(He,Ve.SET_USER_COMMENTS,(function(e,t){e.userNodeComments=t})),Object(l["a"])(He,Ve.SET_NODE_CONTENT,(function(e,t){qe(e.nodeContents,t.nodeID),e.nodeContents[t.nodeID].content=t.content})),Object(l["a"])(He,Ve.SET_NODE_COMMENT,(function(e,t){Ye(e.userNodeComments,t.nodeID),e.userNodeComments[t.nodeID].comment=t.comment})),He)},Je=(n("ac1f"),n("841c"),n("5bd5")),$e=new Je["Worker"]({language:"en",tokenize:"forward"});function Qe(e,t){$e.add(e,t)}function et(e){return $e.search(e)}function tt(e){return nt.apply(this,arguments)}function nt(){return nt=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,c,d,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,W.getMap(t);case 2:if(n=e.sent,r=Object(s["a"])(n,2),o=r[0],i=r[1],(null===o||i)&&k("fetchMap: cannot api.getMap(user)",{err:i}),a=U(o),c=Object(s["a"])(a,2),d=c[0],u=c[1],null===u){e.next=10;break}return e.abrupt("return",[null,u]);case 10:for(l in Ot.commit("tree/".concat(Te.SET_TREE),d),o)W.subscribeMapNodeChange(l,(function(e){return Ot.dispatch("tree/".concat(Ee.handleMapNodeUpdate),e)}));case 12:case"end":return e.stop()}}),e)}))),nt.apply(this,arguments)}function rt(e){return ot.apply(this,arguments)}function ot(){return ot=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,W.getPins(t);case 2:if(n=e.sent,r=Object(s["a"])(n,2),o=r[0],i=r[1],(null==o||i)&&console.error(i),!t||o){e.next=15;break}return e.next=10,W.getPins(null);case 10:a=e.sent,c=Object(s["a"])(a,2),o=c[0],i=c[1],(null==o||i)&&(console.error(i),o={});case 15:Ot.commit("pin/".concat(b.SET_PINS),o);case 16:case"end":return e.stop()}}),e)}))),ot.apply(this,arguments)}function it(e){return at.apply(this,arguments)}function at(){return at=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,c,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,W.getPreconditions(t);case 2:if(n=e.sent,r=Object(s["a"])(n,2),o=r[0],i=r[1],(null==o||i)&&(console.error(i),o={}),!t||o){e.next=15;break}return e.next=10,W.getPreconditions(null);case 10:a=e.sent,c=Object(s["a"])(a,2),o=c[0],i=c[1],(null==o||i)&&(console.error(i),o={});case 15:for(d in o)W.subscribePreconditionNodeChange(d,(function(e,t){return Ot.commit("precondition/".concat(m.UPDATE_PRECONDITIONS),{nodeID:e,preconditionIDs:t})}));Ot.commit("precondition/".concat(m.SET_PRECONDITIONS),o);case 17:case"end":return e.stop()}}),e)}))),at.apply(this,arguments)}function ct(e){return dt.apply(this,arguments)}function dt(){return dt=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,i,a,c,d,u,l,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,W.getNodeContent();case 2:if(n=e.sent,r=Object(s["a"])(n,2),o=r[0],i=r[1],null!=o&&!i){e.next=9;break}return k("fetchNodeContents error",{err:i}),e.abrupt("return");case 9:for(c in a={},o)a[c]={nodeID:o[c].nodeID,content:o[c].content},W.subscribeNodeContentChange(a[c].nodeID,(function(e){Qe(e.nodeID,e.content),Ot.commit("nodeContent/".concat(Ve.SET_NODE_CONTENT),e)}));if(Ot.commit("nodeContent/".concat(Ve.SET_CONTENTS),a),!t){e.next=25;break}return e.next=15,W.getUserComments(t);case 15:if(d=e.sent,u=Object(s["a"])(d,2),l=u[0],p=u[1],!p){e.next=22;break}return k("fetch userComments error",{err:p,user:t}),e.abrupt("return");case 22:if(null!==l){e.next=24;break}return e.abrupt("return");case 24:Ot.commit("nodeContent/".concat(Ve.SET_USER_COMMENTS),l);case 25:case"end":return e.stop()}}),e)}))),dt.apply(this,arguments)}function ut(e){return lt.apply(this,arguments)}function lt(){return lt=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,tt(t);case 2:return e.next=4,rt(t);case 4:return e.next=6,it(t);case 6:return e.next=8,ct(t);case 8:case"end":return e.stop()}}),e)}))),lt.apply(this,arguments)}var st={init:"init",updateNodePosition:"updateNodePosition",createNode:"createNode",cutPasteNode:"cutPasteNode",removeNode:"removeNode",setEditMode:"setEditMode",subscribeDBChange:"subscribeDBChange",confirmSignInPopup:"confirmSignInPopup"},pt={SET_EDIT_MODE:"SET_EDIT_MODE",SET_SUBSCRIBED_NODE_IDS:"SET_SUBSCRIBED_NODE_IDS"},ft=Object(T["debounce"])((function(e,t,n,r){var o=Oe("normalize",t,n,r),i=Object(s["a"])(o,1),a=i[0];W.update(Object(l["a"])({},"map/".concat(e,"/position"),a))}),200),bt=Symbol(),Ot=Object(p["a"])({state:{editModeOn:!1,subscribedNodeIDs:[]},mutations:(Xe={},Object(l["a"])(Xe,pt.SET_EDIT_MODE,(function(e,t){e.editModeOn=t})),Object(l["a"])(Xe,pt.SET_SUBSCRIBED_NODE_IDS,(function(e,t){e.subscribedNodeIDs=t})),Xe),actions:(Ke={},Object(l["a"])(Ke,st.confirmSignInPopup,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.dispatch,e.state,t.require({message:"Please authorize to change node contents",header:"SignIn",acceptLabel:"Ok, Sign In",rejectLabel:"No, thanks, just watching",accept:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r("user/".concat(Me.signIn));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),reject:function(){}});case 2:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Ke,st.setEditMode,(function(e,t){var n=e.commit,r=e.state;n(pt.SET_EDIT_MODE,t),t||(r.subscribedNodeIDs.forEach((function(e){return W.unsubscribeDBChange("map/"+e)})),n(pt.SET_SUBSCRIBED_NODE_IDS,[]))})),Object(l["a"])(Ke,st.init,(function(e){return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.commit,W.initFirebase(),A["a"].auth().onAuthStateChanged((function(e){e&&!e.isAnonymous?(n("user/".concat(Pe.SET_USER),e),ut(e)):(n("user/".concat(Pe.SET_USER),null),ut(null))}));case 3:case"end":return t.stop()}}),t)})))()})),Object(l["a"])(Ke,st.createNode,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a,c,d,u,p,f,b,O,v,m,h,g,j,y,N,I,x;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,i=e.state,a=i.tree.nodeRecord[t.parentID].node,c=M(a,i.tree.mapNodeLayers,!0),d=Object(s["a"])(c,3),u=d[0],p=d[1],f=d[2],null===f){n.next=6;break}return k("Cannot create new center",{err:f,parent:a,"state.tree.mapNodeLayers":i.tree.mapNodeLayers}),n.abrupt("return");case 6:if(b=Oe("normalize",u,t.parentID,i.tree.mapNodeLayers),O=Object(s["a"])(b,2),v=O[0],m=O[1],!m){n.next=10;break}return k("createNode: cannot create new center",{err:m,parent:a,"state.tree.mapNodeLayers":i.tree.mapNodeLayers}),n.abrupt("return");case 10:return h=P(t.title,v),g={id:h.id,parentID:t.parentID,name:t.title,children:[],position:v},j=W.generateKey(),r={},Object(l["a"])(r,"map/".concat(g.id),g),Object(l["a"])(r,"map/".concat(g.parentID,"/children/").concat(j),g.id),y=r,p&&(N=Oe("normalize",p.position,t.parentID,i.tree.mapNodeLayers),I=Object(s["a"])(N,1),x=I[0],y["map/".concat(p.id,"/position")]=x),n.next=17,W.update(y);case 17:o("history/".concat(Ae.ADD_CREATE),{nodeID:h.id,parentID:t.parentID});case 18:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Ke,st.cutPasteNode,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a,c,d,u,p,f,b,O,v,m,h,g,j,y,N,I,x;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,i=e.state,a=i.tree.nodeRecord[t.nodeID].parent,c=i.tree.nodeRecord[t.parentID].node,d=M(c,i.tree.mapNodeLayers,!0),u=Object(s["a"])(d,3),p=u[0],f=u[1],b=u[2],!b){n.next=7;break}return k("cutPasteNode: cannot getNewNodeCenter",{err:b}),n.abrupt("return");case 7:if(O=Oe("normalize",p,t.parentID,i.tree.mapNodeLayers),v=Object(s["a"])(O,2),m=v[0],h=v[1],!h){n.next=11;break}return k("cutPasteNode: cannot create new center",{err:h,parent:parent,"state.tree.mapNodeLayers":i.tree.mapNodeLayers}),n.abrupt("return");case 11:return g=W.generateKey(),n.next=14,W.findKeyOfChild(a.id,t.nodeID);case 14:return j=n.sent,r={},Object(l["a"])(r,"map/".concat(t.nodeID,"/parentID"),c.id),Object(l["a"])(r,"map/".concat(a.id,"/children/").concat(j),null),Object(l["a"])(r,"map/".concat(c.id,"/children/").concat(g),t.nodeID),Object(l["a"])(r,"map/".concat(t.nodeID,"/position"),m),y=r,f&&(N=Oe("normalize",f.position,t.parentID,i.tree.mapNodeLayers),I=Object(s["a"])(N,1),x=I[0],y["map/".concat(f.id,"/position")]=x),n.next=19,W.update(y);case 19:o("history/".concat(Ae.ADD_CUT_PASTE),{nodeID:t.nodeID,parentID:t.parentID});case 20:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Ke,st.removeNode,(function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,o,i,a,c,u,s,p,f,b,O,v;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,i=e.state,a=i.tree.nodeRecord[t].parent,a){n.next=4;break}return n.abrupt("return");case 4:return c=a.id,n.next=7,W.getNode(t);case 7:u=n.sent,s=u.children,p={};case 10:if(!(s.length>0)){n.next=18;break}if(f=s.pop(),i.tree.nodeRecord[f]&&i.tree.nodeRecord[f].node&&i.tree.nodeRecord[f].parent){n.next=14;break}return n.abrupt("continue",10);case 14:p[f]={id:f,parentID:i.tree.nodeRecord[f].parent.id,name:i.tree.nodeRecord[f].node.title,children:i.tree.nodeRecord[f].node.children.map((function(e){return e.id})),position:i.tree.nodeRecord[f].node.position},s.push.apply(s,Object(d["a"])(i.tree.nodeRecord[f].node.children.map((function(e){return e.id})))),n.next=10;break;case 18:return n.next=20,W.findKeyOfChild(a.id,t);case 20:return b=n.sent,n.next=23,W.update((r={},Object(l["a"])(r,"trash/".concat(t),u),Object(l["a"])(r,"map/".concat(a.id,"/children/").concat(b),null),Object(l["a"])(r,"map/".concat(t),null),r));case 23:for(v in O={},p)O["trash/".concat(v)]=p[v],O["map/".concat(v)]=null;return n.next=27,W.update(O);case 27:o("history/".concat(Ae.ADD_REMOVE),{parentNodeID:c,nodeID:t});case 28:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Ke,st.updateNodePosition,(function(e,t){var n=e.commit,r=e.state;if(r.editModeOn){var o=_(t.nodeId,r.tree.mapNodeLayers),i=Object(s["a"])(o,1),a=i[0];if(!a)return y("UPDATE_NODE_POSITION: cannot find mapNode",{"v.nodeId":t.nodeId,"state.mapNodeLayers":r.tree.mapNodeLayers});var c=de({from:{x:0,y:0},to:a.center},{from:{x:0,y:0},to:t.delta}).to,d={nodeId:t.nodeId,newCenter:c,returnError:null};n("tree/".concat(Te.UPDATE_NODE_POSITION),d),null===d.returnError&&(n("history/".concat(Ae.ADD_POSITION_CHANGE),{nodeID:t.nodeId,oldPosition:a.center,newPosition:c}),ft(t.nodeId,c,r.tree.nodeRecord[t.nodeId].parent.id,r.tree.mapNodeLayers))}})),Ke),modules:{pin:v,precondition:h,tree:De,user:Le,zoomPan:Se,history:Ue,nodeContent:Ze}});function vt(){return Object(p["b"])(bt)}var mt=Object(r["k"])({setup:function(){var e=vt();e.dispatch(st.init)}});mt.render=o;var ht=mt,gt=n("9319"),jt=n("b24b"),yt=n("485c"),Nt=n("6c02"),It=Object(r["i"])(" This section is just for test/emulator cases for now "),xt=Object(r["j"])("input",{id:"email"},null,-1),Tt=Object(r["j"])("input",{id:"password"},null,-1);function Et(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])(r["a"],null,[It,xt,Tt,Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return e.login&&e.login.apply(e,arguments)})},"login")],64)}var Dt=Object(r["k"])({name:"PasswordLogin",setup:function(){vt();return{login:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=document.getElementById("email"),n=document.getElementById("password"),e.next=4,A["a"].auth().signInWithEmailAndPassword(t.value,n.value);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}}});Dt.render=Et;var Ct=Dt;function wt(e,t,n,o,i,a){var c=Object(r["C"])("ConfirmDialog"),d=Object(r["C"])("Toast"),u=Object(r["C"])("NodeContent"),l=Object(r["C"])("Menu"),s=Object(r["C"])("Map");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])(c),Object(r["j"])(d,{position:"bottom-left"}),Object(r["j"])(u,{show:!e.editModeOn&&!!e.selectedNodeId},null,8,["show"]),Object(r["j"])(l,{clickedTitleId:e.clickedTitleId,onSelectPreconditionIsOn:e.setSelectPreconditionON,onSelectPreconditionIsOff:e.setSelectPreconditionOFF},null,8,["clickedTitleId","onSelectPreconditionIsOn","onSelectPreconditionIsOff"]),Object(r["j"])(s,{layers:e.visibleZoomedPanedLayers,viewBox:e.viewBox,selectedNodeId:e.selectedNodeId,selectedNodePreconditionIds:e.selectedNodePreconditionIds,"pin-nodes":e.pinNodes,onTitleDragging:e.nodeDragging,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave,onDraggingBackground:e.mapDragging,onWheel:e.zoom},null,8,["layers","viewBox","selectedNodeId","selectedNodePreconditionIds","pin-nodes","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave","onDraggingBackground","onWheel"])],64)}function kt(e,t,n,o,i,a){var c=Object(r["C"])("MapLayer"),d=Object(r["C"])("PreconditionLayer"),u=Object(r["C"])("PinLayer");return Object(r["u"])(),Object(r["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:e.viewBox,id:e.mapID,style:{"touch-action":"none"}},[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.layers,(function(t,n){return Object(r["u"])(),Object(r["g"])(c,{key:n,"map-nodes":t,"border-color":e.borderColor(n),"font-color":e.fontColor(n),"font-size":e.fontSize(n),"font-opacity":e.fontOpacity(n),selectedNodeId:e.selectedNodeId,selectedNodePreconditionIds:e.selectedNodePreconditionIds,"map-id":e.mapID,onTitleDragging:e.draggingNode,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["map-nodes","border-color","font-color","font-size","font-opacity","selectedNodeId","selectedNodePreconditionIds","map-id","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave"])})),128)),Object(r["j"])(d,{selectedNodeId:e.selectedNodeId,visibleTitleIds:e.visibleTitleIds,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["selectedNodeId","visibleTitleIds","onTitleClick","onTitleOver","onTitleLeave"]),Object(r["j"])(u,{pinNodes:e.pinNodes,selectedNodeId:e.selectedNodeId,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["pinNodes","selectedNodeId","onTitleClick","onTitleOver","onTitleLeave"])],8,["viewBox","id"])}n("4057");var Rt=Object(r["P"])("data-v-21e6be06"),_t=Rt((function(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])(r["a"],null,[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t,n){return Object(r["u"])(),Object(r["g"])("polygon",{key:n,stroke:e.borderColor,fill:e.polygonFill(e.selectedNodeId,t.id,e.selectedNodePreconditionIds),"fill-opacity":e.polygonFillOpacity(e.selectedNodeId,t.id,e.selectedNodePreconditionIds),"stroke-width":"2",points:e.polygonToPath(t.border),"pointer-events":"none"},null,8,["stroke","fill","fill-opacity","points"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t){var n,o;return Object(r["u"])(),Object(r["g"])("text",{id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,"font-family":"Roboto","font-size":e.fontSize,"font-weight":e.selectedNodeId&&e.selectedNodeId==t.id?"bold":"normal",fill:e.selectedNodeId&&e.selectedNodeId==t.id||(null===(n=e.selectedNodePreconditionIds)||void 0===n?void 0:n.length)>0&&-1!=(null===(o=e.selectedNodePreconditionIds)||void 0===o?void 0:o.indexOf(t.id))?"#ffa500":e.fontColor,"fill-opacity":e.fontOpacity,class:"text"},[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.splitLines(t.title,20),(function(n,o){return Object(r["u"])(),Object(r["g"])("tspan",{key:o,x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y+o*e.fontSize:0,"alignment-baseline":"hanging"},Object(r["F"])(n),9,["x","y"])})),128))],8,["id","font-size","font-weight","fill","fill-opacity"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t){return Object(r["u"])(),Object(r["g"])("rect",{key:t.id,x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y:0,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,fill:"transparent","stroke-width":"0",onMouseover:function(n){return e.titleOver(t.id)},onMouseleave:function(n){return e.titleLeave(t.id)},onClick:function(n){return e.titleClick(t.id)},onMousedown:function(n){return e.titleMouseDown(t.id)},stroke:"pink",cursor:"pointer","pointer-events":"fill"},null,40,["x","y","width","height","onMouseover","onMouseleave","onClick","onMousedown"])})),128))],64)})),St=function(e,t,n){n.nodeId&&(n.dragStart=!0,e("title-dragging",{nodeId:n.nodeId,delta:{x:t.movementX,y:t.movementY}}))},Pt=function(e,t){t.nodeId&&(t.dragStart&&e("title-drop",{id:t.nodeId}),t.dragStart=!1,t.nodeId=null)},Mt=function(e){var t={};for(var n in e){var r=e[n];t[r.id]={position:r.center,bbox:{width:0,height:0}}}return t},Lt=function(e,t,n,o){Object(r["p"])((function(){for(var r in o)delete o[r];for(var i in n){var a=n[i],c=document.getElementById("".concat(e).concat(a.id));null!=c&&("center"==t?o[a.id]={position:{x:a.center.x-c.getBoundingClientRect().width/2,y:a.center.y-c.getBoundingClientRect().height/2},bbox:{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}}:"left"==t&&(o[a.id]={position:{x:a.center.x-c.getBoundingClientRect().width,y:a.center.y-c.getBoundingClientRect().height/2},bbox:{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}}))}}))},At=function(e,t,n){var o=Object(r["z"])(Mt(n.value));return Object(r["K"])(n,(function(n){return Lt(e,t,n,o.value)}),{immediate:!0}),o};n("1276");function Bt(e,t){if(t<=0)return[];if(""==e)return[];var n=e.split(" "),r=[],o=[];while(n.length)if(o.join(" ").length>t){var i=[];o.length>1&&i.push(o.pop()),r.push(o.join(" ")),o=i}else o.push(n.shift());if(o.join(" ").length>t){var a=[];o.length>1&&a.push(o.pop()),r.push(o.join(" ")),o=a}return o.length&&r.push(o.join(" ")),r}var Ht="title_",zt=Object(r["k"])({name:"MapLayer",emits:["title-over","title-leave","title-click","title-drop","title-dragging"],props:{mapId:{type:String,required:!0},mapNodes:{type:Object,required:!0},borderColor:{type:String,required:!0},fontSize:{type:Number,required:!0},fontColor:{type:String,required:!0},fontOpacity:{type:Number,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0},selectedNodePreconditionIds:Object},setup:function(e,t){var n=Object(r["G"])(e,"mapNodes"),o=At(Ht,"center",n),i={nodeId:null,dragStart:!1},a=function(e){return St(t.emit,e,i)},c=function(){return Pt(t.emit,i)};return Object(r["s"])((function(){var t=document.getElementById(e.mapId);t?(t.addEventListener("mousemove",a),t.addEventListener("mouseup",c)):k("MapLayer.vue: cannot find map id for event listener",{})})),Object(r["t"])((function(){var t=document.getElementById(e.mapId);t?(t.removeEventListener("mousemove",a),t.removeEventListener("mouseup",c)):k("MapLayer.vue: cannot find map id for event listener",{})})),{TITLE_PREFIX:Ht,titleBox:o,titleClick:function(e){t.emit("title-click",{id:e})},titleOver:function(e){t.emit("title-over",{id:e})},titleLeave:function(e){t.emit("title-leave",{id:e})},titleMouseDown:function(e){i.nodeId=e,i.dragStart=!1}}},methods:{splitLines:Bt,polygonToPath:ie,polygonFill:re,polygonFillOpacity:oe}});n("8794");zt.render=_t,zt.__scopeId="data-v-21e6be06";var Ut=zt,Vt={on:!1},Gt=function(){Vt.on=!0},Ft=function(){Vt.on=!1},qt=function(e,t){Vt.on&&e("dragging-background",t)},Wt={mouseDown:Gt,mouseUp:Ft,mouseMove:qt};function Yt(e,t,n,o,i,a){var c=Object(r["C"])("PinMarker"),d=Object(r["C"])("SVGTextBox");return Object(r["u"])(),Object(r["g"])(r["a"],null,[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.visiblePinNodes,(function(e){return Object(r["u"])(),Object(r["g"])(c,{key:e.id,x:e.center.x,y:e.center.y,color:"pink"},null,8,["x","y"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.visiblePinNodes,(function(t){return Object(r["u"])(),Object(r["g"])(d,{text:t.title,id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,useLineBreak:!0,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,"line-height":8,"max-char-per-line":10,"font-family":"Roboto","font-size":8,"font-weight":"normal",color:"pink"},null,8,["text","id","x","y"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.pinNodes,(function(t){return Object(r["u"])(),Object(r["g"])("rect",{key:t.id,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,cursor:"pointer",fill:"transparent",onClick:function(n){return e.titleBoxClick(t.id)},onMouseover:function(n){return e.titleOver(t.id)},onMouseleave:function(n){return e.titleLeave(t.id)},"stroke-width":"0",stroke:"pink"},null,40,["x","y","width","height","onClick","onMouseover","onMouseleave"])})),128))],64)}function Xt(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])("g",{transform:"translate(".concat(e.x-e.WIDTH/2," ").concat(e.y-e.HEIGHT,") scale(0.05 0.05)")},[Object(r["j"])("path",{fill:"".concat(e.color),d:"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n        C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n        c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z"},null,8,["fill"])],8,["transform"])}var Kt=18,Zt=26,Jt=Object(r["k"])({name:"PinMarker",props:{x:{type:Number,required:!0},y:{type:Number,required:!0},color:{type:String,required:!0}},setup:function(){return{WIDTH:Kt,HEIGHT:Zt}}});Jt.render=Xt;var $t=Jt,Qt=Object(r["P"])("data-v-78117b36"),en=Qt((function(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])("text",{id:e.id,"font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,fill:e.color,class:"text"},[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.lines,(function(t,n){return Object(r["u"])(),Object(r["g"])("tspan",{key:n,x:e.x,y:e.y>0?e.y+n*e.lineHeight:0,"alignment-baseline":"hanging"},Object(r["F"])(t),9,["x","y"])})),128))],8,["id","font-family","font-size","font-weight","fill"])})),tn=Object(r["k"])({name:"SVGTextBox",props:{id:{type:String,required:!0},useLineBreak:{type:Boolean,required:!0},text:{type:String,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},lineHeight:{type:Number,required:!0},maxCharPerLine:{type:Number,required:!0},fontFamily:{type:String,required:!0},fontSize:{type:Number,required:!0},fontWeight:{type:String,required:!0},color:{type:String,required:!0}},setup:function(e){var t=[];return t=e.useLineBreak?Bt(e.text,e.maxCharPerLine):[e.text],{lines:t}}});n("0659");tn.render=en,tn.__scopeId="data-v-78117b36";var nn=tn,rn="pin_title_",on=Object(r["k"])({name:"PinLayer",components:{SVGTextBox:nn,PinMarker:$t},emits:["title-click","title-over","title-leave"],props:{pinNodes:{type:Object,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0}},setup:function(e,t){var n=Object(r["e"])((function(){var t,n={},r=Object(f["a"])(e.pinNodes);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.id]=o}}catch(i){r.e(i)}finally{r.f()}return n})),o=Object(r["e"])((function(){var t,n={},r=Object(f["a"])(e.pinNodes);try{for(r.s();!(t=r.n()).done;){var o=t.value;o.id!=e.selectedNodeId&&(n[o.id]=o)}}catch(i){r.e(i)}finally{r.f()}return n})),i=At(rn,"left",n);return{TITLE_PREFIX:rn,PIN_MARKER_HEIGHT:Zt,PIN_MARKER_WIDTH:Kt,visiblePinNodes:o,titleBox:i,titleXY:Object(r["e"])((function(){var e={};for(var t in n.value){var r=n.value[t];e[r.id]={x:i.value[r.id]?i.value[r.id].position.x:0,y:i.value[r.id]?i.value[r.id].position.y:0}}return e})),titleBoxClick:function(e){t.emit("title-click",{id:e})},titleOver:function(e){t.emit("title-over",{id:e})},titleLeave:function(e){t.emit("title-leave",{id:e})}}}});on.render=Yt;var an=on,cn=Object(r["j"])("defs",null,[Object(r["j"])("marker",{id:"preconditionArrowHead",markerWidth:"6",markerHeight:"7",refX:"3",refY:"3.5",orient:"auto"},[Object(r["j"])("polygon",{fill:"#aae3b9",stroke:"#aae3b9",points:"0 0, 6 3.5, 0 7"})])],-1);function dn(e,t,n,o,i,a){var c=Object(r["C"])("PreconditionArrow"),d=Object(r["C"])("SVGTextBox");return Object(r["u"])(),Object(r["g"])(r["a"],null,[cn,(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.preconditions,(function(t){return Object(r["u"])(),Object(r["g"])(c,{key:t.id,markerId:"preconditionArrow",from:t.center,to:e.selectedNode.center,color:"#aae3b9"},null,8,["from","to"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.visibleTitleNodes,(function(t){return Object(r["u"])(),Object(r["g"])(d,{text:t.title,id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,useLineBreak:!0,x:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.x:0,y:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.y:0,"line-height":8,"max-char-per-line":10,"font-family":"Roboto","font-size":8,"font-weight":"normal",color:"#ffa500"},null,8,["text","id","x","y"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.visibleTitleNodes,(function(t){return Object(r["u"])(),Object(r["g"])("rect",{key:t.id,x:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.x:0,y:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.y:0,width:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].bbox.width:0,height:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].bbox.height:0,cursor:"pointer",fill:"transparent",onClick:function(n){return e.titleBoxClick(t.id)},onMouseover:function(n){return e.titleBoxOver(t.id)},onMouseleave:function(n){return e.titleBoxLeave(t.id)},"stroke-width":"0",stroke:"pink"},null,40,["x","y","width","height","onClick","onMouseover","onMouseleave"])})),128))],64)}function un(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])("line",{x1:e.from.x,y1:e.from.y,x2:e.to.x,y2:e.to.y,stroke:e.color,"stroke-width":"1","marker-end":"url(#preconditionArrowHead)"},null,8,["x1","y1","x2","y2","stroke"])}var ln=Object(r["k"])({name:"PreconditionArrow",props:{markerId:String,color:String,from:Object,to:Object}});ln.render=un;var sn=ln,pn=3;function fn(e,t,n){return{x:e.x*t+n.x,y:e.y*t+n.y}}function bn(e,t,n){return e.map((function(e){return fn(e,t,n)}))}function On(e,t,n,r,o,i){if(!e||0==e.length)return["",null];var a=null,c=n.width*n.height,d=e[0];while(Object.keys(d).length){for(var u in a="",d){var l=bn(d[u].border,r,o);if(Z(i,l)){a=u;break}}if(""===a){var p=1/0;for(var b in d){var O=fn(d[b].center,r,o),v=X({from:O,to:i});v<p&&(p=v,a=b)}}var m=$(bn(d[a].border,r,o));if(Math.floor(m)<=Math.floor(c/pn))return null==t[a].parent?[a,null]:[t[a].parent.id,null];if(d={},!t[a])return["",y("findCurrentNode: cannot find underCursorNodeId in nodeRecord",{maxIntersectNodeId:a,nodeRecord:t})];var h,g=Object(f["a"])(t[a].node.children);try{for(g.s();!(h=g.n()).done;){var j=h.value,N=_(j.id,e),I=Object(s["a"])(N,1),x=I[0];if(null==x)return["",y("filterNodesAndLayers: Cannot find node in layers",{"child.id":j.id,layers:e})];d[j.id]=x}}catch(T){g.e(T)}finally{g.f()}if(0===Object.keys(d).length)return[a,null]}return["",y("filterNodesAndLayers: unknown error",{})]}function vn(e,t,n){if(!e||!e.length)return[[],null];var r=[],o=_(n,e),i=Object(s["a"])(o,2),a=i[0],c=i[1];if(null==a||null==c)return[[],y("filterNodesAndLayers-currentNode: error in findMapNode",{currentNodeId:n,layers:e})];var d={};if(null==t[a.id].parent)d[a.id]=w(a);else{var u,l=Object(f["a"])(t[a.id].parent.children);try{for(l.s();!(u=l.n()).done;){var p=u.value,b=_(p.id,[e[c]]),O=Object(s["a"])(b,2),v=O[0],m=O[1];if(null==v||null===m)return[[],y("filterNodesAndLayers-upperLayer: error in findMapNode",{"child.id":p.id,level:c,layers:[e[c]]})];d[p.id]=w(v),d[p.id].title=""}}catch(Z){l.e(Z)}finally{l.f()}}r.push(d);var h={};for(var g in d){var j,N=Object(f["a"])(t[g].node.children);try{for(N.s();!(j=N.n()).done;){var I=j.value,x=_(I.id,[e[c+1]]),T=Object(s["a"])(x,2),E=T[0],D=T[1];if(null==E||null===D)return[[],y("filterNodesAndLayers-firstLayer: error in findMapNode",{"child.id":I.id,layers:[e[c+1]]})];g!=n?(h[I.id]=w(E),h[I.id].title=""):h[I.id]=w(E)}}catch(Z){N.e(Z)}finally{N.f()}}Object.keys(h).length>0&&r.push(h);var C,k={},R=Object(f["a"])(t[n].node.children);try{for(R.s();!(C=R.n()).done;){var S,P=C.value,M=Object(f["a"])(t[P.id].node.children);try{for(M.s();!(S=M.n()).done;){var L=S.value,A=_(L.id,[e[c+2]]),B=Object(s["a"])(A,2),H=B[0],z=B[1];if(null==H||null===z)return[[],y("filterNodesAndLayers-secondLayer: error in findMapNode",{"child.id":P.id,layers:[e[c+2]]})];k[L.id]=w(H)}}catch(Z){M.e(Z)}finally{M.f()}}}catch(Z){R.e(Z)}finally{R.f()}Object.keys(k).length>0&&r.push(k);var U={};for(var V in k){var G,F=Object(f["a"])(t[V].node.children);try{for(F.s();!(G=F.n()).done;){var q=G.value,W=_(q.id,[e[c+3]]),Y=Object(s["a"])(W,2),X=Y[0],K=Y[1];if(null==X||null===K)return[[],y("filterNodesAndLayers-thirdLayer:cannot findMapNode",{"child.id":q.id,level:c+3,layers:[e[c+3]]})];U[q.id]=w(X),U[q.id].title=""}}catch(Z){F.e(Z)}finally{F.f()}}return Object.keys(U).length>0&&r.push(U),[r,null]}function mn(e,t,n){if(!e||0==e.length)return[];var r,o=Object(f["a"])(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;for(var a in i){var c=i[a];c.center=fn(c.center,t,n),c.border=bn(c.border,t,n)}}}catch(d){o.e(d)}finally{o.f()}return e}var hn="precondition_title_",gn=Object(r["k"])({name:"PreconditionLayer",emits:["title-over","title-leave","title-click"],components:{SVGTextBox:nn,PreconditionArrow:sn},props:{selectedNodeId:String,visibleTitleIds:Object},setup:function(e,t){var n=vt(),o=n.state.zoomPan,i=Object(r["e"])((function(){if(e.selectedNodeId&&n.state.tree.mapNodeLayers){var t=_(e.selectedNodeId,n.state.tree.mapNodeLayers),r=Object(s["a"])(t,1),i=r[0];if(!i)return null;var a=w(i);return a.center=fn(a.center,o.zoom,o.pan),a}return null})),a=Object(r["z"])({}),c=Object(r["z"])({}),d=At(hn,"left",c);return Object(r["L"])((function(){var t;if(a.value={},c.value={},e.selectedNodeId&&n.state.precondition.preconditions[e.selectedNodeId]&&n.state.tree.mapNodeLayers){var r,d=w(S(n.state.precondition.preconditions[e.selectedNodeId],n.state.tree.mapNodeLayers)),u=Object(f["a"])(d);try{for(u.s();!(r=u.n()).done;){var l=r.value;l.center=fn(l.center,o.zoom,o.pan),a.value[l.id]=l}}catch(b){u.e(b)}finally{u.f()}}for(var s in a.value){var p;-1==(null===(p=e.visibleTitleIds)||void 0===p?void 0:p.indexOf(s))&&(c.value[s]=a.value[s])}e.selectedNodeId&&i.value&&n.state.tree.mapNodeLayers&&-1==(null===(t=e.visibleTitleIds)||void 0===t?void 0:t.indexOf(e.selectedNodeId))&&(c.value[e.selectedNodeId]=i.value)})),{TITLE_PREFIX:hn,selectedNode:i,preconditions:a,visibleTitleNodes:c,visibleTitleNodeBoxes:d,titleBoxClick:function(e){t.emit("title-click",{id:e})},titleBoxOver:function(e){t.emit("title-over",{id:e})},titleBoxLeave:function(e){t.emit("title-leave",{id:e})}}}});gn.render=dn;var jn=gn,yn="mapID",Nn=Object(r["k"])({name:"Map",emits:["title-dragging","title-click","title-over","title-leave","dragging-background","wheel"],components:{PreconditionLayer:jn,PinLayer:an,MapLayer:Ut},props:{viewBox:{type:String,required:!0},layers:Object,selectedNodeId:{type:String||null,validator:function(e){return"string"===typeof e||null===e},required:!0},selectedNodePreconditionIds:Object,pinNodes:Object},setup:function(e,t){return Object(r["s"])((function(){var e=document.getElementById(yn);if(e){e.addEventListener("mousedown",(function(e){Wt.mouseDown()})),e.addEventListener("mouseup",(function(e){Wt.mouseUp()})),e.addEventListener("mousemove",(function(e){Wt.mouseMove(t.emit,{from:{x:e.clientX-e.movementX,y:e.clientY-e.movementY},to:{x:e.clientX,y:e.clientY}})})),e.addEventListener("wheel",(function(e){t.emit("wheel",{delta:e.deltaY,center:{x:e.clientX,y:e.clientY}})}),{passive:!0});var n=1/0,r={x:1/0,y:1/0};e.addEventListener("touchstart",(function(e){Wt.mouseDown()}),{passive:!0}),e.addEventListener("touchend",(function(e){n=1/0,r.x=1/0,r.y=1/0,Wt.mouseUp()})),e.addEventListener("touchmove",(function(e){if(1===e.touches.length)r.x!=1/0&&r.y!=1/0&&Wt.mouseMove(t.emit,{from:r,to:{x:e.touches[0].clientX,y:e.touches[0].clientY}}),r.x=e.touches[0].clientX,r.y=e.touches[0].clientY;else if(2===e.touches.length){var o=0,i=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);n!==1/0&&(o=n-i),n=i,t.emit("wheel",{delta:o,center:{x:(e.touches[0].pageX-e.touches[1].pageX)/2,y:(e.touches[0].pageY-e.touches[1].pageY)/2}})}}),{passive:!0})}else k("Map.vue: cannot find map id for event listener",{})})),{visibleTitleIds:Object(r["e"])((function(){if(!e.layers)return[];var t,n=[],r=Object(f["a"])(e.layers);try{for(r.s();!(t=r.n()).done;){var o=t.value;for(var i in o)""!=o[i].title&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}return n})),draggingNode:function(e){t.emit("title-dragging",{id:e.nodeId,delta:e.delta})},titleClick:function(e){t.emit("title-click",{id:e.id})},titleOver:function(e){t.emit("title-over",{id:e.id})},titleLeave:function(e){t.emit("title-leave",{id:e.id})},mapID:yn,fontSize:function(t){var n=0,r={0:6,1:11,2:21,3:28};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),n},fontOpacity:function(t){var n=0,r={0:1,1:1,2:.2,3:1};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),n},fontColor:function(t){return e.layers.length>=4?"rgb(".concat(200-100*t,",").concat(200-100*t,",").concat(200-100*t,")"):3==e.layers.length?"rgb(".concat(200-100*(t+1),",").concat(200-100*(t+1),",").concat(200-100*(t+1),")"):""},borderColor:function(t){var n=0,r={0:240,1:200,2:100,3:90};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),"rgb(".concat(n,",").concat(n,",").concat(n,")")}}}});Nn.render=kt;var In=Nn,xn=Object(r["P"])("data-v-207de61e");Object(r["x"])("data-v-207de61e");var Tn={key:0,class:"wrapper"},En={class:"p-fluid"},Dn={class:"p-field p-grid"},Cn={class:"p-col-12"},wn={class:"p-col-12"},kn={class:"p-field p-grid"},Rn={class:"p-col-12 p-md-12"},_n=Object(r["j"])("h3",null,[Object(r["j"])("i",null,"based on")],-1);Object(r["v"])();var Sn=xn((function(e,t,n,o,i,a){var c=Object(r["C"])("TextArea"),d=Object(r["C"])("Markdown"),u=Object(r["C"])("SectionPreconditions");return Object(r["u"])(),Object(r["g"])(r["c"],{name:"slide"},{default:xn((function(){return[n.show&&o.selectedNode?(Object(r["u"])(),Object(r["g"])("div",Tn,[Object(r["j"])("div",En,[Object(r["j"])("div",Dn,[Object(r["j"])("div",Cn,[Object(r["j"])(c,{rows:"1",autoResize:!0,placeholder:"Node title",value:o.selectedNode.title,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.changeNodeTitle(e)})},null,8,["value"])]),Object(r["j"])("div",wn,[Object(r["j"])(d,{content:o.selectedNodeContent?o.selectedNodeContent.content:"",rows:20,onContentChanged:t[2]||(t[2]=function(e){return o.changeContent(e)})},null,8,["content"])])]),Object(r["j"])("div",kn,[Object(r["j"])("div",Rn,[Object(r["j"])(c,{id:"comment",placeholder:"Your notes (visible only to you)",autoResize:!0,rows:"2",value:o.comment,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.changeComment(e)}),onKeydown:o.checkAuthorized},null,8,["value","onKeydown"])])]),_n,o.selectedNodeContent?(Object(r["u"])(),Object(r["g"])(u,{key:0,"node-id":o.selectedNode.id},null,8,["node-id"])):Object(r["h"])("",!0)])])):Object(r["h"])("",!0)]})),_:1})})),Pn=n("4c62"),Mn={class:"p-col-12"},Ln={class:"p-grid"},An={class:"p-col-11"},Bn={class:"p-col-1"};function Hn(e,t,n,o,i,a){var c=Object(r["C"])("Button");return Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(o.preconditions,(function(e){return Object(r["u"])(),Object(r["g"])("div",{class:"p-grid",key:e.id},[Object(r["j"])("div",Mn,[Object(r["j"])("div",Ln,[Object(r["j"])("div",An,[Object(r["j"])("a",{href:e.id},Object(r["F"])(e.title),9,["href"])]),Object(r["j"])("div",Bn,[Object(r["j"])(c,{onClick:function(t){return o.remove(e.id)},icon:"pi pi-ban",class:"p-button-rounded p-button-help p-button-outlined"},null,8,["onClick"])])])])])})),128)}var zn=n("bb57"),Un={name:"Preconditions",props:{nodeId:String},components:{Button:zn["a"]},setup:function(e){var t=vt(),n=Object(r["z"])([]);return Object(r["L"])((function(){if(n.value=[],e.nodeId&&t.state.precondition.preconditions[e.nodeId]){var r,o=Object(f["a"])(t.state.precondition.preconditions[e.nodeId]);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.value.push(t.state.tree.nodeRecord[i].node)}}catch(a){o.e(a)}finally{o.f()}}})),{preconditions:n,remove:function(n){var r=t.state.precondition.preconditions[e.nodeId];r&&-1!=r.indexOf(n)&&W.savePreconditions(t.state.user.user,{nodeId:e.nodeId,preconditionIds:r.splice(r.indexOf(n),1)})}}}};Un.render=Hn;var Vn=Un,Gn=n("d725"),Fn=Object(r["P"])("data-v-92fe9ff2"),qn=Fn((function(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["N"])(Object(r["j"])("p",{innerHTML:o.renderedContent,onClick:t[1]||(t[1]=function(e){return o.setEditOn(!0)}),class:"renderedContent"},null,8,["innerHTML"]),[[r["J"],!o.editOn]]),Object(r["j"])("textarea",{class:"rawContent p-inputtextarea p-inputtext p-component p-inputtextarea-resizable",style:{display:"none"},ref:"txtarea",rows:n.rows,value:n.content,onInput:t[2]||(t[2]=function(e){return o.changeContent(e.target.value)}),onFocusout:t[3]||(t[3]=function(e){return o.setEditOn(!1)})},null,40,["rows","value"])],64)})),Wn=(n("466d"),n("498a"),n("d4cd")),Yn=n.n(Wn),Xn=n("a68e"),Kn=n("8102"),Zn=n("746a"),Jn=new Yn.a;Jn.use(Xn,{output:"html"}).use(Kn).use(Zn,"warning",{validate:function(e){return console.log("validate",e.trim(),"warning"==e.trim()),e.trim().match(/^warning$/)},render:function(e,t){var n=e[t].info.trim().match(/^warning(.*)$/);return 1===e[t].nesting?'<div style="background-color: #c6f68d; padding: 8px;">'+Jn.utils.escapeHtml(n[1])+"\n":"</div>\n"}});var $n={name:"Markdown",emits:["content-changed"],props:{content:{type:String,required:!0},rows:{type:Number,required:!0}},setup:function(e,t){var n=Object(r["e"])((function(){return Jn.render(e.content)})),o=Object(r["z"])(!1),i=Object(r["z"])(null);return{editOn:o,txtarea:i,setEditOn:function(e){o.value=e,e&&i.value&&(i.value.style.display="block",i.value.focus()),!e&&i.value&&(i.value.style.display="none")},renderedContent:n,changeContent:function(e){t.emit("content-changed",e)}}}};n("6e6f");$n.render=qn,$n.__scopeId="data-v-92fe9ff2";var Qn=$n,er={name:"NodeContent",components:{Markdown:Qn,TextArea:Pn["a"],SectionPreconditions:Vn},props:{show:{type:Boolean,required:!0}},setup:function(){var e=vt(),t=Object(Gn["b"])(),n=e.state.tree,o=Object(r["e"])((function(){return e.state.nodeContent.nodeContents})),i=Object(r["e"])((function(){return e.state.nodeContent.userNodeComments})),a=Object(r["e"])((function(){return n.selectedNodeId&&n.nodeRecord[n.selectedNodeId]?n.nodeRecord[n.selectedNodeId].node:null})),c=Object(r["e"])((function(){if(n.selectedNodeId&&o.value[n.selectedNodeId])return o.value[n.selectedNodeId];var e=w(Fe);return e.nodeID=n.selectedNodeId,e})),d=Object(r["e"])((function(){return n.selectedNodeId&&i.value[n.selectedNodeId]?i.value[n.selectedNodeId].comment:""}));return{selectedNode:a,selectedNodeContent:c,checkAuthorized:function(){var n=Object(u["a"])(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.state.user.user&&!e.state.user.user.isAnonymous){n.next=4;break}return n.next=3,e.dispatch("".concat(st.confirmSignInPopup),t);case 3:r.preventDefault();case 4:case"end":return n.stop()}}),n)})));function r(e){return n.apply(this,arguments)}return r}(),comment:d,changeNodeTitle:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a.value&&a.value.id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,W.debouncedUpdate(Object(l["a"])({},"map/".concat(a.value.id,"/name"),t));case 4:n=e.sent,n&&k(n.error.message,n.kv);case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),changeContent:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("nodeContent/".concat(Ge.setNodeContent),{nodeID:a.value.id,content:n});case 2:r=t.sent,r&&k(r,{});case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),changeComment:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("nodeContent/".concat(Ge.setNodeComment),{nodeID:a.value.id,comment:n});case 2:r=t.sent,r&&k(r,{});case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()}}};n("b658");er.render=Sn,er.__scopeId="data-v-207de61e";var tr=er,nr=n("9383"),rr=n("b3b6"),or={key:0},ir={class:"p-grid"},ar={class:"p-col"},cr={class:"p-col"},dr={class:"p-grid"},ur={key:0};function lr(e,t,n,o,i,a){var c=Object(r["C"])("TextSearch"),d=Object(r["C"])("Feedback"),u=Object(r["C"])("EditMode"),l=Object(r["C"])("CutPaste"),s=Object(r["C"])("AddNode"),p=Object(r["C"])("RemoveNode"),f=Object(r["C"])("AddPrecondition"),b=Object(r["C"])("PinNode"),O=Object(r["C"])("UnpinNode");return Object(r["u"])(),Object(r["g"])("div",{class:e.$style.wrapper},[o.email?(Object(r["u"])(),Object(r["g"])("div",or,[Object(r["j"])("div",ir,[Object(r["j"])("div",ar,[Object(r["j"])(c)]),Object(r["j"])("div",cr,Object(r["F"])(o.email),1)]),Object(r["j"])("div",dr,[Object(r["j"])(d),Object(r["j"])(u),o.editModeOn?(Object(r["u"])(),Object(r["g"])("span",ur,[o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(l,{key:0})):Object(r["h"])("",!0),Object(r["j"])(s),o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(p,{key:1})):Object(r["h"])("",!0)])):Object(r["h"])("",!0),o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(f,{key:1,clickedTitleId:n.clickedTitleId,onSelectPreconditionIsOn:t[1]||(t[1]=function(t){return e.$emit("select-precondition-is-on")}),onSelectPreconditionIsOff:t[2]||(t[2]=function(t){return e.$emit("select-precondition-is-off")})},null,8,["clickedTitleId"])):Object(r["h"])("",!0),o.isNodeSelected&&!o.isPinned?(Object(r["u"])(),Object(r["g"])(b,{key:2})):Object(r["h"])("",!0),o.isNodeSelected&&o.isPinned?(Object(r["u"])(),Object(r["g"])(O,{key:3})):Object(r["h"])("",!0),Object(r["j"])("button",{onClick:t[3]||(t[3]=function(){return o.signOut&&o.signOut.apply(o,arguments)})},"Sign Out")])])):(Object(r["u"])(),Object(r["g"])("button",{key:1,onClick:t[4]||(t[4]=function(){return o.signIn&&o.signIn.apply(o,arguments)})}," Sign In "))],2)}var sr=Object(r["j"])("h3",null,Object(r["F"])("Choose parent from which pin will be visible"),-1);function pr(e,t,n,o,i,a){var c=Object(r["C"])("Listbox"),d=Object(r["C"])("Button"),u=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onMousedown:t[1]||(t[1]=Object(r["O"])((function(){return o.toggleAddDialog&&o.toggleAddDialog.apply(o,arguments)}),["stop"]))},"pin",32),Object(r["j"])(u,{visible:o.addDialogVisible,"onUpdate:visible":t[3]||(t[3]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["M"])((function(){return[sr]})),footer:Object(r["M"])((function(){return[Object(r["j"])(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(d,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["M"])((function(){return[Object(r["j"])(c,{modelValue:o.selectedParent,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.selectedParent=e}),options:o.parents,optionLabel:"title"},null,8,["modelValue","options"])]})),_:1},8,["visible"])],64)}var fr=n("5bd2"),br=n("dc4a"),Or={name:"PinNode",components:{Dialog:fr["a"],Button:zn["a"],Listbox:br["a"]},setup:function(){var e=vt(),t=e.state.tree,n=Object(r["z"])(!1),o=Object(r["z"])(!1),i=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),a=Object(r["z"])(""),c=Object(r["e"])((function(){var e=[],n=t.nodeRecord[t.selectedNodeId].parent;while(t.nodeRecord[n.id].parent)e.push({title:n.title,id:n.id}),n=t.nodeRecord[n.id].parent;return e.push({title:"root",id:0}),e}));return{toggleAddDialog:function(){n.value=!n.value},selectedParent:o,parents:c,add:function(){n.value=!1,e.dispatch("pin/".concat(O.AddPin),{parentId:o.value.id,nodeId:i.value.id}),W.savePins(e.state.user.user,e.state.pin.pins),o.value=null},cancelAdd:function(){n.value=!1},addDialogVisible:n,newNodeTitle:a}}};Or.render=pr;var vr=Or;function mr(e,t,n,o,i,a){var c=Object(r["C"])("Button"),d=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.showAddBanner&&o.showAddBanner.apply(o,arguments)})},"Add precondition"),Object(r["j"])(d,{visible:o.addBannerVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addBannerVisible=e}),dismissableMask:!1,closable:!0,modal:!1,closeOnEscape:!0,onMousedown:t[3]||(t[3]=Object(r["O"])((function(){}),["stop"]))},{header:Object(r["M"])((function(){return[Object(r["j"])("h3",null,' Set "'+Object(r["F"])(o.preconditionNode.title?o.preconditionNode.title:o.selectedNode?o.selectedNode.title:"")+'" as precondition for "'+Object(r["F"])(o.targetNode?o.targetNode.title:"")+'" ',1)]})),footer:Object(r["M"])((function(){return[Object(r["j"])(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(c,{label:"Done",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),_:1},8,["visible"])],64)}n("aa20");var hr={name:"AddPrecondition",components:{Dialog:fr["a"],Button:zn["a"]},emits:["select-precondition-is-on","select-precondition-is-off"],props:{clickedTitleId:{type:String,required:!0}},setup:function(e,t){var n=vt(),o=Object(r["z"])(!1),i=Object(r["z"])({}),a=Object(r["z"])({}),c=Object(r["e"])((function(){return n.getters["tree/selectedNode"]}));return Object(r["K"])((function(){return e.clickedTitleId}),(function(){"-1"!==e.clickedTitleId&&n.state.tree.nodeRecord[e.clickedTitleId]&&(a.value=n.state.tree.nodeRecord[e.clickedTitleId].node)}),{immediate:!0}),{showAddBanner:function(){t.emit("select-precondition-is-on"),i.value=n.getters["tree/selectedNode"],o.value=!o.value},add:function(){var e=[];n.state.precondition.preconditions[i.value.id]&&(e=n.state.precondition.preconditions[i.value.id]),e.push(a.value.id),W.savePreconditions(n.state.user.user,{nodeId:i.value.id,preconditionIds:e}),t.emit("select-precondition-is-off"),o.value=!1,a.value={}},cancelAdd:function(){o.value=!1,a.value={},t.emit("select-precondition-is-off")},addBannerVisible:o,targetNode:i,preconditionNode:a,selectedNode:c}}};hr.render=mr;var gr=hr;function jr(e,t,n,o,i,a){var c=Object(r["C"])("Input"),d=Object(r["C"])("Button"),u=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.toggleAddDialog&&o.toggleAddDialog.apply(o,arguments)})},"+"),Object(r["j"])(u,{visible:o.addDialogVisible,"onUpdate:visible":t[3]||(t[3]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0,onMousedown:t[4]||(t[4]=Object(r["O"])((function(){}),["stop"]))},{header:Object(r["M"])((function(){return[Object(r["j"])("h3",null,Object(r["F"])(o.selectedNodeTitle?"Add subsection to ".concat(o.selectedNodeTitle):"Add section"),1)]})),footer:Object(r["M"])((function(){return[Object(r["j"])(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(d,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["M"])((function(){return[Object(r["j"])(c,{type:"text",modelValue:o.newNodeTitle,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.newNodeTitle=e})},null,8,["modelValue"])]})),_:1},8,["visible"])],64)}var yr=n("8398"),Nr={name:"AddNode",components:{Dialog:fr["a"],Button:zn["a"],Input:yr["a"]},setup:function(){var e=vt(),t=Object(r["z"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),o=Object(r["z"])("");return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleAddDialog:function(){return t.value=!t.value},add:function(){e.dispatch("".concat(st.createNode),{parentID:n.value?n.value.id:0,title:o.value}),o.value="",t.value=!1},cancelAdd:function(){o.value="",t.value=!1},addDialogVisible:t,newNodeTitle:o}}};Nr.render=jr;var Ir=Nr;function xr(e,t,n,o,i,a){var c=Object(r["C"])("Button"),d=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.toggleDialog&&o.toggleDialog.apply(o,arguments)}),disabled:!o.selectedNodeTitle},"-",8,["disabled"]),Object(r["j"])(d,{visible:o.addDialogVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["M"])((function(){return[Object(r["j"])("h3",null,Object(r["F"])("Remove ".concat(o.selectedNodeTitle," and all its descendants?")),1)]})),footer:Object(r["M"])((function(){return[Object(r["j"])(c,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancel},null,8,["onClick"]),Object(r["j"])(c,{label:"Yes",icon:"pi pi-check",onClick:o.remove},null,8,["onClick"])]})),_:1},8,["visible"])],64)}var Tr={name:"RemoveNode",components:{Dialog:fr["a"],Button:zn["a"]},setup:function(){var e=vt(),t=Object(r["z"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]}));return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleDialog:function(){return t.value=!t.value},remove:function(){t.value=!1,e.dispatch("".concat(st.removeNode),n.value.id)},cancel:function(){t.value=!1},addDialogVisible:t}}};Tr.render=xr;var Er=Tr;function Dr(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])(r["a"],null,[o.editModeOn?(Object(r["u"])(),Object(r["g"])("button",{key:0,onClick:t[1]||(t[1]=function(){return o.off&&o.off.apply(o,arguments)})},"Back to view mode")):Object(r["h"])("",!0),o.editModeOn?Object(r["h"])("",!0):(Object(r["u"])(),Object(r["g"])("button",{key:1,onClick:t[2]||(t[2]=function(){return o.on&&o.on.apply(o,arguments)})},"Edit Map"))],64)}var Cr={name:"EditMode",setup:function(){var e=vt();return{editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),on:function(){e.dispatch("".concat(st.setEditMode),!0)},off:function(){e.dispatch("".concat(st.setEditMode),!1)}}}};Cr.render=Dr;var wr=Cr;function kr(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])("button",{onClick:t[1]||(t[1]=function(){return o.unpin&&o.unpin.apply(o,arguments)})},"unpin")}var Rr={name:"UnpinNode",setup:function(){var e=vt();return{unpin:function(){e.dispatch("pin/".concat(O.RemovePin),e.state.tree.selectedNodeId),W.savePins(e.state.user.user,e.state.pin.pins)}}}};Rr.render=kr;var _r=Rr;function Sr(e,t,n,o,i,a){return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.cut&&o.cut.apply(o,arguments)})},"cut"),null!=o.cutNodeID?(Object(r["u"])(),Object(r["g"])("button",{key:0,onClick:t[2]||(t[2]=function(){return o.paste&&o.paste.apply(o,arguments)})},"Paste")):Object(r["h"])("",!0)],64)}var Pr={name:"CutPaste",setup:function(){var e=vt(),t=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),n=Object(r["z"])(null);return{cutNodeID:n,cut:function(){n.value=t.value.id},paste:function(){e.dispatch("".concat(st.cutPasteNode),{nodeID:n.value,parentID:t.value.id}),n.value=null}}}};Pr.render=Sr;var Mr=Pr,Lr=n("805e"),Ar=n.n(Lr),Br=Object(r["j"])("img",{alt:"logo",src:Ar.a,style:{width:"20px"}},null,-1),Hr=Object(r["j"])("span",{class:"p-ml-2 p-text-bold"},"chat",-1);function zr(e,t,n,o,i,a){var c=Object(r["C"])("Button");return Object(r["u"])(),Object(r["g"])(c,{iconPos:"right",onClick:o.send},{default:Object(r["M"])((function(){return[Br,Hr]})),_:1},8,["onClick"])}var Ur={name:"Feedback",components:{Button:zn["a"]},setup:function(){return{send:function(){window.open("https://discord.com/channels/1171118046543347782/1171118047105396749","_blank")}}}};Ur.render=zr;var Vr=Ur;function Gr(e,t,n,o,i,a){var c=Object(r["C"])("InputText");return Object(r["u"])(),Object(r["g"])(c,{placeholder:"some text to search","onUpdate:modelValue":t[1]||(t[1]=function(e){return o.doSearch(e)})})}var Fr={name:"TextSearch",components:{InputText:yr["a"]},setup:function(){return{doSearch:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,et(t);case 2:return n=e.sent,console.log(n),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}}};Fr.render=Gr;var qr=Fr,Wr={name:"Menu",components:{Feedback:Vr,CutPaste:Mr,UnpinNode:_r,PinNode:vr,AddNode:Ir,AddPrecondition:gr,RemoveNode:Er,EditMode:wr,TextSearch:qr},props:{clickedTitleId:{type:String,required:!0}},setup:function(){var e=vt(),t=e.state.user,n=Object(r["e"])((function(){return t.user?t.user.email:null}));return{email:n,editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),isNodeSelected:Object(r["e"])((function(){return e.state.tree.selectedNodeId})),isPinned:Object(r["e"])((function(){return void 0!==e.state.pin.pins[e.state.tree.selectedNodeId]})),signIn:function(){return e.dispatch("user/".concat(Me.signIn))},signOut:function(){return e.dispatch("user/".concat(Me.signOut))}}}},Yr=n("6fb8");const Xr=Wr.__cssModules={};Xr["$style"]=Yr["default"],Wr.render=lr;var Kr=Wr,Zr=Object(r["k"])({name:"Home",components:{Map:In,Menu:Kr,NodeContent:tr,ConfirmDialog:nr["a"],Toast:rr["a"]},setup:function(){var e=vt(),t=Object(Nt["e"])(),n=Object(Nt["d"])(),o=e.state.tree,i=e.state.zoomPan,a=e.state.pin,c=Object(r["z"])("-1"),d=!1,l=!1;Object(r["K"])((function(){return n.params.id}),(function(){e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),n.params.id)}),{immediate:!0});var p=Object(r["e"])((function(){return o.mapNodeLayers&&o.mapNodeLayers.length?"0 0 ".concat(2*o.mapNodeLayers[0]["0"].center.x," ").concat(2*o.mapNodeLayers[0]["0"].center.y):"0 0 1000 1000"})),b=function(e,t,n){var r=vn(t,n,e),o=Object(s["a"])(r,2),i=o[0],a=o[1];return a?(k("Home.vue: error in filterNodesAndLayers:",{err:a}),[]):i.reverse()},O=Object(r["z"])(null),v=Object(r["z"])([]),m=!0;Object(Nt["c"])(function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:m=!1;case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(r["K"])((function(){return[o.mapNodeLayers]}),(function(){if(m&&n.params.id.length>0&&o.mapNodeLayers.length>0){var t=_(n.params.id,o.mapNodeLayers),r=Object(s["a"])(t,1),i=r[0];null!=i&&e.commit("zoomPan/".concat(Ce.SET_PAN),{x:-i.center.x+o.mapNodeLayers[0]["0"].center.x,y:-i.center.y+o.mapNodeLayers[0]["0"].center.y})}})),Object(r["K"])((function(){return[o.mapNodeLayers,i.debouncedZoom,i.debouncedPan]}),(function(){var e=On(o.mapNodeLayers,o.nodeRecord,{width:window.innerWidth,height:window.innerHeight},i.debouncedZoom,i.pan,i.zoomCenter),t=Object(s["a"])(e,2),n=t[0],r=t[1];null!=r&&k("filterNodesAndLayers: error in findCurrentNode",{err:r}),O.value=n,v.value=b(n,o.mapNodeLayers,o.nodeRecord)}),{immediate:!0,deep:!0});var h=Object(r["z"])([]);return Object(r["K"])((function(){return[i.pan.x,i.pan.y,i.zoom,v]}),(function(){var e=w(v.value);h.value=mn(e,i.zoom,i.pan)}),{immediate:!0,deep:!0}),{pinNodes:Object(r["e"])((function(){if(null==O.value)return[];var e=a.pinsReverse[O.value];if(!e)return[];var t,n=Object(f["a"])(v.value);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var c in r){var d=r[c];if(""!=d.title){var u=e.indexOf(d.id);-1!=u&&e.splice(u,1)}}}}catch(g){n.e(g)}finally{n.f()}var l,s=S(e,o.mapNodeLayers),p=[],b=Object(f["a"])(s);try{for(b.s();!(l=b.n()).done;){var m=l.value,h=w(m);h.center=fn(m.center,i.zoom,i.pan),p.push(h)}}catch(g){b.e(g)}finally{b.f()}return p})),viewBox:p,editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),selectedNodeId:Object(r["e"])((function(){return o.selectedNodeId})),selectedNodePreconditionIds:Object(r["e"])((function(){return o.selectedNodeId?e.state.precondition.preconditions[o.selectedNodeId]:[]})),visibleZoomedPanedLayers:h,nodeDragging:function(t){e.dispatch("".concat(st.updateNodePosition),{nodeId:t.id,delta:{x:t.delta.x/i.zoom,y:t.delta.y/i.zoom}})},setSelectPreconditionON:function(){d=!0},setSelectPreconditionOFF:function(){d=!1},clickedTitleId:c,titleClick:function(e){d?c.value=e.id:t.push({name:"node",params:{id:e.id}})},titleOver:function(t){l=!0,e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),t.id)},titleLeave:function(t){l=!1,e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),n.params.id)},mapDragging:function(t){e.state.editModeOn&&l||e.commit("zoomPan/".concat(Ce.ADD_PAN),t)},zoom:function(t){var n={x:(t.center.x-i.pan.x)/i.zoom,y:(t.center.y-i.pan.y)/i.zoom};e.commit("zoomPan/".concat(Ce.ADD_ZOOM),-1*t.delta);var r={x:n.x*i.zoom+i.pan.x,y:n.y*i.zoom+i.pan.y};e.commit("zoomPan/".concat(Ce.ADD_PAN),{from:r,to:t.center}),e.commit("zoomPan/".concat(Ce.SET_ZOOM_CENTER),t.center)}}}});Zr.render=wt;var Jr=Zr;function $r(e,t){return Object(r["u"])(),Object(r["g"])("h1",null,"Oops, it looks like the page you're looking for doesn't exist.")}const Qr={};Qr.render=$r;var eo=Qr,to=[{path:"/passwordLogin",component:Ct},{path:"/:id?",name:"node",component:Jr},{path:"/:catchAll(.*)",component:eo}],no=Object(Nt["a"])({history:Object(Nt["b"])("/"),routes:to}),ro=no;n("098b"),n("e1ae"),n("4121"),n("bddf");Object(r["f"])(ht).use(Ot,bt).use(ro).use(gt["a"]).use(jt["a"]).use(yt["a"]).mount("#app")},cd50:function(e,t,n){var r={"./bmp":"0dcc","./bmp.js":"0dcc","./gif":"c416","./gif.js":"c416","./jpg":"135b","./jpg.js":"135b","./png":"e9ef","./png.js":"e9ef","./psd":"520c","./psd.js":"520c","./svg":"b0bf","./svg.js":"b0bf","./tiff":"f270","./tiff.js":"f270","./webp":"cf1e","./webp.js":"cf1e"};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id="cd50"},d6b6:function(e){e.exports=JSON.parse("{}")},ecf0:function(e,t,n){}});
//# sourceMappingURL=app.e643f569.js.map