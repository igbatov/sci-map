(function(e){function t(t){for(var r,i,c=t[0],u=t[1],d=t[2],l=0,p=[];l<c.length;l++)i=c[l],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);s&&s(t);while(p.length)p.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var s=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0622":function(e,t,n){e.exports=n.p+"img/sign-in.857c8105.svg"},"0bfa":function(e,t,n){"use strict";n("ab5c")},"0c69":function(e,t,n){"use strict";n("c02a")},"10b7":function(e,t,n){e.exports=n.p+"img/chat.b54d0730.svg"},1158:function(e,t,n){e.exports=n.p+"img/action.885d4d13.svg"},1493:function(e,t,n){},1515:function(e,t,n){e.exports={title:"Preconditions_title_1ANO_"}},"1d0f":function(e,t,n){"use strict";n("32db")},"1fec":function(e,t,n){e.exports=n.p+"img/plugin.71b16b67.svg"},"2a98":function(e,t,n){"use strict";n("1493")},"2c60":function(e,t,n){e.exports=n.p+"img/talk.636aebb1.svg"},"32db":function(e,t,n){},4612:function(e,t,n){e.exports=n.p+"img/switch-off.17f7401d.svg"},4623:function(e,t,n){e.exports=n.p+"img/remove-off.9d54941e.svg"},"504a":function(e,t,n){},6710:function(e,t,n){"use strict";n("e0f1")},"67c1":function(e,t,n){e.exports=n.p+"img/remove-on.9d54941e.svg"},"70bb":function(e,t,n){e.exports=n.p+"img/paste.c9ceeece.svg"},7835:function(e,t,n){e.exports=n.p+"img/add-on.5a83fc0e.svg"},"7ccc":function(e,t,n){"use strict";n("9816")},8423:function(e,t,n){e.exports=n.p+"img/switch-on.70cdd4b4.svg"},9233:function(e,t,n){e.exports=n.p+"img/cut.5b0b166e.svg"},"936b":function(e,t,n){},9816:function(e,t,n){},"99ba":function(e,t,n){e.exports=n.p+"img/goal.3f563b24.svg"},"9ac3":function(e,t,n){"use strict";var r=n("f327"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},"9e9f":function(e,t,n){"use strict";var r=n("c8b9"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},a48e:function(e,t,n){"use strict";n("936b")},ab5c:function(e,t,n){},ad65:function(e,t,n){"use strict";var r=n("1515"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},b969:function(e,t,n){e.exports=n.p+"img/pin-off.730bd912.svg"},bc82:function(e,t,n){e.exports=n.p+"img/pin-on.0b6013a3.svg"},c02a:function(e,t,n){},c8b9:function(e,t,n){e.exports={searchBox:"Textsearch_searchBox_1SbLb"}},c9d8:function(e,t,n){e.exports=n.p+"img/user.55fe760e.svg"},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function o(e,t,n,o,a,i){var c=Object(r["I"])("router-view");return Object(r["z"])(),Object(r["g"])(c)}n("a4d3"),n("e01a"),n("99af"),n("4160"),n("d81d"),n("d3b7"),n("159b");var a,i,c,u,d=n("2909"),s=(n("96cf"),n("1da1")),l=n("ade3"),p=n("3835"),b=n("5502"),f=(n("c975"),n("a434"),n("b85c")),m={SET_PINS:"SET_PINS",ADD_TO_PINS:"ADD_TO_PINS",REMOVE_PIN:"REMOVE_PIN",ADD_TO_PINS_REVERSE:"ADD_TO_PINS_REVERSE"},O={AddPin:"AddPin",RemovePin:"RemovePin"},v={namespaced:!0,state:{pins:{},pinsReverse:{}},actions:(a={},Object(l["a"])(a,O.AddPin,(function(e,t){var n=e.commit,r=e.rootState,o=r.tree.nodeRecord[t.nodeId].parent;if(o){var a=[];while(o&&o.id!=t.parentId)a.push(o.id),o=r.tree.nodeRecord[o.id].parent;a.push(t.parentId),n(m.ADD_TO_PINS,{nodeId:t.nodeId,parentIds:a});for(var i=0,c=a;i<c.length;i++){var u=c[i];n(m.ADD_TO_PINS_REVERSE,{nodeId:u,pinId:t.nodeId})}}})),Object(l["a"])(a,O.RemovePin,(function(e,t){var n=e.commit;n(m.REMOVE_PIN,t)})),a),mutations:(i={},Object(l["a"])(i,m.SET_PINS,(function(e,t){for(var n in e.pins=t,e.pinsReverse={},t){var r,o=Object(f["a"])(t[n]);try{for(o.s();!(r=o.n()).done;){var a=r.value;e.pinsReverse[a]||(e.pinsReverse[a]=[]),e.pinsReverse[a].push(n)}}catch(i){o.e(i)}finally{o.f()}}})),Object(l["a"])(i,m.ADD_TO_PINS,(function(e,t){e.pins[t.nodeId]=t.parentIds})),Object(l["a"])(i,m.ADD_TO_PINS_REVERSE,(function(e,t){e.pinsReverse[t.nodeId]||(e.pinsReverse[t.nodeId]=[]),e.pinsReverse[t.nodeId].push(t.pinId)})),Object(l["a"])(i,m.REMOVE_PIN,(function(e,t){var n,r=Object(f["a"])(e.pins[t]);try{for(r.s();!(n=r.n()).done;){var o=n.value,a=e.pinsReverse[o].indexOf(t);e.pinsReverse[o].splice(a,1)}}catch(i){r.e(i)}finally{r.f()}delete e.pins[t]})),i)},h={SET_MAP:"SET_MAP"},g={namespaced:!0,state:{layerMap:{}},mutations:Object(l["a"])({},h.SET_MAP,(function(e,t){e.layerMap[t.layerName]=t.titleBoxMap}))},j={SET_PRECONDITIONS:"SET_PRECONDITIONS",UPDATE_PRECONDITIONS:"UPDATE_PRECONDITIONS"},y={namespaced:!0,state:{preconditions:{},reverseIndex:{}},mutations:(c={},Object(l["a"])(c,j.SET_PRECONDITIONS,(function(e,t){for(var n in e.preconditions=t,t){var r,o=Object(f["a"])(t[n]);try{for(o.s();!(r=o.n()).done;){var a=r.value;"undefined"===typeof e.reverseIndex[a]&&(e.reverseIndex[a]=[]),e.reverseIndex[a].push(n)}}catch(i){o.e(i)}finally{o.f()}}})),Object(l["a"])(c,j.UPDATE_PRECONDITIONS,(function(e,t){e.preconditions[t.nodeID]||(e.preconditions[t.nodeID]=[]);var n,r=Object(f["a"])(e.preconditions[t.nodeID]);try{for(r.s();!(n=r.n()).done;){var o=n.value;e.reverseIndex[o]&&-1!=e.reverseIndex[o].indexOf(t.nodeID)&&e.reverseIndex[o].splice(e.reverseIndex[o].indexOf(t.nodeID),1)}}catch(u){r.e(u)}finally{r.f()}e.preconditions[t.nodeID]=t.preconditionIDs;var a,i=Object(f["a"])(e.preconditions[t.nodeID]);try{for(i.s();!(a=i.n()).done;){var c=a.value;"undefined"===typeof e.reverseIndex[c]&&(e.reverseIndex[c]=[]),e.reverseIndex[c].push(t.nodeID)}}catch(u){i.e(u)}finally{i.f()}})),c)},I=36e5,x={ADD_NODES:"ADD_NODES",REMOVE_NODES:"REMOVE_NODES"},N={CheckNodeID:"CheckNodeID"},D={namespaced:!0,state:{permittedNodeIDs:{}},mutations:(u={},Object(l["a"])(u,x.ADD_NODES,(function(e,t){var n,r=Object(f["a"])(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;e.permittedNodeIDs[o]=(new Date).getTime()}}catch(a){r.e(a)}finally{r.f()}})),Object(l["a"])(u,x.REMOVE_NODES,(function(e,t){var n,r=Object(f["a"])(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;delete e.permittedNodeIDs[o]}}catch(a){r.e(a)}finally{r.f()}})),u),actions:Object(l["a"])({},N.CheckNodeID,(function(e,t){var n=e.commit,r=e.state;return!!(r.permittedNodeIDs[t]&&(new Date).getTime()<r.permittedNodeIDs[t]+I)||(r.permittedNodeIDs[t]&&n(x.REMOVE_NODES,[t]),!1)}))},w=(n("4de4"),n("c740"),n("caad"),n("b0c0"),n("2532"),n("3ca3"),n("ddb0"),n("53ca")),T=(n("a15b"),n("13d5"),n("a9e3"),n("b64b"),n("595b")),k=function(e,t,n){var r=new Error(e);return{error:r,kv:t,code:n}},C=n("9fe2"),E=n("dcbe"),R=n.n(E),_=n("2ef0"),S=0;function M(e,t){return(e%t+t)%t}function P(e){var t=Math.pow(10,S);return Math.round(e*t)/t}function L(e){return Object(_["cloneDeep"])(e)}function A(e,t){var n;t||console.error(e);var r=[];for(var o in t)r.push(o,t[o]);(n=console).error.apply(n,[e].concat(r))}var B=n("ec26");function z(e,t){for(var n in t){var r=t[Number(n)];if(r&&r[e])return[r[e],Number(n)]}return[null,null]}function U(e,t){var n,r=[],o=Object(f["a"])(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a){var i,c=Object(f["a"])(e);try{for(c.s();!(i=c.n()).done;){var u=i.value;a[u]&&r.push(a[u])}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){o.e(d)}finally{o.f()}return r}function V(e,t){return{id:Object(B["a"])(),position:t,title:e,children:[]}}function F(e,t,n){var r=z(e.id,t),o=Object(p["a"])(r,1),a=o[0];if(null===a)return[null,null,k("getNewNodeCenter: cannot find mapNode for parent",{parentId:e.id,mapNodeLayers:t})];if(0===e.children.length){var i,c=a.border.map((function(e){return{from:a.center,to:e}})),u=c[0],d=Object(f["a"])(c);try{for(d.s();!(i=d.n()).done;){var s=i.value;ne(s)>ne(u)&&(u=s)}}catch(V){d.e(V)}finally{d.f()}var l=.5;return n&&(l=.5*Math.random()+1/4),[{x:u.from.x+l*(u.to.x-u.from.x),y:u.from.y+l*(u.to.y-u.from.y)},null,null]}var b=e.children[0],m=z(b.id,t),O=Object(p["a"])(m,1),v=O[0];if(null===v)return[null,null,k("getNewNodeCenter: cannot find maxDiagChild in layers",{maxDiagChildId:b.id,mapNodeLayers:t})];var h,g=Object(f["a"])(e.children);try{for(g.s();!(h=g.n()).done;){var j=h.value,y=z(j.id,t),I=Object(p["a"])(y,1),x=I[0];if(null===x)return[null,null,k("getNewNodeCenter: cannot find child in layers",{childId:j.id,mapNodeLayers:t})];var N=Ie(x.border),D=Object(p["a"])(N,2),w=D[0],T=D[1];if(T)return[null,null,k("getNewNodeCenter: error getMaxDiagonal",{childMapNode:x,err1:T})];var C=Ie(v.border),E=Object(p["a"])(C,2),R=E[0],_=E[1];if(_)return[null,null,k("getNewNodeCenter: error getMaxDiagonal",{maxDiagChildMapNode:v,err2:_})];ne(w)>ne(R)&&(v=x)}}catch(V){g.e(V)}finally{g.f()}var S=3/4;n&&(S=Math.random()*(1/4)+.625);var M=Ie(v.border),P=Object(p["a"])(M,1),A=P[0],B=ve(A,S).to,U=L(b);return U.position=ve(A,1/4).to,[B,U,null]}function H(e,t){if(null==e.tree)return k("state.tree == null",{});var n=e.nodeRecord[t.nodeId];if(!n)return k("updateNodePosition: cannot find node in nodeRecord",{"v.nodeId":t.nodeId,"state.nodeRecord":e.nodeRecord});if(!n.parent)return k("updateNodePosition: cannot move root of tree",{"v.nodeId":t.nodeId});var r=xe("normalize",t.position,n.parent.id,e.mapNodeLayers),o=Object(p["a"])(r,1),a=o[0];n.node.position=a;var i=z(n.parent.id,e.mapNodeLayers),c=Object(p["a"])(i,2),u=c[0],d=c[1];if(!u||null===d)return k("updateNodePosition: cannot find mapNode for parent",{id:n.parent.id,"state.mapNodeLayers":e.mapNodeLayers});var s=Ne(n.parent,u.border,u.center),l=Object(p["a"])(s,2),b=l[0],f=l[1];return null==b||null!=f?k("updateNodePosition: create layers for parent",{id:n.parent.id,parentMapNode:u}):De(e.mapNodeLayers,b,d)}n("25f0");var G=n("e6de"),q=n("bc3a"),W=n.n(q);n("07ac");function Y(e){var t;return e?Array.isArray(e)?(t=e.filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):(t=Object.values(e).filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):t=[],t}function X(e){var t={id:e["0"].id.toString(),title:e["0"].name,position:e["0"].position,children:[]},n=[t];while(n.length>0){var r=n.pop();if(r){if(!e[r.id])return[null,k("Cannot find id in dbNodes",{"node.id":r.id,dbNodes:e})];if(e[r.id].children=Y(e[r.id].children),e[r.id].children.length){var o,a=[],i=Object(f["a"])(e[r.id].children);try{for(i.s();!(o=i.n()).done;){var c=o.value;if(!e[c])return[null,k("Cannot find child id in dbNodes",{childID:c,parentID:r.id})];a.push({id:c.toString(),title:e[c].name,position:e[c].position,children:[]})}}catch(u){i.e(u)}finally{i.f()}r.children=a,n.push.apply(n,a)}}}return[t,null]}n("d6b6");var Z,K=n("1494"),$="https://us-central1-sci-map-1982.cloudfunctions.net/",J=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G["a"].database().ref().update(t);case 3:return e.abrupt("return",null);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",k("api: error in update",{err:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),Q=Object(_["debounce"])(J,2e3),ee={ROOT_WIDTH:2*window.innerWidth/3,ROOT_HEIGHT:window.innerHeight,ROOT_CENTER_X:.3*window.innerWidth+.7*window.innerWidth/2,ROOT_CENTER_Y:window.innerHeight/2,ST_WIDTH:1e3,ST_HEIGHT:1e3,initFirebase:function(){var e={apiKey:"AIzaSyCP50k-WOkTeG8BYvRtu4Bo_x3T2RnVsxU",authDomain:"sci-map-1982.firebaseapp.com",databaseURL:"https://sci-map-1982.firebaseio.com",projectId:"sci-map-1982",storageBucket:"sci-map-1982.appspot.com",messagingSenderId:"340899060236",appId:"1:340899060236:web:b136e9289e342a8bb62c29",measurementId:"G-TV74Q61H9P"};G["a"].initializeApp(e),G["a"].analytics()},callFunction:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=G["a"].auth().currentUser,r){n.next=3;break}return n.abrupt("return",["",k("callFunction: cannot determine current user",{})]);case 3:return n.next=5,r.getIdToken(!0);case 5:return o=n.sent,t.idToken=o,n.prev=7,n.next=10,W.a.get($+e,{params:t});case 10:return a=n.sent,n.abrupt("return",[a.data,null]);case 14:return n.prev=14,n.t0=n["catch"](7),n.abrupt("return",["",k("Error in callFunction",{method:e,params:t,e:n.t0})]);case 17:case"end":return n.stop()}}),n,null,[[7,14]])})))()},getMapFromDB:function(){return Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,G["a"].database().ref("map").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[null,k("!snapshot.exists",{})]);case 5:return n=t.val(),e.abrupt("return",[n,null]);case 7:case"end":return e.stop()}}),e)})))()},getMapFromStorage:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=G["a"].storage().ref(),o=r.child("/map.json"),e&&(o=r.child("/user/".concat(e.uid,"/map.json"))),n.next=5,o.getDownloadURL();case 5:return a=n.sent,n.next=8,W.a.get(a);case 8:return i=n.sent,n.abrupt("return",[{id:"0",title:"",position:{x:t.ROOT_WIDTH/2,y:t.ROOT_HEIGHT/2},children:i.data},null]);case 10:case"end":return n.stop()}}),n)})))()},getMap:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getMapFromDB();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",[null,k(e.t0.message,{e:e.t0})]);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},getPins:function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,o,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,null!=e){t.next=13;break}return n=G["a"].storage().ref(),r=n.child("/pins.json"),t.next=6,r.getDownloadURL();case 6:return o=t.sent,t.next=9,W.a.get(o);case 9:return a=t.sent,t.abrupt("return",[a.data,null]);case 13:return t.next=15,G["a"].database().ref("user_data/".concat(e.uid,"/pins")).get();case 15:if(i=t.sent,i.exists()){t.next=18;break}return t.abrupt("return",[null,k("!snapshot.exists",{})]);case 18:return t.abrupt("return",[i.val(),null]);case 19:t.next=24;break;case 21:return t.prev=21,t.t0=t["catch"](0),t.abrupt("return",[null,k(t.t0.message,{e:t.t0})]);case 24:case"end":return t.stop()}}),t,null,[[0,21]])})))()},savePins:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,G["a"].database().ref("user_data/".concat(e.uid,"/pins")).set(t);case 4:case"end":return n.stop()}}),n)})))()},getPreconditions:function(e){return Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G["a"].database().ref("precondition").get();case 3:if(t=e.sent,t.exists()){e.next=6;break}return e.abrupt("return",[null,k("!snapshot.exists",{})]);case 6:return n=t.val(),e.abrupt("return",[n,null]);case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",[null,k(e.t0.message,{e:e.t0})]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},savePreconditions:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,G["a"].database().ref("precondition/"+t.nodeId).set(t.preconditionIds);case 4:case"end":return n.stop()}}),n)})))()},subscribeMapNodeChange:function(e,t){this.subscribeDBChange("map/".concat(e),(function(e){if(e.exists()){var n=e.val();n.id=n.id.toString(),n.children=Y(n.children),t(n)}}))},subscribeNodeContentChange:function(e,t){this.subscribeDBChange("node_content/".concat(e),(function(e){if(e.exists()){var n=e.val();t(n)}}))},subscribePreconditionNodeChange:function(e,t){this.subscribeDBChange("precondition/".concat(e),(function(n){if(n.exists()){var r=n.val();t(e,r)}}))},unsubscribeMapNodeChange:function(e){G["a"].database().ref("map/".concat(e)).off("value")},subscribeDBChange:function(e,t){G["a"].database().ref(e).on("value",t)},unsubscribeDBChange:function(e,t){G["a"].database().ref(e).off("value",t)},transaction:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,G["a"].database().ref("map/"+e).transaction(t,(function(){}),!1);case 2:case"end":return n.stop()}}),n)})))()},setNode:function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,G["a"].database().ref("map/"+e.id).set(e);case 2:case"end":return t.stop()}}),t)})))()},setPublicUserData:function(e,t,n){return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,G["a"].database().ref("public_user_data/"+e).set({displayName:t,discordName:n});case 3:r.sent,r.next=9;break;case 6:r.prev=6,r.t0=r["catch"](0),console.log(r.t0);case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()},getNode:function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,G["a"].database().ref("map/"+e).get();case 2:return n=t.sent,r=n.val(),r.id=r.id.toString(),r.children=Y(r.children),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})))()},generateKey:function(){return G["a"].database().ref().push().key},findKeyInList:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,G["a"].database().ref(e).orderByValue().equalTo(t).limitToFirst(1).get();case 2:return r=n.sent,n.abrupt("return",r.key);case 4:case"end":return n.stop()}}),n)})))()},findKeyOfChild:function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,G["a"].database().ref("map/"+e).get();case 2:if(r=n.sent,o=r.val(),o.children){n.next=6;break}return n.abrupt("return",null);case 6:n.t0=regeneratorRuntime.keys(o.children);case 7:if((n.t1=n.t0()).done){n.next=13;break}if(a=n.t1.value,o.children[a].toString()!==t){n.next=11;break}return n.abrupt("return",a);case 11:n.next=7;break;case 13:return n.abrupt("return",null);case 14:case"end":return n.stop()}}),n)})))()},update:J,debouncedUpdate:Q,getUserComments:function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.uid,t.next=3,G["a"].database().ref("user_data/".concat(n,"/comment")).get();case 3:if(r=t.sent,r.exists()){t.next=6;break}return t.abrupt("return",[null,k("!snapshot.exists",{})]);case 6:return o=r.val(),t.abrupt("return",[o,null]);case 8:case"end":return t.stop()}}),t)})))()},getNodeContent:function(){return Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,G["a"].database().ref("node_content").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[{},null]);case 5:return e.abrupt("return",[t.val(),null]);case 6:case"end":return e.stop()}}),e)})))()}},te=[{x:0,y:0},{x:0,y:ee.ST_HEIGHT},{x:ee.ST_WIDTH,y:ee.ST_HEIGHT},{x:ee.ST_WIDTH,y:0}];function ne(e){return Math.sqrt(Math.pow(e.from.x-e.to.x,2)+Math.pow(e.from.y-e.to.y,2))}function re(e){if(!e)throw new Error("polygonToTurf: p is empty");var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),T["polygon"]([t])}function oe(e,t){return T["booleanPointInPolygon"](T["point"]([e.x,e.y]),re(t))}function ae(e){var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),[t]}function ie(e){return Math.abs(Object(C["a"])(e.map((function(e){return[e.x,e.y]}))))}function ce(e,t){var n=L(e),r=L(t),o=1;while(ie(n)<1e3&&ie(r)<1e3)o*=10,n=e.map((function(e){return{x:e.x*o,y:e.y*o}})),r=t.map((function(e){return{x:e.x*o,y:e.y*o}}));n=n.map((function(e){return{x:P(e.x),y:P(e.y)}})),r=r.map((function(e){return{x:P(e.x),y:P(e.y)}}));var a=ae(n),i=ae(r);if(null==a||null==i)return[null,k("intersect: error in polygonToPCPolygon",{p1:e,p2:t})];var c=R.a.intersection(a,i);if(null==c||!c.length)return[[],null];var u,d=[],s=Object(f["a"])(c[0]);try{for(s.s();!(u=s.n()).done;){var l,p=u.value,b=[],m=Object(f["a"])(p);try{for(m.s();!(l=m.n()).done;){var O=l.value;b.push({x:O[0]/o,y:O[1]/o})}}catch(v){m.e(v)}finally{m.f()}b.pop(),d.push(b)}}catch(v){s.e(v)}finally{s.f()}return[d,null]}function ue(e){e||console.error("bad border",e);var t=e.reduce((function(e,t){return e.x>t.x?t:e})).x,n=e.reduce((function(e,t){return e.y>t.y?t:e})).y,r=e.reduce((function(e,t){return e.x<t.x?t:e})).x,o=e.reduce((function(e,t){return e.y<t.y?t:e})).y;return{leftBottom:{x:t,y:n},rightTop:{x:r,y:o}}}function de(e,t,n){var r,o=e.map((function(e){return T["point"]([e.x,e.y])})),a=T["featureCollection"](o),i=T["voronoi"](a,{bbox:[t.x,t.y,n.x,n.y]}),c={},u=0,d=Object(f["a"])(i.features);try{for(d.s();!(r=d.n()).done;){var s=r.value;if(!s)return[{},k("getVoronoiCellsInSquare: undefined cell",{centers:e,leftBottom:t,rightTop:n,cells:i})];var l=s.geometry.coordinates[0].map((function(e){return{x:e[0],y:e[1]}}));l.pop(),c[u]=l,u++}}catch(p){d.e(p)}finally{d.f()}return[c,null]}function se(e,t){if(!e)return[[],k("getVoronoiCells: bad outerBorder",{outerBorder:e,centers:t})];var n=ue(e),r=de(t,n.leftBottom,n.rightTop),o=Object(p["a"])(r,2),a=o[0],i=o[1];if(i)return[[],k("getVoronoiCells: error in getVoronoiCellsInSquare",{err:i,bb:n,centers:t})];var c=[];for(var u in t){if(!a[u])return[[],k("Cannot find index in cellMap",{index:u,centers:t,cellMap:a,BoundingBorders:n,outerBorder:e})];var d=ce(a[u],e),s=Object(p["a"])(d,2),l=s[0],b=s[1];if(null==l||null!=b)return[[],k("getVoronoiCells error",{err:b,cellBorder:a[u],outerBorder:e})];if(l==[])return[[],k("Voronoi cell has no intersection with outerBorder",{point:t[u]})];if(l.length>1)return[[],k("Voronoi cell has more than one intersection with outerBorder",{point:t[u]})];c.push({border:l[0],center:t[u]})}return[c,null]}function le(e,t,n){return e&&e==t?"#f3afaf":n&&-1!=n.indexOf(t)?"#62f363":"transparent"}function pe(e,t,n){return e&&e==t||n&&-1!=n.indexOf(t)?"0.2":"0"}function be(e){return e.map((function(e){return"".concat(e.x," ").concat(e.y)})).join(",")}function fe(e){var t={},n=[{node:e,parent:null}],r=function(){var e=n.pop();if(!e)return"break";t[e.node.id]=e,n.push.apply(n,Object(d["a"])(e.node.children.map((function(t){return{node:t,parent:e.node}}))))};while(n.length){var o=r();if("break"===o)break}return t}function me(e,t){return{from:{x:t.x,y:t.y},to:{x:t.x+(e.to.x-e.from.x),y:t.y+(e.to.y-e.from.y)}}}function Oe(e,t){var n=me(t,e.to);return{from:{x:e.from.x,y:e.from.y},to:{x:n.to.x,y:n.to.y}}}function ve(e,t){var n=me(e,{x:0,y:0});return me({from:{x:0,y:0},to:{x:n.to.x*t,y:n.to.y*t}},e.from)}function he(e,t){return me(t,e).to}function ge(e,t){var n=e.from.x,r=e.from.y,o=e.to.x,a=e.to.y,i=t.from.x,c=t.from.y,u=t.to.x,d=t.to.y,s=(d-c)*(o-n)-(u-i)*(a-r),l=(u-i)*(r-c)-(d-c)*(n-i),p=(o-n)*(r-c)-(a-r)*(n-i);if(0==s)return null;var b=l/s,f=p/s;return b>=0&&b<=1&&f>=0&&f<=1?{x:n+b*(o-n),y:r+b*(a-r)}:null}function je(e,t,n){var r=T["centerOfMass"](re(e)).geometry;if(null==r)return[null,k("morphChildrenPoints oldBorder centerOfMass error",{oldBorder:e,oldPoints:n})];var o=T["centerOfMass"](re(t)).geometry;if(null==o)return[null,k("morphChildrenPoints newBorder centerOfMass error",{newBorder:t,oldPoints:n})];var a={x:r.coordinates[0],y:r.coordinates[1]},i={x:o.coordinates[0],y:o.coordinates[1]};for(var c in e=e.map((function(e){return he(e,{from:a,to:i})})),n)n[c]=he(n[c],{from:a,to:i});var u=Math.max(ne({from:ue(e).leftBottom,to:ue(e).rightTop}),ne({from:ue(t).leftBottom,to:ue(t).rightTop})),d={};for(var s in n){var l=n[s];if(i.x!=l.x||i.y!=l.y){var p={from:i,to:n[s]};p=ve(p,u/ne(p));var b=null;for(var f in e){var m={from:e[f],to:e[(Number(f)+1)%e.length]},O=ge(p,m);if(null!=O){b=O;break}}if(null==b)return[null,k("morphChildrenPoints cannot find intersection with oldBorder",{centerToPoint:p,oldBorder:e})];var v=null;for(var h in t){var g={from:t[h],to:t[(Number(h)+1)%t.length]},j=ge(p,g);if(null!=j){v=j;break}}if(null==v)return[null,k("morphChildrenPoints cannot find intersection with newBorder",{centerToPoint:p,newBorder:t})];if(b.x!=v.x||b.y!=v.y){var y=ne({from:i,to:v})/ne({from:i,to:b});d[s]=ve({from:i,to:l},y).to}else d[s]=l}else d[s]=l}return[d,null]}function ye(){return{from:{x:0,y:0},to:{x:0,y:0}}}function Ie(e){if(!e||e.length<3)return[ye(),k("getMaxDiagonal: bad polygon",{polygon:e})];var t=[];if(3==e.length)for(var n in e){var r=ve({from:e[M(Number(n)-1,e.length)],to:e[M(Number(n)+1,e.length)]},.5);t.push({from:e[n],to:r.to})}else for(var o in e)for(var a in e)Number(a)!=M(Number(o)-1,e.length)&&Number(a)!=Number(o)&&Number(a)!=M(Number(o)+1,e.length)&&t.push({from:e[o],to:e[a]});for(var i=t[0],c=0,u=t;c<u.length;c++){var d=u[c];ne(d)>ne(i)&&(i=d)}return[i,null]}function xe(e,t,n,r){var o;if(n){var a,i,c=z(n,r),u=Object(p["a"])(c,1),d=u[0];if(!d)return[null,k("UPDATE_NODE: Cannot findMapNode",{id:n})];if("denormalize"===e){if(!oe(t,te))return[null,k("convertPosition: position outside NORMALIZED_BORDER",{normalizedBorder:te,position:t,parentID:n})];var s=je(te,d.border,{tmp:t}),l=Object(p["a"])(s,2);a=l[0],i=l[1]}else{if(!oe(t,d.border))return[null,k("convertPosition: position outside parentMapNode.border",{"parentMapNode.border":d.border,"parentMapNode.center":d.center,position:t,parentID:n})];var b=je(d.border,te,{tmp:t}),f=Object(p["a"])(b,2);if(a=f[0],i=f[1],null!==i)return[null,k("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:te,"parentMapNode.border":d.border,"dbNode.position":t})];a["tmp"].x<0&&(a["tmp"].x=1),a["tmp"].x>ee.ST_WIDTH&&(a["tmp"].x=ee.ST_WIDTH-1),a["tmp"].y<0&&(a["tmp"].y=1),a["tmp"].y>ee.ST_HEIGHT&&(a["tmp"].y=ee.ST_HEIGHT-1)}if(null!==i)return[null,k("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:te,"parentMapNode.border":d.border,"dbNode.position":t})];o=a["tmp"]}else o="denormalize"===e?{x:ee.ROOT_CENTER_X,y:ee.ROOT_CENTER_Y}:{x:ee.ST_WIDTH/2,y:ee.ST_HEIGHT/2};return[o,null]}function Ne(e,t,n){if(0==Object.keys(e).length)return[[],null];var r=[[e]],o=[Object(l["a"])({},e.id,{id:e.id,border:t,title:e.title,center:n})];while(1){var a,i=r[r.length-1],c=o[r.length-1],u=[],s={},b=Object(f["a"])(i);try{for(b.s();!(a=b.n()).done;){var m=a.value;if(!m.children)return[null,k("treeToMapNodeLayers: treeNode with children undefined",{treeNode:m})];if(m.children.length){var O={},v="";for(var h in m.children){if(v=JSON.stringify(m.children[h].position),O[v]&&O[v].length>0)return[null,k("two children has the same center",{firstId:O[v],secondId:m.children[h].id})];O[v]=m.children[h].id}if(u.push.apply(u,Object(d["a"])(m.children)),!c[m.id])return[null,k("Cannot find node in mapNodeLayers",{layer:o[o.length-1],treeNode:m})];var g,j=L(m.children),y=Object(f["a"])(j);try{for(y.s();!(g=y.n()).done;){var I=g.value,x=xe("denormalize",I.position,m.id,[c]),N=Object(p["a"])(x,2),D=N[0],w=N[1];if(w)return[null,w];I.position=D}}catch(z){y.e(z)}finally{y.f()}var T=se(c[m.id].border,j.map((function(e){return{x:e.position.x,y:e.position.y}}))),C=Object(p["a"])(T,2),E=C[0],R=C[1];if(null!=R)return[null,R];var _,S=Object(f["a"])(E);try{for(S.s();!(_=S.n()).done;){var M,P=_.value,A=Object(f["a"])(j);try{for(A.s();!(M=A.n()).done;){var B=M.value;B.position.x==P.center.x&&B.position.y==P.center.y&&(s[B.id]={id:B.id,title:B.title,center:B.position,border:P.border})}}catch(z){A.e(z)}finally{A.f()}}}catch(z){S.e(z)}finally{S.f()}}}}catch(z){b.e(z)}finally{b.f()}if(!u.length)return[o,null];r.push(u),o.push(s)}}function De(e,t,n){if(n>=e.length||n<0)return k("startFromLevel >= recipientLayers.length or startFromLevel < 0",{startFromLevel:n,"recipientLayers.length":e.length});var r=n;while(r<n+t.length){for(var o in t[r-n])e[r][o]=t[r-n][o];r++}return null}var we=2560,Te=1600,ke=1/3,Ce=[{x:0,y:ke*Te},{x:0,y:2*ke*Te},{x:ke/2.5*we,y:(1-ke/4)*Te},{x:ke*we,y:Te},{x:2*ke*we,y:Te},{x:(1-ke/2.5)*we,y:(1-ke/4)*Te},{x:we,y:2*ke*Te},{x:we,y:ke*Te},{x:(1-ke/2.5)*we,y:ke/4*Te},{x:2*ke*we,y:0},{x:ke*we,y:0},{x:ke/2.5*we,y:ke/4*Te}],Ee={x:ee.ROOT_CENTER_X,y:ee.ROOT_CENTER_Y},Re=Math.min(ee.ROOT_WIDTH/we,ee.ROOT_HEIGHT/Te);for(var _e in Ce)Ce[_e].x=Re*Ce[_e].x+ee.ROOT_CENTER_X-Re*we/2,Ce[_e].y=Re*Ce[_e].y+ee.ROOT_CENTER_Y-Re*Te/2;var Se,Me,Pe,Le,Ae={SET_SELECTED_NODE_ID:"SET_SELECTED_NODE_ID",SET_TREE:"SET_TREE",UPDATE_NODE_POSITION:"UPDATE_NODE_POSITION",REMOVE_NODE:"REMOVE_NODE"},Be={handleMapNodeUpdate:"handleMapNodeUpdate"},ze={namespaced:!0,state:function(){return{tree:null,nodeRecord:{},mapNodeLayers:[],selectedNodeId:null}},getters:{selectedNode:function(e){return e.selectedNodeId&&e.nodeRecord[e.selectedNodeId]?e.nodeRecord[e.selectedNodeId].node:null}},actions:Object(l["a"])({},Be.handleMapNodeUpdate,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,s,l,b,m,O,v,h,g,j,y,I,x,N,D,T,k,C,E,R;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,o=e.state,a=e.dispatch,i=o.nodeRecord[t.id],i){n.next=5;break}return A("UPDATE_NODE: Cannot find dbNode in dbNodeRecord",{"dbNode.id":t.id}),n.abrupt("return");case 5:if(c={id:i.node.id,parentID:i.parent?i.parent.id:null,name:i.node.title,children:i.node.children.map((function(e){return e.id})).sort(),position:i.node.position},u=t.children.filter((function(e){return!c.children.includes(e)})),d=c.children.filter((function(e){return!t.children.includes(e)})),!u.length){n.next=30;break}s=Object(f["a"])(u),n.prev=10,b=regeneratorRuntime.mark((function e(){var n,i,c,u,d,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=l.value,o.nodeRecord[n]&&(console.log("actions.handleDBUpdate: remove node for cut-and-paste",o.nodeRecord[n]),i={nodeID:n,returnError:null},r(Ae.REMOVE_NODE,{nodeID:n,returnError:null}),i.returnError&&A("handleDBUpdate: cannot cut node",{err:i.returnError})),e.next=4,ee.getNode(n);case 4:if(c=e.sent,console.log("actions.handleDBUpdate: add node for cut-and-paste",c),u=[c],c){e.next=11;break}return t.children=t.children.filter((function(e){return e!=n})),A("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 11:d=regeneratorRuntime.mark((function e(){var t,n,r,i,c,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=u.pop(),t){e.next=3;break}return e.abrupt("return","continue");case 3:if(n={id:t.id,title:t.name,position:t.position,children:[]},o.nodeRecord[t.parentID]){e.next=7;break}return A("Cannot find nodeID in nodeRecord",{nodeID:t.parentID}),e.abrupt("return",{v:{v:void 0}});case 7:o.nodeRecord[t.parentID].node.children=o.nodeRecord[t.parentID].node.children.filter((function(e){return e.id!=n.id})),o.nodeRecord[t.parentID].node.children.push(n),o.nodeRecord[n.id]={parent:o.nodeRecord[t.parentID].node,node:n},ee.subscribeMapNodeChange(n.id,(function(e){return a(Be.handleMapNodeUpdate,e)})),r=Object(f["a"])(t.children),e.prev=12,c=regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.value,e.next=3,ee.getNode(n);case 3:if(r=e.sent,r){e.next=8;break}return t.children=t.children.filter((function(e){return e!=n})),A("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 8:u.push(r);case 9:case"end":return e.stop()}}),e)})),r.s();case 15:if((i=r.n()).done){e.next=22;break}return e.delegateYield(c(),"t0",17);case 17:if(d=e.t0,"continue"!==d){e.next=20;break}return e.abrupt("continue",20);case 20:e.next=15;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e["catch"](12),r.e(e.t1);case 27:return e.prev=27,r.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[12,24,27,30]])}));case 12:if(!u.length){e.next=21;break}return e.delegateYield(d(),"t0",14);case 14:if(s=e.t0,"continue"!==s){e.next=17;break}return e.abrupt("continue",12);case 17:if("object"!==Object(w["a"])(s)){e.next=19;break}return e.abrupt("return",s.v);case 19:e.next=12;break;case 21:case"end":return e.stop()}}),e)})),s.s();case 13:if((l=s.n()).done){n.next=22;break}return n.delegateYield(b(),"t0",15);case 15:if(m=n.t0,"continue"!==m){n.next=18;break}return n.abrupt("continue",20);case 18:if("object"!==Object(w["a"])(m)){n.next=20;break}return n.abrupt("return",m.v);case 20:n.next=13;break;case 22:n.next=27;break;case 24:n.prev=24,n.t1=n["catch"](10),s.e(n.t1);case 27:return n.prev=27,s.f(),n.finish(27);case 30:if(!d.length){n.next=55;break}O=Object(f["a"])(d),n.prev=32,O.s();case 34:if((v=O.n()).done){n.next=47;break}if(h=v.value,o.nodeRecord[h]&&o.nodeRecord[h].parent){n.next=38;break}return n.abrupt("continue",45);case 38:if(!o.nodeRecord[h]||o.nodeRecord[h].parent.id===t.id){n.next=40;break}return n.abrupt("continue",45);case 40:console.log("actions.handleDBUpdate: removing children",o.nodeRecord[h]),g={nodeID:h,returnError:null},r(Ae.REMOVE_NODE,g),g.returnError&&A("actions.handleDBUpdate: cannot remove node",{err:g.returnError,id:h}),ee.unsubscribeMapNodeChange(h);case 45:n.next=34;break;case 47:n.next=52;break;case 49:n.prev=49,n.t2=n["catch"](32),O.e(n.t2);case 52:return n.prev=52,O.f(),n.finish(52);case 55:if(!d.length&&!u.length){n.next=61;break}if(j=Ne(o.tree,Ce,Ee),y=Object(p["a"])(j,2),I=y[0],x=y[1],!x){n.next=60;break}return A("Cannot treeToMapNodeLayers",{err:x}),n.abrupt("return");case 60:o.mapNodeLayers=I;case 61:if(P(t.position.x)===P(c.position.x)&&P(t.position.y)===P(c.position.y)){n.next=69;break}if(N=xe("denormalize",t.position,i.parent?i.parent.id:null,o.mapNodeLayers),D=Object(p["a"])(N,1),T=D[0],c.parentID!=t.parentID){n.next=69;break}if(k={nodeId:t.id,newCenter:T,returnError:null},r(Ae.UPDATE_NODE_POSITION,k),null===k.returnError){n.next=69;break}return A("actions.handleDBUpdate: cannot update node's position",{dbNode:t,err:k.returnError}),n.abrupt("return");case 69:if(c.name===t.name){n.next=75;break}if(i.node.title=t.name,C=z(c.id,o.mapNodeLayers),E=Object(p["a"])(C,1),R=E[0],R){n.next=74;break}return n.abrupt("return");case 74:R.title=t.name;case 75:case"end":return n.stop()}}),n,null,[[10,24,27,30],[32,49,52,55]])})))()})),mutations:(Z={},Object(l["a"])(Z,Ae.REMOVE_NODE,(function(e,t){if(null!==e.tree)if(e.nodeRecord[t.nodeID]){var n=e.nodeRecord[t.nodeID].parent;if(n){var r=[t.nodeID];while(r.length){var o=r.pop();o&&(r.push.apply(r,Object(d["a"])(e.nodeRecord[o].node.children.map((function(e){return e.id})))),delete e.nodeRecord[o])}var a=n.children.findIndex((function(e){return e.id===t.nodeID}));n.children.splice(a,1)}else t.returnError=k("REMOVE_NODE: cannot remove root node",{nodeId:t.nodeID})}else t.returnError=k("REMOVE_NODE: cannot find nodeId in nodeRecord",{nodeID:t.nodeID,nodeRecord:e.nodeRecord});else t.returnError=k("state.tree === null",{})})),Object(l["a"])(Z,Ae.SET_SELECTED_NODE_ID,(function(e,t){e.selectedNodeId=t})),Object(l["a"])(Z,Ae.SET_TREE,(function(e,t){if(null==t)return e.tree=null,e.nodeRecord={},void(e.mapNodeLayers=[]);e.tree=t,e.nodeRecord=fe(t);var n=Ne(t,Ce,Ee),r=Object(p["a"])(n,2),o=r[0],a=r[1];null!=o&&null==a?e.mapNodeLayers=o:console.error(a)})),Object(l["a"])(Z,Ae.UPDATE_NODE_POSITION,(function(e,t){var n=e.nodeRecord[t.nodeId].parent;if(null!==n){var r=z(n.id,e.mapNodeLayers),o=Object(p["a"])(r,1),a=o[0];if(!a)return void(t.returnError=k("UPDATE_NODE_POSITION: cannot find parent mapNode",{"parent.id":n.id,"state.mapNodeLayers":e.mapNodeLayers}));if(!oe(t.newCenter,a.border))return void(t.returnError=k("!isInside",{newCenter:t.newCenter,"parentMapNode.border":a.border}))}t.returnError=H(e,{nodeId:t.nodeId,position:t.newCenter})})),Z)},Ue={ADD_ZOOM:"ADD_ZOOM",ADD_PAN:"ADD_PAN",SET_PAN:"SET_PAN",SET_ZOOM_CENTER:"SET_ZOOM_CENTER"},Ve=Object(_["debounce"])((function(e,t){e.debouncedZoom=t}),100),Fe=Object(_["debounce"])((function(e,t){e.debouncedPan=t}),100),He=.002,Ge=1,qe={namespaced:!0,state:{zoom:1,pan:{x:0,y:0},debouncedZoom:1,debouncedPan:{x:0,y:0},zoomCenter:{x:0,y:0}},mutations:(Se={},Object(l["a"])(Se,Ue.SET_ZOOM_CENTER,(function(e,t){e.zoomCenter=t})),Object(l["a"])(Se,Ue.ADD_ZOOM,(function(e,t){var n=e.zoom*Math.pow(2,t*He);n<.5||(e.zoom=n,Ve(e,e.zoom))})),Object(l["a"])(Se,Ue.ADD_PAN,(function(e,t){e.pan=Oe({from:{x:0,y:0},to:e.pan},ve(t,Ge)).to,Fe(e,e.pan)})),Object(l["a"])(Se,Ue.SET_PAN,(function(e,t){e.pan=t,Fe(e,e.pan)})),Se)},We={SET_USER:"SET_USER"},Ye={signIn:"signIn",signOut:"signOut"},Xe={namespaced:!0,state:{user:null},mutations:Object(l["a"])({},We.SET_USER,(function(e,t){e.user=t})),actions:(Me={},Object(l["a"])(Me,Ye.signIn,(function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.commit,t.next=3,G["a"].auth().signInWithPopup(new G["a"].auth.GoogleAuthProvider);case 3:case"end":return t.stop()}}),t)})))()})),Object(l["a"])(Me,Ye.signOut,(function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.next=3,G["a"].auth().signOut();case 3:n(We.SET_USER,null);case 4:case"end":return t.stop()}}),t)})))()})),Me)},Ze={ADD_CUT_PASTE:"ADD_CUT_PASTE",ADD_CREATE:"ADD_CREATE",ADD_REMOVE:"ADD_REMOVE",ADD_POSITION_CHANGE:"ADD_POSITION_CHANGE"};(function(e){e["CUT_PASTE"]="CUT_PASTE",e["CREATE"]="CREATE",e["REMOVE"]="REMOVE",e["POSITION_CHANGE"]="POSITION_CHANGE"})(Le||(Le={}));var Ke,$e,Je={CUT_PASTE:"CUT_PASTE",CREATE:"CREATE",REMOVE:"REMOVE",POSITION_CHANGE:"POSITION_CHANGE"},Qe={namespaced:!0,state:{stableChangeList:{},localChangeList:{}},mutations:(Pe={},Object(l["a"])(Pe,Ze.ADD_CUT_PASTE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][Je.CREATE]?e.localChangeList[t.nodeID][Je.CREATE].parentID=t.newParentID:e.localChangeList[t.nodeID][Je.CUT_PASTE]=t})),Object(l["a"])(Pe,Ze.ADD_CREATE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][Je.CREATE]=t})),Object(l["a"])(Pe,Ze.ADD_REMOVE,(function(e,t){e.localChangeList[t.nodeID]={},e.localChangeList[t.nodeID][Je.REMOVE]=t})),Object(l["a"])(Pe,Ze.ADD_POSITION_CHANGE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={});var n=t.oldPosition;e.localChangeList[t.nodeID][Je.POSITION_CHANGE]&&(n=e.localChangeList[t.nodeID][Je.POSITION_CHANGE].oldPosition),e.localChangeList[t.nodeID][Je.POSITION_CHANGE]={nodeID:t.nodeID,oldPosition:n,newPosition:t.newPosition}})),Pe),actions:{}},et={SET_CONTENTS:"SET_CONTENTS",SET_USER_COMMENTS:"SET_USER_COMMENTS",SET_NODE_CONTENT:"SET_NODE_CONTENT",SET_NODE_COMMENT:"SET_NODE_COMMENT"},tt={getNodeContent:"getNodeContent",setNodeContent:"setNodeContent",setNodeComment:"setNodeComment"},nt={nodeID:"",content:""};function rt(e,t){e[t]||(e[t]=L(nt),e[t].nodeID=t)}var ot={nodeID:"",comment:""};function at(e,t){e[t]||(e[t]=L(ot),e[t].nodeID=t)}var it,ct,ut={namespaced:!0,state:{nodeContents:{},userNodeComments:{}},actions:(Ke={},Object(l["a"])(Ke,tt.getNodeContent,(function(e,t){var n=e.state;return n.nodeContents[t]})),Object(l["a"])(Ke,tt.setNodeComment,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.rootState,a.user.user&&!a.user.user.isAnonymous){n.next=3;break}return n.abrupt("return",null);case 3:return n.next=5,ee.debouncedUpdate((r={},Object(l["a"])(r,"user_data/".concat(a.user.user.uid,"/comment/").concat(t.nodeID,"/nodeID"),t.nodeID),Object(l["a"])(r,"user_data/".concat(a.user.user.uid,"/comment/").concat(t.nodeID,"/comment"),t.comment),r));case 5:if(i=n.sent,!i){n.next=8;break}return n.abrupt("return",i);case 8:return o("".concat(et.SET_NODE_COMMENT),t),n.abrupt("return",null);case 10:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(Ke,tt.setNodeContent,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,e.state,o("".concat(et.SET_NODE_CONTENT),t),n.next=4,ee.debouncedUpdate((r={},Object(l["a"])(r,"node_content/".concat(t.nodeID,"/nodeID"),t.nodeID),Object(l["a"])(r,"node_content/".concat(t.nodeID,"/content"),t.content),r));case 4:if(a=n.sent,!a){n.next=7;break}return n.abrupt("return",a);case 7:return n.abrupt("return",null);case 8:case"end":return n.stop()}}),n)})))()})),Ke),mutations:($e={},Object(l["a"])($e,et.SET_CONTENTS,(function(e,t){e.nodeContents=t})),Object(l["a"])($e,et.SET_USER_COMMENTS,(function(e,t){e.userNodeComments=t})),Object(l["a"])($e,et.SET_NODE_CONTENT,(function(e,t){rt(e.nodeContents,t.nodeID),e.nodeContents[t.nodeID].content=t.content})),Object(l["a"])($e,et.SET_NODE_COMMENT,(function(e,t){at(e.userNodeComments,t.nodeID),e.userNodeComments[t.nodeID].comment=t.comment})),$e)},dt=(n("fb6a"),{SET_NODE_IDS:"SET_NODE_IDS"}),st={namespaced:!0,state:{nodeIDs:[]},mutations:Object(l["a"])({},dt.SET_NODE_IDS,(function(e,t){t.length>20?e.nodeIDs=t.slice(0,20):e.nodeIDs=t}))},lt=(n("ac1f"),n("841c"),n("5bd5")),pt=new lt["Worker"]({language:"en",tokenize:"forward"});function bt(e,t){pt.add(e,t)}function ft(e){return pt.search(e)}function mt(e){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u,d,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ee.getMap(t);case 2:if(n=e.sent,r=Object(p["a"])(n,2),o=r[0],a=r[1],(null===o||a)&&A("fetchMap: cannot api.getMap(user)",{err:a}),i=X(o),c=Object(p["a"])(i,2),u=c[0],d=c[1],null===d){e.next=10;break}return e.abrupt("return",[null,d]);case 10:for(s in Ct.commit("tree/".concat(Ae.SET_TREE),u),o)ee.subscribeMapNodeChange(s,(function(e){return Ct.dispatch("tree/".concat(Be.handleMapNodeUpdate),e)}));case 12:case"end":return e.stop()}}),e)}))),Ot.apply(this,arguments)}function vt(e){return ht.apply(this,arguments)}function ht(){return ht=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ee.getPins(t);case 2:if(n=e.sent,r=Object(p["a"])(n,2),o=r[0],a=r[1],null==o&&(a?console.error("fetchPins",a):console.log("fetchPins: empty pins")),!t||o){e.next=15;break}return e.next=10,ee.getPins(null);case 10:i=e.sent,c=Object(p["a"])(i,2),o=c[0],a=c[1],(null==o||a)&&(console.error(a),o={});case 15:Ct.commit("pin/".concat(m.SET_PINS),o);case 16:case"end":return e.stop()}}),e)}))),ht.apply(this,arguments)}function gt(e){return jt.apply(this,arguments)}function jt(){return jt=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ee.getPreconditions(t);case 2:if(n=e.sent,r=Object(p["a"])(n,2),o=r[0],a=r[1],(null==o||a)&&(console.error(a),o={}),!t||o){e.next=15;break}return e.next=10,ee.getPreconditions(null);case 10:i=e.sent,c=Object(p["a"])(i,2),o=c[0],a=c[1],(null==o||a)&&(console.error(a),o={});case 15:for(u in o)ee.subscribePreconditionNodeChange(u,(function(e,t){return Ct.commit("precondition/".concat(j.UPDATE_PRECONDITIONS),{nodeID:e,preconditionIDs:t})}));Ct.commit("precondition/".concat(j.SET_PRECONDITIONS),o);case 17:case"end":return e.stop()}}),e)}))),jt.apply(this,arguments)}function yt(e){return It.apply(this,arguments)}function It(){return It=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u,d,s,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ee.getNodeContent();case 2:if(n=e.sent,r=Object(p["a"])(n,2),o=r[0],a=r[1],null!=o&&!a){e.next=9;break}return A("fetchNodeContents error",{err:a}),e.abrupt("return");case 9:for(c in i={},o)i[c]={nodeID:o[c].nodeID,content:o[c].content},ee.subscribeNodeContentChange(i[c].nodeID,(function(e){bt(e.nodeID,e.content),Ct.commit("nodeContent/".concat(et.SET_NODE_CONTENT),e)}));if(Ct.commit("nodeContent/".concat(et.SET_CONTENTS),i),!t){e.next=25;break}return e.next=15,ee.getUserComments(t);case 15:if(u=e.sent,d=Object(p["a"])(u,2),s=d[0],l=d[1],!l){e.next=22;break}return A("fetch userComments error",{err:l,user:t}),e.abrupt("return");case 22:if(null!==s){e.next=24;break}return e.abrupt("return");case 24:Ct.commit("nodeContent/".concat(et.SET_USER_COMMENTS),s);case 25:case"end":return e.stop()}}),e)}))),It.apply(this,arguments)}function xt(e){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,mt(t);case 2:return e.next=4,vt(t);case 4:return e.next=6,gt(t);case 6:return e.next=8,yt(t);case 8:case"end":return e.stop()}}),e)}))),Nt.apply(this,arguments)}var Dt={init:"init",updateNodePosition:"updateNodePosition",createNode:"createNode",cutPasteNode:"cutPasteNode",removeNode:"removeNode",setEditMode:"setEditMode",subscribeDBChange:"subscribeDBChange",confirmSignInPopup:"confirmSignInPopup"},wt={SET_EDIT_MODE:"SET_EDIT_MODE",SET_SUBSCRIBED_NODE_IDS:"SET_SUBSCRIBED_NODE_IDS"},Tt=Object(_["debounce"])((function(e,t,n,r){var o=xe("normalize",t,n,r),a=Object(p["a"])(o,1),i=a[0];ee.update(Object(l["a"])({},"map/".concat(e,"/position"),i))}),200),kt=Symbol(),Ct=Object(b["a"])({state:{editModeOn:!1,subscribedNodeIDs:[]},mutations:(it={},Object(l["a"])(it,wt.SET_EDIT_MODE,(function(e,t){e.editModeOn=t})),Object(l["a"])(it,wt.SET_SUBSCRIBED_NODE_IDS,(function(e,t){e.subscribedNodeIDs=t})),it),actions:(ct={},Object(l["a"])(ct,Dt.confirmSignInPopup,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.dispatch,e.state,t.confirm.require({message:t.message,header:"SignIn",acceptLabel:"Ok, Sign In",rejectLabel:"No, thanks, just watching",accept:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r("user/".concat(Ye.signIn));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),reject:function(){}});case 2:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(ct,Dt.setEditMode,(function(e,t){var n=e.commit,r=e.state;n(wt.SET_EDIT_MODE,t),t||(r.subscribedNodeIDs.forEach((function(e){return ee.unsubscribeDBChange("map/"+e)})),n(wt.SET_SUBSCRIBED_NODE_IDS,[]))})),Object(l["a"])(ct,Dt.init,(function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.commit,ee.initFirebase(),G["a"].auth().onAuthStateChanged((function(e){e&&!e.isAnonymous?(ee.setPublicUserData(e.uid,e.displayName,null),n("user/".concat(We.SET_USER),e),xt(e)):(n("user/".concat(We.SET_USER),null),xt(null))}));case 3:case"end":return t.stop()}}),t)})))()})),Object(l["a"])(ct,Dt.createNode,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,s,b,f,m,O,v,h,g,j,y,I,x,N;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.state,i=a.tree.nodeRecord[t.parentID].node,c=F(i,a.tree.mapNodeLayers,!0),u=Object(p["a"])(c,3),d=u[0],s=u[1],b=u[2],null===b){n.next=6;break}return A("Cannot create new center",{err:b,parent:i,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 6:if(f=xe("normalize",d,t.parentID,a.tree.mapNodeLayers),m=Object(p["a"])(f,2),O=m[0],v=m[1],!v){n.next=10;break}return A("createNode: cannot create new center",{err:v,parent:i,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 10:return h=V(t.title,O),g={id:h.id,parentID:t.parentID,name:t.title,children:[],position:O},j=ee.generateKey(),r={},Object(l["a"])(r,"map/".concat(g.id),g),Object(l["a"])(r,"map/".concat(g.parentID,"/children/").concat(j),g.id),y=r,s&&(I=xe("normalize",s.position,t.parentID,a.tree.mapNodeLayers),x=Object(p["a"])(I,1),N=x[0],y["map/".concat(s.id,"/position")]=N),n.next=17,ee.update(y);case 17:return o("history/".concat(Ze.ADD_CREATE),{nodeID:h.id,parentID:t.parentID}),n.abrupt("return",h.id);case 19:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(ct,Dt.cutPasteNode,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,s,b,f,m,O,v,h,g,j,y,I,x,N;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.state,i=a.tree.nodeRecord[t.nodeID].parent,c=a.tree.nodeRecord[t.parentID].node,u=F(c,a.tree.mapNodeLayers,!0),d=Object(p["a"])(u,3),s=d[0],b=d[1],f=d[2],!f){n.next=7;break}return A("cutPasteNode: cannot getNewNodeCenter",{err:f}),n.abrupt("return");case 7:if(m=xe("normalize",s,t.parentID,a.tree.mapNodeLayers),O=Object(p["a"])(m,2),v=O[0],h=O[1],!h){n.next=11;break}return A("cutPasteNode: cannot create new center",{err:h,parent:parent,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 11:return g=ee.generateKey(),n.next=14,ee.findKeyOfChild(i.id,t.nodeID);case 14:return j=n.sent,r={},Object(l["a"])(r,"map/".concat(t.nodeID,"/parentID"),c.id),Object(l["a"])(r,"map/".concat(i.id,"/children/").concat(j),null),Object(l["a"])(r,"map/".concat(c.id,"/children/").concat(g),t.nodeID),Object(l["a"])(r,"map/".concat(t.nodeID,"/position"),v),y=r,b&&(I=xe("normalize",b.position,t.parentID,a.tree.mapNodeLayers),x=Object(p["a"])(I,1),N=x[0],y["map/".concat(b.id,"/position")]=N),n.next=19,ee.update(y);case 19:o("history/".concat(Ze.ADD_CUT_PASTE),{nodeID:t.nodeID,parentID:t.parentID});case 20:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(ct,Dt.removeNode,(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,s,l,p,b,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,o=e.state,a=o.tree.nodeRecord[t].parent,a){n.next=4;break}return n.abrupt("return");case 4:return i=a.id,n.next=7,ee.getNode(t);case 7:c=n.sent,u=Object(_["clone"])(c.children),s={};case 10:if(!(u.length>0)){n.next=18;break}if(l=u.pop(),l&&o.tree.nodeRecord[l]&&o.tree.nodeRecord[l].node&&o.tree.nodeRecord[l].parent){n.next=14;break}return n.abrupt("continue",10);case 14:s[l]={id:l,parentID:o.tree.nodeRecord[l].parent.id,name:o.tree.nodeRecord[l].node.title,children:o.tree.nodeRecord[l].node.children.map((function(e){return e.id})),position:o.tree.nodeRecord[l].node.position},u.push.apply(u,Object(d["a"])(o.tree.nodeRecord[l].node.children.map((function(e){return e.id})))),n.next=10;break;case 18:return p={},n.next=21,ee.findKeyOfChild(a.id,t);case 21:for(f in b=n.sent,p["trash/".concat(t,"/map")]=c,p["map/".concat(t)]=null,p["map/".concat(a.id,"/children/").concat(b)]=null,o.nodeContent.nodeContents[t]&&(p["trash/".concat(t,"/node_content")]=o.nodeContent.nodeContents[t],p["node_content/".concat(t)]=null),o.precondition.preconditions[t]&&(p["trash/".concat(t,"/precondition")]=o.precondition.preconditions[t],p["precondition/".concat(t)]=null),s)p["trash/".concat(f,"/map")]=s[f],p["map/".concat(f)]=null,o.nodeContent.nodeContents[f]&&(p["trash/".concat(f,"/node_content")]=o.nodeContent.nodeContents[f],p["node_content/".concat(f)]=null),o.precondition.preconditions[f]&&(p["trash/".concat(f,"/precondition")]=o.precondition.preconditions[f],p["precondition/".concat(f)]=null);return n.next=30,ee.update(p);case 30:r("history/".concat(Ze.ADD_REMOVE),{parentNodeID:i,nodeID:t});case 31:case"end":return n.stop()}}),n)})))()})),Object(l["a"])(ct,Dt.updateNodePosition,(function(e,t){var n=e.commit,r=e.state;if(r.editModeOn){var o=z(t.nodeId,r.tree.mapNodeLayers),a=Object(p["a"])(o,1),i=a[0];if(!i)return k("UPDATE_NODE_POSITION: cannot find mapNode",{"v.nodeId":t.nodeId,"state.mapNodeLayers":r.tree.mapNodeLayers});var c=Oe({from:{x:0,y:0},to:i.center},{from:{x:0,y:0},to:t.delta}).to,u={nodeId:t.nodeId,newCenter:c,returnError:null};n("tree/".concat(Ae.UPDATE_NODE_POSITION),u),null===u.returnError&&(n("history/".concat(Ze.ADD_POSITION_CHANGE),{nodeID:t.nodeId,oldPosition:i.center,newPosition:c}),Tt(t.nodeId,c,r.tree.nodeRecord[t.nodeId].parent.id,r.tree.mapNodeLayers))}})),ct),modules:{pin:v,titleBox:g,precondition:y,positionChangePermits:D,tree:ze,user:Xe,zoomPan:qe,history:Qe,nodeContent:ut,searchResult:st}});function Et(){return Object(b["b"])(kt)}var Rt=Object(r["n"])({setup:function(){var e=Et();e.dispatch(Dt.init)}});Rt.render=o;var _t=Rt,St=n("9319"),Mt=n("b24b"),Pt=n("485c"),Lt=n("6c02"),At=Object(r["l"])(" This section is just for test/emulator cases for now "),Bt=Object(r["m"])("input",{id:"email"},null,-1),zt=Object(r["m"])("input",{id:"password"},null,-1);function Ut(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])(r["a"],null,[At,Bt,zt,Object(r["m"])("button",{onClick:t[1]||(t[1]=function(){return e.login&&e.login.apply(e,arguments)})},"login")],64)}var Vt=Object(r["n"])({name:"PasswordLogin",setup:function(){Et();return{login:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=document.getElementById("email"),n=document.getElementById("password"),e.next=4,G["a"].auth().signInWithEmailAndPassword(t.value,n.value);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}}});Vt.render=Ut;var Ft=Vt;function Ht(e,t,n,o,a,i){var c=Object(r["I"])("ConfirmDialog"),u=Object(r["I"])("Toast"),d=Object(r["I"])("NodeContent"),s=Object(r["I"])("Menu"),l=Object(r["I"])("Map");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c),Object(r["m"])(u,{position:"bottom-left"}),Object(r["m"])(d,{clickedTitleId:e.clickedTitleId,onSelectPreconditionIsOn:e.setSelectPreconditionON,onSelectPreconditionIsOff:e.setSelectPreconditionOFF,show:!e.editModeOn,selectedNodeId:e.selectedNodeId},null,8,["clickedTitleId","onSelectPreconditionIsOn","onSelectPreconditionIsOff","show","selectedNodeId"]),Object(r["m"])(s),Object(r["m"])(l,{layers:e.visibleZoomedPanedLayers,selectedNodeId:e.selectedNodeId,selectedNodePreconditionIds:e.selectedNodePreconditionIds,"pin-nodes":e.pinNodes,searchResultPinNodes:e.searchResultPinNodes,searchResultNodeIDs:e.searchResultNodeIDs,onTitleDragging:e.nodeDragging,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave,onDraggingBackground:e.mapDragging,onWheel:e.zoom},null,8,["layers","selectedNodeId","selectedNodePreconditionIds","pin-nodes","searchResultPinNodes","searchResultNodeIDs","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave","onDraggingBackground","onWheel"])],64)}function Gt(e,t,n,o,a,i){var c=Object(r["I"])("MapLayer"),u=Object(r["I"])("PreconditionLayer"),d=Object(r["I"])("PinLayer");return Object(r["z"])(),Object(r["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",width:e.svgWidth,height:e.svgHeight,id:e.mapID,style:{"touch-action":"none"}},[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.layers,(function(t,n){return Object(r["z"])(),Object(r["g"])(c,{key:n,"layer-id":n,"map-nodes":t,"border-color":e.borderColor(n),"font-color":e.fontColor(n),"font-size":e.fontSize(n),"font-opacity":e.fontOpacity(n),selectedNodeId:e.selectedNodeId,selectedNodePreconditionIds:e.selectedNodePreconditionIds,searchResultNodeIDs:e.searchResultNodeIDs,"map-id":e.mapID,onTitleDragging:e.draggingNode,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["layer-id","map-nodes","border-color","font-color","font-size","font-opacity","selectedNodeId","selectedNodePreconditionIds","searchResultNodeIDs","map-id","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave"])})),128)),Object(r["m"])(u,{selectedNodeId:e.selectedNodeId,visibleTitleIds:e.visibleTitleIds,"layer-id":"precondition",onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["selectedNodeId","visibleTitleIds","onTitleClick","onTitleOver","onTitleLeave"]),Object(r["m"])(d,{pinNodes:e.pinNodes,"layer-id":"pinNodes",color:"pink","font-size":8,"font-weight":"normal","text-decoration":"none",selectedNodeId:e.selectedNodeId,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["pinNodes","selectedNodeId","onTitleClick","onTitleOver","onTitleLeave"]),Object(r["m"])(d,{pinNodes:e.searchResultPinNodes,"layer-id":"searchResultPinNodes",color:"red","font-size":10,"font-weight":"bold","text-decoration":"underline",selectedNodeId:e.selectedNodeId,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["pinNodes","selectedNodeId","onTitleClick","onTitleOver","onTitleLeave"])],8,["width","height","id"])}n("4057");var qt=Object(r["W"])("data-v-59d7967e"),Wt=qt((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])(r["a"],null,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.mapNodes,(function(t,n){return Object(r["z"])(),Object(r["g"])("polygon",{key:n,stroke:e.borderColor,fill:e.polygonFill(e.selectedNodeId,t.id,e.selectedNodePreconditionIds),"fill-opacity":e.polygonFillOpacity(e.selectedNodeId,t.id,e.selectedNodePreconditionIds),"stroke-width":"2",points:e.polygonToPath(t.border),"pointer-events":"none"},null,8,["stroke","fill","fill-opacity","points"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.mapNodes,(function(t){return Object(r["z"])(),Object(r["g"])("text",{id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,"font-family":"Roboto","font-size":e.fontSize,"font-weight":e.textWeight(t.id,e.selectedNodeId),fill:e.textColor(t.id,e.selectedNodeId),"fill-opacity":e.fontOpacity,"text-decoration":e.textDecoration(t.id),class:"text"},[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.splitLines(t.title,20),(function(n,o){return Object(r["z"])(),Object(r["g"])("tspan",{key:o,x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y+o*e.fontSize:0,"alignment-baseline":"hanging"},Object(r["M"])(n),9,["x","y"])})),128))],8,["id","font-size","font-weight","fill","fill-opacity","text-decoration"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.mapNodes,(function(t){return Object(r["z"])(),Object(r["g"])("rect",{key:t.id,x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y:0,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,fill:"transparent","stroke-width":"0",onMouseover:function(n){return e.titleOver(t.id)},onMouseleave:function(n){return e.titleLeave(t.id)},onClick:function(n){return e.titleClick(t.id)},onMousedown:function(n){return e.titleMouseDown(t.id)},stroke:"pink",cursor:"pointer","pointer-events":"fill"},null,40,["x","y","width","height","onMouseover","onMouseleave","onClick","onMousedown"])})),128))],64)})),Yt=function(e,t,n){n.nodeId&&(n.dragStart=!0,e("title-dragging",{nodeId:n.nodeId,delta:{x:t.movementX,y:t.movementY}}))},Xt=function(e,t){t.nodeId&&(t.dragStart&&e("title-drop",{id:t.nodeId}),t.dragStart=!1,t.nodeId=null)},Zt=function(e){var t={};for(var n in e){var r=e[n];t[r.id]={position:r.center,bbox:{width:0,height:0}}}return t},Kt=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n,o){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={},e.next=3,Object(r["s"])((function(){for(var e in o){var r=o[e],i=document.getElementById("".concat(t).concat(r.id));null!=i&&("center"==n?a[r.id]={position:{x:r.center.x-i.getBoundingClientRect().width/2,y:r.center.y-i.getBoundingClientRect().height/2},bbox:{width:i.getBoundingClientRect().width,height:i.getBoundingClientRect().height}}:"left"==n&&(a[r.id]={position:{x:r.center.x-i.getBoundingClientRect().width,y:r.center.y-i.getBoundingClientRect().height/2},bbox:{width:i.getBoundingClientRect().width,height:i.getBoundingClientRect().height}}))}}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),$t=function(e,t,n,o){o(Zt(n.value)),Object(r["R"])(n,function(){var n=Object(s["a"])(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",Kt(e,t,r).then((function(e){return o(e)})));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),{immediate:!0})};n("1276");function Jt(e,t){if(t<=0)return[];if(""==e)return[];var n=e.split(" "),r=[],o=[];while(n.length)if(o.join(" ").length>t){var a=[];o.length>1&&a.push(o.pop()),r.push(o.join(" ")),o=a}else o.push(n.shift());if(o.join(" ").length>t){var i=[];o.length>1&&i.push(o.pop()),r.push(o.join(" ")),o=i}return o.length&&r.push(o.join(" ")),r}var Qt="title_",en=Object(r["n"])({name:"MapLayer",emits:["title-over","title-leave","title-click","title-drop","title-dragging"],props:{layerId:{type:Number},mapId:{type:String,required:!0},mapNodes:{type:Object,required:!0},borderColor:{type:String,required:!0},fontSize:{type:Number,required:!0},fontColor:{type:String,required:!0},fontOpacity:{type:Number,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0},selectedNodePreconditionIds:Object,searchResultNodeIDs:Object},setup:function(e,t){var n=Object(r["N"])(e,"mapNodes"),o=Et(),a="map_"+e.layerId,i=Object(r["e"])((function(){return o.state.titleBox.layerMap[a]}));$t(Qt,"center",n,(function(e){o.commit("titleBox/".concat(h.SET_MAP),{layerName:a,titleBoxMap:e})}));var c={nodeId:null,dragStart:!1},u=function(e){return Yt(t.emit,e,c)},d=function(){return Xt(t.emit,c)};Object(r["x"])((function(){var t=document.getElementById(e.mapId);t?(t.addEventListener("mousemove",u),t.addEventListener("mouseup",d)):A("MapLayer.vue: cannot find map id for event listener",{})})),Object(r["y"])((function(){var t=document.getElementById(e.mapId);t?(t.removeEventListener("mousemove",u),t.removeEventListener("mouseup",d)):A("MapLayer.vue: cannot find map id for event listener",{})}));var s=Object(r["e"])((function(){var t={};if(!e.searchResultNodeIDs)return t;var n,r=Object(f["a"])(e.searchResultNodeIDs);try{for(r.s();!(n=r.n()).done;){var o=n.value;t[o]=!0}}catch(a){r.e(a)}finally{r.f()}return t}));return{TITLE_PREFIX:Qt,titleBox:i,textColor:function(t,n){var r;return n&&n==t||e.selectedNodePreconditionIds&&-1!=(null===(r=e.selectedNodePreconditionIds)||void 0===r?void 0:r.indexOf(t))?"#ffa500":s.value[t]?"red":e.fontColor},textWeight:function(e,t){return t&&t==e||s.value[e]?"bold":"normal"},textDecoration:function(e){return s.value[e]?"underline":"none"},titleClick:function(e){t.emit("title-click",{id:e})},titleOver:function(e){t.emit("title-over",{id:e})},titleLeave:function(e){t.emit("title-leave",{id:e})},titleMouseDown:function(e){c.nodeId=e,c.dragStart=!1}}},methods:{splitLines:Jt,polygonToPath:be,polygonFill:le,polygonFillOpacity:pe}});n("e35d");en.render=Wt,en.__scopeId="data-v-59d7967e";var tn=en,nn={on:!1},rn=function(){nn.on=!0},on=function(){nn.on=!1},an=function(e,t){nn.on&&e("dragging-background",t)},cn={mouseDown:rn,mouseUp:on,mouseMove:an};function un(e,t,n,o,a,i){var c=Object(r["I"])("PinMarker"),u=Object(r["I"])("SVGTextBox");return Object(r["z"])(),Object(r["g"])(r["a"],null,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.visiblePinNodes,(function(t){return Object(r["z"])(),Object(r["g"])(c,{key:t.id,x:t.center.x,y:t.center.y,color:e.color},null,8,["x","y","color"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.visiblePinNodes,(function(t){return Object(r["z"])(),Object(r["g"])(u,{text:t.title,id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,useLineBreak:!0,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,"line-height":8,"max-char-per-line":10,"font-family":"Roboto","font-size":e.fontSize,"font-weight":e.fontWeight,color:e.color,"text-decoration":e.textDecoration},null,8,["text","id","x","y","font-size","font-weight","color","text-decoration"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.pinNodes,(function(t){return Object(r["z"])(),Object(r["g"])("rect",{key:t.id,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,cursor:"pointer",fill:"transparent",onClick:function(n){return e.titleBoxClick(t.id)},onMouseover:function(n){return e.titleOver(t.id)},onMouseleave:function(n){return e.titleLeave(t.id)},"stroke-width":"0",stroke:"pink"},null,40,["x","y","width","height","onClick","onMouseover","onMouseleave"])})),128))],64)}function dn(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("g",{transform:"translate(".concat(e.x-e.WIDTH/2," ").concat(e.y-e.HEIGHT,") scale(0.05 0.05)")},[Object(r["m"])("path",{fill:"".concat(e.color),d:"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n        C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n        c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z"},null,8,["fill"])],8,["transform"])}var sn=18,ln=26,pn=Object(r["n"])({name:"PinMarker",props:{x:{type:Number,required:!0},y:{type:Number,required:!0},color:{type:String,required:!0}},setup:function(){return{WIDTH:sn,HEIGHT:ln}}});pn.render=dn;var bn=pn,fn=Object(r["W"])("data-v-3400d8a7"),mn=fn((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("text",{id:e.id,"font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,fill:e.color,class:"text"},[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.lines,(function(t,n){return Object(r["z"])(),Object(r["g"])("tspan",{key:n,x:e.x,y:e.y>0?e.y+n*e.lineHeight:0,"alignment-baseline":"hanging"},Object(r["M"])(t),9,["x","y"])})),128))],8,["id","font-family","font-size","font-weight","fill"])})),On=Object(r["n"])({name:"SVGTextBox",props:{id:{type:String,required:!0},useLineBreak:{type:Boolean,required:!0},text:{type:String,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},lineHeight:{type:Number,required:!0},maxCharPerLine:{type:Number,required:!0},fontFamily:{type:String,required:!0},fontSize:{type:Number,required:!0},fontWeight:{type:String,required:!0},color:{type:String,required:!0}},setup:function(e){var t=[];return t=e.useLineBreak?Jt(e.text,e.maxCharPerLine):[e.text],{lines:t}}});n("1d0f");On.render=mn,On.__scopeId="data-v-3400d8a7";var vn=On,hn="pin_title_",gn=Object(r["n"])({name:"PinLayer",components:{SVGTextBox:vn,PinMarker:bn},emits:["title-click","title-over","title-leave"],props:{layerId:String,pinNodes:{type:Object,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0},color:{type:String},fontWeight:{type:String},fontSize:{type:Number},textDecoration:{type:String}},setup:function(e,t){var n=Object(r["e"])((function(){var t,n={},r=Object(f["a"])(e.pinNodes);try{for(r.s();!(t=r.n()).done;){var o=t.value;n[o.id]=o}}catch(a){r.e(a)}finally{r.f()}return n})),o=Object(r["e"])((function(){var t,n={},r=Object(f["a"])(e.pinNodes);try{for(r.s();!(t=r.n()).done;){var o=t.value;o.id!=e.selectedNodeId&&(n[o.id]=o)}}catch(a){r.e(a)}finally{r.f()}return n})),a=Et(),i="pin_"+e.layerId,c=Object(r["e"])((function(){return a.state.titleBox.layerMap[i]}));return $t(hn,"left",n,(function(e){a.commit("titleBox/".concat(h.SET_MAP),{layerName:i,titleBoxMap:e})})),{TITLE_PREFIX:hn,PIN_MARKER_HEIGHT:ln,PIN_MARKER_WIDTH:sn,visiblePinNodes:o,titleBox:c,titleXY:Object(r["e"])((function(){var e={};for(var t in n.value){var r=n.value[t];e[r.id]={x:c.value[r.id]?c.value[r.id].position.x:0,y:c.value[r.id]?c.value[r.id].position.y:0}}return e})),titleBoxClick:function(e){t.emit("title-click",{id:e})},titleOver:function(e){t.emit("title-over",{id:e})},titleLeave:function(e){t.emit("title-leave",{id:e})}}}});gn.render=un;var jn=gn,yn=Object(r["m"])("defs",null,[Object(r["m"])("marker",{id:"preconditionArrowHead",markerWidth:"6",markerHeight:"7",refX:"3",refY:"3.5",orient:"auto"},[Object(r["m"])("polygon",{fill:"#aae3b9",stroke:"#aae3b9",points:"0 0, 6 3.5, 0 7"})])],-1);function In(e,t,n,o,a,i){var c=Object(r["I"])("PreconditionArrow"),u=Object(r["I"])("SVGTextBox");return Object(r["z"])(),Object(r["g"])(r["a"],null,[yn,(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.preconditions,(function(t){return Object(r["z"])(),Object(r["g"])(c,{key:t.id,markerId:"preconditionArrow",from:t.center,to:e.selectedNode.center,color:"#aae3b9"},null,8,["from","to"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.visibleTitleNodes,(function(t){return Object(r["z"])(),Object(r["g"])(u,{text:t.title,id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,useLineBreak:!0,x:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.x:0,y:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.y:0,"line-height":8,"max-char-per-line":10,"font-family":"Roboto","font-size":8,"font-weight":"normal",color:"#ffa500"},null,8,["text","id","x","y"])})),128)),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.visibleTitleNodes,(function(t){return Object(r["z"])(),Object(r["g"])("rect",{key:t.id,x:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.x:0,y:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].position.y:0,width:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].bbox.width:0,height:e.visibleTitleNodeBoxes[t.id]?e.visibleTitleNodeBoxes[t.id].bbox.height:0,cursor:"pointer",fill:"transparent",onClick:function(n){return e.titleBoxClick(t.id)},onMouseover:function(n){return e.titleBoxOver(t.id)},onMouseleave:function(n){return e.titleBoxLeave(t.id)},"stroke-width":"0",stroke:"pink"},null,40,["x","y","width","height","onClick","onMouseover","onMouseleave"])})),128))],64)}function xn(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("line",{x1:e.from.x,y1:e.from.y,x2:e.to.x,y2:e.to.y,stroke:e.color,"stroke-width":"1","marker-end":"url(#preconditionArrowHead)"},null,8,["x1","y1","x2","y2","stroke"])}var Nn=Object(r["n"])({name:"PreconditionArrow",props:{markerId:String,color:String,from:Object,to:Object}});Nn.render=xn;var Dn=Nn,wn=3;function Tn(e,t,n){return{x:e.x*t+n.x,y:e.y*t+n.y}}function kn(e,t,n){return e.map((function(e){return Tn(e,t,n)}))}function Cn(e,t,n,r,o,a){if(!e||0==e.length)return["",null];var i=null,c=n.width*n.height,u=e[0];while(Object.keys(u).length){for(var d in i="",u){var s=kn(u[d].border,r,o);if(oe(a,s)){i=d;break}}if(""===i){var l=1/0;for(var b in u){var m=Tn(u[b].center,r,o),O=ne({from:m,to:a});O<l&&(l=O,i=b)}}var v=ie(kn(u[i].border,r,o));if(Math.floor(v)<=Math.floor(c/wn))return null==t[i].parent?[i,null]:[t[i].parent.id,null];if(u={},!t[i])return["",k("findCurrentNode: cannot find underCursorNodeId in nodeRecord",{maxIntersectNodeId:i,nodeRecord:t})];var h,g=Object(f["a"])(t[i].node.children);try{for(g.s();!(h=g.n()).done;){var j=h.value,y=z(j.id,e),I=Object(p["a"])(y,1),x=I[0];if(null==x)return["",k("filterNodesAndLayers: Cannot find node in layers",{"child.id":j.id,layers:e})];u[j.id]=x}}catch(N){g.e(N)}finally{g.f()}if(0===Object.keys(u).length)return[i,null]}return["",k("filterNodesAndLayers: unknown error",{})]}function En(e,t,n){if(!e||!e.length)return[[],null];var r=[],o=z(n,e),a=Object(p["a"])(o,2),i=a[0],c=a[1];if(null==i||null==c)return[[],k("filterNodesAndLayers-currentNode: error in findMapNode",{currentNodeId:n,layers:e})];var u={};if(null==t[i.id].parent)u[i.id]=L(i);else{var d,s=Object(f["a"])(t[i.id].parent.children);try{for(s.s();!(d=s.n()).done;){var l=d.value,b=z(l.id,[e[c]]),m=Object(p["a"])(b,2),O=m[0],v=m[1];if(null==O||null===v)return[[],k("filterNodesAndLayers-upperLayer: error in findMapNode",{"child.id":l.id,level:c,layers:[e[c]]})];u[l.id]=L(O),u[l.id].title=""}}catch(K){s.e(K)}finally{s.f()}}r.push(u);var h={};for(var g in u){var j,y=Object(f["a"])(t[g].node.children);try{for(y.s();!(j=y.n()).done;){var I=j.value,x=z(I.id,[e[c+1]]),N=Object(p["a"])(x,2),D=N[0],w=N[1];if(null==D||null===w)return[[],k("filterNodesAndLayers-firstLayer: error in findMapNode",{"child.id":I.id,layers:[e[c+1]]})];g!=n?(h[I.id]=L(D),h[I.id].title=""):h[I.id]=L(D)}}catch(K){y.e(K)}finally{y.f()}}Object.keys(h).length>0&&r.push(h);var T,C={},E=Object(f["a"])(t[n].node.children);try{for(E.s();!(T=E.n()).done;){var R,_=T.value,S=Object(f["a"])(t[_.id].node.children);try{for(S.s();!(R=S.n()).done;){var M=R.value,P=z(M.id,[e[c+2]]),A=Object(p["a"])(P,2),B=A[0],U=A[1];if(null==B||null===U)return[[],k("filterNodesAndLayers-secondLayer: error in findMapNode",{"child.id":_.id,layers:[e[c+2]]})];C[M.id]=L(B)}}catch(K){S.e(K)}finally{S.f()}}}catch(K){E.e(K)}finally{E.f()}Object.keys(C).length>0&&r.push(C);var V={};for(var F in C){var H,G=Object(f["a"])(t[F].node.children);try{for(G.s();!(H=G.n()).done;){var q=H.value,W=z(q.id,[e[c+3]]),Y=Object(p["a"])(W,2),X=Y[0],Z=Y[1];if(null==X||null===Z)return[[],k("filterNodesAndLayers-thirdLayer:cannot findMapNode",{"child.id":q.id,level:c+3,layers:[e[c+3]]})];V[q.id]=L(X),V[q.id].title=""}}catch(K){G.e(K)}finally{G.f()}}return Object.keys(V).length>0&&r.push(V),[r,null]}function Rn(e,t,n){if(!e||0==e.length)return[];var r,o=Object(f["a"])(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;for(var i in a){var c=a[i];c.center=Tn(c.center,t,n),c.border=kn(c.border,t,n)}}}catch(u){o.e(u)}finally{o.f()}return e}var _n="precondition_title_",Sn=Object(r["n"])({name:"PreconditionLayer",emits:["title-over","title-leave","title-click"],components:{SVGTextBox:vn,PreconditionArrow:Dn},props:{layerId:String,selectedNodeId:String,visibleTitleIds:Object},setup:function(e,t){var n=Et(),o=n.state.zoomPan,a=Object(r["e"])((function(){if(e.selectedNodeId&&n.state.tree.mapNodeLayers){var t=z(e.selectedNodeId,n.state.tree.mapNodeLayers),r=Object(p["a"])(t,1),a=r[0];if(!a)return null;var i=L(a);return i.center=Tn(i.center,o.zoom,o.pan),i}return null})),i=Object(r["F"])({}),c=Object(r["F"])({}),u="precondition",d=Object(r["e"])((function(){return n.state.titleBox.layerMap[u]}));return $t(_n,"left",c,(function(e){n.commit("titleBox/".concat(h.SET_MAP),{layerName:u,titleBoxMap:e})})),Object(r["S"])((function(){var t;if(i.value={},c.value={},e.selectedNodeId&&n.state.precondition.preconditions[e.selectedNodeId]&&n.state.tree.mapNodeLayers){var r,u=L(U(n.state.precondition.preconditions[e.selectedNodeId],n.state.tree.mapNodeLayers)),d=Object(f["a"])(u);try{for(d.s();!(r=d.n()).done;){var s=r.value;s.center=Tn(s.center,o.zoom,o.pan),i.value[s.id]=s}}catch(b){d.e(b)}finally{d.f()}}for(var l in i.value){var p;-1==(null===(p=e.visibleTitleIds)||void 0===p?void 0:p.indexOf(l))&&(c.value[l]=i.value[l])}e.selectedNodeId&&a.value&&n.state.tree.mapNodeLayers&&-1==(null===(t=e.visibleTitleIds)||void 0===t?void 0:t.indexOf(e.selectedNodeId))&&(c.value[e.selectedNodeId]=a.value)})),{TITLE_PREFIX:_n,selectedNode:a,preconditions:i,visibleTitleNodes:c,visibleTitleNodeBoxes:d,titleBoxClick:function(e){t.emit("title-click",{id:e})},titleBoxOver:function(e){t.emit("title-over",{id:e})},titleBoxLeave:function(e){t.emit("title-leave",{id:e})}}}});Sn.render=In;var Mn=Sn,Pn="mapID",Ln=Object(r["n"])({name:"Map",emits:["title-dragging","title-click","title-over","title-leave","dragging-background","wheel"],components:{PreconditionLayer:Mn,PinLayer:jn,MapLayer:tn},props:{layers:Object,selectedNodeId:{type:String||null,validator:function(e){return"string"===typeof e||null===e},required:!0},selectedNodePreconditionIds:Object,pinNodes:Object,searchResultPinNodes:Object,searchResultNodeIDs:Object},setup:function(e,t){return Object(r["x"])((function(){var e=document.getElementById(Pn);if(e){e.addEventListener("mousedown",(function(e){cn.mouseDown()})),e.addEventListener("mouseup",(function(e){cn.mouseUp()})),e.addEventListener("mousemove",(function(e){cn.mouseMove(t.emit,{from:{x:e.clientX-e.movementX,y:e.clientY-e.movementY},to:{x:e.clientX,y:e.clientY}})})),e.addEventListener("wheel",(function(e){t.emit("wheel",{delta:e.deltaY,center:{x:e.clientX,y:e.clientY}})}),{passive:!0});var n=1/0,r={x:1/0,y:1/0};e.addEventListener("touchstart",(function(e){cn.mouseDown()}),{passive:!0}),e.addEventListener("touchend",(function(e){n=1/0,r.x=1/0,r.y=1/0,cn.mouseUp()})),e.addEventListener("touchmove",(function(e){if(1===e.touches.length)r.x!=1/0&&r.y!=1/0&&cn.mouseMove(t.emit,{from:r,to:{x:e.touches[0].clientX,y:e.touches[0].clientY}}),r.x=e.touches[0].clientX,r.y=e.touches[0].clientY;else if(2===e.touches.length){var o=0,a=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);n!==1/0&&(o=n-a),n=a,t.emit("wheel",{delta:o,center:{x:(e.touches[0].pageX-e.touches[1].pageX)/2,y:(e.touches[0].pageY-e.touches[1].pageY)/2}})}}),{passive:!0})}else A("Map.vue: cannot find map id for event listener",{})})),{svgWidth:window.innerWidth,svgHeight:.99*window.innerHeight,visibleTitleIds:Object(r["e"])((function(){if(!e.layers)return[];var t,n=[],r=Object(f["a"])(e.layers);try{for(r.s();!(t=r.n()).done;){var o=t.value;for(var a in o)""!=o[a].title&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n})),draggingNode:function(e){t.emit("title-dragging",{id:e.nodeId,delta:e.delta})},titleClick:function(e){t.emit("title-click",{id:e.id})},titleOver:function(e){t.emit("title-over",{id:e.id})},titleLeave:function(e){t.emit("title-leave",{id:e.id})},mapID:Pn,fontSize:function(t){var n=0,r={0:6,1:11,2:21,3:28};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),n},fontOpacity:function(t){var n=0,r={0:1,1:1,2:.2,3:1};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),n},fontColor:function(t){return e.layers.length>=4?"rgb(".concat(200-100*t,",").concat(200-100*t,",").concat(200-100*t,")"):3==e.layers.length?"rgb(".concat(200-100*(t+1),",").concat(200-100*(t+1),",").concat(200-100*(t+1),")"):""},borderColor:function(t){var n=0,r={0:240,1:200,2:100,3:90};return e.layers.length>=4&&(n=r[t]),3==e.layers.length&&(n=r[t+1]),"rgb(".concat(n,",").concat(n,",").concat(n,")")}}}});Ln.render=Gt;var An=Ln,Bn=n("0622"),zn=n.n(Bn),Un=n("99ba"),Vn=n.n(Un),Fn=n("1fec"),Hn=n.n(Fn),Gn=n("ec58"),qn=n.n(Gn),Wn=n("1158"),Yn=n.n(Wn),Xn=n("2c60"),Zn=n.n(Xn),Kn=Object(r["W"])("data-v-2dae896a");Object(r["C"])("data-v-2dae896a");var $n={key:0,class:"wrapper"},Jn={class:"p-fluid"},Qn={class:"p-field p-grid"},er=Object(r["m"])("div",{class:"p-col-12"},[Object(r["m"])("div",{style:{height:"240px"}})],-1),tr={class:"p-col-10"},nr={class:"p-col-2"},rr={class:"p-col-12"},or={class:"p-field p-grid"},ar={class:"p-col-12 p-md-12"},ir={class:"p-field p-grid"},cr=Object(r["m"])("div",{class:"p-col-10 section"}," based on ",-1),ur={class:"p-col-2"},dr=Object(r["m"])("div",{class:"p-field p-grid"},[Object(r["m"])("div",{class:"p-col-10 section"}," used by ")],-1),sr={key:1,class:"wrapper"},lr=Object(r["m"])("div",{class:"p-fluid"},[Object(r["m"])("div",{class:"p-field p-grid"},[Object(r["m"])("div",{class:"p-col-12"},[Object(r["m"])("div",{style:{height:"60px"}})]),Object(r["m"])("div",{class:"p-col-12"},[Object(r["m"])("div",{class:"title"}," Welcome to new way of knowledge crowdsourcing! ")]),Object(r["m"])("div",{class:"p-col-12"},[Object(r["m"])("iframe",{width:"100%",height:"225px",src:"https://www.youtube.com/embed/4S9sDyooxf4?si=u4z2DkDwNTsVdMBH",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""})]),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:zn.a,style:{width:"25px"}})]),Object(r["m"])("div",{class:"p-col-11 list"}," Sign in to edit map "),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:Vn.a,style:{width:"30px"}})]),Object(r["m"])("div",{class:"p-col-11 list"}," Keep description focused and simple but profound (i - snippet with example of formula and image markdown) "),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:Hn.a,style:{width:"30px"}})]),Object(r["m"])("div",{class:"p-col-11 list"},[Object(r["l"])(" Use "),Object(r["m"])("b",null,'"based on"'),Object(r["l"])(" to link nodes that are necessary for solid understanding of your description ")]),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:qn.a,style:{width:"30px"}})]),Object(r["m"])("div",{class:"p-col-11 list"}," Pin nodes that you are focused on "),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:Yn.a,style:{width:"30px"}})]),Object(r["m"])("div",{class:"p-col-11 list"}," Not only description, if you know actions one can take to push knowledge further (vacancies, crowdsourcing etc) - add it! "),Object(r["m"])("div",{class:"p-col-1 icon"},[Object(r["m"])("img",{alt:"logo",src:Zn.a,style:{width:"20px"}})]),Object(r["m"])("div",{class:"p-col-11 list"},[Object(r["l"])(" Talk to your coauthors to make description better in "),Object(r["m"])("a",{target:"_blank",href:"https://discord.com/channels/1171118046543347782/1171118047587745953"},"chat")]),Object(r["m"])("div",{class:"p-col-12 list"},[Object(r["m"])("i",null,"If you thank we need more rules or change these ones, feel free to discuss them in community chat")])])],-1);Object(r["A"])();var pr=Kn((function(e,t,n,o,a,i){var c=Object(r["I"])("TitleImage"),u=Object(r["I"])("Title"),d=Object(r["I"])("PinButton"),s=Object(r["I"])("Markdown"),l=Object(r["I"])("TextArea"),p=Object(r["I"])("AddBasedOnButton"),b=Object(r["I"])("SectionPreconditions"),f=Object(r["I"])("SectionUsedBy"),m=Object(r["I"])("ChangeLog");return e.show&&e.selectedNode?(Object(r["z"])(),Object(r["g"])("div",$n,[Object(r["m"])("div",Jn,[Object(r["m"])(c,{nodeID:e.selectedNodeContent?e.selectedNodeContent.nodeID:""},null,8,["nodeID"]),Object(r["m"])("div",Qn,[er,Object(r["m"])("div",tr,[Object(r["m"])(u,{content:e.selectedNodeContent?e.selectedNode.title:"",onContentChanged:t[1]||(t[1]=function(t){return e.changeNodeTitle(t)})},null,8,["content"])]),Object(r["m"])("div",nr,[Object(r["m"])(d)]),Object(r["m"])("div",rr,[Object(r["m"])(s,{content:e.selectedNodeContent?e.selectedNodeContent.content:"",rows:20,onContentChanged:t[2]||(t[2]=function(t){return e.changeContent(t)})},null,8,["content"])])]),Object(r["m"])("div",or,[Object(r["m"])("div",ar,[Object(r["m"])(l,{id:"comment",placeholder:"Your notes (visible only to you)",autoResize:!0,rows:"2",value:e.selectedNodeComment,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.changeComment(t)}),onKeydown:e.checkAuthorized},null,8,["value","onKeydown"])])]),Object(r["m"])("div",ir,[cr,Object(r["m"])("div",ur,[Object(r["m"])(p,{clickedTitleId:e.clickedTitleId,onSelectPreconditionIsOn:t[4]||(t[4]=function(t){return e.$emit("select-precondition-is-on")}),onSelectPreconditionIsOff:t[5]||(t[5]=function(t){return e.$emit("select-precondition-is-off")})},null,8,["clickedTitleId"])])]),e.selectedNodeContent?(Object(r["z"])(),Object(r["g"])(b,{key:0,"node-id":e.selectedNode.id},null,8,["node-id"])):Object(r["h"])("",!0),dr,e.selectedNodeContent?(Object(r["z"])(),Object(r["g"])(f,{key:1,"node-id":e.selectedNode.id},null,8,["node-id"])):Object(r["h"])("",!0),Object(r["m"])(m,{"node-id":e.selectedNode.id},null,8,["node-id"])])])):(Object(r["z"])(),Object(r["g"])("div",sr,[lr]))})),br=n("4c62"),fr={class:"p-col-12"},mr={class:"p-grid"},Or={class:"p-col-2"};function vr(e,t,n,o,a,i){var c=Object(r["I"])("RemoveIcon");return Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.preconditions,(function(t){return Object(r["z"])(),Object(r["g"])("div",{class:"p-grid",key:t.id},[Object(r["m"])("div",fr,[Object(r["m"])("div",mr,[Object(r["m"])("div",{class:"p-col-10 ".concat(e.$style.title)},[Object(r["m"])("a",{href:t.id},Object(r["M"])(t.title),9,["href"])],2),Object(r["m"])("div",Or,[Object(r["m"])(c,{onClick:function(n){return e.remove(t.id)}},null,8,["onClick"])])])])])})),128)}var hr=n("67c1"),gr=n.n(hr),jr=n("4623"),yr=n.n(jr),Ir=Object(r["W"])("data-v-fb1a5bf4");Object(r["C"])("data-v-fb1a5bf4");var xr={key:0,class:"custom"},Nr=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-off",src:gr.a},null,-1),Dr={key:1,class:"custom"},wr=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-on",src:yr.a},null,-1);Object(r["A"])();var Tr=Ir((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("div",{style:{cursor:"pointer"},onMouseenter:t[1]||(t[1]=function(e){return o.mouseOver=!0}),onMouseleave:t[2]||(t[2]=function(e){return o.mouseOver=!1})},[o.mouseOver?(Object(r["z"])(),Object(r["g"])("div",xr,[Nr])):(Object(r["z"])(),Object(r["g"])("div",Dr,[wr]))],32)})),kr={name:"RemoveIcon",setup:function(){var e=Object(r["F"])(!1);return{mouseOver:e}}};n("0bfa");kr.render=Tr,kr.__scopeId="data-v-fb1a5bf4";var Cr=kr,Er=n("d725"),Rr=Object(r["n"])({name:"Preconditions",props:{nodeId:{type:String,required:!0}},components:{RemoveIcon:Cr},setup:function(e){var t=Et(),n=Object(Er["b"])(),o=Object(r["F"])([]);return Object(r["S"])((function(){if(o.value=[],e.nodeId&&t.state.precondition.preconditions[e.nodeId]){var n,r=Object(f["a"])(t.state.precondition.preconditions[e.nodeId]);try{for(r.s();!(n=r.n()).done;){var a=n.value;o.value.push(t.state.tree.nodeRecord[a].node)}}catch(i){r.e(i)}finally{r.f()}}})),{preconditions:o,remove:function(){var r=Object(s["a"])(regeneratorRuntime.mark((function r(o){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.state.user&&t.state.user.user&&!t.state.user.user.isAnonymous){r.next=4;break}return r.next=3,t.dispatch("".concat(Dt.confirmSignInPopup),{confirm:n,message:"Please authorize to added node prerequisites"});case 3:return r.abrupt("return");case 4:if(a=t.state.precondition.preconditions[e.nodeId],a){r.next=7;break}return r.abrupt("return");case 7:if(-1!=a.indexOf(o)){r.next=9;break}return r.abrupt("return");case 9:a.splice(a.indexOf(o),1),ee.savePreconditions(t.state.user.user,{nodeId:e.nodeId,preconditionIds:a});case 11:case"end":return r.stop()}}),r)})));function o(e){return r.apply(this,arguments)}return o}()}}}),_r=n("ad65");const Sr=Rr.__cssModules={};Sr["$style"]=_r["default"],Rr.render=vr;var Mr=Rr,Pr={class:"p-col-12"},Lr={class:"p-grid"},Ar={class:"p-col-11"};function Br(e,t,n,o,a,i){return Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.usedBy,(function(e){return Object(r["z"])(),Object(r["g"])("div",{class:"p-grid",key:e.id},[Object(r["m"])("div",Pr,[Object(r["m"])("div",Lr,[Object(r["m"])("div",Ar,[Object(r["m"])("a",{href:e.id},Object(r["M"])(e.title),9,["href"])])])])])})),128)}var zr=Object(r["n"])({name:"UsedBy",props:{nodeId:String},setup:function(e){var t=Et(),n=Object(r["F"])([]);return Object(r["S"])((function(){if(n.value=[],e.nodeId&&t.state.precondition.reverseIndex[e.nodeId]){var r,o=Object(f["a"])(t.state.precondition.reverseIndex[e.nodeId]);try{for(o.s();!(r=o.n()).done;){var a=r.value;t.state.tree.nodeRecord[a]?n.value.push(t.state.tree.nodeRecord[a].node):console.log("UsedBy: cannot find id in nodeRecord",a)}}catch(i){o.e(i)}finally{o.f()}}})),{usedBy:n}}});zr.render=Br;var Ur=zr,Vr=Object(r["W"])("data-v-14a19a31"),Fr=Vr((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])(r["a"],null,[o.isAuthorized?Object(r["U"])((Object(r["z"])(),Object(r["g"])("p",{key:0,innerHTML:o.renderedContent,onClick:t[1]||(t[1]=function(e){return o.setEditOn(!0)}),class:"renderedContent"},null,8,["innerHTML"])),[[r["Q"],!o.editOn]]):(Object(r["z"])(),Object(r["g"])("p",{key:1,innerHTML:o.renderedContent,class:"renderedContent"},null,8,["innerHTML"])),Object(r["m"])("textarea",{class:"rawContent p-inputtextarea p-inputtext p-component p-inputtextarea-resizable",style:{display:"none"},ref:"txtarea",rows:n.rows,value:n.content,onInput:t[2]||(t[2]=function(e){return o.changeContent(e.target.value)}),onFocusout:t[3]||(t[3]=function(e){return o.setEditOn(!1)})},null,40,["rows","value"])],64)})),Hr=(n("466d"),n("498a"),n("d4cd")),Gr=n.n(Hr),qr=n("a68e"),Wr=n("8102"),Yr=n("746a"),Xr=new Gr.a;Xr.use(qr,{output:"html"}).use(Wr).use(Yr,"warning",{validate:function(e){return console.log("validate",e.trim(),"warning"==e.trim()),e.trim().match(/^warning$/)},render:function(e,t){var n=e[t].info.trim().match(/^warning(.*)$/);return 1===e[t].nesting?'<div style="background-color: #c6f68d; padding: 8px;">'+Xr.utils.escapeHtml(n[1])+"\n":"</div>\n"}});var Zr={name:"Markdown",emits:["content-changed"],props:{content:{type:String,required:!0},rows:{type:Number,required:!0}},setup:function(e,t){var n=Et(),o=Object(r["e"])((function(){return Xr.render(e.content)})),a=Object(r["F"])(!1),i=Object(r["F"])(null);return{isAuthorized:Object(r["e"])((function(){return n.state.user&&n.state.user.user&&!n.state.user.user.isAnonymous})),editOn:a,txtarea:i,setEditOn:function(e){a.value=e,e&&i.value&&(i.value.style.display="block",i.value.focus()),!e&&i.value&&(i.value.style.display="none")},renderedContent:o,changeContent:function(e){t.emit("content-changed",e)}}}};n("6710");Zr.render=Fr,Zr.__scopeId="data-v-14a19a31";var Kr=Zr,$r={key:0},Jr={key:1,class:"m-0"};function Qr(e,t,n,o,a,i){var c=Object(r["I"])("ChangeLogComplain"),u=Object(r["I"])("Markdown"),d=Object(r["I"])("Card"),s=Object(r["I"])("Fieldset");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{show:e.complainModalVisible,complainChangeLink:e.complainChangeLink,onHide:t[1]||(t[1]=function(t){return e.complainModalVisible=!1})},null,8,["show","complainChangeLink"]),Object(r["m"])(s,{legend:"change log",toggleable:!0,collapsed:e.collapsed,"onUpdate:collapsed":t[2]||(t[2]=function(t){return e.toggle(t)}),pt:{legend:{class:"bg-primary"}}},{default:Object(r["T"])((function(){return[e.isAuthorized?(Object(r["z"])(),Object(r["g"])("div",Jr,[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.changes,(function(t,n){return Object(r["z"])(),Object(r["g"])(d,{key:n,class:"mt-3"},Object(r["k"])({title:Object(r["T"])((function(){return[Object(r["l"])(Object(r["M"])(new Date(t.timestamp).toLocaleDateString())+" "+Object(r["M"])(new Date(t.timestamp).toLocaleTimeString())+" / "+Object(r["M"])(t.action)+" change ",1)]})),subtitle:Object(r["T"])((function(){return[Object(r["l"])(Object(r["M"])(t.userDisplayName?t.userDisplayName:"user id ".concat(t.userID))+" / ",1),Object(r["m"])("a",{href:"#",onClick:function(n){return e.showComplain(t.changeLogID)}},"Complain",8,["onClick"])]})),_:2},[t.action==e.ActionType.Name?{name:"content",fn:Object(r["T"])((function(){return[Object(r["l"])(Object(r["M"])(t.newName),1)]}))}:t.action==e.ActionType.Content?{name:"content",fn:Object(r["T"])((function(){return[Object(r["m"])(u,{content:t.newContent,rows:10},null,8,["content"])]}))}:t.action==e.ActionType.Precondition?{name:"content",fn:Object(r["T"])((function(){return[Object(r["m"])("div",{innerHTML:e.getContent(t)},null,8,["innerHTML"])]}))}:void 0]),1024)})),128))])):(Object(r["z"])(),Object(r["g"])("div",$r," Sign in to see node change log "))]})),_:1},8,["collapsed"])],64)}var eo,to=n("743f"),no=n("9899");function ro(e,t,n){return oo.apply(this,arguments)}function oo(){return oo=Object(s["a"])(regeneratorRuntime.mark((function e(t,n,r){var o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=[],n.length&&o.push(Object(K["i"])("node_id","in",n)),t.length&&o.push(Object(K["i"])("action","in",t)),a=Object(K["h"])(Object(K["b"])(Object(K["e"])(),"changes"),K["a"].apply(void 0,o),Object(K["g"])("timestamp","desc")),e.abrupt("return",Object(K["f"])(a,(function(e){var t=[];e.forEach((function(e){t.push({changeLogID:e.id,nodeID:e.get("node_id"),userID:e.get("user_id"),timestamp:e.get("timestamp"),action:e.get("action"),attributes:{value:e.get("attributes.value"),valueBefore:e.get("attributes.valueBefore"),valueAfter:e.get("attributes.valueAfter"),added:e.get("attributes.added"),removed:e.get("attributes.removed")}})})),r(t)})));case 5:case"end":return e.stop()}}),e)}))),oo.apply(this,arguments)}function ao(e){return io.apply(this,arguments)}function io(){return io=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={},e.next=3,G["a"].database().ref("map/".concat(t,"/name")).get();case 3:if(r=e.sent,!r.exists()){e.next=8;break}n["map/".concat(t)]=r.val(),e.next=12;break;case 8:return e.next=10,G["a"].database().ref("trash/".concat(t,"/map/name")).get();case 10:o=e.sent,o.exists()&&(n["trash/".concat(t)]=o.val());case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)}))),io.apply(this,arguments)}function co(e){return uo.apply(this,arguments)}function uo(){return uo=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={},e.next=3,G["a"].database().ref("public_user_data/".concat(t,"/displayName")).get();case 3:return r=e.sent,r.exists()&&(n["".concat(t)]=r.val()),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),uo.apply(this,arguments)}function so(e){return lo.apply(this,arguments)}function lo(){return lo=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u,d,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],r=Object(f["a"])(t);try{for(r.s();!(o=r.n()).done;)a=o.value,n.push(co(a))}catch(l){r.e(l)}finally{r.f()}return e.next=5,Promise.all(n);case 5:i=e.sent,c={},u=Object(f["a"])(i);try{for(u.s();!(d=u.n()).done;)s=d.value,c[Object.keys(s)[0]]=Object.values(s)[0]}catch(l){u.e(l)}finally{u.f()}return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)}))),lo.apply(this,arguments)}function po(e){return bo.apply(this,arguments)}function bo(){return bo=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u,d,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],r=Object(f["a"])(t);try{for(r.s();!(o=r.n()).done;)a=o.value,n.push(ao(a))}catch(l){r.e(l)}finally{r.f()}return e.next=5,Promise.all(n);case 5:i=e.sent,c={},u=Object(f["a"])(i);try{for(u.s();!(d=u.n()).done;)s=d.value,c[Object.keys(s)[0]]=Object.values(s)[0]}catch(l){u.e(l)}finally{u.f()}return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)}))),bo.apply(this,arguments)}function fo(e,t){if(null==e)return"";var n="";return null!=t["map/".concat(e)]?n="map/".concat(e):null!=t["trash/".concat(e)]&&(n="trash/".concat(e)),n}function mo(e,t,n){return Oo.apply(this,arguments)}function Oo(){return Oo=Object(s["a"])(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",ro(t,n,(function(e){var t,n={},o={},a=Object(f["a"])(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(n[i.userID]="",o[i.nodeID]="",i.action==eo.ParentID&&(null!=i.attributes.valueBefore&&(o[i.attributes.valueBefore]=""),null!=i.attributes.valueAfter&&(o[i.attributes.valueAfter]="")),i.action==eo.Precondition){if(null!=i.attributes.removed){var c,u=Object(f["a"])(i.attributes.removed);try{for(u.s();!(c=u.n()).done;){var d=c.value;o[d]=""}}catch(h){u.e(h)}finally{u.f()}}if(null!=i.attributes.added){var s,l=Object(f["a"])(i.attributes.added);try{for(l.s();!(s=l.n()).done;){var p=s.value;o[p]=""}}catch(h){l.e(h)}finally{l.f()}}}}}catch(h){a.e(h)}finally{a.f()}var b=[];for(var m in o)b.push(m);var O=[];for(var v in n)O.push(v);Promise.all([po(b),so(O)]).then((function(t){var n=t[0],o=t[1],a=[];e.forEach((function(e){var t=fo(e.nodeID,n);if(e.action==eo.Name)a.push({changeLogID:e.changeLogID,timestamp:e.timestamp,action:e.action,userID:e.userID,userDisplayName:o[e.userID],node:{id:e.nodeID,idPath:t,name:n[t]},newName:e.attributes.value});else if(e.action==eo.Content)a.push({changeLogID:e.changeLogID,timestamp:e.timestamp,action:e.action,userID:e.userID,userDisplayName:o[e.userID],node:{id:e.nodeID,idPath:t,name:n[t]},newContent:e.attributes.value});else if(e.action==eo.Precondition){var r=[];if(e.attributes.removed){var i,c=Object(f["a"])(e.attributes.removed);try{for(c.s();!(i=c.n()).done;){var u=i.value;r.push({id:u,idPath:fo(u,n),name:n[fo(u,n)]})}}catch(h){c.e(h)}finally{c.f()}}var d=[];if(e.attributes.added){var s,l=Object(f["a"])(e.attributes.added);try{for(l.s();!(s=l.n()).done;){var p=s.value;d.push({id:p,idPath:fo(p,n),name:n[fo(p,n)]})}}catch(h){l.e(h)}finally{l.f()}}a.push({changeLogID:e.changeLogID,timestamp:e.timestamp,action:e.action,userID:e.userID,userDisplayName:o[e.userID],node:{id:e.nodeID,idPath:t,name:n[t]},removed:r,added:d})}else if(e.action==eo.ParentID){var b=fo(e.attributes.valueBefore,n),m=fo(e.attributes.valueAfter,n);a.push({changeLogID:e.changeLogID,timestamp:e.timestamp,action:e.action,userID:e.userID,userDisplayName:o[e.userID],node:{id:e.nodeID,idPath:t,name:n[t]},parentNodeBefore:{id:e.attributes.valueBefore,idPath:b,name:n[b]},parentNodeAfter:{id:e.attributes.valueAfter,idPath:m,name:n[m]},isRemoved:null==e.attributes.valueAfter,isAdded:null==e.attributes.valueBefore})}})),r(a)}))})));case 1:case"end":return e.stop()}}),e)}))),Oo.apply(this,arguments)}function vo(e,t,n){return"trash"==e.substring(0,5)?'<a target="_blank" href="/node_description/'.concat(t,'">').concat(n,"</a>"):'<a target="_blank" href="/'.concat(t,'">').concat(n,"</a>")}(function(e){e["ParentID"]="parentID",e["Precondition"]="precondition",e["Content"]="content",e["Name"]="name"})(eo||(eo={}));var ho=Object(r["m"])("h3",null,Object(r["M"])("Please use our discord channel to complain about inappropriate changes"),-1),go=Object(r["m"])("h3",null,[Object(r["m"])("a",{target:"_blank",href:"https://discord.com/channels/1171118046543347782/1196694554791915600"},"Discord edit-complains channel")],-1),jo=Object(r["m"])("p",null," You can use the following text: ",-1),yo=Object(r["l"])(" Hi, I think I found changes that was inappropriate because ... "),Io=Object(r["m"])("br",null,null,-1),xo=Object(r["m"])("br",null,null,-1),No=Object(r["l"])(" This is the ...st time I found inappropriate changes from this user. "),Do=Object(r["m"])("br",null,null,-1);function wo(e,t,n,o,a,i){var c=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(c,{visible:e.complainModalVisible,"onUpdate:visible":t[1]||(t[1]=function(t){return e.complainModalVisible=t}),onHide:t[2]||(t[2]=function(t){return e.$emit("hide")}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["T"])((function(){return[ho]})),footer:Object(r["T"])((function(){return[]})),default:Object(r["T"])((function(){return[go,jo,Object(r["m"])("code",null,[yo,Io,Object(r["l"])(" Here is the changes I am talking about "+Object(r["M"])(e.complainChangeLink)+" ",1),xo,No,Do])]})),_:1},8,["visible"])}var To=n("5bd2"),ko=Object(r["n"])({name:"ChangeLogComplain",props:{show:Boolean,complainChangeLink:String},components:{Dialog:To["a"]},emits:["hide"],setup:function(e){var t=Object(r["F"])(!1);return Object(r["R"])((function(){return[e.show]}),function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.value=n[0];case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),{complainModalVisible:t}}});ko.render=wo;var Co=ko,Eo=Object(r["n"])({name:"ChangeLog",computed:{ActionType:function(){return eo}},props:{nodeId:{type:String,required:!0}},components:{Markdown:Kr,ChangeLogComplain:Co,Fieldset:to["a"],Card:no["a"]},setup:function(e){var t=Et(),n=Object(r["e"])((function(){return t.state.user.user&&!t.state.user.user.isAnonymous})),o=Object(r["F"])(""),a=Object(r["F"])(!1),i=Object(r["F"])(!0),c=Object(r["D"])([]),u=function(){};return Object(r["R"])((function(){return[e.nodeId,i.value]}),function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n[0]!=r[0]&&(i.value=!0),u(),u=function(){},0!=i.value){t.next=7;break}return t.next=6,mo([eo.Name,eo.Content,eo.Precondition],[e.nodeId],(function(e){c.splice.apply(c,[0,c.length].concat(Object(d["a"])(e)))}));case 6:u=t.sent;case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),{changes:c,collapsed:i,toggle:function(e){i.value=e},showComplain:function(e){a.value=!0,o.value="https://scimap.org/change/"+e},getContent:function(e){e=e;var t,n=[],r=Object(f["a"])(e.removed);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(vo(o.idPath,o.id,o.name))}}catch(s){r.e(s)}finally{r.f()}var a,i=[],c=Object(f["a"])(e.added);try{for(c.s();!(a=c.n()).done;){var u=a.value;i.push(vo(u.idPath,u.id,u.name))}}catch(s){c.e(s)}finally{c.f()}var d="";return n.length>0&&(d+="removed: ".concat(n.join(", "))),i.length>0&&(d+="<br> added: ".concat(i.join(", "))),d},complainModalVisible:a,complainChangeLink:o,isAuthorized:n}}});Eo.render=Qr;var Ro=Eo,_o=Object(r["l"])("pin"),So=Object(r["m"])("h3",null,Object(r["M"])("Choose parent from which pin will be visible"),-1);function Mo(e,t,n,o,a,i){var c=Object(r["I"])("PinIcon"),u=Object(r["I"])("Listbox"),d=Object(r["I"])("Button"),s=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{onClick:o.clickPin},{default:Object(r["T"])((function(){return[_o]})),_:1},8,["onClick"]),Object(r["m"])(s,{visible:o.addDialogVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["T"])((function(){return[So]})),footer:Object(r["T"])((function(){return[Object(r["m"])(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["m"])(d,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["T"])((function(){return[Object(r["m"])(u,{modelValue:o.selectedParent,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.selectedParent=e}),options:o.parents,optionLabel:"title"},null,8,["modelValue","options"])]})),_:1},8,["visible"])],64)}var Po=n("bb57"),Lo=n("dc4a"),Ao=n("bc82"),Bo=n.n(Ao),zo=n("b969"),Uo=n.n(zo),Vo=Object(r["W"])("data-v-5b15f4ff");Object(r["C"])("data-v-5b15f4ff");var Fo={key:0,class:"pin"},Ho=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-off",src:Bo.a},null,-1),Go={key:1,class:"pin"},qo=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-on",src:Uo.a},null,-1);Object(r["A"])();var Wo=Vo((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("div",{style:{cursor:"pointer"},onMouseenter:t[1]||(t[1]=function(e){return o.mouseOver=!0}),onMouseleave:t[2]||(t[2]=function(e){return o.mouseOver=!1})},[o.isPinned||o.mouseOver?(Object(r["z"])(),Object(r["g"])("div",Fo,[Ho])):(Object(r["z"])(),Object(r["g"])("div",Go,[qo]))],32)})),Yo={name:"PinIcon",setup:function(){var e=Et(),t=Object(r["F"])(!1);return{isPinned:Object(r["e"])((function(){return void 0!==e.state.pin.pins[e.state.tree.selectedNodeId]})),mouseOver:t}}};n("a48e");Yo.render=Wo,Yo.__scopeId="data-v-5b15f4ff";var Xo=Yo,Zo={name:"PinButton",components:{PinIcon:Xo,Dialog:To["a"],Button:Po["a"],Listbox:Lo["a"]},setup:function(){var e=Et(),t=Object(Er["b"])(),n=e.state.tree,o=Object(r["F"])(!1),a=Object(r["F"])(!1),i=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),c=Object(r["F"])(""),u=Object(r["e"])((function(){var e=[],t=n.nodeRecord[n.selectedNodeId].parent;while(n.nodeRecord[t.id].parent)e.push({title:t.title,id:t.id}),t=n.nodeRecord[t.id].parent;return e.push({title:"root",id:0}),e}));return{clickPin:function(){var n=Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.state.user&&e.state.user.user&&!e.state.user.user.isAnonymous){n.next=4;break}return n.next=3,e.dispatch("".concat(Dt.confirmSignInPopup),{confirm:t,message:"Please authorize to pin nodes"});case 3:return n.abrupt("return");case 4:void 0!==e.state.pin.pins[e.state.tree.selectedNodeId]?(e.dispatch("pin/".concat(O.RemovePin),e.state.tree.selectedNodeId),ee.savePins(e.state.user.user,e.state.pin.pins)):o.value=!o.value;case 5:case"end":return n.stop()}}),n)})));function r(){return n.apply(this,arguments)}return r}(),selectedParent:a,parents:u,add:function(){o.value=!1,e.dispatch("pin/".concat(O.AddPin),{parentId:a.value.id,nodeId:i.value.id}),ee.savePins(e.state.user.user,e.state.pin.pins),a.value=null},cancelAdd:function(){o.value=!1},addDialogVisible:o,newNodeTitle:c}}};Zo.render=Mo;var Ko=Zo,$o=Object(r["W"])("data-v-00857be5"),Jo=$o((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["U"])(Object(r["m"])("p",{innerHTML:o.renderedContent,onClick:t[1]||(t[1]=function(e){return o.setEditOn(!0)}),class:"title"},null,8,["innerHTML"]),[[r["Q"],!o.editOn]]),Object(r["m"])("textarea",{class:"title rawTitle p-inputtextarea p-inputtext p-component p-inputtextarea-resizable",style:{display:"none"},ref:"txtarea",rows:"1",value:n.content,onInput:t[2]||(t[2]=function(e){return o.changeContent(e.target.value)}),onFocusout:t[3]||(t[3]=function(e){return o.setEditOn(!1)})},null,40,["value"])],64)})),Qo={name:"Title",emits:["content-changed"],props:{content:{type:String,required:!0}},setup:function(e,t){var n=Object(r["e"])((function(){return e.content})),o=Object(r["F"])(!1),a=Et(),i=Object(r["F"])(null);return{editOn:o,txtarea:i,setEditOn:function(e){a.state.user&&a.state.user.user&&!a.state.user.user.isAnonymous&&(o.value=e,e&&i.value&&(i.value.style.display="block",i.value.focus()),!e&&i.value&&(i.value.style.display="none"))},renderedContent:n,changeContent:function(e){t.emit("content-changed",e)}}}};n("0c69");Qo.render=Jo,Qo.__scopeId="data-v-00857be5";var ea=Qo;function ta(e,t,n,o,a,i){var c=Object(r["I"])("AddBasedOnIcon"),u=Object(r["I"])("Button"),d=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{onClick:o.showAddBanner},null,8,["onClick"]),Object(r["m"])(d,{visible:o.addBannerVisible,"onUpdate:visible":t[1]||(t[1]=function(e){return o.addBannerVisible=e}),dismissableMask:!1,closable:!0,modal:!1,closeOnEscape:!0,onMousedown:t[2]||(t[2]=Object(r["V"])((function(){}),["stop"]))},{header:Object(r["T"])((function(){return[Object(r["m"])("h3",null,' Set "'+Object(r["M"])(o.preconditionNode.title?o.preconditionNode.title:o.selectedNode?o.selectedNode.title:"")+'" as precondition for "'+Object(r["M"])(o.targetNode?o.targetNode.title:"")+'" ',1)]})),footer:Object(r["T"])((function(){return[Object(r["m"])(u,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["m"])(u,{label:"Done",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),_:1},8,["visible"])],64)}var na=n("7835"),ra=n.n(na),oa=n("fdc1"),aa=n.n(oa),ia=Object(r["W"])("data-v-2494d1ac");Object(r["C"])("data-v-2494d1ac");var ca={key:0,class:"custom"},ua=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-off",src:ra.a},null,-1),da={key:1,class:"custom"},sa=Object(r["m"])("img",{style:{height:"35px"},alt:"pin-on",src:aa.a},null,-1);Object(r["A"])();var la=ia((function(e,t,n,o,a,i){return Object(r["z"])(),Object(r["g"])("div",{style:{cursor:"pointer"},onMouseenter:t[1]||(t[1]=function(e){return o.mouseOver=!0}),onMouseleave:t[2]||(t[2]=function(e){return o.mouseOver=!1})},[o.mouseOver?(Object(r["z"])(),Object(r["g"])("div",ca,[ua])):(Object(r["z"])(),Object(r["g"])("div",da,[sa]))],32)})),pa={name:"AddBasedOnIcon",setup:function(){var e=Object(r["F"])(!1);return{mouseOver:e}}};n("7ccc");pa.render=la,pa.__scopeId="data-v-2494d1ac";var ba=pa,fa={name:"AddBasedOnButton",components:{Dialog:To["a"],Button:Po["a"],AddBasedOnIcon:ba},emits:["select-precondition-is-on","select-precondition-is-off"],props:{clickedTitleId:{type:String,required:!0}},setup:function(e,t){var n=Et(),o=Object(Er["b"])(),a=Object(r["F"])(!1),i=Object(r["F"])({}),c=Object(r["F"])({}),u=Object(r["e"])((function(){return n.getters["tree/selectedNode"]}));return Object(r["R"])((function(){return e.clickedTitleId}),(function(){"-1"!==e.clickedTitleId&&n.state.tree.nodeRecord[e.clickedTitleId]&&(c.value=n.state.tree.nodeRecord[e.clickedTitleId].node)}),{immediate:!0}),{showAddBanner:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.state.user&&n.state.user.user&&!n.state.user.user.isAnonymous){e.next=4;break}return e.next=3,n.dispatch("".concat(Dt.confirmSignInPopup),{confirm:o,message:"Please authorize to added node prerequisites"});case 3:return e.abrupt("return");case 4:t.emit("select-precondition-is-on"),i.value=n.getters["tree/selectedNode"],a.value=!a.value;case 7:case"end":return e.stop()}}),e)})));function r(){return e.apply(this,arguments)}return r}(),add:function(){var e=[];n.state.precondition.preconditions[i.value.id]&&(e=n.state.precondition.preconditions[i.value.id]),e.push(c.value.id),ee.savePreconditions(n.state.user.user,{nodeId:i.value.id,preconditionIds:e}),t.emit("select-precondition-is-off"),a.value=!1,c.value={}},cancelAdd:function(){a.value=!1,c.value={},t.emit("select-precondition-is-off")},addBannerVisible:a,targetNode:i,preconditionNode:c,selectedNode:u}}};fa.render=ta;var ma=fa,Oa=Object(r["m"])("div",{style:{width:"100%","padding-right":"10px"}}," Upload new one or choose from the list ",-1),va=Object(r["l"])("upload"),ha=Object(r["l"])("set as default"),ga=Object(r["l"])("copy URL");function ja(e,t,n,o,a,i){var c=Object(r["I"])("Button"),u=Object(r["I"])("Card"),d=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[e.isAuthorized?(Object(r["z"])(),Object(r["g"])("img",{key:0,style:{position:"absolute",left:"0",top:"0",width:"100%",height:"240px",cursor:"pointer"},alt:"welcome",src:e.defaultImageURL,onClick:t[1]||(t[1]=function(){return e.toggleAddDialog&&e.toggleAddDialog.apply(e,arguments)})},null,8,["src"])):(Object(r["z"])(),Object(r["g"])("img",{key:1,style:{position:"absolute",left:"0",top:"0",width:"100%",height:"240px"},alt:"welcome",src:e.defaultImageURL},null,8,["src"])),Object(r["m"])("input",{type:"file",ref:"input",style:{display:"none"},onChange:t[2]||(t[2]=function(){return e.onInputChange&&e.onInputChange.apply(e,arguments)}),accept:"image/*"},null,544),Object(r["m"])(d,{visible:e.addDialogVisible,"onUpdate:visible":t[3]||(t[3]=function(t){return e.addDialogVisible=t}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0,onMousedown:t[4]||(t[4]=Object(r["V"])((function(){}),["stop"]))},{header:Object(r["T"])((function(){return[Oa]})),default:Object(r["T"])((function(){return[Object(r["m"])(c,{rounded:"",onClick:e.triggerUpload},{default:Object(r["T"])((function(){return[va]})),_:1},8,["onClick"]),(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(e.items,(function(t,n){return Object(r["z"])(),Object(r["g"])(u,{key:n,class:"mt-3"},{content:Object(r["T"])((function(){return[Object(r["m"])("img",{alt:"image",src:t.url,style:{width:"300px"}},null,8,["src"]),Object(r["m"])("div",null,[Object(r["m"])(c,{rounded:"",onClick:function(n){return e.setAsDefault(t.url)},style:{"margin-right":"50px"}},{default:Object(r["T"])((function(){return[ha]})),_:2},1032,["onClick"]),Object(r["m"])(c,{rounded:"",onClick:function(n){return e.copyURL(t.url)}},{default:Object(r["T"])((function(){return[ga]})),_:2},1032,["onClick"])])]})),_:2},1024)})),128))]})),_:1},8,["visible"])],64)}n("baa5"),n("2b3d");var ya=n("18cb"),Ia=Object(r["n"])({name:"TitleImage",components:{Button:Po["a"],Card:no["a"],Dialog:To["a"]},props:{nodeID:{type:String,required:!0}},setup:function(e){var t=Object(ya["b"])(),n=Et(),o=Object(r["F"])(!1),a=Object(r["F"])(),i="https://cdn.scimap.org/images/default.jpg",c=Object(r["F"])([{name:"default",url:i}]),u=Object(r["F"])(0),d=Object(r["F"])(i),l=Object(r["e"])((function(){return"/node_image/".concat(e.nodeID)}));return Object(r["R"])((function(){return e.nodeID}),function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:c.value=[{name:"default",url:i}],d.value=i,r&&ee.unsubscribeDBChange(r),e.nodeID&&ee.subscribeDBChange(l.value,(function(e){if(e.exists()){c.value=[{name:"default",url:i}];var t=e.val();for(var n in t)"default"!=n?c.value.push({name:t[n].name,url:"https://cdn.scimap.org/"+t[n].path}):d.value="https://cdn.scimap.org/"+t[n].path}}));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{immediate:!0}),{isAuthorized:Object(r["e"])((function(){return n.state.user&&n.state.user.user&&!n.state.user.user.isAnonymous})),defaultImageURL:d,setAsDefault:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,G["a"].database().ref("".concat(l.value)).update({default:{url:t,name:""}});case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),copyURL:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.writeText(t);case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),toggleAddDialog:function(){o.value=!o.value},addDialogVisible:o,items:c,input:a,triggerUpload:function(){a.value.click()},onInputChange:function(r){if(n.state.user&&n.state.user.user&&!n.state.user.user.isAnonymous&&0!=e.nodeID.length){u.value=0;var o=r.target.files[0];if(o.size>1e6)return console.log("cannot upload file > 1Mb"),void t.add({severity:"info",summary:"Sorry",detail:"Cannot upload file > 1Mb",life:3e3});var a=o.name,i=a.substring(a.lastIndexOf(".")+1,a.length)||a,c=(new Date).getTime(),d="/user/".concat(n.state.user.user.uid,"/image/").concat(c,".").concat(i),s=G["a"].storage().ref(d).put(o);s.on("state_changed",(function(e){u.value=e.bytesTransferred/e.totalBytes*100}),(function(e){console.log(e.message)}),(function(){u.value=100,s.snapshot.ref.getDownloadURL().then((function(e){var t={};try{t=new URL(e)}catch(r){return void console.log(r)}var n=t.protocol+"//"+t.hostname+(""==t.port?"":":"+t.port)+t.pathname+"?alt=media";G["a"].database().ref("".concat(l.value,"/").concat(c)).update({name:a,path:d,url:n})}))}))}}}}});Ia.render=ja;var xa=Ia,Na=Object(r["n"])({name:"NodeContent",components:{TitleImage:xa,AddBasedOnButton:ma,Title:ea,SectionUsedBy:Ur,Markdown:Kr,TextArea:br["a"],SectionPreconditions:Mr,ChangeLog:Ro,PinButton:Ko},emits:["select-precondition-is-on","select-precondition-is-off"],props:{show:{type:Boolean,required:!0},selectedNodeId:{type:String||null,validator:function(e){return"string"===typeof e||null===e},required:!0},clickedTitleId:{type:String,required:!0}},setup:function(e){var t=Et(),n=Object(Er["b"])(),o=t.state.tree,a=Object(r["e"])((function(){return e.selectedNodeId&&o.nodeRecord[e.selectedNodeId]?o.nodeRecord[e.selectedNodeId].node:null})),i=Object(r["e"])((function(){if(e.selectedNodeId&&t.state.nodeContent.nodeContents[e.selectedNodeId])return t.state.nodeContent.nodeContents[e.selectedNodeId];var n=L(nt);return n.nodeID=e.selectedNodeId,n})),c=Object(r["e"])((function(){return e.selectedNodeId&&t.state.nodeContent.userNodeComments[e.selectedNodeId]?t.state.nodeContent.userNodeComments[e.selectedNodeId].comment:""}));return{selectedNode:a,selectedNodeContent:i,checkAuthorized:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.state.user.user&&!t.state.user.user.isAnonymous){e.next=4;break}return e.next=3,t.dispatch("".concat(Dt.confirmSignInPopup),{confirm:n,message:"Please authorize to add comments and edit content"});case 3:r.preventDefault();case 4:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}(),selectedNodeComment:c,changeNodeTitle:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a.value&&a.value.id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ee.debouncedUpdate(Object(l["a"])({},"map/".concat(a.value.id,"/name"),t));case 4:n=e.sent,n&&A(n.error.message,n.kv);case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),changeContent:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("nodeContent/".concat(tt.setNodeContent),{nodeID:a.value.id,content:n});case 2:r=e.sent,r&&A(r,{});case 4:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}(),changeComment:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("nodeContent/".concat(tt.setNodeComment),{nodeID:a.value.id,comment:n});case 2:r=e.sent,r&&A(r,{});case 4:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()}}});n("2a98");Na.render=pr,Na.__scopeId="data-v-2dae896a";var Da=Na,wa=n("9383"),Ta=n("b3b6"),ka=n("c9d8"),Ca=n.n(ka),Ea={key:0,style:{width:"100%"}},Ra={style:{position:"absolute",right:"2rem"}},_a=Object(r["m"])("img",{alt:"user",src:Ca.a,style:{width:"20px"}},null,-1),Sa={style:{position:"absolute",right:"6.1rem"}},Ma={key:0,style:{position:"absolute",right:"20.6rem"}},Pa={key:1,style:{position:"absolute",right:"26.6rem"}},La={key:2,style:{position:"absolute",right:"33.6rem"}},Aa={key:3,style:{position:"absolute",right:"39.3rem"}},Ba={key:1};function za(e,t,n,o,a,i){var c=Object(r["I"])("TextSearch"),u=Object(r["I"])("MenuButton"),d=Object(r["I"])("PrimeMenu"),s=Object(r["I"])("Feedback"),l=Object(r["I"])("EditMode"),p=Object(r["I"])("AddNode"),b=Object(r["I"])("RemoveNode"),f=Object(r["I"])("CutPaste"),m=Object(r["I"])("MapChangeLog"),O=Object(r["I"])("Button");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])("div",{class:e.$style.textSearch},[Object(r["m"])(c)],2),Object(r["m"])("div",{class:e.$style.wrapper},[o.email?(Object(r["z"])(),Object(r["g"])("div",Ea,[Object(r["m"])("div",Ra,[Object(r["m"])(u,{onClick:o.toggleUserMenu},{default:Object(r["T"])((function(){return[_a]})),_:1},8,["onClick"]),Object(r["m"])(d,{ref:"menu",id:"overlay_menu",model:o.items,popup:!0},null,8,["model"])]),Object(r["m"])("div",Sa,[Object(r["m"])(s)]),Object(r["m"])(l,{style:{position:"absolute",right:"12.5rem"}}),o.editModeOn?(Object(r["z"])(),Object(r["g"])("div",Ma,[Object(r["m"])(p)])):Object(r["h"])("",!0),o.editModeOn?(Object(r["z"])(),Object(r["g"])("div",Pa,[Object(r["m"])(b)])):Object(r["h"])("",!0),o.editModeOn&&o.isNodeSelected?(Object(r["z"])(),Object(r["g"])("div",La,[o.isNodeSelected?(Object(r["z"])(),Object(r["g"])(f,{key:0})):Object(r["h"])("",!0)])):Object(r["h"])("",!0),o.editModeOn&&o.isNodeSelected?(Object(r["z"])(),Object(r["g"])("div",Aa,[Object(r["m"])(m)])):Object(r["h"])("",!0)])):(Object(r["z"])(),Object(r["g"])("div",Ba,[Object(r["m"])(O,{onClick:o.signIn,style:{position:"absolute",right:"2rem"},rounded:"",size:"small",icon:"pi pi-sign-in",label:"sign in"},null,8,["onClick"])]))],2)],64)}var Ua=Object(r["m"])("img",{alt:"icon",src:aa.a,style:{width:"20px"}},null,-1),Va=Object(r["m"])("span",{class:"p-ml-2"},"add",-1);function Fa(e,t,n,o,a,i){var c=Object(r["I"])("MenuButton"),u=Object(r["I"])("Input"),d=Object(r["I"])("Button"),s=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{onClick:o.toggleAddDialog},{default:Object(r["T"])((function(){return[Ua,Va]})),_:1},8,["onClick"]),Object(r["m"])(s,{visible:o.addDialogVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0,onMousedown:t[3]||(t[3]=Object(r["V"])((function(){}),["stop"]))},{header:Object(r["T"])((function(){return[Object(r["m"])("h3",null,Object(r["M"])(o.selectedNodeTitle?"Add subsection to ".concat(o.selectedNodeTitle):"Add section"),1)]})),footer:Object(r["T"])((function(){return[Object(r["m"])(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["m"])(d,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["T"])((function(){return[Object(r["m"])(u,{type:"text",modelValue:o.newNodeTitle,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.newNodeTitle=e})},null,8,["modelValue"])]})),_:1},8,["visible"])],64)}var Ha=n("8398");function Ga(e,t,n,o,a,i){var c=Object(r["I"])("Button");return Object(r["z"])(),Object(r["g"])(c,{size:"small",rounded:"",onMouseenter:t[1]||(t[1]=function(t){return e.mouseover=!0}),onMouseleave:t[2]||(t[2]=function(t){return e.mouseover=!1}),style:(e.mouseover?"background-color: rgba(0, 0, 0, 0.1); ":e.bgColor?"background-color: ".concat(e.bgColor,";"):"background-color: white;")+"color: black; border-color:#3B6BF9;"},{default:Object(r["T"])((function(){return[Object(r["H"])(e.$slots,"default")]})),_:3},8,["style"])}var qa=Object(r["n"])({name:"MenuButton",components:{Button:Po["a"]},props:{bgColor:String},setup:function(){var e=Object(r["F"])(!1);return{mouseover:e}}});qa.render=Ga;var Wa=qa,Ya={name:"AddNode",components:{MenuButton:Wa,Dialog:To["a"],Button:Po["a"],Input:Ha["a"]},setup:function(){var e=Et(),t=Object(r["F"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),o=Object(r["F"])("");return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleAddDialog:function(){return t.value=!t.value},add:function(){var r=Object(s["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.dispatch("".concat(Dt.createNode),{parentID:n.value?n.value.id:0,title:o.value});case 2:a=r.sent,e.commit("positionChangePermits/".concat(x.ADD_NODES),[a].concat(Object(d["a"])(e.state.tree.nodeRecord[n.value.id].node.children.map((function(e){return e.id}))))),o.value="",t.value=!1;case 6:case"end":return r.stop()}}),r)})));function a(){return r.apply(this,arguments)}return a}(),cancelAdd:function(){o.value="",t.value=!1},addDialogVisible:t,newNodeTitle:o}}};Ya.render=Fa;var Xa=Ya,Za=Object(r["m"])("img",{alt:"icon",src:yr.a,style:{width:"20px"}},null,-1),Ka=Object(r["m"])("span",{class:"p-ml-2"},"delete",-1);function $a(e,t,n,o,a,i){var c=Object(r["I"])("MenuButton"),u=Object(r["I"])("Button"),d=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{onClick:o.toggleDialog,disabled:!o.selectedNodeTitle},{default:Object(r["T"])((function(){return[Za,Ka]})),_:1},8,["onClick","disabled"]),Object(r["m"])(d,{visible:o.addDialogVisible,"onUpdate:visible":t[1]||(t[1]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["T"])((function(){return[Object(r["m"])("h3",null,Object(r["M"])("Remove ".concat(o.selectedNodeTitle," and all its descendants?")),1)]})),footer:Object(r["T"])((function(){return[Object(r["m"])(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancel},null,8,["onClick"]),Object(r["m"])(u,{label:"Yes",icon:"pi pi-check",onClick:o.remove},null,8,["onClick"])]})),_:1},8,["visible"])],64)}var Ja={name:"RemoveNode",components:{MenuButton:Wa,Dialog:To["a"],Button:Po["a"]},setup:function(){var e=Et(),t=Object(r["F"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]}));return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleDialog:function(){return t.value=!t.value},remove:function(){t.value=!1,e.dispatch("".concat(Dt.removeNode),n.value.id),e.commit("positionChangePermits/".concat(x.ADD_NODES),e.state.tree.nodeRecord[n.value.id].parent.children.map((function(e){return e.id})))},cancel:function(){t.value=!1},addDialogVisible:t}}};Ja.render=$a;var Qa=Ja,ei=n("8423"),ti=n.n(ei),ni=n("4612"),ri=n.n(ni),oi=Object(r["m"])("img",{alt:"icon",src:ti.a,style:{width:"20px"}},null,-1),ai=Object(r["m"])("span",{class:"p-ml-2"},"edit map",-1),ii=Object(r["m"])("img",{alt:"icon",src:ri.a,style:{width:"20px"}},null,-1),ci=Object(r["m"])("span",{class:"p-ml-2"},"edit map",-1);function ui(e,t,n,o,a,i){var c=Object(r["I"])("MenuButton");return Object(r["z"])(),Object(r["g"])("div",null,[o.editModeOn?Object(r["h"])("",!0):(Object(r["z"])(),Object(r["g"])(c,{key:0,onClick:o.on,style:{height:"35px"}},{default:Object(r["T"])((function(){return[oi,ai]})),_:1},8,["onClick"])),o.editModeOn?(Object(r["z"])(),Object(r["g"])(c,{key:1,onClick:o.off,style:{height:"35px"}},{default:Object(r["T"])((function(){return[ii,ci]})),_:1},8,["onClick"])):Object(r["h"])("",!0)])}var di={name:"EditMode",components:{MenuButton:Wa},setup:function(){var e=Et();return{editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),on:function(){e.dispatch("".concat(Dt.setEditMode),!0)},off:function(){e.dispatch("".concat(Dt.setEditMode),!1)}}}};di.render=ui;var si=di,li=n("9233"),pi=n.n(li),bi=n("70bb"),fi=n.n(bi),mi=Object(r["m"])("img",{alt:"icon",src:pi.a,style:{width:"20px"}},null,-1),Oi=Object(r["m"])("span",{class:"p-ml-2"},"cut",-1),vi=Object(r["m"])("img",{alt:"icon",src:fi.a,style:{width:"20px"}},null,-1),hi=Object(r["m"])("span",{class:"p-ml-2"},"paste",-1);function gi(e,t,n,o,a,i){var c=Object(r["I"])("MenuButton");return Object(r["z"])(),Object(r["g"])(r["a"],null,[null==o.cutNodeID?(Object(r["z"])(),Object(r["g"])(c,{key:0,onClick:o.cut},{default:Object(r["T"])((function(){return[mi,Oi]})),_:1},8,["onClick"])):Object(r["h"])("",!0),null!=o.cutNodeID?(Object(r["z"])(),Object(r["g"])(c,{key:1,onClick:o.paste},{default:Object(r["T"])((function(){return[vi,hi]})),_:1},8,["onClick"])):Object(r["h"])("",!0)],64)}var ji={name:"CutPaste",components:{MenuButton:Wa},setup:function(){var e=Et(),t=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),n=Object(r["F"])(null);return{cutNodeID:n,cut:function(){n.value=t.value.id},paste:function(){var r=e.state.tree.nodeRecord[n.value].parent.children.map((function(e){return e.id})),o=e.state.tree.nodeRecord[t.value.id].node.children.map((function(e){return e.id}));e.commit("positionChangePermits/".concat(x.ADD_NODES),[].concat(Object(d["a"])(r),Object(d["a"])(o))),e.dispatch("".concat(Dt.cutPasteNode),{nodeID:n.value,parentID:t.value.id}),n.value=null}}}};ji.render=gi;var yi=ji,Ii=n("10b7"),xi=n.n(Ii),Ni=Object(r["m"])("img",{alt:"icon",src:xi.a,style:{width:"20px"}},null,-1),Di=Object(r["m"])("span",{class:"p-ml-2"},"chat",-1);function wi(e,t,n,o,a,i){var c=Object(r["I"])("MenuButton");return Object(r["z"])(),Object(r["g"])(c,{onClick:o.send},{default:Object(r["T"])((function(){return[Ni,Di]})),_:1},8,["onClick"])}var Ti={name:"Feedback",components:{MenuButton:Wa},setup:function(){return{send:function(){window.open("https://discord.com/channels/1171118046543347782/1171118047105396749","_blank")}}}};Ti.render=wi;var ki=Ti,Ci={class:"p-input-icon-right",style:{width:"100%"}};function Ei(e,t,n,o,a,i){var c=Object(r["I"])("InputText");return Object(r["z"])(),Object(r["g"])("span",Ci,[Object(r["m"])("i",{class:"pi pi-times",style:{right:"1.2rem"},onClick:t[1]||(t[1]=function(){return o.clearBox&&o.clearBox.apply(o,arguments)})}),Object(r["m"])(c,{class:e.$style["searchBox"],placeholder:"Search SciMap",modelValue:o.value,"onUpdate:modelValue":[t[2]||(t[2]=function(e){return o.value=e}),t[3]||(t[3]=function(e){return o.doSearch(e)})]},null,8,["class","modelValue"])])}var Ri={name:"TextSearch",components:{InputText:Ha["a"]},setup:function(){var e=Object(r["F"])(""),t=Et();return{doSearch:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ft(n);case 2:return r=e.sent,t.commit("searchResult/".concat(dt.SET_NODE_IDS),r),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}(),value:e,clearBox:function(){e.value=""}}}},_i=n("9e9f");const Si=Ri.__cssModules={};Si["$style"]=_i["default"],Ri.render=Ei;var Mi=Ri,Pi=Object(r["m"])("img",{alt:"icon",src:xi.a,style:{width:"20px"}},null,-1),Li=Object(r["m"])("span",{class:"p-ml-2"},"log",-1),Ai=Object(r["m"])("h3",null," Map change log ",-1);function Bi(e,t,n,o,a,i){var c=Object(r["I"])("ChangeLogComplain"),u=Object(r["I"])("MenuButton"),d=Object(r["I"])("Card"),s=Object(r["I"])("Dialog");return Object(r["z"])(),Object(r["g"])(r["a"],null,[Object(r["m"])(c,{show:o.complainModalVisible,complainChangeLink:o.complainChangeLink,onHide:t[1]||(t[1]=function(e){return o.complainModalVisible=!1})},null,8,["show","complainChangeLink"]),Object(r["m"])(u,{onClick:o.toggleAddDialog},{default:Object(r["T"])((function(){return[Pi,Li]})),_:1},8,["onClick"]),Object(r["m"])(s,{visible:o.addDialogVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0,onMousedown:t[3]||(t[3]=Object(r["V"])((function(){}),["stop"]))},{header:Object(r["T"])((function(){return[Ai]})),default:Object(r["T"])((function(){return[(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(o.changes,(function(e,t){return Object(r["z"])(),Object(r["g"])(d,{key:t,class:"mt-3"},{title:Object(r["T"])((function(){return[Object(r["l"])(Object(r["M"])(new Date(e.timestamp).toLocaleDateString())+" "+Object(r["M"])(new Date(e.timestamp).toLocaleTimeString()),1)]})),subtitle:Object(r["T"])((function(){return[Object(r["l"])(Object(r["M"])(e.userDisplayName)+" / ",1),Object(r["m"])("a",{href:"#",onClick:function(t){return o.showComplain(e.changeLogID)}},"Complain",8,["onClick"])]})),content:Object(r["T"])((function(){return[Object(r["m"])("div",{innerHTML:o.getActionDescription(e)},null,8,["innerHTML"])]})),_:2},1024)})),128))]})),_:1},8,["visible"])],64)}var zi={name:"MapChangeLog",components:{MenuButton:Wa,ChangeLogComplain:Co,Card:no["a"],Dialog:To["a"]},setup:function(){var e=Object(r["F"])(""),t=Object(r["F"])(!1),n=Object(r["F"])(!1),o=Object(r["D"])([]);return mo([eo.ParentID],[],(function(e){o.splice.apply(o,[0,o.length].concat(Object(d["a"])(e)))})),{complainChangeLink:e,complainModalVisible:t,showComplain:function(n){t.value=!0,e.value="https://scimap.org/change/"+n},toggleAddDialog:function(){return n.value=!n.value},addDialogVisible:n,changes:o,getActionDescription:function(e){return e.isAdded?"node ".concat(vo(e.node.idPath,e.node.id,e.node.name)," was added to ").concat(vo(e.parentNodeAfter.idPath,e.parentNodeAfter.id,e.parentNodeAfter.name)):e.isRemoved?"node ".concat(vo(e.node.idPath,e.node.id,e.node.name)," was removed from ").concat(vo(e.parentNodeBefore.idPath,e.parentNodeBefore.id,e.parentNodeBefore.name)):"node ".concat(vo(e.node.idPath,e.node.id,e.node.name)," was moved from ").concat(vo(e.parentNodeBefore.idPath,e.parentNodeBefore.id,e.parentNodeBefore.name)," to ").concat(vo(e.parentNodeAfter.idPath,e.parentNodeAfter.id,e.parentNodeAfter.name))}}}};zi.render=Bi;var Ui=zi,Vi=n("90eb"),Fi={name:"Menu",components:{Button:Po["a"],PrimeMenu:Vi["a"],MenuButton:Wa,Feedback:ki,CutPaste:yi,AddNode:Xa,RemoveNode:Qa,EditMode:si,TextSearch:Mi,MapChangeLog:Ui},setup:function(){var e=Et(),t=e.state.user,n=Object(r["F"])(),o=Object(r["e"])((function(){return t.user&&t.user.photoURL?t.user.photoURL:"../../assets/images/user.svg"})),a=Object(r["e"])((function(){return t.user?t.user.email:null})),i=Object(r["e"])((function(){return[{label:a.value,items:[{label:"sign out",icon:"pi pi-sign-out",command:function(){e.dispatch("user/".concat(Ye.signOut))}}]}]}));return{email:a,userPhotoURL:o,editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),isNodeSelected:Object(r["e"])((function(){return e.state.tree.selectedNodeId})),isPinned:Object(r["e"])((function(){return void 0!==e.state.pin.pins[e.state.tree.selectedNodeId]})),signIn:function(){return e.dispatch("user/".concat(Ye.signIn))},menu:n,toggleUserMenu:function(e){n.value.toggle(e)},items:i}}},Hi=n("9ac3");const Gi=Fi.__cssModules={};Gi["$style"]=Hi["default"],Fi.render=za;var qi=Fi,Wi=Object(r["n"])({name:"Home",components:{Map:An,Menu:qi,NodeContent:Da,ConfirmDialog:wa["a"],Toast:Ta["a"]},setup:function(){var e=Et(),t=Object(Lt["e"])(),n=Object(Lt["d"])(),o=e.state.tree,a=e.state.zoomPan,i=e.state.pin,c=e.state.searchResult,u=Object(r["F"])("-1"),d=!1,l=!1;Object(r["R"])((function(){return n.params.id}),(function(){e.commit("tree/".concat(Ae.SET_SELECTED_NODE_ID),n.params.id)}),{immediate:!0});var b=function(e,t,n){var r=En(t,n,e),o=Object(p["a"])(r,2),a=o[0],i=o[1];return i?(A("Home.vue: error in filterNodesAndLayers:",{err:i}),[]):a.reverse()},m=Object(r["F"])(null),O=Object(r["F"])([]),v=!0;Object(Lt["c"])(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:v=!1;case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(r["R"])((function(){return[o.mapNodeLayers]}),(function(){if(v&&n.params.id.length>0&&o.mapNodeLayers.length>0){var t=z(n.params.id,o.mapNodeLayers),r=Object(p["a"])(t,1),a=r[0];null!=a&&e.commit("zoomPan/".concat(Ue.SET_PAN),{x:-a.center.x+o.mapNodeLayers[0]["0"].center.x,y:-a.center.y+o.mapNodeLayers[0]["0"].center.y})}})),Object(r["R"])((function(){return[o.mapNodeLayers,a.debouncedZoom,a.debouncedPan]}),(function(){var e=Cn(o.mapNodeLayers,o.nodeRecord,{width:window.innerWidth,height:window.innerHeight},a.debouncedZoom,a.pan,a.zoomCenter),t=Object(p["a"])(e,2),n=t[0],r=t[1];null!=r&&A("filterNodesAndLayers: error in findCurrentNode",{err:r}),m.value=n,O.value=b(n,o.mapNodeLayers,o.nodeRecord)}),{immediate:!0,deep:!0});var h=Object(r["F"])([]);return Object(r["R"])((function(){return[a.pan.x,a.pan.y,a.zoom,O]}),(function(){var e=L(O.value);h.value=Rn(e,a.zoom,a.pan)}),{immediate:!0,deep:!0}),{pinNodes:Object(r["e"])((function(){if(null==m.value)return[];var e=i.pinsReverse[m.value];if(!e)return[];var t,n=Object(f["a"])(O.value);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var c in r){var u=r[c];if(""!=u.title){var d=e.indexOf(u.id);-1!=d&&e.splice(d,1)}}}}catch(g){n.e(g)}finally{n.f()}var s,l=U(e,o.mapNodeLayers),p=[],b=Object(f["a"])(l);try{for(b.s();!(s=b.n()).done;){var v=s.value,h=L(v);h.center=Tn(v.center,a.zoom,a.pan),p.push(h)}}catch(g){b.e(g)}finally{b.f()}return p})),searchResultNodeIDs:Object(r["e"])((function(){return c.nodeIDs})),searchResultPinNodes:Object(r["e"])((function(){if(null==m.value)return[];var e=L(c.nodeIDs);if(!e)return[];var t,n=Object(f["a"])(O.value);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var i in r){var u=r[i];if(""!=u.title){var d=e.indexOf(u.id);-1!=d&&e.splice(d,1)}}}}catch(g){n.e(g)}finally{n.f()}var s,l=U(e,o.mapNodeLayers),p=[],b=Object(f["a"])(l);try{for(b.s();!(s=b.n()).done;){var v=s.value,h=L(v);h.center=Tn(v.center,a.zoom,a.pan),p.push(h)}}catch(g){b.e(g)}finally{b.f()}return p})),editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),selectedNodeId:Object(r["e"])((function(){return o.selectedNodeId})),selectedNodePreconditionIds:Object(r["e"])((function(){return o.selectedNodeId?e.state.precondition.preconditions[o.selectedNodeId]:[]})),visibleZoomedPanedLayers:h,nodeDragging:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("positionChangePermits/".concat(N.CheckNodeID),n.id);case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,e.dispatch("".concat(Dt.updateNodePosition),{nodeId:n.id,delta:{x:n.delta.x/a.zoom,y:n.delta.y/a.zoom}});case 7:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),setSelectPreconditionON:function(){d=!0},setSelectPreconditionOFF:function(){d=!1},clickedTitleId:u,titleClick:function(e){d?u.value=e.id:t.push({name:"node",params:{id:e.id}})},titleOver:function(t){l=!0,e.commit("tree/".concat(Ae.SET_SELECTED_NODE_ID),t.id)},titleLeave:function(t){l=!1,e.commit("tree/".concat(Ae.SET_SELECTED_NODE_ID),n.params.id)},mapDragging:function(t){e.state.editModeOn&&l||e.commit("zoomPan/".concat(Ue.ADD_PAN),t)},zoom:function(t){var n={x:(t.center.x-a.pan.x)/a.zoom,y:(t.center.y-a.pan.y)/a.zoom};e.commit("zoomPan/".concat(Ue.ADD_ZOOM),-1*t.delta);var r={x:n.x*a.zoom+a.pan.x,y:n.y*a.zoom+a.pan.y};e.commit("zoomPan/".concat(Ue.ADD_PAN),{from:r,to:t.center}),e.commit("zoomPan/".concat(Ue.SET_ZOOM_CENTER),t.center)}}}});Wi.render=Ht;var Yi=Wi,Xi={key:0},Zi={key:1},Ki=Object(r["m"])("b",null,"id:",-1),$i=Object(r["m"])("b",null,"timestamp:",-1),Ji=Object(r["m"])("b",null,"action:",-1),Qi=Object(r["m"])("b",null,"node_id:",-1),ec=Object(r["m"])("b",null,"user_id:",-1),tc=Object(r["m"])("b",null,"value:",-1),nc={key:1};function rc(e,t,n,o,a,i){var c=Object(r["I"])("Markdown");return o.isAuthorized?(Object(r["z"])(),Object(r["g"])("div",Zi,[Object(r["m"])("div",null,[Ki,Object(r["l"])(" "+Object(r["M"])(o.route.params.id),1)]),Object(r["m"])("div",null,[$i,Object(r["l"])(" "+Object(r["M"])(new Date(o.change["timestamp"]).toLocaleDateString())+" "+Object(r["M"])(new Date(o.change["timestamp"]).toLocaleTimeString()),1)]),Object(r["m"])("div",null,[Ji,Object(r["l"])(" "+Object(r["M"])(o.change["action"]),1)]),Object(r["m"])("div",null,[Qi,Object(r["l"])(" "+Object(r["M"])(o.change["node_id"]),1)]),Object(r["m"])("div",null,[ec,Object(r["l"])(" "+Object(r["M"])(o.change["user_id"]),1)]),tc,-1!=["content","name"].indexOf(o.change["action"])?(Object(r["z"])(),Object(r["g"])(c,{key:0,content:o.change["attributes"]["value"],rows:20},null,8,["content"])):(Object(r["z"])(),Object(r["g"])("div",nc,Object(r["M"])(JSON.stringify(o.change["attributes"])),1))])):(Object(r["z"])(),Object(r["g"])("h1",Xi,"Only authorized users can view changes"))}var oc={name:"Change",components:{Markdown:Kr},setup:function(){var e=Et(),t=Object(r["e"])((function(){return e.state.user.user&&!e.state.user.user.isAnonymous})),n=Object(Lt["d"])(),o=Object(r["F"])({});return Object(r["R"])((function(){return t.value}),Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.value){e.next=6;break}return r=Object(K["c"])(Object(K["e"])(),"changes",n.params.id),e.next=4,Object(K["d"])(r);case 4:a=e.sent,a.exists()&&(o.value=a.data());case 6:case"end":return e.stop()}}),e)}))),{immediate:!0}),{isAuthorized:t,route:n,change:o}}};oc.render=rc;var ac=oc,ic={key:0},cc={key:1},uc=Object(r["m"])("b",null,"id:",-1),dc=Object(r["m"])("b",null,"is removed from map:",-1),sc=Object(r["m"])("b",null,"parent_id:",-1),lc=Object(r["m"])("b",null,"name:",-1),pc=Object(r["m"])("b",null,"content:",-1),bc=Object(r["m"])("b",null,"precondition:",-1),fc=Object(r["m"])("b",null,"children:",-1);function mc(e,t,n,o,a,i){var c=Object(r["I"])("Markdown");return o.isAuthorized?(Object(r["z"])(),Object(r["g"])("div",cc,[Object(r["m"])("div",null,[uc,Object(r["l"])(" "+Object(r["M"])(o.route.params.id),1)]),Object(r["m"])("div",null,[dc,Object(r["l"])(" "+Object(r["M"])(o.node["is_in_trash"]),1)]),Object(r["m"])("div",null,[sc,Object(r["m"])("a",{target:"_blank",href:o.node["map"]["parentID"]},Object(r["M"])(o.node["map"]["parentID"]),9,["href"])]),Object(r["m"])("div",null,[lc,Object(r["l"])(" "+Object(r["M"])(o.node["map"]["name"]),1)]),pc,Object(r["m"])(c,{content:o.node["node_content"]?o.node["node_content"]["content"]:"",rows:20},null,8,["content"]),Object(r["m"])("div",null,[bc,(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(o.node["precondition"],(function(e){return Object(r["z"])(),Object(r["g"])("div",{key:e},[Object(r["m"])("a",{target:"_blank",href:e},Object(r["M"])(e),9,["href"])])})),128))]),Object(r["m"])("div",null,[fc,(Object(r["z"])(!0),Object(r["g"])(r["a"],null,Object(r["G"])(o.node["map"]["children"],(function(e){return Object(r["z"])(),Object(r["g"])("div",{key:e},[Object(r["m"])("a",{target:"_blank",href:e},Object(r["M"])(e),9,["href"])])})),128))])])):(Object(r["z"])(),Object(r["g"])("h1",ic,"Only authorized users can view node profile"))}var Oc={name:"NodeDescription",components:{Markdown:Kr},setup:function(){var e=Et(),t=Object(r["e"])((function(){return e.state.user.user&&!e.state.user.user.isAnonymous})),n=Object(Lt["d"])(),o=Object(r["F"])({});return Object(r["R"])((function(){return t.value}),Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("isAuthorized.value",t.value),t.value&&G["a"].database().ref("/trash/".concat(n.params.id)).once("value",(function(e){e.exists()?(o.value=e.val(),o.value["is_in_trash"]=!0,console.log("node.value",o.value)):(o.value["is_in_trash"]=!1,G["a"].database().ref("/map/".concat(n.params.id)).once("value",(function(e){e.exists()&&(o.value["map"]=e.val())})),G["a"].database().ref("/node_content/".concat(n.params.id)).once("value",(function(e){e.exists()&&(o.value["node_content"]=e.val())})),G["a"].database().ref("/precondition/".concat(n.params.id)).once("value",(function(e){e.exists()&&(o.value["precondition"]=e.val())})))}));case 2:case"end":return e.stop()}}),e)}))),{immediate:!0}),{isAuthorized:t,route:n,node:o}}};Oc.render=mc;var vc=Oc;function hc(e,t){return Object(r["z"])(),Object(r["g"])("h1",null,"Oops, it looks like the page you're looking for doesn't exist.")}const gc={};gc.render=hc;var jc=gc,yc=[{path:"/passwordLogin",component:Ft},{path:"/node_description/:id?",name:"node_description",component:vc},{path:"/change/:id?",name:"change",component:ac},{path:"/:id?",name:"node",component:Yi},{path:"/:catchAll(.*)",component:jc}],Ic=Object(Lt["a"])({history:Object(Lt["b"])("/"),routes:yc}),xc=Ic;n("7165"),n("e1ae"),n("4121"),n("bddf");Object(r["f"])(_t).use(Ct,kt).use(xc).use(St["a"]).use(Mt["a"]).use(Pt["a"]).mount("#app")},cd50:function(e,t,n){var r={"./bmp":"0dcc","./bmp.js":"0dcc","./gif":"c416","./gif.js":"c416","./jpg":"135b","./jpg.js":"135b","./png":"e9ef","./png.js":"e9ef","./psd":"520c","./psd.js":"520c","./svg":"b0bf","./svg.js":"b0bf","./tiff":"f270","./tiff.js":"f270","./webp":"cf1e","./webp.js":"cf1e"};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id="cd50"},d6b6:function(e){e.exports=JSON.parse("{}")},e0f1:function(e,t,n){},e35d:function(e,t,n){"use strict";n("504a")},ec58:function(e,t,n){e.exports=n.p+"img/pin-on-map.3e21aea9.svg"},f327:function(e,t,n){e.exports={wrapper:"Index_wrapper_1nXRC",textSearch:"Index_textSearch_1a-zf"}},fdc1:function(e,t,n){e.exports=n.p+"img/add-off.32a0c20b.svg"}});
//# sourceMappingURL=app.0206eb91.js.map