(function(e){function t(t){for(var r,i,c=t[0],u=t[1],d=t[2],l=0,p=[];l<c.length;l++)i=c[l],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);s&&s(t);while(p.length)p.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var s=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"0c6e":function(e,t,n){"use strict";var r=n("7c1f"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},"0c86":function(e,t,n){e.exports=n.p+"img/telegram.4a3b25ac.svg"},"1b02":function(e,t,n){},"4acb":function(e,t,n){},"65ae":function(e,t,n){"use strict";n("4acb")},"65b8":function(e,t,n){},"7c1f":function(e,t,n){e.exports={wrapper:"Index_wrapper_1nXRC"}},a209:function(e,t,n){"use strict";n("65b8")},aa20:function(e,t){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function o(e,t,n,o,a,i){var c=Object(r["C"])("router-view");return Object(r["u"])(),Object(r["g"])(c)}n("a4d3"),n("e01a"),n("99af"),n("4160"),n("d3b7"),n("159b"),n("96cf");var a,i,c,u,d=n("1da1"),s=n("ade3"),l=n("3835"),p=n("5502"),f=(n("c975"),n("a434"),n("b85c")),b={SET_PINS:"SET_PINS",ADD_TO_PINS:"ADD_TO_PINS",REMOVE_PIN:"REMOVE_PIN",ADD_TO_PINS_REVERSE:"ADD_TO_PINS_REVERSE"},O={AddPin:"AddPin",RemovePin:"RemovePin"},m={namespaced:!0,state:{pins:{},pinsReverse:{}},actions:(a={},Object(s["a"])(a,O.AddPin,(function(e,t){var n=e.commit,r=e.rootState,o=r.tree.nodeRecord[t.nodeId].parent;if(o){var a=[];while(o&&o.id!=t.parentId)a.push(o.id),o=r.tree.nodeRecord[o.id].parent;a.push(t.parentId),n(b.ADD_TO_PINS,{nodeId:t.nodeId,parentIds:a});for(var i=0,c=a;i<c.length;i++){var u=c[i];n(b.ADD_TO_PINS_REVERSE,{nodeId:u,pinId:t.nodeId})}}})),Object(s["a"])(a,O.RemovePin,(function(e,t){var n=e.commit;n(b.REMOVE_PIN,t)})),a),mutations:(i={},Object(s["a"])(i,b.SET_PINS,(function(e,t){for(var n in e.pins=t,e.pinsReverse={},t){var r,o=Object(f["a"])(t[n]);try{for(o.s();!(r=o.n()).done;){var a=r.value;e.pinsReverse[a]||(e.pinsReverse[a]=[]),e.pinsReverse[a].push(n)}}catch(i){o.e(i)}finally{o.f()}}})),Object(s["a"])(i,b.ADD_TO_PINS,(function(e,t){e.pins[t.nodeId]=t.parentIds})),Object(s["a"])(i,b.ADD_TO_PINS_REVERSE,(function(e,t){e.pinsReverse[t.nodeId]||(e.pinsReverse[t.nodeId]=[]),e.pinsReverse[t.nodeId].push(t.pinId)})),Object(s["a"])(i,b.REMOVE_PIN,(function(e,t){var n,r=Object(f["a"])(e.pins[t]);try{for(r.s();!(n=r.n()).done;){var o=n.value,a=e.pinsReverse[o].indexOf(t);e.pinsReverse[o].splice(a,1)}}catch(i){r.e(i)}finally{r.f()}delete e.pins[t]})),i)},v={SET_PRECONDITIONS:"SET_PRECONDITIONS",ADD_TO_PRECONDITIONS:"ADD_TO_PRECONDITIONS",REMOVE_FROM_PRECONDITIONS:"REMOVE_FROM_PRECONDITIONS"},j={AddPrecondition:"AddPrecondition",RemovePrecondition:"RemovePrecondition"},h={namespaced:!0,state:{preconditions:{}},actions:(c={},Object(s["a"])(c,j.AddPrecondition,(function(e,t){var n=e.commit;t.nodeId&&t.preconditionId?n(v.ADD_TO_PRECONDITIONS,t):console.log("AddPrecondition bad arguments","nodeId",t.nodeId,"preconditionId",t.preconditionId)})),Object(s["a"])(c,j.RemovePrecondition,(function(e,t){var n=e.commit;n(v.REMOVE_FROM_PRECONDITIONS,{nodeId:t.nodeId,preconditionId:t.preconditionId})})),c),mutations:(u={},Object(s["a"])(u,v.SET_PRECONDITIONS,(function(e,t){e.preconditions=t})),Object(s["a"])(u,v.ADD_TO_PRECONDITIONS,(function(e,t){e.preconditions[t.nodeId]||(e.preconditions[t.nodeId]=[]),e.preconditions[t.nodeId].push(t.preconditionId)})),Object(s["a"])(u,v.REMOVE_FROM_PRECONDITIONS,(function(e,t){var n=e.preconditions[t.nodeId];n&&-1!=n.indexOf(t.preconditionId)&&e.preconditions[t.nodeId].splice(n.indexOf(t.preconditionId),1)})),u)},g=(n("4de4"),n("c740"),n("caad"),n("d81d"),n("b0c0"),n("2532"),n("3ca3"),n("ddb0"),n("2909")),N=n("53ca"),I=(n("a15b"),n("13d5"),n("a9e3"),n("b64b"),n("595b")),y=function(e,t,n){var r=new Error(e);return{error:r,kv:t,code:n}},x=n("9fe2"),D=n("dcbe"),E=n.n(D),R=n("2ef0"),T=0;function w(e,t){return(e%t+t)%t}function C(e){var t=Math.pow(10,T);return Math.round(e*t)/t}function k(e){return Object(R["cloneDeep"])(e)}function _(e,t){var n;t||console.error(e);var r=[];for(var o in t)r.push(o,t[o]);(n=console).error.apply(n,[e].concat(r))}var S=n("ec26");function P(e,t){for(var n in t){var r=t[Number(n)];if(r&&r[e])return[r[e],Number(n)]}return[null,null]}function A(e,t){var n,r=[],o=Object(f["a"])(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(a){var i,c=Object(f["a"])(e);try{for(c.s();!(i=c.n()).done;){var u=i.value;a[u]&&r.push(a[u])}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){o.e(d)}finally{o.f()}return r}function M(e,t){return{id:Object(S["a"])(),position:t,title:e,wikipedia:"",resources:[],children:[]}}function L(e,t){var n=P(e.id,t),r=Object(l["a"])(n,1),o=r[0];if(null===o)return[null,null,y("getNewNodeCenter: cannot find mapNode for parent",{parentId:e.id,mapNodeLayers:t})];if(0===e.children.length){var a,i=o.border.map((function(t){return{from:e.position,to:t}})),c=i[0],u=Object(f["a"])(i);try{for(u.s();!(a=u.n()).done;){var d=a.value;J(d)>J(c)&&(c=d)}}catch(B){u.e(B)}finally{u.f()}return[{x:c.from.x+(c.to.x-c.from.x)/2,y:c.from.y+(c.to.y-c.from.y)/2},null,null]}var s=e.children[0],p=P(s.id,t),b=Object(l["a"])(p,1),O=b[0];if(null===O)return[null,null,y("getNewNodeCenter: cannot find maxDiagChild in layers",{maxDiagChildId:s.id,mapNodeLayers:t})];var m,v=Object(f["a"])(e.children);try{for(v.s();!(m=v.n()).done;){var j=m.value,h=P(j.id,t),g=Object(l["a"])(h,1),N=g[0];if(null===N)return[null,null,y("getNewNodeCenter: cannot find child in layers",{childId:j.id,mapNodeLayers:t})];var I=ve(N.border),x=Object(l["a"])(I,2),D=x[0],E=x[1];if(E)return[null,null,y("getNewNodeCenter: error getMaxDiagonal",{childMapNode:N,err1:E})];var R=ve(O.border),T=Object(l["a"])(R,2),w=T[0],C=T[1];if(C)return[null,null,y("getNewNodeCenter: error getMaxDiagonal",{maxDiagChildMapNode:O,err2:C})];J(D)>J(w)&&(O=N)}}catch(B){v.e(B)}finally{v.f()}var _=ve(O.border),S=Object(l["a"])(_,1),A=S[0],M=pe(A,3/4).to,L=k(s);return L.position=pe(A,1/4).to,[M,L,null]}function B(e,t){if(null==e.tree)return y("state.tree == null",{});var n=e.nodeRecord[t.nodeId];if(!n)return y("updateNodePosition: cannot find node in nodeRecord",{"v.nodeId":t.nodeId,"state.nodeRecord":e.nodeRecord});if(!n.parent)return y("updateNodePosition: cannot move root of tree",{"v.nodeId":t.nodeId});var r=je("normalize",t.position,n.parent.id,e.mapNodeLayers),o=Object(l["a"])(r,1),a=o[0];n.node.position=a;var i=P(n.parent.id,e.mapNodeLayers),c=Object(l["a"])(i,2),u=c[0],d=c[1];if(!u||null===d)return y("updateNodePosition: cannot find mapNode for parent",{id:n.parent.id,"state.mapNodeLayers":e.mapNodeLayers});var s=he(n.parent,u.border,u.center),p=Object(l["a"])(s,2),f=p[0],b=p[1];return null==f||null!=b?y("updateNodePosition: create layers for parent",{id:n.parent.id,parentMapNode:u}):ge(e.mapNodeLayers,f,d)}n("25f0");var U=n("2591"),H=n("bc3a"),z=n.n(H);n("07ac");function V(e){var t;return e?Array.isArray(e)?(t=e.filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):(t=Object.values(e).filter((function(e){return!!e})).sort(),t.forEach((function(e,t,n){return n[t]=e.toString()}))):t=[],t}function F(e){var t={id:e["0"].id.toString(),title:e["0"].name,position:e["0"].position,children:[]},n=[t];while(n.length>0){var r=n.pop();if(r){if(!e[r.id])return[null,y("Cannot find id in dbNodes",{"node.id":r.id,dbNodes:e})];if(e[r.id].children=V(e[r.id].children),e[r.id].children.length){var o,a=[],i=Object(f["a"])(e[r.id].children);try{for(i.s();!(o=i.n()).done;){var c=o.value;a.push({id:c.toString(),title:e[c].name,position:e[c].position,children:[]})}}catch(u){i.e(u)}finally{i.f()}r.children=a,n.push.apply(n,a)}}}return[t,null]}n("d6b6");var G,W=!1,q="https://us-central1-sci-map-1982.cloudfunctions.net/",Y=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U["a"].database().ref().update(t);case 3:return e.abrupt("return",null);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",y("api: error in update",{err:e.t0}));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),K=Object(R["debounce"])(Y,400),X={ROOT_WIDTH:1440,ROOT_HEIGHT:821,ST_WIDTH:1e3,ST_HEIGHT:1e3,initFirebase:function(){var e={apiKey:"AIzaSyCP50k-WOkTeG8BYvRtu4Bo_x3T2RnVsxU",authDomain:"sci-map-1982.firebaseapp.com",databaseURL:"https://sci-map-1982.firebaseio.com",projectId:"sci-map-1982",storageBucket:"sci-map-1982.appspot.com",messagingSenderId:"340899060236",appId:"1:340899060236:web:b136e9289e342a8bb62c29",measurementId:"G-TV74Q61H9P"};U["a"].initializeApp(e),U["a"].analytics(),console.log("process.env.VUE_APP_IS_EMULATOR","")},callFunction:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=U["a"].auth().currentUser,r){n.next=3;break}return n.abrupt("return",["",y("callFunction: cannot determine current user",{})]);case 3:return n.next=5,r.getIdToken(!0);case 5:return o=n.sent,t.idToken=o,n.prev=7,n.next=10,z.a.get(q+e,{params:t});case 10:return a=n.sent,n.abrupt("return",[a.data,null]);case 14:return n.prev=14,n.t0=n["catch"](7),n.abrupt("return",["",y("Error in callFunction",{method:e,params:t,e:n.t0})]);case 17:case"end":return n.stop()}}),n,null,[[7,14]])})))()},getMapFromDB:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){var t,n,r,o,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U["a"].database().ref("map").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[null,y("!snapshot.exists",{})]);case 5:if(n=t.val(),r=F(n),o=Object(l["a"])(r,2),a=o[0],i=o[1],null===i){e.next=9;break}return e.abrupt("return",[null,i]);case 9:return e.abrupt("return",[a,null]);case 10:case"end":return e.stop()}}),e)})))()},getMapFromStorage:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=U["a"].storage().ref(),o=r.child("/map.json"),e&&(o=r.child("/user/".concat(e.uid,"/map.json"))),n.next=5,o.getDownloadURL();case 5:return a=n.sent,n.next=8,z.a.get(a);case 8:return i=n.sent,n.abrupt("return",[{id:"0",title:"",position:{x:t.ROOT_WIDTH/2,y:t.ROOT_HEIGHT/2},children:i.data},null]);case 10:case"end":return n.stop()}}),n)})))()},getMap:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!W){n.next=5;break}return n.abrupt("return",t.getMapFromStorage(e));case 5:return n.abrupt("return",t.getMapFromDB());case 6:n.next=11;break;case 8:return n.prev=8,n.t0=n["catch"](0),n.abrupt("return",[null,y(n.t0.message,{e:n.t0})]);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},getPins:function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,r,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=U["a"].storage().ref(),r=n.child("/pins.json"),e&&(r=n.child("/user/".concat(e.uid,"/pins.json"))),t.next=6,r.getDownloadURL();case 6:return o=t.sent,t.next=9,z.a.get(o);case 9:return a=t.sent,t.abrupt("return",[a.data,null]);case 13:return t.prev=13,t.t0=t["catch"](0),t.abrupt("return",[null,y(t.t0.message,{e:t.t0})]);case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},savePins:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return r=U["a"].storage().ref(),o=r.child("/user/".concat(e.uid,"/pins.json")),n.next=6,o.putString(btoa(unescape(encodeURIComponent(JSON.stringify(t)))),"base64");case 6:case"end":return n.stop()}}),n)})))()},getPreconditions:function(e){return Object(d["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U["a"].database().ref("precondition").get();case 3:if(t=e.sent,t.exists()){e.next=6;break}return e.abrupt("return",[null,y("!snapshot.exists",{})]);case 6:return n=t.val(),e.abrupt("return",[n,null]);case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",[null,y(e.t0.message,{e:e.t0})]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},savePreconditions:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,U["a"].database().ref("precondition/"+t.nodeId).set(t.preconditionIds);case 4:case"end":return n.stop()}}),n)})))()},subscribeNodeChange:function(e,t){this.subscribeDBChange("map/".concat(e),(function(e){if(e.exists()){var n=e.val();n.id=n.id.toString(),n.children=V(n.children),t(n)}}))},unsubscribeNodeChange:function(e){U["a"].database().ref("map/".concat(e)).off("value")},subscribeDBChange:function(e,t){U["a"].database().ref(e).on("value",t)},unsubscribeDBChange:function(e,t){U["a"].database().ref(e).off("value",t)},transaction:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,U["a"].database().ref("map/"+e).transaction(t,(function(){}),!1);case 2:case"end":return n.stop()}}),n)})))()},setNode:function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,U["a"].database().ref("map/"+e.id).set(e);case 2:case"end":return t.stop()}}),t)})))()},getNode:function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,U["a"].database().ref("map/"+e).get();case 2:return n=t.sent,r=n.val(),r.id=r.id.toString(),r.children=V(r.children),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})))()},generateKey:function(){return U["a"].database().ref().push().key},findKeyInList:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,U["a"].database().ref(e).orderByValue().equalTo(t).limitToFirst(1).get();case 2:return r=n.sent,n.abrupt("return",r.key);case 4:case"end":return n.stop()}}),n)})))()},findKeyOfChild:function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,U["a"].database().ref("map/"+e).get();case 2:if(r=n.sent,o=r.val(),o.children){n.next=6;break}return n.abrupt("return",null);case 6:n.t0=regeneratorRuntime.keys(o.children);case 7:if((n.t1=n.t0()).done){n.next=13;break}if(a=n.t1.value,o.children[a]!==t){n.next=11;break}return n.abrupt("return",a);case 11:n.next=7;break;case 13:return n.abrupt("return",null);case 14:case"end":return n.stop()}}),n)})))()},update:Y,debouncedUpdate:K,getResources:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U["a"].database().ref("resources").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[null,y("!snapshot.exists",{})]);case 5:return n=t.val(),e.abrupt("return",[n,null]);case 7:case"end":return e.stop()}}),e)})))()},getUserComments:function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.uid,t.next=3,U["a"].database().ref("user_data/".concat(n,"/comment")).get();case 3:if(r=t.sent,r.exists()){t.next=6;break}return t.abrupt("return",[null,y("!snapshot.exists",{})]);case 6:return o=r.val(),t.abrupt("return",[o,null]);case 8:case"end":return t.stop()}}),t)})))()},getNodeContent:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,U["a"].database().ref("node_content").get();case 2:if(t=e.sent,t.exists()){e.next=5;break}return e.abrupt("return",[{},null]);case 5:return e.abrupt("return",[t.val(),null]);case 6:case"end":return e.stop()}}),e)})))()}},Z=[{x:0,y:0},{x:0,y:X.ST_HEIGHT},{x:X.ST_WIDTH,y:X.ST_HEIGHT},{x:X.ST_WIDTH,y:0}];function J(e){return Math.sqrt(Math.pow(e.from.x-e.to.x,2)+Math.pow(e.from.y-e.to.y,2))}function $(e){if(!e)throw new Error("polygonToTurf: p is empty");var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),I["polygon"]([t])}function Q(e,t){return I["booleanPointInPolygon"](I["point"]([e.x,e.y]),$(t))}function ee(e){var t=e.map((function(e){return[e.x,e.y]}));return t.push([e[0].x,e[0].y]),[t]}function te(e){return Math.abs(Object(x["a"])(e.map((function(e){return[e.x,e.y]}))))}function ne(e,t){var n=k(e),r=k(t),o=1;while(te(n)<1e3&&te(r)<1e3)o*=10,n=e.map((function(e){return{x:e.x*o,y:e.y*o}})),r=t.map((function(e){return{x:e.x*o,y:e.y*o}}));n=n.map((function(e){return{x:C(e.x),y:C(e.y)}})),r=r.map((function(e){return{x:C(e.x),y:C(e.y)}}));var a=ee(n),i=ee(r);if(null==a||null==i)return[null,y("intersect: error in polygonToPCPolygon",{p1:e,p2:t})];var c=E.a.intersection(a,i);if(null==c||!c.length)return[[],null];var u,d=[],s=Object(f["a"])(c[0]);try{for(s.s();!(u=s.n()).done;){var l,p=u.value,b=[],O=Object(f["a"])(p);try{for(O.s();!(l=O.n()).done;){var m=l.value;b.push({x:m[0]/o,y:m[1]/o})}}catch(v){O.e(v)}finally{O.f()}b.pop(),d.push(b)}}catch(v){s.e(v)}finally{s.f()}return[d,null]}function re(e){e||console.error("bad border",e);var t=e.reduce((function(e,t){return e.x>t.x?t:e})).x,n=e.reduce((function(e,t){return e.y>t.y?t:e})).y,r=e.reduce((function(e,t){return e.x<t.x?t:e})).x,o=e.reduce((function(e,t){return e.y<t.y?t:e})).y;return{leftBottom:{x:t,y:n},rightTop:{x:r,y:o}}}function oe(e,t,n){var r,o=e.map((function(e){return I["point"]([e.x,e.y])})),a=I["featureCollection"](o),i=I["voronoi"](a,{bbox:[t.x,t.y,n.x,n.y]}),c={},u=0,d=Object(f["a"])(i.features);try{for(d.s();!(r=d.n()).done;){var s=r.value;if(!s)return[{},y("getVoronoiCellsInSquare: undefined cell",{centers:e,leftBottom:t,rightTop:n})];var l=s.geometry.coordinates[0].map((function(e){return{x:e[0],y:e[1]}}));l.pop(),c[u]=l,u++}}catch(p){d.e(p)}finally{d.f()}return[c,null]}function ae(e,t){if(!e)return[[],y("getVoronoiCells: bad outerBorder",{outerBorder:e,centers:t})];var n=re(e),r=oe(t,n.leftBottom,n.rightTop),o=Object(l["a"])(r,2),a=o[0],i=o[1];if(i)return[[],y("getVoronoiCells: error in getVoronoiCellsInSquare",{err:i,bb:n,centers:t})];var c=[];for(var u in t){if(!a[u])return[[],y("Cannot find index in cellMap",{index:u,centers:t,cellMap:a,BoundingBorders:n,outerBorder:e})];var d=ne(a[u],e),s=Object(l["a"])(d,2),p=s[0],f=s[1];if(null==p||null!=f)return[[],y("getVoronoiCells error",{err:f,cellBorder:a[u],outerBorder:e})];if(p==[])return[[],y("Voronoi cell has no intersection with outerBorder",{point:t[u]})];if(p.length>1)return[[],y("Voronoi cell has more than one intersection with outerBorder",{point:t[u]})];c.push({border:p[0],center:t[u]})}return[c,null]}function ie(e,t,n){return e&&e==t?"#f3afaf":n&&-1!=n.indexOf(t)?"#62f363":"transparent"}function ce(e,t,n){return e&&e==t||n&&-1!=n.indexOf(t)?"0.2":"0"}function ue(e){return e.map((function(e){return"".concat(e.x," ").concat(e.y)})).join(",")}function de(e){var t={},n=[{node:e,parent:null}],r=function(){var e=n.pop();if(!e)return"break";t[e.node.id]=e,n.push.apply(n,Object(g["a"])(e.node.children.map((function(t){return{node:t,parent:e.node}}))))};while(n.length){var o=r();if("break"===o)break}return t}function se(e,t){return{from:{x:t.x,y:t.y},to:{x:t.x+(e.to.x-e.from.x),y:t.y+(e.to.y-e.from.y)}}}function le(e,t){var n=se(t,e.to);return{from:{x:e.from.x,y:e.from.y},to:{x:n.to.x,y:n.to.y}}}function pe(e,t){var n=se(e,{x:0,y:0});return se({from:{x:0,y:0},to:{x:n.to.x*t,y:n.to.y*t}},e.from)}function fe(e,t){return se(t,e).to}function be(e,t){var n=e.from.x,r=e.from.y,o=e.to.x,a=e.to.y,i=t.from.x,c=t.from.y,u=t.to.x,d=t.to.y,s=(d-c)*(o-n)-(u-i)*(a-r),l=(u-i)*(r-c)-(d-c)*(n-i),p=(o-n)*(r-c)-(a-r)*(n-i);if(0==s)return null;var f=l/s,b=p/s;return f>=0&&f<=1&&b>=0&&b<=1?{x:n+f*(o-n),y:r+f*(a-r)}:null}function Oe(e,t,n){var r=I["centerOfMass"]($(e)).geometry;if(null==r)return[null,y("morphChildrenPoints oldBorder centerOfMass error",{oldBorder:e,oldPoints:n})];var o=I["centerOfMass"]($(t)).geometry;if(null==o)return[null,y("morphChildrenPoints newBorder centerOfMass error",{newBorder:t,oldPoints:n})];var a={x:r.coordinates[0],y:r.coordinates[1]},i={x:o.coordinates[0],y:o.coordinates[1]};for(var c in e=e.map((function(e){return fe(e,{from:a,to:i})})),n)n[c]=fe(n[c],{from:a,to:i});var u=Math.max(J({from:re(e).leftBottom,to:re(e).rightTop}),J({from:re(t).leftBottom,to:re(t).rightTop})),d={};for(var s in n){var l=n[s];if(i.x!=l.x||i.y!=l.y){var p={from:i,to:n[s]};p=pe(p,u/J(p));var f=null;for(var b in e){var O={from:e[b],to:e[(Number(b)+1)%e.length]},m=be(p,O);if(null!=m){f=m;break}}if(null==f)return[null,y("morphChildrenPoints cannot find intersection with oldBorder",{centerToPoint:p,oldBorder:e})];var v=null;for(var j in t){var h={from:t[j],to:t[(Number(j)+1)%t.length]},g=be(p,h);if(null!=g){v=g;break}}if(null==v)return[null,y("morphChildrenPoints cannot find intersection with newBorder",{centerToPoint:p,newBorder:t})];if(f.x!=v.x||f.y!=v.y){var N=J({from:i,to:v})/J({from:i,to:f});d[s]=pe({from:i,to:l},N).to}else d[s]=l}else d[s]=l}return[d,null]}function me(){return{from:{x:0,y:0},to:{x:0,y:0}}}function ve(e){if(!e||e.length<3)return[me(),y("getMaxDiagonal: bad polygon",{polygon:e})];var t=[];if(3==e.length)for(var n in e){var r=pe({from:e[w(Number(n)-1,e.length)],to:e[w(Number(n)+1,e.length)]},.5);t.push({from:e[n],to:r.to})}else for(var o in e)for(var a in e)Number(a)!=w(Number(o)-1,e.length)&&Number(a)!=Number(o)&&Number(a)!=w(Number(o)+1,e.length)&&t.push({from:e[o],to:e[a]});for(var i=t[0],c=0,u=t;c<u.length;c++){var d=u[c];J(d)>J(i)&&(i=d)}return[i,null]}function je(e,t,n,r){var o;if(n){var a,i,c=P(n,r),u=Object(l["a"])(c,1),d=u[0];if(!d)return[null,y("UPDATE_NODE: Cannot findMapNode",{id:n})];if("denormalize"===e){if(!Q(t,Z))return[null,y("convertPosition: position outside NORMALIZED_BORDER",{normalizedBorder:Z,position:t,parentID:n})];var s=Oe(Z,d.border,{tmp:t}),p=Object(l["a"])(s,2);a=p[0],i=p[1]}else{if(!Q(t,d.border))return[null,y("convertPosition: position outside parentMapNode.border",{"parentMapNode.border":d.border,position:t,parentID:n})];var f=Oe(d.border,Z,{tmp:t}),b=Object(l["a"])(f,2);if(a=b[0],i=b[1],null!==i)return[null,y("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:Z,"parentMapNode.border":d.border,"dbNode.position":t})];a["tmp"].x<0&&(a["tmp"].x=1),a["tmp"].x>X.ST_WIDTH&&(a["tmp"].x=X.ST_WIDTH-1),a["tmp"].y<0&&(a["tmp"].y=1),a["tmp"].y>X.ST_HEIGHT&&(a["tmp"].y=X.ST_HEIGHT-1)}if(null!==i)return[null,y("UPDATE_NODE: Cannot morphChildrenPoints",{type:e,normalizedBorder:Z,"parentMapNode.border":d.border,"dbNode.position":t})];o=a["tmp"]}else o="denormalize"===e?{x:X.ROOT_WIDTH/2,y:X.ROOT_HEIGHT/2}:{x:X.ST_WIDTH/2,y:X.ST_HEIGHT/2};return[o,null]}function he(e,t,n){if(0==Object.keys(e).length)return[[],null];var r=[[e]],o=[Object(s["a"])({},e.id,{id:e.id,border:t,title:e.title,center:n})];while(1){var a,i=r[r.length-1],c=o[r.length-1],u=[],d={},p=Object(f["a"])(i);try{for(p.s();!(a=p.n()).done;){var b=a.value;if(!b.children)return[null,y("treeToMapNodeLayers: treeNode with children undefined",{treeNode:b})];if(b.children.length){if(u.push.apply(u,Object(g["a"])(b.children)),!c[b.id])return[null,y("Cannot find node in mapNodeLayers",{layer:o[o.length-1],treeNode:b})];var O,m=k(b.children),v=Object(f["a"])(m);try{for(v.s();!(O=v.n()).done;){var j=O.value,h=je("denormalize",j.position,b.id,[c]),N=Object(l["a"])(h,2),I=N[0],x=N[1];if(x)return[null,x];j.position=I}}catch(M){v.e(M)}finally{v.f()}var D=ae(c[b.id].border,m.map((function(e){return{x:e.position.x,y:e.position.y}}))),E=Object(l["a"])(D,2),R=E[0],T=E[1];if(null!=T)return[null,T];var w,C=Object(f["a"])(R);try{for(C.s();!(w=C.n()).done;){var _,S=w.value,P=Object(f["a"])(m);try{for(P.s();!(_=P.n()).done;){var A=_.value;A.position.x==S.center.x&&A.position.y==S.center.y&&(d[A.id]={id:A.id,title:A.title,center:A.position,border:S.border})}}catch(M){P.e(M)}finally{P.f()}}}catch(M){C.e(M)}finally{C.f()}}}}catch(M){p.e(M)}finally{p.f()}if(!u.length)return[o,null];r.push(u),o.push(d)}}function ge(e,t,n){if(n>=e.length||n<0)return y("startFromLevel >= recipientLayers.length or startFromLevel < 0",{startFromLevel:n,"recipientLayers.length":e.length});var r=n;while(r<n+t.length){for(var o in t[r-n])e[r][o]=t[r-n][o];r++}return null}var Ne,Ie,ye,xe,De=X.ROOT_WIDTH/7,Ee=[{x:De,y:0},{x:0,y:.3*X.ROOT_HEIGHT},{x:0,y:.7*X.ROOT_HEIGHT},{x:De,y:X.ROOT_HEIGHT},{x:.3*(X.ROOT_WIDTH-2*De)+De,y:1.1*X.ROOT_HEIGHT},{x:.6*(X.ROOT_WIDTH-2*De)+De,y:1.1*X.ROOT_HEIGHT},{x:X.ROOT_WIDTH-2*De+De,y:X.ROOT_HEIGHT},{x:X.ROOT_WIDTH,y:.7*X.ROOT_HEIGHT},{x:X.ROOT_WIDTH,y:.3*X.ROOT_HEIGHT},{x:X.ROOT_WIDTH-De,y:0},{x:X.ROOT_WIDTH-De-.3*(X.ROOT_WIDTH-2*De),y:-.1*X.ROOT_HEIGHT},{x:X.ROOT_WIDTH-De-.7*(X.ROOT_WIDTH-2*De),y:-.1*X.ROOT_HEIGHT}],Re={x:X.ROOT_WIDTH/2,y:X.ROOT_HEIGHT/2},Te={SET_SELECTED_NODE_ID:"SET_SELECTED_NODE_ID",SET_TREE:"SET_TREE",UPDATE_NODE_POSITION:"UPDATE_NODE_POSITION",REMOVE_NODE:"REMOVE_NODE"},we={handleDBUpdate:"handleDBUpdate"},Ce={namespaced:!0,state:function(){return{tree:null,nodeRecord:{},mapNodeLayers:[],selectedNodeId:null}},getters:{selectedNode:function(e){return e.selectedNodeId&&e.nodeRecord[e.selectedNodeId]?e.nodeRecord[e.selectedNodeId].node:null}},actions:Object(s["a"])({},we.handleDBUpdate,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,s,p,b,O,m,v,j,h,g,I,y,x,D,E;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,o=e.state,a=o.nodeRecord[t.dbNode.id],a){n.next=5;break}return _("UPDATE_NODE: Cannot find dbNode in dbNodeRecord",{"dbNode.id":t.dbNode.id}),n.abrupt("return");case 5:if(i={id:a.node.id,parentID:a.parent?a.parent.id:null,name:a.node.title,children:a.node.children.map((function(e){return e.id})).sort(),position:a.node.position},c=t.dbNode.children.filter((function(e){return!i.children.includes(e)})),u=i.children.filter((function(e){return!t.dbNode.children.includes(e)})),!c.length){n.next=30;break}d=Object(f["a"])(c),n.prev=10,p=regeneratorRuntime.mark((function e(){var n,a,i,c,u,d,p,b,O,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=s.value,o.nodeRecord[n]&&(console.log("actions.handleDBUpdate: remove node for cut-and-paste",o.nodeRecord[n]),a={nodeID:n,returnError:null},r(Te.REMOVE_NODE,{nodeID:n,returnError:null}),a.returnError&&_("handleDBUpdate: cannot cut node",{err:a.returnError})),e.next=4,X.getNode(n);case 4:if(i=e.sent,console.log("actions.handleDBUpdate: add node for cut-and-paste",i),c=[i],i){e.next=11;break}return t.dbNode.children=t.dbNode.children.filter((function(e){return e!=n})),_("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 11:u=regeneratorRuntime.mark((function e(){var t,n,r,a,i,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=c.pop(),t){e.next=3;break}return e.abrupt("return","continue");case 3:if(n={id:t.id,title:t.name,position:t.position,children:[],wikipedia:"",resources:[]},o.nodeRecord[t.parentID]){e.next=7;break}return _("Cannot find nodeID in nodeRecord",{nodeID:t.parentID}),e.abrupt("return",{v:{v:void 0}});case 7:o.nodeRecord[t.parentID].node.children=o.nodeRecord[t.parentID].node.children.filter((function(e){return e.id!=n.id})),o.nodeRecord[t.parentID].node.children.push(n),o.nodeRecord[n.id]={parent:o.nodeRecord[t.parentID].node,node:n},r=Object(f["a"])(t.children),e.prev=11,i=regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.value,e.next=3,X.getNode(n);case 3:if(r=e.sent,r){e.next=8;break}return t.children=t.children.filter((function(e){return e!=n})),_("Cannot find node for addition",{nodeID:n}),e.abrupt("return","continue");case 8:c.push(r);case 9:case"end":return e.stop()}}),e)})),r.s();case 14:if((a=r.n()).done){e.next=21;break}return e.delegateYield(i(),"t0",16);case 16:if(u=e.t0,"continue"!==u){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e["catch"](11),r.e(e.t1);case 26:return e.prev=26,r.f(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[11,23,26,29]])}));case 12:if(!c.length){e.next=21;break}return e.delegateYield(u(),"t0",14);case 14:if(d=e.t0,"continue"!==d){e.next=17;break}return e.abrupt("continue",12);case 17:if("object"!==Object(N["a"])(d)){e.next=19;break}return e.abrupt("return",d.v);case 19:e.next=12;break;case 21:if(p=he(o.tree,Ee,Re),b=Object(l["a"])(p,2),O=b[0],m=b[1],!m){e.next=25;break}return _("Cannot treeToMapNodeLayers",{err:m}),e.abrupt("return",{v:void 0});case 25:o.mapNodeLayers=O;case 26:case"end":return e.stop()}}),e)})),d.s();case 13:if((s=d.n()).done){n.next=22;break}return n.delegateYield(p(),"t0",15);case 15:if(b=n.t0,"continue"!==b){n.next=18;break}return n.abrupt("continue",20);case 18:if("object"!==Object(N["a"])(b)){n.next=20;break}return n.abrupt("return",b.v);case 20:n.next=13;break;case 22:n.next=27;break;case 24:n.prev=24,n.t1=n["catch"](10),d.e(n.t1);case 27:return n.prev=27,d.f(),n.finish(27);case 30:if(!u.length){n.next=54;break}O=Object(f["a"])(u),n.prev=32,O.s();case 34:if((m=O.n()).done){n.next=46;break}if(v=m.value,o.nodeRecord[v]&&o.nodeRecord[v].parent){n.next=38;break}return n.abrupt("continue",44);case 38:if(!o.nodeRecord[v]||o.nodeRecord[v].parent.id===t.dbNode.id){n.next=40;break}return n.abrupt("continue",44);case 40:console.log("actions.handleDBUpdate: removing children",o.nodeRecord[v]),j={nodeID:v,returnError:null},r(Te.REMOVE_NODE,j),j.returnError&&_("actions.handleDBUpdate: cannot remove node",{err:j.returnError,id:v});case 44:n.next=34;break;case 46:n.next=51;break;case 48:n.prev=48,n.t2=n["catch"](32),O.e(n.t2);case 51:return n.prev=51,O.f(),n.finish(51);case 54:if(C(t.dbNode.position.x)===C(i.position.x)&&C(t.dbNode.position.y)===C(i.position.y)){n.next=62;break}if(h=je("denormalize",t.dbNode.position,a.parent?a.parent.id:null,o.mapNodeLayers),g=Object(l["a"])(h,1),I=g[0],i.parentID!=t.dbNode.parentID){n.next=62;break}if(y={nodeId:t.dbNode.id,newCenter:I,returnError:null},r(Te.UPDATE_NODE_POSITION,y),null===y.returnError){n.next=62;break}return _("actions.handleDBUpdate: cannot update node's position",{"arg.dbNode":t.dbNode,err:y.returnError}),n.abrupt("return");case 62:if(i.name===t.dbNode.name){n.next=68;break}if(a.node.title=t.dbNode.name,x=P(i.id,o.mapNodeLayers),D=Object(l["a"])(x,1),E=D[0],E){n.next=67;break}return n.abrupt("return");case 67:E.title=t.dbNode.name;case 68:case"end":return n.stop()}}),n,null,[[10,24,27,30],[32,48,51,54]])})))()})),mutations:(G={},Object(s["a"])(G,Te.REMOVE_NODE,(function(e,t){if(null!==e.tree)if(e.nodeRecord[t.nodeID]){var n=e.nodeRecord[t.nodeID].parent;if(n){var r=[t.nodeID];while(r.length){var o=r.pop();o&&(r.push.apply(r,Object(g["a"])(e.nodeRecord[o].node.children.map((function(e){return e.id})))),delete e.nodeRecord[o])}var a=n.children.findIndex((function(e){return e.id===t.nodeID}));n.children.splice(a,1);var i=he(e.tree,Ee,Re),c=Object(l["a"])(i,2),u=c[0],d=c[1];null!=u&&null==d?e.mapNodeLayers=u:t.returnError=d}else t.returnError=y("REMOVE_NODE: cannot remove root node",{nodeId:t.nodeID})}else t.returnError=y("REMOVE_NODE: cannot find nodeId in nodeRecord",{nodeID:t.nodeID,nodeRecord:e.nodeRecord});else t.returnError=y("state.tree === null",{})})),Object(s["a"])(G,Te.SET_SELECTED_NODE_ID,(function(e,t){e.selectedNodeId=t})),Object(s["a"])(G,Te.SET_TREE,(function(e,t){if(null==t)return e.tree=null,e.nodeRecord={},void(e.mapNodeLayers=[]);e.tree=t,e.nodeRecord=de(t);var n=he(t,Ee,Re),r=Object(l["a"])(n,2),o=r[0],a=r[1];null!=o&&null==a?e.mapNodeLayers=o:console.error(a)})),Object(s["a"])(G,Te.UPDATE_NODE_POSITION,(function(e,t){var n=e.nodeRecord[t.nodeId].parent;if(null!==n){var r=P(n.id,e.mapNodeLayers),o=Object(l["a"])(r,1),a=o[0];if(!a)return void(t.returnError=y("UPDATE_NODE_POSITION: cannot find parent mapNode",{"parent.id":n.id,"state.mapNodeLayers":e.mapNodeLayers}));if(!Q(t.newCenter,a.border))return void(t.returnError=y("!isInside",{newCenter:t.newCenter,"parentMapNode.border":a.border}))}t.returnError=B(e,{nodeId:t.nodeId,position:t.newCenter})})),G)},ke={ADD_ZOOM:"ADD_ZOOM",ADD_PAN:"ADD_PAN",SET_ZOOM_CENTER:"SET_ZOOM_CENTER"},_e=Object(R["debounce"])((function(e,t){e.debouncedZoom=t}),100),Se=Object(R["debounce"])((function(e,t){e.debouncedPan=t}),100),Pe=.01,Ae=1,Me={namespaced:!0,state:{zoom:1,pan:{x:0,y:0},debouncedZoom:1,debouncedPan:{x:0,y:0},zoomCenter:{x:0,y:0}},mutations:(Ne={},Object(s["a"])(Ne,ke.SET_ZOOM_CENTER,(function(e,t){e.zoomCenter=t})),Object(s["a"])(Ne,ke.ADD_ZOOM,(function(e,t){e.zoom=e.zoom*Math.pow(2,t*Pe),_e(e,e.zoom)})),Object(s["a"])(Ne,ke.ADD_PAN,(function(e,t){e.pan=le({from:{x:0,y:0},to:e.pan},pe(t,Ae)).to,Se(e,e.pan)})),Ne)},Le={SET_USER:"SET_USER"},Be={signIn:"signIn",signOut:"signOut"},Ue={namespaced:!0,state:{user:null},mutations:Object(s["a"])({},Le.SET_USER,(function(e,t){e.user=t})),actions:(Ie={},Object(s["a"])(Ie,Be.signIn,(function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.commit,t.next=3,U["a"].auth().signInWithPopup(new U["a"].auth.GoogleAuthProvider);case 3:case"end":return t.stop()}}),t)})))()})),Object(s["a"])(Ie,Be.signOut,(function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.next=3,U["a"].auth().signOut();case 3:n(Le.SET_USER,null);case 4:case"end":return t.stop()}}),t)})))()})),Ie)},He={ADD_CUT_PASTE:"ADD_CUT_PASTE",ADD_CREATE:"ADD_CREATE",ADD_REMOVE:"ADD_REMOVE",ADD_POSITION_CHANGE:"ADD_POSITION_CHANGE"};(function(e){e["CUT_PASTE"]="CUT_PASTE",e["CREATE"]="CREATE",e["REMOVE"]="REMOVE",e["POSITION_CHANGE"]="POSITION_CHANGE"})(xe||(xe={}));var ze,Ve,Fe,Ge,We={CUT_PASTE:"CUT_PASTE",CREATE:"CREATE",REMOVE:"REMOVE",POSITION_CHANGE:"POSITION_CHANGE"},qe={namespaced:!0,state:{stableChangeList:{},localChangeList:{}},mutations:(ye={},Object(s["a"])(ye,He.ADD_CUT_PASTE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][We.CREATE]?e.localChangeList[t.nodeID][We.CREATE].parentID=t.newParentID:e.localChangeList[t.nodeID][We.CUT_PASTE]=t})),Object(s["a"])(ye,He.ADD_CREATE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={}),e.localChangeList[t.nodeID][We.CREATE]=t})),Object(s["a"])(ye,He.ADD_REMOVE,(function(e,t){e.localChangeList[t.nodeID]={},e.localChangeList[t.nodeID][We.REMOVE]=t})),Object(s["a"])(ye,He.ADD_POSITION_CHANGE,(function(e,t){e.localChangeList[t.nodeID]||(e.localChangeList[t.nodeID]={});var n=t.oldPosition;e.localChangeList[t.nodeID][We.POSITION_CHANGE]&&(n=e.localChangeList[t.nodeID][We.POSITION_CHANGE].oldPosition),e.localChangeList[t.nodeID][We.POSITION_CHANGE]={nodeID:t.nodeID,oldPosition:n,newPosition:t.newPosition}})),ye),actions:{}},Ye={SET_RESOURCES:"SET_RESOURCES",ADD_TO_RESOURCES:"ADD_TO_RESOURCES"},Ke={find:"find",getByID:"getByID"},Xe={namespaced:!0,state:{resources:{}},actions:(ze={},Object(s["a"])(ze,Ke.find,(function(e,t){var n=e.state,r=[];for(var o in n.resources){var a=n.resources[o];-1==a.author.indexOf(t)&&-1==a.title.indexOf(t)&&-1==a.chapterName.indexOf(t)&&-1==a.doi.indexOf(t)&&-1==a.isbn.indexOf(t)||r.push(a)}return r})),Object(s["a"])(ze,Ke.getByID,(function(e,t){var n=e.state;return n.resources[t]})),ze),mutations:(Ve={},Object(s["a"])(Ve,Ye.SET_RESOURCES,(function(e,t){e.resources=t})),Object(s["a"])(Ve,Ye.ADD_TO_RESOURCES,(function(e,t){e.resources[t.id]=t})),Ve)},Ze={SET_CONTENTS:"SET_CONTENTS",SET_USER_COMMENTS:"SET_USER_COMMENTS",SET_NODE_CONTENT:"SET_NODE_CONTENT",SET_NODE_COMMENT:"SET_NODE_COMMENT",REMOVE_NODE_RESOURCE:"REMOVE_NODE_RESOURCE",ADD_NODE_RESOURCE:"ADD_NODE_RESOURCE"},Je={getNodeContent:"getNodeContent",setNodeContent:"setNodeContent",setNodeComment:"setNodeComment",removeNodeResource:"removeNodeResource",addNodeResource:"addNodeResource"},$e={nodeID:"",content:"",resourceIds:[]};function Qe(e,t){e[t]||(e[t]=k($e),e[t].nodeID=t)}var et={nodeID:"",comment:""};function tt(e,t){e[t]||(e[t]=k(et),e[t].nodeID=t)}var nt,rt,ot={namespaced:!0,state:{nodeContents:{},userNodeComments:{}},actions:(Fe={},Object(s["a"])(Fe,Je.getNodeContent,(function(e,t){var n=e.state;return n.nodeContents[t]})),Object(s["a"])(Fe,Je.removeNodeResource,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,e.state,n.next=3,X.update(Object(s["a"])({},"node_content/".concat(t.nodeID,"/resourceIds/").concat(t.resourceID),null));case 3:if(o=n.sent,!o){n.next=7;break}return _("removeNodeResource: api.update error",{err:o}),n.abrupt("return");case 7:r("".concat(Ze.REMOVE_NODE_RESOURCE),t);case 8:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(Fe,Je.addNodeResource,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,e.state,n.next=3,X.update(Object(s["a"])({},"node_content/".concat(t.nodeID,"/resourceIds/").concat(t.resourceID),!0));case 3:if(o=n.sent,!o){n.next=7;break}return _("addNodeResource: api.update error",{err:o}),n.abrupt("return");case 7:r("".concat(Ze.ADD_NODE_RESOURCE),t);case 8:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(Fe,Je.setNodeComment,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.rootState,a.user.user&&!a.user.user.isAnonymous){n.next=3;break}return n.abrupt("return",null);case 3:return n.next=5,X.update((r={},Object(s["a"])(r,"user_data/".concat(a.user.user.uid,"/comment/").concat(t.nodeID,"/nodeID"),t.nodeID),Object(s["a"])(r,"user_data/".concat(a.user.user.uid,"/comment/").concat(t.nodeID,"/comment"),t.comment),r));case 5:if(i=n.sent,!i){n.next=8;break}return n.abrupt("return",i);case 8:return o("".concat(Ze.SET_NODE_COMMENT),t),n.abrupt("return",null);case 10:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(Fe,Je.setNodeContent,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,e.state,n.next=3,X.update((r={},Object(s["a"])(r,"node_content/".concat(t.nodeID,"/nodeID"),t.nodeID),Object(s["a"])(r,"node_content/".concat(t.nodeID,"/content"),t.content),r));case 3:if(a=n.sent,!a){n.next=6;break}return n.abrupt("return",a);case 6:return o("".concat(Ze.SET_NODE_CONTENT),t),n.abrupt("return",null);case 8:case"end":return n.stop()}}),n)})))()})),Fe),mutations:(Ge={},Object(s["a"])(Ge,Ze.SET_CONTENTS,(function(e,t){e.nodeContents=t})),Object(s["a"])(Ge,Ze.SET_USER_COMMENTS,(function(e,t){e.userNodeComments=t})),Object(s["a"])(Ge,Ze.SET_NODE_CONTENT,(function(e,t){Qe(e.nodeContents,t.nodeID),e.nodeContents[t.nodeID].content=t.content})),Object(s["a"])(Ge,Ze.SET_NODE_COMMENT,(function(e,t){tt(e.userNodeComments,t.nodeID),e.userNodeComments[t.nodeID].comment=t.comment})),Object(s["a"])(Ge,Ze.REMOVE_NODE_RESOURCE,(function(e,t){if(e.nodeContents[t.nodeID]&&e.nodeContents[t.nodeID].resourceIds){var n=e.nodeContents[t.nodeID].resourceIds.indexOf(t.resourceID);-1!=n&&e.nodeContents[t.nodeID].resourceIds.splice(n,1)}})),Object(s["a"])(Ge,Ze.ADD_NODE_RESOURCE,(function(e,t){Qe(e.nodeContents,t.nodeID),e.nodeContents[t.nodeID].resourceIds.push(t.resourceID)})),Ge)};function at(e){return it.apply(this,arguments)}function it(){return it=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.getMap(t);case 2:n=e.sent,r=Object(l["a"])(n,2),o=r[0],a=r[1],(null==o||a)&&_("fetchMap: cannot api.getMap(user)",{err:a}),Nt.commit("tree/".concat(Te.SET_TREE),o);case 8:case"end":return e.stop()}}),e)}))),it.apply(this,arguments)}function ct(e){return ut.apply(this,arguments)}function ut(){return ut=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.getPins(t);case 2:if(n=e.sent,r=Object(l["a"])(n,2),o=r[0],a=r[1],(null==o||a)&&console.error(a),!t||o){e.next=15;break}return e.next=10,X.getPins(null);case 10:i=e.sent,c=Object(l["a"])(i,2),o=c[0],a=c[1],(null==o||a)&&(console.error(a),o={});case 15:Nt.commit("pin/".concat(b.SET_PINS),o);case 16:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}function dt(e){return st.apply(this,arguments)}function st(){return st=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.getPreconditions(t);case 2:if(n=e.sent,r=Object(l["a"])(n,2),o=r[0],a=r[1],(null==o||a)&&(console.error(a),o={}),!t||o){e.next=15;break}return e.next=10,X.getPreconditions(null);case 10:i=e.sent,c=Object(l["a"])(i,2),o=c[0],a=c[1],(null==o||a)&&(console.error(a),o={});case 15:Nt.commit("precondition/".concat(v.SET_PRECONDITIONS),o);case 16:case"end":return e.stop()}}),e)}))),st.apply(this,arguments)}function lt(){return pt.apply(this,arguments)}function pt(){return pt=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.getResources();case 2:if(t=e.sent,n=Object(l["a"])(t,2),r=n[0],o=n[1],null!=r&&!o){e.next=9;break}return _("fetchResources error",{err:o}),e.abrupt("return");case 9:Nt.commit("resources/".concat(Ye.SET_RESOURCES),r);case 10:case"end":return e.stop()}}),e)}))),pt.apply(this,arguments)}function ft(e){return bt.apply(this,arguments)}function bt(){return bt=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,a,i,c,u,d,s,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,X.getNodeContent();case 2:if(n=e.sent,r=Object(l["a"])(n,2),o=r[0],a=r[1],null!=o&&!a){e.next=9;break}return _("fetchNodeContents error",{err:a}),e.abrupt("return");case 9:for(c in i={},o)i[c]={nodeID:o[c].nodeID,content:o[c].content,resourceIds:Object.keys(o[c].resourceIds)};if(Nt.commit("nodeContent/".concat(Ze.SET_CONTENTS),i),!t){e.next=23;break}return e.next=15,X.getUserComments(t);case 15:if(u=e.sent,d=Object(l["a"])(u,2),s=d[0],p=d[1],null!=s&&!p){e.next=22;break}return _("fetchNodeContents error",{err:p,user:t}),e.abrupt("return");case 22:Nt.commit("nodeContent/".concat(Ze.SET_USER_COMMENTS),s);case 23:case"end":return e.stop()}}),e)}))),bt.apply(this,arguments)}function Ot(e){return mt.apply(this,arguments)}function mt(){return mt=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,at(t);case 2:return e.next=4,ct(t);case 4:return e.next=6,dt(t);case 6:return e.next=8,lt();case 8:return e.next=10,ft(t);case 10:case"end":return e.stop()}}),e)}))),mt.apply(this,arguments)}var vt={init:"init",updateNodePosition:"updateNodePosition",createNode:"createNode",cutPasteNode:"cutPasteNode",removeNode:"removeNode",handleDBUpdate:"handleDBUpdate",setEditMode:"setEditMode",subscribeDBChange:"subscribeDBChange",addNewResource:"addNewResource",confirmSignInPopup:"confirmSignInPopup"},jt={SET_EDIT_MODE:"SET_EDIT_MODE",SET_SUBSCRIBED_NODE_IDS:"SET_SUBSCRIBED_NODE_IDS"},ht=Object(R["debounce"])((function(e,t,n,r){var o=je("normalize",t,n,r),a=Object(l["a"])(o,1),i=a[0];X.update(Object(s["a"])({},"map/".concat(e,"/position"),i))}),200),gt=Symbol(),Nt=Object(p["a"])({state:{editModeOn:!1,subscribedNodeIDs:[]},mutations:(nt={},Object(s["a"])(nt,jt.SET_EDIT_MODE,(function(e,t){e.editModeOn=t})),Object(s["a"])(nt,jt.SET_SUBSCRIBED_NODE_IDS,(function(e,t){e.subscribedNodeIDs=t})),nt),actions:(rt={},Object(s["a"])(rt,vt.confirmSignInPopup,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.dispatch,e.state,t.require({message:"Please authorize to change node contents",header:"SignIn",acceptLabel:"Ok, Sign In",rejectLabel:"No, thanks, just watching",accept:function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r("user/".concat(Be.signIn));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),reject:function(){}});case 2:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.addNewResource,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,e.state,o=X.generateKey(),o){n.next=5;break}return _("addNewResource: Cannot api.generateKey",{}),n.abrupt("return",null);case 5:return t.id=o,a=Object(s["a"])({},"resources/".concat(o),t),n.next=9,X.update(a);case 9:if(i=n.sent,!i){n.next=13;break}return _("addNewResource: cannot update",{err:i}),n.abrupt("return",null);case 13:return r("resources/".concat(Ye.ADD_TO_RESOURCES),t),n.abrupt("return",t);case 15:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.setEditMode,(function(e,t){var n=e.commit,r=e.state;n(jt.SET_EDIT_MODE,t),t||(r.subscribedNodeIDs.forEach((function(e){return X.unsubscribeDBChange("map/"+e)})),n(jt.SET_SUBSCRIBED_NODE_IDS,[]))})),Object(s["a"])(rt,vt.handleDBUpdate,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.dispatch,o=e.state,n.next=3,r("tree/".concat(we.handleDBUpdate),{dbNode:t,user:o.user.user});case 3:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.init,(function(e){return Object(d["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.commit,X.initFirebase(),U["a"].auth().onAuthStateChanged((function(e){e&&!e.isAnonymous?(n("user/".concat(Le.SET_USER),e),Ot(e)):(n("user/".concat(Le.SET_USER),null),Ot(null))}));case 3:case"end":return t.stop()}}),t)})))()})),Object(s["a"])(rt,vt.createNode,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,p,f,b,O,m,v,j,h,g,N,I,y,x;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.state,i=a.tree.nodeRecord[t.parentID].node,c=L(i,a.tree.mapNodeLayers),u=Object(l["a"])(c,3),d=u[0],p=u[1],f=u[2],null===f){n.next=6;break}return _("Cannot create new center",{err:f,parent:i,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 6:if(b=je("normalize",d,t.parentID,a.tree.mapNodeLayers),O=Object(l["a"])(b,2),m=O[0],v=O[1],!v){n.next=10;break}return _("createNode: cannot create new center",{err:v,parent:i,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 10:return j=M(t.title,m),h={id:j.id,parentID:t.parentID,name:t.title,children:[],position:m},g=X.generateKey(),r={},Object(s["a"])(r,"map/".concat(h.id),h),Object(s["a"])(r,"map/".concat(h.parentID,"/children/").concat(g),h.id),N=r,p&&(I=je("normalize",p.position,t.parentID,a.tree.mapNodeLayers),y=Object(l["a"])(I,1),x=y[0],N["map/".concat(p.id,"/position")]=x),n.next=17,X.update(N);case 17:o("history/".concat(He.ADD_CREATE),{nodeID:j.id,parentID:t.parentID});case 18:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.cutPasteNode,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d,p,f,b,O,m,v,j,h,g,N,I,y,x;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.state,i=a.tree.nodeRecord[t.nodeID].parent,c=a.tree.nodeRecord[t.parentID].node,u=L(c,a.tree.mapNodeLayers),d=Object(l["a"])(u,3),p=d[0],f=d[1],b=d[2],!b){n.next=7;break}return _("cutPasteNode: cannot getNewNodeCenter",{err:b}),n.abrupt("return");case 7:if(O=je("normalize",p,t.parentID,a.tree.mapNodeLayers),m=Object(l["a"])(O,2),v=m[0],j=m[1],!j){n.next=11;break}return _("createNode: cannot create new center",{err:j,parent:parent,"state.tree.mapNodeLayers":a.tree.mapNodeLayers}),n.abrupt("return");case 11:return h=X.generateKey(),n.next=14,X.findKeyOfChild(i.id,t.nodeID);case 14:return g=n.sent,r={},Object(s["a"])(r,"map/".concat(t.nodeID,"/parentID"),c.id),Object(s["a"])(r,"map/".concat(i.id,"/children/").concat(g),null),Object(s["a"])(r,"map/".concat(c.id,"/children/").concat(h),t.nodeID),Object(s["a"])(r,"map/".concat(t.nodeID,"/position"),v),N=r,f&&(I=je("normalize",f.position,t.parentID,a.tree.mapNodeLayers),y=Object(l["a"])(I,1),x=y[0],N["map/".concat(f.id,"/position")]=x),n.next=19,X.update(N);case 19:o("history/".concat(He.ADD_CUT_PASTE),{nodeID:t.nodeID,parentID:t.parentID});case 20:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.removeNode,(function(e,t){return Object(d["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,c,u,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.commit,a=e.state,i=a.tree.nodeRecord[t].parent,i){n.next=4;break}return n.abrupt("return");case 4:return c=i.id,n.next=7,X.getNode(t);case 7:return u=n.sent,u.removedAt=Date.now(),n.next=11,X.findKeyOfChild(i.id,t);case 11:return d=n.sent,n.next=14,X.update((r={},Object(s["a"])(r,"trash/".concat(t),u),Object(s["a"])(r,"map/".concat(i.id,"/children/").concat(d),null),Object(s["a"])(r,"map/".concat(t),null),r));case 14:o("history/".concat(He.ADD_REMOVE),{parentNodeID:c,nodeID:t});case 15:case"end":return n.stop()}}),n)})))()})),Object(s["a"])(rt,vt.updateNodePosition,(function(e,t){var n=e.commit,r=e.state;if(r.editModeOn){var o=P(t.nodeId,r.tree.mapNodeLayers),a=Object(l["a"])(o,1),i=a[0];if(!i)return y("UPDATE_NODE_POSITION: cannot find mapNode",{"v.nodeId":t.nodeId,"state.mapNodeLayers":r.tree.mapNodeLayers});var c=le({from:{x:0,y:0},to:i.center},{from:{x:0,y:0},to:t.delta}).to,u={nodeId:t.nodeId,newCenter:c,returnError:null};n("tree/".concat(Te.UPDATE_NODE_POSITION),u),null===u.returnError&&(n("history/".concat(He.ADD_POSITION_CHANGE),{nodeID:t.nodeId,oldPosition:i.center,newPosition:c}),ht(t.nodeId,c,r.tree.nodeRecord[t.nodeId].parent.id,r.tree.mapNodeLayers))}})),Object(s["a"])(rt,vt.subscribeDBChange,(function(e,t){var n=e.commit;e.state;Object(R["isEqual"])(t.oldNodeIDs.sort(),t.newNodeIDs.sort())||(t.oldNodeIDs.forEach((function(e){return X.unsubscribeNodeChange(e)})),t.newNodeIDs.forEach((function(e){return X.subscribeNodeChange(e,(function(e){t.cb(e)}))})),n(jt.SET_SUBSCRIBED_NODE_IDS,t.newNodeIDs))})),rt),modules:{pin:m,precondition:h,tree:Ce,user:Ue,zoomPan:Me,history:qe,resources:Xe,nodeContent:ot}});function It(){return Object(p["b"])(gt)}var yt=Object(r["k"])({setup:function(){var e=It();e.dispatch(vt.init)}});yt.render=o;var xt=yt,Dt=n("9319"),Et=n("b24b"),Rt=n("485c"),Tt=n("6c02"),wt=Object(r["i"])(" This section is just for test/emulator cases for now "),Ct=Object(r["j"])("input",{id:"email"},null,-1),kt=Object(r["j"])("input",{id:"password"},null,-1);function _t(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])(r["a"],null,[wt,Ct,kt,Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return e.login&&e.login.apply(e,arguments)})},"login")],64)}var St=Object(r["k"])({name:"PasswordLogin",setup:function(){It();return{login:function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=document.getElementById("email"),n=document.getElementById("password"),e.next=4,U["a"].auth().signInWithEmailAndPassword(t.value,n.value);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}}});St.render=_t;var Pt=St;function At(e,t,n,o,a,i){var c=Object(r["C"])("ConfirmDialog"),u=Object(r["C"])("Toast"),d=Object(r["C"])("NodeContent"),s=Object(r["C"])("Menu"),l=Object(r["C"])("Map");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])(c),Object(r["j"])(u,{position:"bottom-left"}),Object(r["j"])(d,{show:!e.editModeOn&&!!e.selectedNodeId},null,8,["show"]),Object(r["j"])(s,{clickedTitleId:e.clickedTitleId,onSelectPreconditionIsOn:e.setSelectPreconditionON,onSelectPreconditionIsOff:e.setSelectPreconditionOFF},null,8,["clickedTitleId","onSelectPreconditionIsOn","onSelectPreconditionIsOff"]),Object(r["j"])(l,{layers:e.zoomedPanedLayers,viewBox:e.viewBox,selectedNodeId:e.selectedNodeId,preconditionNodeIds:e.preconditionNodeIds,"pin-nodes":e.pinNodes,onTitleDragging:e.nodeDragging,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave,onDraggingBackground:e.mapDragging,onWheel:e.zoom},null,8,["layers","viewBox","selectedNodeId","preconditionNodeIds","pin-nodes","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave","onDraggingBackground","onWheel"])],64)}function Mt(e,t,n,o,a,i){var c=Object(r["C"])("MapLayer"),u=Object(r["C"])("PinLayer"),d=Object(r["C"])("PreconditionLayer");return Object(r["u"])(),Object(r["g"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:e.viewBox,id:e.mapID},[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.layers,(function(t,n){return Object(r["u"])(),Object(r["g"])(c,{key:n,"map-nodes":t,"border-color":"rgb(".concat(200-100*n,",").concat(200-100*n,",").concat(200-100*n,")"),"font-size":10*(n+1),selectedNodeId:e.selectedNodeId,preconditionNodeIds:e.preconditionNodeIds,"map-id":e.mapID,onTitleDragging:e.draggingNode,onTitleClick:e.titleClick,onTitleOver:e.titleOver,onTitleLeave:e.titleLeave},null,8,["map-nodes","border-color","font-size","selectedNodeId","preconditionNodeIds","map-id","onTitleDragging","onTitleClick","onTitleOver","onTitleLeave"])})),128)),Object(r["j"])(u,{pinNodes:e.pinNodes,selectedNodeId:e.selectedNodeId,onClick:e.titleClick,onTitleMouseDown:e.pinNodeMouseDown},null,8,["pinNodes","selectedNodeId","onClick","onTitleMouseDown"]),Object(r["j"])(d,{preconditionNodeIds:e.preconditionNodeIds,selectedNodeId:e.selectedNodeId},null,8,["preconditionNodeIds","selectedNodeId"])],8,["viewBox","id"])}var Lt=Object(r["P"])("data-v-f5f2b9d4"),Bt=Lt((function(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])(r["a"],null,[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t,n){return Object(r["u"])(),Object(r["g"])("polygon",{key:n,stroke:e.borderColor,fill:e.polygonFill(e.selectedNodeId,t.id,e.preconditionNodeIds),"fill-opacity":e.polygonFillOpacity(e.selectedNodeId,t.id,e.preconditionNodeIds),"stroke-width":"2",points:e.polygonToPath(t.border),"pointer-events":"none"},null,8,["stroke","fill","fill-opacity","points"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t){return Object(r["u"])(),Object(r["g"])("text",{id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,"font-family":"Roboto","font-size":e.fontSize,"font-weight":e.selectedNodeId&&e.selectedNodeId==t.id?"bold":"normal",fill:e.borderColor,class:"text"},[Object(r["j"])("tspan",{x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y:0,"alignment-baseline":"hanging"},Object(r["F"])(t.title),9,["x","y"])],8,["id","font-size","font-weight","fill"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.mapNodes,(function(t){return Object(r["u"])(),Object(r["g"])("rect",{key:t.id,x:e.titleBox[t.id]?e.titleBox[t.id].position.x:0,y:e.titleBox[t.id]?e.titleBox[t.id].position.y:0,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,fill:"transparent","stroke-width":"0",onMouseover:function(n){return e.titleOver(t.id)},onMouseleave:function(n){return e.titleLeave(t.id)},onClick:function(n){return e.titleClick(t.id)},onMousedown:function(n){return e.titleMouseDown(t.id)},stroke:"pink",cursor:"pointer","pointer-events":"fill"},null,40,["x","y","width","height","onMouseover","onMouseleave","onClick","onMousedown"])})),128))],64)})),Ut=function(e,t,n){n.nodeId&&(n.dragStart=!0,e("title-dragging",{nodeId:n.nodeId,delta:{x:t.movementX,y:t.movementY}}))},Ht=function(e,t){t.nodeId&&(t.dragStart&&e("title-drop",{id:t.nodeId}),t.dragStart=!1,t.nodeId=null)},zt=function(e){var t={};for(var n in e){var r=e[n];t[r.id]={position:r.center,bbox:{width:0,height:0}}}return t},Vt=function(e,t,n,o){Object(r["p"])((function(){for(var r in o)delete o[r];for(var a in n){var i=n[a],c=document.getElementById("".concat(e).concat(i.id));null!=c&&("center"==t?o[i.id]={position:{x:i.center.x-c.getBoundingClientRect().width/2,y:i.center.y-c.getBoundingClientRect().height/2},bbox:{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}}:"left"==t&&(o[i.id]={position:{x:i.center.x-c.getBoundingClientRect().width,y:i.center.y-c.getBoundingClientRect().height/2},bbox:{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}}))}}))},Ft=function(e,t,n){var o=Object(r["z"])(zt(n.value));return Object(r["J"])(n,(function(n){return Vt(e,t,n,o.value)}),{immediate:!0}),o},Gt="title_",Wt=Object(r["k"])({name:"MapLayer",emits:["title-over","title-leave","title-click","title-drop","title-dragging"],props:{mapId:{type:String,required:!0},mapNodes:{type:Object,required:!0},borderColor:{type:String,required:!0},fontSize:{type:Number,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0},preconditionNodeIds:Object},setup:function(e,t){var n=Object(r["G"])(e,"mapNodes"),o=Ft(Gt,"center",n),a={nodeId:null,dragStart:!1},i=function(e){return Ut(t.emit,e,a)},c=function(){return Ht(t.emit,a)};return Object(r["s"])((function(){var t=document.getElementById(e.mapId);t?(t.addEventListener("mousemove",i),t.addEventListener("mouseup",c)):_("MapLayer.vue: cannot find map id for event listener",{})})),Object(r["t"])((function(){var t=document.getElementById(e.mapId);t?(t.removeEventListener("mousemove",i),t.removeEventListener("mouseup",c)):_("MapLayer.vue: cannot find map id for event listener",{})})),{TITLE_PREFIX:Gt,titleBox:o,titleClick:function(e){t.emit("title-click",{id:e})},titleOver:function(e){t.emit("title-over",{id:e})},titleLeave:function(e){t.emit("title-leave",{id:e})},titleMouseDown:function(e){a.nodeId=e,a.dragStart=!1}}},methods:{polygonToPath:ue,polygonFill:ie,polygonFillOpacity:ce}});n("a209");Wt.render=Bt,Wt.__scopeId="data-v-f5f2b9d4";var qt=Wt,Yt={on:!1},Kt=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Yt.on=!0;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xt=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Yt.on=!1,!1;case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Zt=function(){!0},Jt=function(e,t){Yt.on&&e("dragging-background",{from:{x:t.clientX-t.movementX,y:t.clientY-t.movementY},to:{x:t.clientX,y:t.clientY}})},$t={mouseDown:Kt,mouseUp:Xt,mouseMove:Jt,pinNodeMouseDownHandler:Zt};function Qt(e,t,n,o,a,i){var c=Object(r["C"])("PinMarker"),u=Object(r["C"])("SVGTextBox");return Object(r["u"])(),Object(r["g"])(r["a"],null,[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.pinNodes,(function(e){return Object(r["u"])(),Object(r["g"])(c,{key:e.id,x:e.center.x,y:e.center.y,color:"#ffa500"},null,8,["x","y"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.pinNodes,(function(t){return Object(r["u"])(),Object(r["g"])(u,{text:t.title,id:"".concat(e.TITLE_PREFIX).concat(t.id),key:t.id,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,"line-height":"8","max-char-per-line":10,"font-family":"Roboto","font-size":8,"font-weight":e.selectedNodeId&&e.selectedNodeId===t.id?"bold":"normal",color:"#ffa500"},null,8,["text","id","x","y","font-weight"])})),128)),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.pinNodes,(function(t){return Object(r["u"])(),Object(r["g"])("rect",{key:t.id,x:e.titleXY[t.id].x,y:e.titleXY[t.id].y,width:e.titleBox[t.id]?e.titleBox[t.id].bbox.width:0,height:e.titleBox[t.id]?e.titleBox[t.id].bbox.height:0,cursor:"pointer",fill:"transparent",onClick:function(n){return e.titleBoxClick(t.id)},onMousedown:function(n){return e.nodeMouseDown(t.id)},"stroke-width":"0",stroke:"pink"},null,40,["x","y","width","height","onClick","onMousedown"])})),128))],64)}function en(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])("g",{transform:"translate(".concat(e.x-e.WIDTH/2," ").concat(e.y-e.HEIGHT,") scale(0.05 0.05)")},[Object(r["j"])("path",{fill:"".concat(e.color),d:"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n        C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n        c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z"},null,8,["fill"])],8,["transform"])}var tn=18,nn=26,rn=Object(r["k"])({name:"PinMarker",props:{x:{type:Number,required:!0},y:{type:Number,required:!0},color:{type:String,required:!0}},setup:function(){return{WIDTH:tn,HEIGHT:nn}}});rn.render=en;var on=rn;function an(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])("text",{id:e.id,"font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,fill:e.color},[(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.lines,(function(t,n){return Object(r["u"])(),Object(r["g"])("tspan",{key:n,x:e.x,y:e.y+n*e.lineHeight,"alignment-baseline":"hanging"},Object(r["F"])(t),9,["x","y"])})),128))],8,["id","font-family","font-size","font-weight","fill"])}n("ac1f"),n("1276");function cn(e,t){if(t<=0)return[];if(""==e)return[];var n=e.split(" "),r=[],o=[];while(n.length)if(o.join(" ").length>t){var a=[];o.length>1&&a.push(o.pop()),r.push(o.join(" ")),o=a}else o.push(n.shift());if(o.join(" ").length>t){var i=[];o.length>1&&i.push(o.pop()),r.push(o.join(" ")),o=i}return o.length&&r.push(o.join(" ")),r}var un=Object(r["k"])({name:"SVGTextBox",props:{id:{type:String,required:!0},text:{type:String,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},lineHeight:{type:String,required:!0},maxCharPerLine:{type:Number,required:!0},fontFamily:{type:String,required:!0},fontSize:{type:Number,required:!0},fontWeight:{type:String,required:!0},color:{type:String,required:!0}},setup:function(e){return{lines:cn(e.text,e.maxCharPerLine)}}});un.render=an;var dn=un,sn="pin_title_",ln=Object(r["k"])({name:"PinLayer",components:{SVGTextBox:dn,PinMarker:on},emits:["click","title-mouse-down"],props:{pinNodes:{type:Object,required:!0},selectedNodeId:{type:String,validator:function(e){return"string"===typeof e||null===e},required:!0}},setup:function(e,t){var n=Object(r["G"])(e,"pinNodes"),o=Ft(sn,"left",n);return{TITLE_PREFIX:sn,PIN_MARKER_HEIGHT:nn,PIN_MARKER_WIDTH:tn,titleBox:o,titleXY:Object(r["e"])((function(){var e={};for(var t in n.value){var r=n.value[t];e[r.id]={x:o.value[r.id]?o.value[r.id].position.x-tn/2-1:0,y:o.value[r.id]?o.value[r.id].position.y-nn/2:0}}return e})),titleBoxClick:function(e){t.emit("click",{id:e})},nodeMouseDown:function(e){t.emit("title-mouse-down",{id:e})}}}});ln.render=Qt;var pn=ln,fn=Object(r["j"])("defs",null,[Object(r["j"])("marker",{id:"preconditionArrowHead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[Object(r["j"])("polygon",{points:"0 0, 10 3.5, 0 7"})])],-1);function bn(e,t,n,o,a,i){var c=Object(r["C"])("PreconditionArrow");return Object(r["u"])(),Object(r["g"])(r["a"],null,[fn,(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(e.preconditions,(function(t){return Object(r["u"])(),Object(r["g"])(c,{key:t.id,markerId:"preconditionArrow",from:t.center,to:e.selectedNode.center},null,8,["from","to"])})),128))],64)}function On(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])("line",{x1:e.from.x,y1:e.from.y,x2:e.to.x,y2:e.to.y,stroke:"#000","stroke-width":"2","marker-end":"url(#preconditionArrowHead)"},null,8,["x1","y1","x2","y2"])}var mn=Object(r["k"])({name:"PreconditionArrow",props:{markerId:String,from:Object,to:Object}});mn.render=On;var vn=mn,jn=2;function hn(e,t,n){return{x:e.x*t+n.x,y:e.y*t+n.y}}function gn(e,t,n){return e.map((function(e){return hn(e,t,n)}))}function Nn(e,t,n,r,o,a){if(!e||0==e.length)return["",null];var i=null,c=n.width*n.height,u=e[0];while(Object.keys(u).length){for(var d in i="",u){var s=gn(u[d].border,r,o);if(Q(a,s)){i=d;break}}if(""===i){var p=1/0;for(var b in u){var O=hn(u[b].center,r,o),m=J({from:O,to:a});m<p&&(p=m,i=b)}}var v=te(gn(u[i].border,r,o));if(Math.floor(v)<=Math.floor(c/jn))return null==t[i].parent?[i,null]:[t[i].parent.id,null];if(u={},!t[i])return["",y("findCurrentNode: cannot find underCursorNodeId in nodeRecord",{maxIntersectNodeId:i,nodeRecord:t})];var j,h=Object(f["a"])(t[i].node.children);try{for(h.s();!(j=h.n()).done;){var g=j.value,N=P(g.id,e),I=Object(l["a"])(N,1),x=I[0];if(null==x)return["",y("filterNodesAndLayers: Cannot find node in layers",{"child.id":g.id,layers:e})];u[g.id]=x}}catch(D){h.e(D)}finally{h.f()}if(0===Object.keys(u).length)return[i,null]}return["",y("filterNodesAndLayers: unknown error",{})]}function In(e,t,n){if(!e||!e.length)return[[],null];var r=[],o=P(n,e),a=Object(l["a"])(o,2),i=a[0],c=a[1];if(null==i||null==c)return[[],y("filterNodesAndLayers-currentNode: error in findMapNode",{currentNodeId:n,layers:e})];var u={};if(null==t[i.id].parent)u[i.id]=k(i);else{var d,s=Object(f["a"])(t[i.id].parent.children);try{for(s.s();!(d=s.n()).done;){var p=d.value,b=P(p.id,[e[c]]),O=Object(l["a"])(b,2),m=O[0],v=O[1];if(null==m||null===v)return[[],y("filterNodesAndLayers-upperLayer: error in findMapNode",{"child.id":p.id,level:c,layers:[e[c]]})];u[p.id]=k(m),u[p.id].title=""}}catch(Z){s.e(Z)}finally{s.f()}}r.push(u);var j={};for(var h in u){var g,N=Object(f["a"])(t[h].node.children);try{for(N.s();!(g=N.n()).done;){var I=g.value,x=P(I.id,[e[c+1]]),D=Object(l["a"])(x,2),E=D[0],R=D[1];if(null==E||null===R)return[[],y("filterNodesAndLayers-firstLayer: error in findMapNode",{"child.id":I.id,layers:[e[c+1]]})];h!=n?(j[I.id]=k(E),j[I.id].title=""):j[I.id]=k(E)}}catch(Z){N.e(Z)}finally{N.f()}}Object.keys(j).length>0&&r.push(j);var T,w={},C=Object(f["a"])(t[n].node.children);try{for(C.s();!(T=C.n()).done;){var _,S=T.value,A=Object(f["a"])(t[S.id].node.children);try{for(A.s();!(_=A.n()).done;){var M=_.value,L=P(M.id,[e[c+2]]),B=Object(l["a"])(L,2),U=B[0],H=B[1];if(null==U||null===H)return[[],y("filterNodesAndLayers-secondLayer: error in findMapNode",{"child.id":S.id,layers:[e[c+2]]})];w[M.id]=k(U)}}catch(Z){A.e(Z)}finally{A.f()}}}catch(Z){C.e(Z)}finally{C.f()}Object.keys(w).length>0&&r.push(w);var z={};for(var V in w){var F,G=Object(f["a"])(t[V].node.children);try{for(G.s();!(F=G.n()).done;){var W=F.value,q=P(W.id,[e[c+3]]),Y=Object(l["a"])(q,2),K=Y[0],X=Y[1];if(null==K||null===X)return[[],y("filterNodesAndLayers-thirdLayer:cannot findMapNode",{"child.id":W.id,level:c+3,layers:[e[c+3]]})];z[W.id]=k(K),z[W.id].title=""}}catch(Z){G.e(Z)}finally{G.f()}}return Object.keys(z).length>0&&r.push(z),[r,null]}function yn(e,t,n){if(!e||0==e.length)return[];var r,o=Object(f["a"])(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;for(var i in a){var c=a[i];c.center=hn(c.center,t,n),c.border=gn(c.border,t,n)}}}catch(u){o.e(u)}finally{o.f()}return e}var xn=Object(r["k"])({name:"PreconditionLayer",components:{PreconditionArrow:vn},props:{selectedNodeId:String,preconditionNodeIds:Object},setup:function(e,t){var n=It(),o=Object(r["z"])([]),a=n.state.zoomPan,i=Object(r["e"])((function(){if(e.selectedNodeId&&n.state.tree.mapNodeLayers){var t=P(e.selectedNodeId,n.state.tree.mapNodeLayers),r=Object(l["a"])(t,1),o=r[0],i=k(o);return i.center=hn(i.center,a.zoom,a.pan),i}return null}));return Object(r["K"])((function(){if(o.value=[],e.selectedNodeId&&n.state.precondition.preconditions[e.selectedNodeId]&&n.state.tree.mapNodeLayers){var t,r=k(A(n.state.precondition.preconditions[e.selectedNodeId],n.state.tree.mapNodeLayers)),i=Object(f["a"])(r);try{for(i.s();!(t=i.n()).done;){var c=t.value;c.center=hn(c.center,a.zoom,a.pan),o.value.push(c)}}catch(u){i.e(u)}finally{i.f()}}})),{selectedNode:i,preconditions:o}}});xn.render=bn;var Dn=xn,En="mapID",Rn=Object(r["k"])({name:"Map",emits:["title-dragging","title-click","title-over","title-leave","dragging-background","wheel"],components:{PreconditionLayer:Dn,PinLayer:pn,MapLayer:qt},props:{viewBox:{type:String,required:!0},layers:Object,selectedNodeId:{type:String||null,validator:function(e){return"string"===typeof e||null===e},required:!0},preconditionNodeIds:Object,pinNodes:Object},setup:function(e,t){return Object(r["s"])((function(){var e=document.getElementById(En);e?(e.addEventListener("mousedown",function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,$t.mouseDown(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.addEventListener("mouseup",function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,$t.mouseUp(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.addEventListener("mousemove",(function(e){$t.mouseMove(t.emit,e)})),e.addEventListener("wheel",(function(e){t.emit("wheel",{delta:e.deltaY,center:{x:e.clientX,y:e.clientY}})}))):_("Map.vue: cannot find map id for event listener",{})})),{draggingNode:function(e){t.emit("title-dragging",{id:e.nodeId,delta:e.delta})},titleClick:function(e){t.emit("title-click",{id:e.id})},titleOver:function(e){t.emit("title-over",{id:e.id})},titleLeave:function(e){t.emit("title-leave",{id:e.id})},pinNodeMouseDown:function(){$t.pinNodeMouseDownHandler()},mapID:En}}});Rn.render=Mt;var Tn=Rn,wn=Object(r["P"])("data-v-06976913");Object(r["x"])("data-v-06976913");var Cn={key:0,class:"wrapper"},kn={class:"p-fluid"},_n={class:"p-field p-grid"},Sn={class:"p-col-12"},Pn=Object(r["j"])("h3",null,"Sources",-1),An=Object(r["j"])("h3",null,"Preconditions",-1),Mn=Object(r["j"])("h3",null,"Your personal comment",-1),Ln={class:"p-field p-grid"},Bn={class:"p-col-12 p-md-12"};Object(r["v"])();var Un=wn((function(e,t,n,o,a,i){var c=Object(r["C"])("InputText"),u=Object(r["C"])("TextArea"),d=Object(r["C"])("SectionResources"),s=Object(r["C"])("SectionPreconditions");return Object(r["u"])(),Object(r["g"])(r["c"],{name:"slide"},{default:wn((function(){return[n.show&&o.selectedNode?(Object(r["u"])(),Object(r["g"])("div",Cn,[Object(r["j"])("h2",null,[Object(r["j"])(c,{type:"text",placeholder:"Node title",value:o.selectedNode.title,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.changeNodeTitle(e)})},null,8,["value"])]),Object(r["j"])("div",kn,[Object(r["j"])("div",_n,[Object(r["j"])("div",Sn,[Object(r["j"])(u,{id:"content",placeholder:"Description",autoResize:!0,rows:"20",value:o.selectedNodeContent?o.selectedNodeContent.content:"","onUpdate:modelValue":t[2]||(t[2]=function(e){return o.changeContent(e)}),onKeydown:o.checkAuthorized},null,8,["value","onKeydown"])])]),Pn,o.selectedNodeContent?(Object(r["u"])(),Object(r["g"])(d,{key:0,"node-id":o.selectedNode.id,resources:o.resources,resourceIds:o.selectedNodeContent.resourceIds},null,8,["node-id","resources","resourceIds"])):Object(r["h"])("",!0),An,o.selectedNodeContent?(Object(r["u"])(),Object(r["g"])(s,{key:1,"node-id":o.selectedNode.id},null,8,["node-id"])):Object(r["h"])("",!0),Mn,Object(r["j"])("div",Ln,[Object(r["j"])("div",Bn,[Object(r["j"])(u,{id:"comment",placeholder:"Your personal comment",autoResize:!0,rows:"2",value:o.comment,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.changeComment(e)}),onKeydown:o.checkAuthorized},null,8,["value","onKeydown"])])])])])):Object(r["h"])("",!0)]})),_:1})})),Hn=n("4c62"),zn=n("8398"),Vn=Object(r["P"])("data-v-70d44aa0");Object(r["x"])("data-v-70d44aa0");var Fn={class:"p-col-12"},Gn={class:"p-grid"},Wn={class:"p-col-11"},qn={class:"p-col-1"};Object(r["v"])();var Yn=Vn((function(e,t,n,o,a,i){var c=Object(r["C"])("AddResourceForm"),u=Object(r["C"])("Button");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])(c,{resources:n.resources},null,8,["resources"]),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(n.resourceIds,(function(e){return Object(r["u"])(),Object(r["g"])("div",{class:"p-grid",key:e},[Object(r["j"])("div",Fn,[Object(r["j"])("div",Gn,[Object(r["j"])("div",Wn,Object(r["F"])(n.resources[e].title),1),Object(r["j"])("div",qn,[Object(r["j"])(u,{onClick:function(t){return o.remove(e)},icon:"pi pi-ban",class:"p-button-rounded p-button-help p-button-outlined"},null,8,["onClick"])])])])])})),128))],64)})),Kn=n("6b8c"),Xn=n("d725"),Zn={class:"p-grid"},Jn={key:0,class:"p-col-12"},$n={key:0,class:"p-grid"},Qn={class:"p-col-12"},er={class:"p-grid"},tr={class:"p-col-12"},nr={class:"p-col-9"},rr={class:"p-grid"},or={class:"p-col-3"},ar={class:"p-col-4"};function ir(e,t,n,o,a,i){var c=Object(r["C"])("AddResourceFormAutocomplete"),u=Object(r["C"])("SelectButton"),d=Object(r["C"])("InputText"),s=Object(r["C"])("Button");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("div",Zn,[o.newFormShow?Object(r["h"])("",!0):(Object(r["u"])(),Object(r["g"])("div",Jn,[Object(r["j"])(c,{resources:n.resources,onItemSelect:t[1]||(t[1]=function(e){return o.autoCompleteSelect(e)}),onKeydown:o.checkAuthorized},null,8,["resources","onKeydown"])]))]),o.newFormShow?(Object(r["u"])(),Object(r["g"])("div",$n,[Object(r["j"])("div",Qn,[Object(r["j"])("div",er,[Object(r["j"])("div",tr,[Object(r["j"])(u,{modelValue:o.selectedType,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.selectedType=e}),options:o.typeOptions,optionLabel:"name",optionValue:"code"},null,8,["modelValue","options"])])]),(Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(o.types[o.selectedType].fields,(function(e){return Object(r["u"])(),Object(r["g"])("div",{class:"p-field p-grid",key:Object.keys(e)[0]},[Object(r["j"])("label",{for:Object.keys(e)[0],class:"p-col-3 p-mb-0"},Object(r["F"])(Object.values(e)[0]),9,["for"]),Object(r["j"])("div",nr,[Object(r["j"])(d,{id:Object.keys(e)[0],type:"text",placeholder:o.placeholders[Object.keys(e)[0]]},null,8,["id","placeholder"])])])})),128)),Object(r["j"])("div",rr,[Object(r["j"])("div",or,[Object(r["j"])(s,{label:"Save",class:"p-button-rounded",onClick:o.save},null,8,["onClick"])]),Object(r["j"])("div",ar,[Object(r["j"])(s,{label:"Cancel",class:"p-button-rounded",onClick:o.cancel},null,8,["onClick"])])])])])):Object(r["h"])("",!0)],64)}function cr(e,t,n,o,a,i){var c=Object(r["C"])("AutoComplete");return Object(r["u"])(),Object(r["g"])(c,{placeholder:"start typing to add new educational resource...",suggestions:o.filteredResources,modelValue:o.modelValue,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.modelValue=e}),onComplete:t[2]||(t[2]=function(e){return o.searchResource(e)}),onItemSelect:t[3]||(t[3]=function(e){return o.selectResource(e)}),field:"title"},null,8,["suggestions","modelValue"])}var ur=n("4084"),dr="BRAND_NEW_RESOURCE",sr={name:"AddResourceFormAutocomplete",emits:["item-select","update-value"],components:{AutoComplete:ur["a"]},props:{resources:Object},setup:function(e,t){var n=Object(r["z"])([]),o=Object(r["z"])("");return{modelValue:o,filteredResources:n,selectResource:function(e){t.emit("item-select",e.value)},searchResource:function(r){for(var o in t.emit("update-value",r.query),n.value=[],e.resources)e.resources[o].title.includes(r.query)&&n.value.push(e.resources[o]);n.value.push({id:dr,type:"book",author:"",title:"Not in list? Click me to add brand new",chapterNumber:"",chapterName:"",findPhrase:"",url:"",doi:"",isbn:"",createdAt:0,updatedAt:0})}}}};sr.render=cr;var lr=sr,pr=n("bb57"),fr=n("a5af"),br={name:"AddResourceForm",components:{InputText:zn["a"],AddResourceFormAutocomplete:lr,Button:pr["a"],SelectButton:fr["a"]},props:{resources:Object},setup:function(){var e=It(),t=Object(r["z"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),o=Object(r["z"])("book"),a=Object(Xn["b"])(),i={book:{name:"book",fields:[{title:"title"},{author:"author(s)"},{chapter:"chapter(s)"},{findPhrase:"find phrase"},{url:"URL"},{isbn:"ISBN"},{doi:"DOI"}]},article:{name:"article",fields:[{title:"title"},{author:"author(s)"},{findPhrase:"find phrase"},{url:"URL"},{doi:"DOI"}]},other:{name:"other",fields:[{title:"title"},{author:"author(s)"},{url:"URL"},{findPhrase:"find phrase"}]}},c=Object.keys(i),u=c.map((function(e){return{name:i[e].name,code:e}}));return{newFormShow:t,selectedType:o,checkAuthorized:function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.state.user.user&&!e.state.user.user.isAnonymous){t.next=4;break}return t.next=3,e.dispatch("".concat(vt.confirmSignInPopup),a);case 3:n.preventDefault();case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),autoCompleteSelect:function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(o){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o.id!=dr){r.next=3;break}return t.value=!0,r.abrupt("return");case 3:return r.next=5,e.dispatch("nodeContent/".concat(Je.addNodeResource),{nodeID:n.value.id,resourceID:o.id});case 5:case"end":return r.stop()}}),r)})));function o(e){return r.apply(this,arguments)}return o}(),save:function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(){var r,a,c,u,d,s,l,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.value&&n.value.id){t.next=3;break}return _("Bad selectedNode",{selectedNode:n}),t.abrupt("return");case 3:r={id:"",type:"book",author:"",title:"",findPhrase:"",url:"",doi:"",isbn:"",createdAt:0,updatedAt:0},a=Object(f["a"])(i[o.value].fields);try{for(a.s();!(c=a.n()).done;)u=c.value,d=Object.keys(u)[0],s=document.getElementById(d),l=s.value,r[d]=l}catch(b){a.e(b)}finally{a.f()}return t.next=8,e.dispatch("".concat(vt.addNewResource),r);case 8:if(p=t.sent,null!=p){t.next=12;break}return _("Cannot add addNewResource",r),t.abrupt("return");case 12:return t.next=14,e.dispatch("nodeContent/".concat(Je.addNodeResource),{nodeID:n.value.id,resourceID:p.id});case 14:case"end":return t.stop()}}),t)})));function r(){return t.apply(this,arguments)}return r}(),cancel:function(){t.value=!1},typeOptions:u,types:i,placeholders:{title:"The Feynman Lectures on Physics, Vol. 1: Mainly Mechanics, Radiation, and Heat",author:"Richard Feynman, Robert B. Leighton, Matthew Sands",chapter:"1",findPhrase:"If, in some cataclysm, all of scientific knowledge were to be destroyed, and only one sentence passed on to the next generations of creatures, what statement would contain the most information in the fewest words?",url:"https://www.feynmanlectures.caltech.edu/I_01.html#Ch1-S1",doi:"https://doi.org/10.1119/1.1972241",isbn:"9780465023820"}}}};br.render=ir;var Or=br,mr={name:"Resources",props:{nodeId:String,resources:Object,resourceIds:Object},components:{Button:pr["a"],AddResourceForm:Or},directives:{tooltip:Kn["a"]},setup:function(e){var t=It(),n=Object(Xn["b"])();return{checkAuthorized:function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.state.user.user&&!t.state.user.user.isAnonymous){e.next=4;break}return e.next=3,t.dispatch("".concat(vt.confirmSignInPopup),n);case 3:r.preventDefault();case 4:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}(),remove:function(n){t.dispatch("nodeContent/".concat(Je.removeNodeResource),{nodeID:e.nodeId,resourceID:n})}}}};n("65ae");mr.render=Yn,mr.__scopeId="data-v-70d44aa0";var vr=mr,jr={class:"p-col-12"},hr={class:"p-grid"},gr={class:"p-col-11"},Nr={class:"p-col-1"};function Ir(e,t,n,o,a,i){var c=Object(r["C"])("Button");return Object(r["u"])(!0),Object(r["g"])(r["a"],null,Object(r["A"])(o.preconditions,(function(e){return Object(r["u"])(),Object(r["g"])("div",{class:"p-grid",key:e.id},[Object(r["j"])("div",jr,[Object(r["j"])("div",hr,[Object(r["j"])("div",gr,Object(r["F"])(e.title),1),Object(r["j"])("div",Nr,[Object(r["j"])(c,{onClick:function(t){return o.remove(e.id)},icon:"pi pi-ban",class:"p-button-rounded p-button-help p-button-outlined"},null,8,["onClick"])])])])])})),128)}var yr={name:"Vacancies",props:{nodeId:String},components:{Button:pr["a"]},setup:function(e){var t=It(),n=Object(r["z"])([]);return Object(r["K"])((function(){if(n.value=[],e.nodeId&&t.state.precondition.preconditions[e.nodeId]){var r,o=Object(f["a"])(t.state.precondition.preconditions[e.nodeId]);try{for(o.s();!(r=o.n()).done;){var a=r.value;n.value.push(t.state.tree.nodeRecord[a].node)}}catch(i){o.e(i)}finally{o.f()}}})),{preconditions:n,remove:function(n){t.dispatch("precondition/".concat(j.RemovePrecondition),{nodeId:e.nodeId,preconditionId:n}),X.savePreconditions(t.state.user.user,{nodeId:e.nodeId,preconditionIds:t.state.precondition.preconditions[e.nodeId]})}}}};yr.render=Ir;var xr=yr,Dr={name:"NodeContent",components:{TextArea:Hn["a"],InputText:zn["a"],SectionResources:vr,SectionPreconditions:xr},props:{show:{type:Boolean,required:!0}},setup:function(){var e=It(),t=Object(Xn["b"])(),n=e.state.tree,o=Object(r["e"])((function(){return e.state.nodeContent.nodeContents})),a=Object(r["e"])((function(){return e.state.nodeContent.userNodeComments})),i=Object(r["e"])((function(){return e.state.resources.resources})),c=Object(r["e"])((function(){return n.selectedNodeId&&n.nodeRecord[n.selectedNodeId]?n.nodeRecord[n.selectedNodeId].node:null})),u=Object(r["e"])((function(){if(n.selectedNodeId&&o.value[n.selectedNodeId])return o.value[n.selectedNodeId];var e=k($e);return e.nodeID=n.selectedNodeId,e})),l=Object(r["e"])((function(){return n.selectedNodeId&&a.value[n.selectedNodeId]?a.value[n.selectedNodeId].comment:""}));return{resources:i,selectedNode:c,selectedNodeContent:u,checkAuthorized:function(){var n=Object(d["a"])(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.state.user.user&&!e.state.user.user.isAnonymous){n.next=4;break}return n.next=3,e.dispatch("".concat(vt.confirmSignInPopup),t);case 3:r.preventDefault();case 4:case"end":return n.stop()}}),n)})));function r(e){return n.apply(this,arguments)}return r}(),comment:l,changeNodeTitle:function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(c.value&&c.value.id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,X.update(Object(s["a"])({},"map/".concat(c.value.id,"/name"),t));case 4:n=e.sent,n&&_(n.error.message,n.kv);case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),changeContent:function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("nodeContent/".concat(Je.setNodeContent),{nodeID:c.value.id,content:n});case 2:r=t.sent,r&&_(r,{});case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),changeComment:function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.dispatch("nodeContent/".concat(Je.setNodeComment),{nodeID:c.value.id,comment:n});case 2:r=t.sent,r&&_(r,{});case 4:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()}}};n("cfd0");Dr.render=Un,Dr.__scopeId="data-v-06976913";var Er=Dr,Rr=n("9383"),Tr=n("b3b6"),wr={key:0},Cr={key:0};function kr(e,t,n,o,a,i){var c=Object(r["C"])("Feedback"),u=Object(r["C"])("EditMode"),d=Object(r["C"])("CutPaste"),s=Object(r["C"])("AddNode"),l=Object(r["C"])("RemoveNode"),p=Object(r["C"])("AddPrecondition"),f=Object(r["C"])("PinNode"),b=Object(r["C"])("UnpinNode");return Object(r["u"])(),Object(r["g"])("div",{class:e.$style.wrapper},[o.email?(Object(r["u"])(),Object(r["g"])("div",wr,[Object(r["i"])(Object(r["F"])(o.email)+" ",1),Object(r["j"])(c),Object(r["j"])(u),o.editModeOn?(Object(r["u"])(),Object(r["g"])("span",Cr,[o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(d,{key:0})):Object(r["h"])("",!0),Object(r["j"])(s),o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(l,{key:1})):Object(r["h"])("",!0)])):Object(r["h"])("",!0),o.isNodeSelected?(Object(r["u"])(),Object(r["g"])(p,{key:1,clickedTitleId:n.clickedTitleId,onSelectPreconditionIsOn:t[1]||(t[1]=function(t){return e.$emit("select-precondition-is-on")}),onSelectPreconditionIsOff:t[2]||(t[2]=function(t){return e.$emit("select-precondition-is-off")})},null,8,["clickedTitleId"])):Object(r["h"])("",!0),o.isNodeSelected&&!o.isPinned?(Object(r["u"])(),Object(r["g"])(f,{key:2})):Object(r["h"])("",!0),o.isNodeSelected&&o.isPinned?(Object(r["u"])(),Object(r["g"])(b,{key:3})):Object(r["h"])("",!0),Object(r["j"])("button",{onClick:t[3]||(t[3]=function(){return o.signOut&&o.signOut.apply(o,arguments)})},"Sign Out")])):(Object(r["u"])(),Object(r["g"])("button",{key:1,onClick:t[4]||(t[4]=function(){return o.signIn&&o.signIn.apply(o,arguments)})}," Sign In "))],2)}var _r=Object(r["j"])("h3",null,Object(r["F"])("Choose parent from which pin will be visible"),-1);function Sr(e,t,n,o,a,i){var c=Object(r["C"])("Listbox"),u=Object(r["C"])("Button"),d=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onMousedown:t[1]||(t[1]=Object(r["O"])((function(){return o.toggleAddDialog&&o.toggleAddDialog.apply(o,arguments)}),["stop"]))},"pin",32),Object(r["j"])(d,{visible:o.addDialogVisible,"onUpdate:visible":t[3]||(t[3]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["L"])((function(){return[_r]})),footer:Object(r["L"])((function(){return[Object(r["j"])(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(u,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["L"])((function(){return[Object(r["j"])(c,{modelValue:o.selectedParent,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.selectedParent=e}),options:o.parents,optionLabel:"title"},null,8,["modelValue","options"])]})),_:1},8,["visible"])],64)}var Pr=n("5bd2"),Ar=n("dc4a"),Mr={name:"PinNode",components:{Dialog:Pr["a"],Button:pr["a"],Listbox:Ar["a"]},setup:function(){var e=It(),t=e.state.tree,n=Object(r["z"])(!1),o=Object(r["z"])(!1),a=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),i=Object(r["z"])(""),c=Object(r["e"])((function(){var e=[],n=t.nodeRecord[t.selectedNodeId].parent;while(t.nodeRecord[n.id].parent)e.push({title:n.title,id:n.id}),n=t.nodeRecord[n.id].parent;return e.push({title:"root",id:0}),e}));return{toggleAddDialog:function(){n.value=!n.value},selectedParent:o,parents:c,add:function(){n.value=!1,e.dispatch("pin/".concat(O.AddPin),{parentId:o.value.id,nodeId:a.value.id}),X.savePins(e.state.user.user,e.state.pin.pins),o.value=null},cancelAdd:function(){n.value=!1},addDialogVisible:n,newNodeTitle:i}}};Mr.render=Sr;var Lr=Mr;function Br(e,t,n,o,a,i){var c=Object(r["C"])("Button"),u=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.showAddBanner&&o.showAddBanner.apply(o,arguments)})},"Add Premise"),Object(r["j"])(u,{visible:o.addBannerVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addBannerVisible=e}),dismissableMask:!1,closable:!0,modal:!1,closeOnEscape:!0,onMousedown:t[3]||(t[3]=Object(r["O"])((function(){}),["stop"]))},{header:Object(r["L"])((function(){return[Object(r["j"])("h3",null,' Set "'+Object(r["F"])(o.preconditionNode.title?o.preconditionNode.title:o.selectedNode?o.selectedNode.title:"")+'" as precondition for "'+Object(r["F"])(o.targetNode?o.targetNode.title:"")+'" ',1)]})),footer:Object(r["L"])((function(){return[Object(r["j"])(c,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(c,{label:"Done",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),_:1},8,["visible"])],64)}n("aa20");var Ur={name:"AddPrecondition",components:{Dialog:Pr["a"],Button:pr["a"]},emits:["select-precondition-is-on","select-precondition-is-off"],props:{clickedTitleId:{type:String,required:!0}},setup:function(e,t){var n=It(),o=Object(r["z"])(!1),a=Object(r["z"])({}),i=Object(r["z"])({}),c=Object(r["e"])((function(){return n.getters["tree/selectedNode"]}));return Object(r["J"])((function(){return e.clickedTitleId}),(function(){e.clickedTitleId>0&&n.state.tree.nodeRecord[e.clickedTitleId]&&(i.value=n.state.tree.nodeRecord[e.clickedTitleId].node)}),{immediate:!0}),{showAddBanner:function(){t.emit("select-precondition-is-on"),a.value=n.getters["tree/selectedNode"],o.value=!o.value},add:function(){n.dispatch("precondition/".concat(j.AddPrecondition),{nodeId:a.value.id,preconditionId:i.value.id}),X.savePreconditions(n.state.user.user,{nodeId:a.value.id,preconditionIds:n.state.precondition.preconditions[a.value.id]}),t.emit("select-precondition-is-off"),o.value=!1,i.value={}},cancelAdd:function(){o.value=!1,i.value={},t.emit("select-precondition-is-off")},addBannerVisible:o,targetNode:a,preconditionNode:i,selectedNode:c}}};Ur.render=Br;var Hr=Ur;function zr(e,t,n,o,a,i){var c=Object(r["C"])("Input"),u=Object(r["C"])("Button"),d=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.toggleAddDialog&&o.toggleAddDialog.apply(o,arguments)})},"+"),Object(r["j"])(d,{visible:o.addDialogVisible,"onUpdate:visible":t[3]||(t[3]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0,onMousedown:t[4]||(t[4]=Object(r["O"])((function(){}),["stop"]))},{header:Object(r["L"])((function(){return[Object(r["j"])("h3",null,Object(r["F"])(o.selectedNodeTitle?"Add subsection to ".concat(o.selectedNodeTitle):"Add section"),1)]})),footer:Object(r["L"])((function(){return[Object(r["j"])(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancelAdd},null,8,["onClick"]),Object(r["j"])(u,{label:"Yes",icon:"pi pi-check",onClick:o.add},null,8,["onClick"])]})),default:Object(r["L"])((function(){return[Object(r["j"])(c,{type:"text",modelValue:o.newNodeTitle,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.newNodeTitle=e})},null,8,["modelValue"])]})),_:1},8,["visible"])],64)}var Vr={name:"AddNode",components:{Dialog:Pr["a"],Button:pr["a"],Input:zn["a"]},setup:function(){var e=It(),t=Object(r["z"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),o=Object(r["z"])("");return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleAddDialog:function(){return t.value=!t.value},add:function(){e.dispatch("".concat(vt.createNode),{parentID:n.value?n.value.id:null,title:o.value}),o.value="",t.value=!1},cancelAdd:function(){o.value="",t.value=!1},addDialogVisible:t,newNodeTitle:o}}};Vr.render=zr;var Fr=Vr;function Gr(e,t,n,o,a,i){var c=Object(r["C"])("Button"),u=Object(r["C"])("Dialog");return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.toggleDialog&&o.toggleDialog.apply(o,arguments)}),disabled:!o.selectedNodeTitle},"-",8,["disabled"]),Object(r["j"])(u,{visible:o.addDialogVisible,"onUpdate:visible":t[2]||(t[2]=function(e){return o.addDialogVisible=e}),dismissableMask:!0,closable:!0,modal:!0,closeOnEscape:!0},{header:Object(r["L"])((function(){return[Object(r["j"])("h3",null,Object(r["F"])("Remove ".concat(o.selectedNodeTitle," and all its descendants?")),1)]})),footer:Object(r["L"])((function(){return[Object(r["j"])(c,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:o.cancel},null,8,["onClick"]),Object(r["j"])(c,{label:"Yes",icon:"pi pi-check",onClick:o.remove},null,8,["onClick"])]})),_:1},8,["visible"])],64)}var Wr={name:"RemoveNode",components:{Dialog:Pr["a"],Button:pr["a"]},setup:function(){var e=It(),t=Object(r["z"])(!1),n=Object(r["e"])((function(){return e.getters["tree/selectedNode"]}));return{selectedNodeTitle:Object(r["e"])((function(){return n.value?n.value.title:""})),toggleDialog:function(){return t.value=!t.value},remove:function(){t.value=!1,e.dispatch("".concat(vt.removeNode),n.value.id)},cancel:function(){t.value=!1},addDialogVisible:t}}};Wr.render=Gr;var qr=Wr;function Yr(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])(r["a"],null,[o.editModeOn?(Object(r["u"])(),Object(r["g"])("button",{key:0,onClick:t[1]||(t[1]=function(){return o.off&&o.off.apply(o,arguments)})},"Back to view mode")):Object(r["h"])("",!0),o.editModeOn?Object(r["h"])("",!0):(Object(r["u"])(),Object(r["g"])("button",{key:1,onClick:t[2]||(t[2]=function(){return o.on&&o.on.apply(o,arguments)})},"Edit Map"))],64)}var Kr={name:"EditMode",setup:function(){var e=It();return{editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),on:function(){e.dispatch("".concat(vt.setEditMode),!0)},off:function(){e.dispatch("".concat(vt.setEditMode),!1)}}}};Kr.render=Yr;var Xr=Kr;function Zr(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])("button",{onClick:t[1]||(t[1]=function(){return o.unpin&&o.unpin.apply(o,arguments)})},"unpin")}var Jr={name:"UnpinNode",setup:function(){var e=It();return{unpin:function(){e.dispatch("pin/".concat(O.RemovePin),e.state.tree.selectedNodeId),X.savePins(e.state.user.user,e.state.pin.pins)}}}};Jr.render=Zr;var $r=Jr;function Qr(e,t,n,o,a,i){return Object(r["u"])(),Object(r["g"])(r["a"],null,[Object(r["j"])("button",{onClick:t[1]||(t[1]=function(){return o.cut&&o.cut.apply(o,arguments)})},"cut"),null!=o.cutNodeID?(Object(r["u"])(),Object(r["g"])("button",{key:0,onClick:t[2]||(t[2]=function(){return o.paste&&o.paste.apply(o,arguments)})},"Paste")):Object(r["h"])("",!0)],64)}var eo={name:"CutPaste",setup:function(){var e=It(),t=Object(r["e"])((function(){return e.getters["tree/selectedNode"]})),n=Object(r["z"])(null);return{cutNodeID:n,cut:function(){n.value=t.value.id},paste:function(){e.dispatch("".concat(vt.cutPasteNode),{nodeID:n.value,parentID:t.value.id}),n.value=null}}}};eo.render=Qr;var to=eo,no=n("0c86"),ro=n.n(no),oo=Object(r["j"])("img",{alt:"logo",src:ro.a,style:{width:"20px"}},null,-1),ao=Object(r["j"])("span",{class:"p-ml-2 p-text-bold"},"give us feedback!",-1);function io(e,t,n,o,a,i){var c=Object(r["C"])("Button");return Object(r["u"])(),Object(r["g"])(c,{iconPos:"right",onClick:o.send},{default:Object(r["L"])((function(){return[oo,ao]})),_:1},8,["onClick"])}var co={name:"Feedback",components:{Button:pr["a"]},setup:function(){return{send:function(){window.open("https://t.me/scimap","_blank")}}}};co.render=io;var uo=co,so={name:"Menu",components:{Feedback:uo,CutPaste:to,UnpinNode:$r,PinNode:Lr,AddNode:Fr,AddPrecondition:Hr,RemoveNode:qr,EditMode:Xr},props:{clickedTitleId:{type:String,required:!0}},setup:function(){var e=It(),t=e.state.user,n=Object(r["e"])((function(){return t.user?t.user.email:null}));return{email:n,editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),isNodeSelected:Object(r["e"])((function(){return e.state.tree.selectedNodeId})),isPinned:Object(r["e"])((function(){return void 0!==e.state.pin.pins[e.state.tree.selectedNodeId]})),signIn:function(){return e.dispatch("user/".concat(Be.signIn))},signOut:function(){return e.dispatch("user/".concat(Be.signOut))}}}},lo=n("0c6e");const po=so.__cssModules={};po["$style"]=lo["default"],so.render=kr;var fo=so,bo=Object(r["k"])({name:"Home",components:{Map:Tn,Menu:fo,NodeContent:Er,ConfirmDialog:Rr["a"],Toast:Tr["a"]},setup:function(){var e=It(),t=Object(Tt["d"])(),n=Object(Tt["c"])(),o=e.state.tree,a=e.state.zoomPan,i=e.state.pin,c=Object(r["z"])("-1"),u=!1;Object(r["J"])((function(){return n.params.id}),(function(){e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),n.params.id)}),{immediate:!0});var d=Object(r["e"])((function(){return o.mapNodeLayers&&o.mapNodeLayers.length?"0 0 ".concat(2*o.mapNodeLayers[0]["0"].center.x," ").concat(2*o.mapNodeLayers[0]["0"].center.y):"0 0 1000 1000"})),s=function(e,t,n){var r=In(t,n,e),o=Object(l["a"])(r,2),a=o[0],i=o[1];return i?(_("Home.vue: error in filterNodesAndLayers:",{err:i}),[]):a.reverse()},p=Object(r["z"])(null),b=Object(r["z"])([]);Object(r["J"])((function(){return[o.mapNodeLayers,a.debouncedZoom,a.debouncedPan]}),(function(){var t=Nn(o.mapNodeLayers,o.nodeRecord,{width:window.innerWidth,height:window.innerHeight},a.debouncedZoom,a.pan,a.zoomCenter),n=Object(l["a"])(t,2),r=n[0],i=n[1];null!=i&&_("filterNodesAndLayers: error in findCurrentNode",{err:i});var c,u=[],d=Object(f["a"])(b.value);try{for(d.s();!(c=d.n()).done;){var O=c.value;u.push.apply(u,Object(g["a"])(Object.values(O).filter((function(e){return!!e.title})).map((function(e){return e.id}))))}}catch(i){d.e(i)}finally{d.f()}p.value=r,b.value=s(r,o.mapNodeLayers,o.nodeRecord);var m,v=[],j=Object(f["a"])(b.value);try{for(j.s();!(m=j.n()).done;){var h=m.value;v.push.apply(v,Object(g["a"])(Object.values(h).filter((function(e){return!!e.title})).map((function(e){return e.id}))))}}catch(i){j.e(i)}finally{j.f()}e.dispatch(vt.subscribeDBChange,{oldNodeIDs:u,newNodeIDs:v,cb:function(t){return e.dispatch(vt.handleDBUpdate,t)}})}),{immediate:!0,deep:!0});var O=Object(r["z"])([]);return Object(r["J"])((function(){return[a.pan.x,a.pan.y,a.zoom,b]}),(function(){var e=k(b.value);O.value=yn(e,a.zoom,a.pan)}),{immediate:!0,deep:!0}),{pinNodes:Object(r["e"])((function(){if(null==p.value)return[];var e=i.pinsReverse[p.value];if(!e)return[];var t,n=Object(f["a"])(b.value);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var c in r){var u=r[c];if(""!=u.title){var d=e.indexOf(u.id);-1!=d&&e.splice(d,1)}}}}catch(h){n.e(h)}finally{n.f()}var s,l=A(e,o.mapNodeLayers),O=[],m=Object(f["a"])(l);try{for(m.s();!(s=m.n()).done;){var v=s.value,j=k(v);j.center=hn(v.center,a.zoom,a.pan),O.push(j)}}catch(h){m.e(h)}finally{m.f()}return O})),viewBox:d,editModeOn:Object(r["e"])((function(){return e.state.editModeOn})),selectedNodeId:Object(r["e"])((function(){return o.selectedNodeId})),preconditionNodeIds:Object(r["e"])((function(){return o.selectedNodeId?e.state.precondition.preconditions[o.selectedNodeId]:[]})),zoomedPanedLayers:O,nodeDragging:function(t){e.dispatch("".concat(vt.updateNodePosition),{nodeId:t.id,delta:{x:t.delta.x/a.zoom,y:t.delta.y/a.zoom}})},setSelectPreconditionON:function(){u=!0},setSelectPreconditionOFF:function(){u=!1},clickedTitleId:c,titleClick:function(e){u?c.value=e.id:t.push({name:"node",params:{id:e.id}})},titleOver:function(t){e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),t.id)},titleLeave:function(t){e.commit("tree/".concat(Te.SET_SELECTED_NODE_ID),n.params.id)},mapDragging:function(t){e.commit("zoomPan/".concat(ke.ADD_PAN),t)},zoom:function(t){var n={x:(t.center.x-a.pan.x)/a.zoom,y:(t.center.y-a.pan.y)/a.zoom};e.commit("zoomPan/".concat(ke.ADD_ZOOM),-1*t.delta);var r={x:n.x*a.zoom+a.pan.x,y:n.y*a.zoom+a.pan.y};e.commit("zoomPan/".concat(ke.ADD_PAN),{from:r,to:t.center}),e.commit("zoomPan/".concat(ke.SET_ZOOM_CENTER),t.center)}}}});bo.render=At;var Oo=bo;function mo(e,t){return Object(r["u"])(),Object(r["g"])("h1",null,"Oops, it looks like the page you're looking for doesn't exist.")}const vo={};vo.render=mo;var jo=vo,ho=[{path:"/passwordLogin",component:Pt},{path:"/:id?",name:"node",component:Oo},{path:"/:catchAll(.*)",component:jo}],go=Object(Tt["a"])({history:Object(Tt["b"])("/"),routes:ho}),No=go;n("098b"),n("e1ae"),n("4121"),n("bddf");Object(r["f"])(xt).use(Nt,gt).use(No).use(Dt["a"]).use(Et["a"]).use(Rt["a"]).mount("#app")},cfd0:function(e,t,n){"use strict";n("1b02")},d6b6:function(e){e.exports=JSON.parse("{}")}});
//# sourceMappingURL=app.02be0d85.js.map