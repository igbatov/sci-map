{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/menu/Index.vue?6d68","webpack:///./src/assets/images/sign-in.svg","webpack:///./src/components/menu/Textsearch.vue?cdad","webpack:///./src/components/menu/Index.vue?dc69","webpack:///./src/components/node_content/Title.vue?1654","webpack:///./src/assets/images/chat.svg","webpack:///./src/components/node_content/Markdown.vue?071d","webpack:///./src/components/node_content/UsedBy.vue?2a53","webpack:///./src/components/SVGTextBox.vue?6701","webpack:///./src/assets/images/plugin.svg","webpack:///./src/components/node_content/PinIcon.vue?4950","webpack:///./src/components/node_content/Index.vue?c4f0","webpack:///./src/assets/images/log.svg","webpack:///./src/assets/images/eye-on.svg","webpack:///./src/assets/images/switch-off.svg","webpack:///./src/assets/images/remove-off.svg","webpack:///./src/components/node_content/RemoveIcon.vue?aab8","webpack:///./src/assets/images/revert.svg","webpack:///./src/components/node_content/Preconditions.vue?971a","webpack:///./src/components/map_layer/MapLayer.vue?1492","webpack:///./src/assets/images/remove-on.svg","webpack:///./src/components/node_content/SubscribeIcon.vue?8445","webpack:///./src/assets/images/paste.svg","webpack:///./src/assets/images/add-on.svg","webpack:///./src/components/node_content/AddBasedOnIcon.vue?e31f","webpack:///./src/assets/images/switch-on.svg","webpack:///./src/assets/images/cut.svg","webpack:///./src/assets/images/goal.svg","webpack:///./src/components/node_content/UsedBy.vue?47f0","webpack:///./src/components/node_content/Preconditions.vue?630e","webpack:///./src/assets/images/pin-off.svg","webpack:///./src/assets/images/pin-on.svg","webpack:///./src/assets/images/user.svg","webpack:///./src/App.vue","webpack:///./src/store/pin/index.ts","webpack:///./src/tools/errorkv.ts","webpack:///./src/store/precondition/index.ts","webpack:///./src/store/image/index.ts","webpack:///./src/api/helpers.ts","webpack:///./src/api/api.ts","webpack:///./src/store/subscriptions/index.ts","webpack:///./src/store/title_box/index.ts","webpack:///./src/store/position_change_permits/index.ts","webpack:///./src/tools/utils.ts","webpack:///./src/store/tree/helpers.ts","webpack:///./src/tools/graphics.ts","webpack:///./src/store/node_content/index.ts","webpack:///./src/tools/textsearch.ts","webpack:///./src/store/user/index.ts","webpack:///./src/store/helpers.ts","webpack:///./src/store/tree/index.ts","webpack:///./src/store/history/index.ts","webpack:///./src/store/zoom_pan/index.ts","webpack:///./src/store/search_result/index.ts","webpack:///./src/store/index.ts","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?dfb6","webpack:///./src/views/PasswordLogin.vue","webpack:///./src/views/PasswordLogin.vue?76a3","webpack:///./src/views/PasswordLogin.vue?e3c1","webpack:///./src/views/Home.vue","webpack:///./src/components/map/Map.vue","webpack:///./src/components/map_layer/MapLayer.vue","webpack:///./src/components/map_layer/MapLayer.ts","webpack:///./src/components/SVGTextBox.ts","webpack:///./src/components/map_layer/MapLayer.vue?1431","webpack:///./src/components/map_layer/MapLayer.vue?0796","webpack:///./src/components/map/MapPan.ts","webpack:///./src/components/pin_layer/PinLayer.vue","webpack:///./src/components/pin_layer/PinMarker.vue","webpack:///./src/components/pin_layer/PinMarker.vue?bbb0","webpack:///./src/components/pin_layer/PinMarker.vue?9aa1","webpack:///./src/components/SVGTextBox.vue","webpack:///./src/components/SVGTextBox.vue?ae08","webpack:///./src/components/SVGTextBox.vue?ec46","webpack:///./src/components/pin_layer/PinLayer.vue?738a","webpack:///./src/components/pin_layer/PinLayer.vue?8bd0","webpack:///./src/components/precondition_layer/PreconditionLayer.vue","webpack:///./src/components/precondition_layer/PreconditionArrow.vue","webpack:///./src/components/precondition_layer/PreconditionArrow.vue?e51e","webpack:///./src/components/precondition_layer/PreconditionArrow.vue?74c6","webpack:///./src/views/Home.ts","webpack:///./src/components/precondition_layer/PreconditionLayer.vue?6cdc","webpack:///./src/components/precondition_layer/PreconditionLayer.vue?73c2","webpack:///./src/components/map/Map.vue?b432","webpack:///./src/components/map/Map.vue?8505","webpack:///./src/components/node_content/Index.vue","webpack:///./src/components/node_content/Preconditions.vue","webpack:///./src/components/node_content/RemoveIcon.vue","webpack:///./src/components/node_content/RemoveIcon.vue?f4ef","webpack:///./src/components/helpers.ts","webpack:///./src/components/Link.vue","webpack:///./src/components/Link.vue?14eb","webpack:///./src/components/Link.vue?da62","webpack:///./src/components/node_content/Preconditions.vue?b5b4","webpack:///./src/components/node_content/Preconditions.vue?c4ee","webpack:///./src/components/node_content/UsedBy.vue","webpack:///./src/components/node_content/UsedBy.vue?fc09","webpack:///./src/components/node_content/UsedBy.vue?0024","webpack:///./src/components/node_content/Markdown.vue","webpack:///./src/components/node_content/Markdown.vue?6e5c","webpack:///./src/components/node_content/Markdown.vue?9efd","webpack:///./src/components/node_content/ChangeLog.vue","webpack:///./src/store/change_log/index.ts","webpack:///./src/api/change_log.ts","webpack:///./src/components/node_content/ChangeLogComplain.vue","webpack:///./src/components/node_content/ChangeLogComplain.vue?d4d1","webpack:///./src/components/node_content/ChangeLogComplain.vue?5b6f","webpack:///./src/components/node_content/ChangeLog.vue?ff01","webpack:///./src/components/node_content/ChangeLog.vue?5753","webpack:///./src/components/node_content/PinButton.vue","webpack:///./src/components/node_content/PinIcon.vue","webpack:///./src/components/node_content/PinIcon.vue?7cf5","webpack:///./src/components/node_content/PinButton.vue?f1ab","webpack:///./src/components/node_content/SubscribeButton.vue","webpack:///./src/components/node_content/SubscribeIcon.vue","webpack:///./src/components/node_content/SubscribeIcon.vue?a7ab","webpack:///./src/components/node_content/SubscribeButton.vue?f9b6","webpack:///./src/components/node_content/SubscribeButton.vue?04a0","webpack:///./src/components/node_content/Title.vue","webpack:///./src/components/node_content/Title.vue?1578","webpack:///./src/components/node_content/Title.vue?f8bb","webpack:///./src/components/node_content/AddBasedOnButton.vue","webpack:///./src/components/node_content/AddBasedOnIcon.vue","webpack:///./src/components/node_content/AddBasedOnIcon.vue?6da1","webpack:///./src/components/node_content/AddBasedOnButton.vue?6d44","webpack:///./src/components/node_content/TitleImage.vue","webpack:///./src/components/node_content/TitleImage.vue?36f1","webpack:///./src/components/node_content/TitleImage.vue?6fb7","webpack:///./src/components/node_content/Index.vue?70b7","webpack:///./src/components/node_content/Index.vue?1dc7","webpack:///./src/components/menu/Index.vue","webpack:///./src/components/menu/AddNode.vue","webpack:///./src/components/menu/MenuButton.vue","webpack:///./src/components/menu/MenuButton.vue?30bd","webpack:///./src/components/menu/AddNode.vue?9c98","webpack:///./src/components/menu/RemoveNode.vue","webpack:///./src/components/menu/RemoveNode.vue?4610","webpack:///./src/components/menu/RemoveNode.vue?2cae","webpack:///./src/components/menu/EditMode.vue","webpack:///./src/components/menu/EditMode.vue?1f8e","webpack:///./src/components/menu/CutPaste.vue","webpack:///./src/components/menu/CutPaste.vue?91c8","webpack:///./src/components/menu/Feedback.vue","webpack:///./src/components/menu/Feedback.vue?098b","webpack:///./src/components/menu/Textsearch.vue","webpack:///./src/components/menu/Textsearch.vue?1edb","webpack:///./src/components/menu/Textsearch.vue?31d6","webpack:///./src/components/menu/MapChangeLog.vue","webpack:///./src/components/menu/RestoreNode.vue","webpack:///./src/components/menu/RestoreNode.vue?51ab","webpack:///./src/components/menu/RestoreNode.vue?1d4e","webpack:///./src/components/menu/MapChangeLog.vue?c7fd","webpack:///./src/components/menu/MapChangeLog.vue?978e","webpack:///./src/components/menu/Index.vue?075d","webpack:///./src/views/Home.vue?d5e7","webpack:///./src/views/Home.vue?ab8c","webpack:///./src/views/Change.vue","webpack:///./src/views/Change.vue?708d","webpack:///./src/views/Change.vue?8302","webpack:///./src/views/UnsubscribeDigest.vue","webpack:///./src/views/UnsubscribeDigest.vue?eca5","webpack:///./src/views/UnsubscribeDigest.vue?3058","webpack:///./src/views/NodeDescription.vue","webpack:///./src/views/NodeDescription.vue?fd3e","webpack:///./src/views/NodeDescription.vue?8bca","webpack:///./src/views/NotFound.vue","webpack:///./src/views/NotFound.vue?8fd3","webpack:///./src/views/MobileWarning.vue","webpack:///./src/views/MobileWarning.vue?bce7","webpack:///./src/views/MobileWarning.vue?e041","webpack:///./src/router/index.ts","webpack:///./src/main.ts","webpack:///./node_modules/markdown-it-imsize/lib/imsize/types sync ^\\.\\/.*$","webpack:///./src/assets/images/eye-off.svg","webpack:///./src/components/menu/Textsearch.vue?0596","webpack:///./src/assets/images/move.svg","webpack:///./src/assets/images/add-off.svg","webpack:///./src/assets/images/question.svg"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","mutations","SET_PINS","ADD_TO_PINS","REMOVE_PIN","ADD_TO_PINS_REVERSE","AddPin","RemovePin","namespaced","state","pins","pinsReverse","actions","v","commit","rootState","currentParent","tree","nodeRecord","nodeId","parent","parentIds","id","parentId","pinId","index","indexOf","message","kv","code","err","Error","error","SET_PRECONDITIONS","UPDATE_PRECONDITIONS","REMOVE_PRECONDITION","preconditions","reverseIndex","precondID","nodeID","preconditionIDs","preconditionID","UPDATE_IMAGES","images","convertChildren","children","Array","isArray","filter","childID","sort","forEach","arr","toString","values","convertDBMapToTree","dbNodes","root","title","position","stack","node","pop","parentID","FUNCTION_DOMAIN","database","ref","update","debouncedUpdate","ROOT_WIDTH","innerWidth","ROOT_HEIGHT","innerHeight","ROOT_CENTER_X","ROOT_CENTER_Y","ST_WIDTH","ST_HEIGHT","initFirebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","analytics","callFunction","method","params","currentUser","auth","getIdToken","idToken","a","response","e","getMapFromDB","snapshot","exists","map","val","getMapFromStorage","user","storage","child","uid","getDownloadURL","url","x","y","getMap","getPins","savePins","set","getSubscriptions","setSubscription","getPreconditions","savePreconditions","preconditionIds","subscribeMapNodeChange","cb","this","subscribeDBChange","snap","subscribeNodeContentChange","subscribePreconditionNodeChange","subscribeNodeImageChange","path","on","unsubscribeDBChange","off","transaction","setPublicUserData","userID","displayName","discordName","console","getMapNode","pr","getTrashNode","type","generateKey","findKeyInList","orderByValue","equalTo","limitToFirst","findKeyOfChild","getUserSubscribePeriod","setUserSubscribePeriod","period","setUserLastSearch","searchPhrase","getUserComments","nodeComment","getNodeContent","SET_SUBSCRIPTIONS","SET_SUBSCRIPTION","ToggleSubscription","subscriptions","api","SET_MAP","layerMap","layerName","titleBoxMap","PERMISSION_TIMEOUT","ADD_NODES","REMOVE_NODES","CheckNodeID","permittedNodeIDs","nodeIDs","Date","getTime","ROUND_EPSILON","mod","round","num","Math","pow","clone","printError","msg","kvArr","findMapNode","mapNodeLayers","level","layer","Number","findMapNodes","ids","createNewNode","center","getNewNodeCenter","addRandom","parentMapNode","fromCenterVectors","border","from","to","maxFromCenterVector","getVectorLength","coeff","random","maxDiagChild","maxDiagChildMapNode","maxDiagChildId","childMapNode","childId","getMaxDiagonal","childDiag","err1","maxDiag","err2","finalMaxDiag","newNodeCenter","vectorOnNumber","modifiedNode","updatePosition","item","convertPosition","normalizedPosition","layerLevel","treeToMapNodeLayers","ls","mergeMapNodeLayers","NORMALIZED_BORDER","sqrt","polygonToTurf","pp","point","isInside","polygon","polygonToPCPolygon","abs","intersect","p1","p2","np1","np2","cf","tp1","tp2","polygonIntersect","intersection","resultPolys","poly","resultPoly","getBoundingBorders","minX","reduce","previousValue","currentValue","minY","maxX","maxY","leftBottom","rightTop","getVoronoiCellsInSquare","centers","turfPoints","collection","cells","bbox","cellMap","features","cell","cellBorder","geometry","coordinates","getVoronoiCells","outerBorder","bb","res","BoundingBorders","intersections","polygonFill","selectedNodeId","currentNodeId","selectedNodePreconditionIds","polygonFillOpacity","polygonToPath","join","treeToNodeRecord","transferToPoint","vector","addVector","b","bTransferred","aTr","transferPointOnVector","getVectorIntersection","v1","v2","x1","y1","x2","y2","x3","y3","x4","y4","denom","numeA","numeB","uA","uB","morphChildrenPoints","oldBorder","newBorder","oldPoints","oldCenterTf","newCenterTf","oldCenter","newCenter","maxDiameter","max","newPoints","oldPoint","centerToPoint","oldBorderIntersection","segment","newBorderIntersection","NewEmptyVector","diagonals","middle","maxDiagonal","diag","convertedPosition","morphedPositions","normalizedBorder","tmp","rootBorder","rootPosition","keys","treeLayers","lastTreeLayer","lastMapNodeLayer","newTreeLayer","newMapNodeLayer","treeNode","tmpMap","strPos","JSON","stringify","firstId","secondId","treeNodeChildren","denormalizedPosition","ch","recipientLayers","insertedLayers","startFromLevel","SET_CONTENTS","SET_USER_COMMENTS","SET_NODE_CONTENT","SET_NODE_COMMENT","setNodeContent","setNodeComment","EmptyNodeContent","content","createContentIfNotExist","nodeContents","EmptyNodeComment","comment","createCommentIfNotExist","userNodeComments","isAnonymous","language","tokenize","text","add","search","SET_USER","SET_SUBSCRIBE_PERIOD","signIn","signOut","setSubscribePeriod","subscribePeriod","signInWithPopup","GoogleAuthProvider","initMap","convErr","SET_TREE","subscribeNodeChanges","unSubscribeNodeChanges","dbNode","dispatch","handleMapNodeUpdate","fetchPins","log","fetchSubscribePeriod","fetchSubscriptions","initPreconditions","initNodeContents","nodeContent","userComments","initData","ROOT_BORDER","ROOT_CENTER","userFitCoefficient","min","changeTypeEnum","SET_SELECTED_NODE_ID","UPDATE_NODE_POSITION","REMOVE_NODE","getters","selectedNode","dbNodeRecord","oldDBNode","newChildren","includes","removedChildren","returnError","addedDBNode","toProcess","inProcessNode","childNode","ind","findIndex","ADD_ZOOM","ADD_PAN","SET_PAN","SET_ZOOM_CENTER","RESET_ZOOM_AND_PAN","zoomDebounce","debouncedZoom","panDebounce","debouncedPan","ZOOM_SENSITIVITY","PAN_SENSITIVITY","zoom","pan","zoomCenter","delta","newZoom","ADD_CUT_PASTE","ADD_CREATE","ADD_REMOVE","ADD_POSITION_CHANGE","changeTypes","CUT_PASTE","CREATE","REMOVE","POSITION_CHANGE","stableChangeList","localChangeList","change","newParentID","firstOldPosition","oldPosition","newPosition","SET_NODE_IDS","init","updateNodePosition","createNode","cutPasteNode","removeNode","setEditMode","confirmSignInPopup","SET_EDIT_MODE","debouncedPositionSet","normalizedNewNodeCenter","editModeOn","confirm","require","header","acceptLabel","rejectLabel","accept","reject","onAuthStateChanged","changedNode","newDBNode","newKey","updateMap","normalizedChangedCenter","pn","oldParent","newParent","oldKey","parentNodeID","mapNode","args","pin","titleBox","image","precondition","positionChangePermits","zoomPan","history","searchResult","useStore","setup","store","render","login","emailEl","document","getElementById","passwordEl","signInWithEmailAndPassword","class","icon","slotProps","summary","detail","clickedTitleId","setSelectPreconditionON","setSelectPreconditionOFF","show","setRestoreSelectNewParentON","setRestoreSelectNewParentOFF","layers","visibleZoomedPanedLayers","pin-nodes","pinNodes","searchResultPinNodes","searchResultNodeIDs","nodeDragging","titleClick","titleOver","titleLeave","mapDragging","xmlns","width","svgWidth","height","svgHeight","mapID","style","layer-id","map-nodes","border-color","borderColor","font-color","fontColor","font-size","fontSize","font-opacity","fontOpacity","map-id","draggingNode","visibleTitleIds","color","font-weight","text-decoration","mapNodes","stroke","fill","fill-opacity","stroke-width","points","pointer-events","TITLE_PREFIX","font-family","textWeight","textColor","textDecoration","splitLines","line","alignment-baseline","titleMouseDown","cursor","mouseMoveListener","emit","event","mouseDownInfo","dragStart","movementX","movementY","mouseUpListener","nodeToTitleBox","nodes","updateTitleBox","titleIdPrefix","dom","getBoundingClientRect","mps","then","immediate","maxCharNum","words","split","lines","currLine","nextLine","emits","props","layerId","mapId","String","required","validator","prop","ctx","layerID","titleMouseDownInfo","mouseMove","mouseUp","addEventListener","removeEventListener","searchResultNodeIDsMap","methods","__scopeId","mouseDownBg","mouseDown","visiblePinNodes","useLineBreak","titleXY","line-height","max-char-per-line","fontWeight","titleBoxClick","transform","WIDTH","HEIGHT","fontFamily","lineHeight","Boolean","maxCharPerLine","components","SVGTextBox","PinMarker","allPinNodes","PIN_MARKER_HEIGHT","PIN_MARKER_WIDTH","alignedXY","markerWidth","markerHeight","refX","refY","orient","markerId","visibleTitleNodes","titleBoxOver","titleBoxLeave","marker-end","MIN_VISIBLE_NODES_NUM","zoomAndPanPoint","zoomAndPanPolygon","findCentralNode","viewport","zoomFactor","focusPoint","underFocusPointNodeId","viewportArea","nodesToCheck","borderToCheck","minDist","Infinity","nodeCenter","dist","underCursorNodeArea","floor","maxIntersectNodeId","filterNodesAndLayers","resultLayers","currentNode","upperLayer","firstLayer","secondLayer","childOfChild","thirdLayer","zoomAnPanLayers","PreconditionArrow","zoomPanState","zoomedPannedSelectedNode","extraPreconditionTitles","visibleTitleNodeBoxes","PreconditionLayer","PinLayer","MapLayer","clientX","clientY","deltaY","passive","prevDist","prevPoint","touches","hypot","pageX","pageY","idx","size","levelSizes","0","1","2","3","levelColors","alt","src","frameborder","allow","referrerpolicy","allowfullscreen","target","href","selectedNodeContent","changeNodeTitle","$event","rows","changeContent","placeholder","autoResize","selectedNodeComment","changeComment","checkAuthorized","$emit","node-id","usedBy","$style","preconditionPath","preconditionPaths","nodeTitle","remove","mouseOver","idToLink","getArrayDiff","beforeArr","afterArr","beforeMap","afterMap","added","removed","getTreePathNodes","records","getTreePathString","reverse","goto","router","treeState","preventDefault","firstNode","Link","RemoveIcon","cssModules","__cssModules","usedByNode","usedByPaths","isAuthorized","renderedContent","setEditOn","editOn","mdKatex","mdImsize","mdContainer","md","use","output","validate","trim","match","tokens","info","nesting","utils","escapeHtml","txtarea","display","focus","complainModalVisible","complainChangeLink","legend","toggleable","collapsed","toggle","pt","changes","timestamp","toLocaleDateString","toLocaleTimeString","action","subtitle","userDisplayName","showComplain","changeLogID","ActionType","Name","newName","Content","newContent","Precondition","getContent","subscribeChangeLog","andConditions","q","changeLogs","doc","attributes","valueBefore","valueAfter","getNodeName","nodeName","prTrash","getUserDisplayName","userName","getUserDisplayNames","userIDs","fetches","Promise","all","responses","getNodeNames","getPathFromNodeName","nodeNames","nodePath","subscribeChangeLogEnriched","userNames","changeLog","ParentID","Restore","resp","changeLogsEnriched","idPath","beforePath","afterPath","parentNodeBefore","parentNodeAfter","isRemoved","isAdded","Remove","IsNodeInTrash","nodeIDPath","startsWith","GetNodeUrl","visible","dismissableMask","closable","modal","closeOnEscape","footer","Dialog","newArgs","oldArgs","computed","Markdown","ChangeLogComplain","Fieldset","Card","unsubscribe","cd","clickPin","addDialogVisible","label","cancelAdd","selectedParent","options","parents","optionLabel","isPinned","undefined","PinIcon","Button","Listbox","newNodeTitle","selectedNodeParents","toggleSubscribe","is-on","isOn","SubscribeIcon","showAddBanner","addBannerVisible","preconditionNode","targetNode","AddBasedOnIcon","preconditionsIDs","defaultImageURL","toggleAddDialog","onInputChange","rounded","triggerUpload","showProgressBar","items","setAsDefault","copyMDLink","showRemoveButton","toTrash","severity","raised","aria-label","fileFormat","ProgressBar","toast","input","defaultURL","dbNodeImgPath","default","navigator","clipboard","writeText","life","rejectClass","click","imgFile","files","compressedBlob","fileName","filePath","storageRef","put","parsedURL","URL","preparedURL","protocol","hostname","port","pathname","TitleImage","AddBasedOnButton","Title","SectionUsedBy","TextArea","SectionPreconditions","ChangeLog","PinButton","SubscribeButton","textSearch","wrapper","email","toggleUserMenu","model","popup","selectedNodeTitle","mouseover","bgColor","MenuButton","Input","newNodeID","toggleDialog","disabled","cancel","allChildrenIDs","usedByNodes","nr","detailText","bg-color","cutNodeID","cut","paste","oldParentChildrenID","newParentChildrenID","send","open","clearBox","doSearch","InputText","debouncedLog","getActionDescription","revertRemove","newParentDialogVisible","newParentNode","nodeIdToRestore","restoreNodeWithChildren","RestoreNode","PrimeMenu","Feedback","CutPaste","AddNode","RemoveNode","EditMode","TextSearch","MapChangeLog","menu","userPhotoURL","photoURL","separator","command","isNodeSelected","Map","Menu","NodeContent","ConfirmDialog","Toast","route","pinState","searchResultState","selectPreconditionIsOn","restoreSelectNewParentIsOn","updateLayers","centralNodeId","filteredLayers","visibleLayers","isFirstPageLoad","newCentralNodeId","deep","layersToZoomAndPan","pinNodeIDs","pinMapNodes","pinMapNode","cl","searchResultMapNodes","searchResultMapNode","hasDragPermit","initial","after","docRef","docSnap","userActions","once","script","urlParams","URLSearchParams","location","decodeURI","searchParams","append","routes","component","PasswordLogin","MobileWarning","NodeDescription","Change","UnsubscribeDigest","Home","NotFound","App","directive","mount","webpackContext","req","webpackContextResolve","resolve"],"mappings":"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","file":"js/app.23eb13a1.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Index_wrapper_1nXRC\",\"textSearch\":\"Index_textSearch_1a-zf\"};","module.exports = __webpack_public_path__ + \"img/sign-in.857c8105.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"searchBox\":\"Textsearch_searchBox_1SbLb\"};","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=2db44821&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=2db44821&module=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Title.vue?vue&type=style&index=0&id=00857be5&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/chat.b54d0730.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Markdown.vue?vue&type=style&index=0&id=22c74c27&scoped=true&lang=css\"","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UsedBy.vue?vue&type=style&index=0&id=b8b30aac&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./UsedBy.vue?vue&type=style&index=0&id=b8b30aac&module=true&lang=css\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SVGTextBox.vue?vue&type=style&index=0&id=3400d8a7&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/plugin.71b16b67.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PinIcon.vue?vue&type=style&index=0&id=4ed46db5&scoped=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=57571194&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/log.2b2ea6d0.svg\";","module.exports = __webpack_public_path__ + \"img/eye-on.e881e189.svg\";","module.exports = __webpack_public_path__ + \"img/switch-off.17f7401d.svg\";","module.exports = __webpack_public_path__ + \"img/remove-off.9d54941e.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./RemoveIcon.vue?vue&type=style&index=0&id=154fe046&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/revert.3fe2bc78.svg\";","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Preconditions.vue?vue&type=style&index=0&id=c5b277c6&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Preconditions.vue?vue&type=style&index=0&id=c5b277c6&module=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MapLayer.vue?vue&type=style&index=0&id=182e8a4c&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/remove-on.9d54941e.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SubscribeIcon.vue?vue&type=style&index=0&id=5d02b387&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/paste.c9ceeece.svg\";","module.exports = __webpack_public_path__ + \"img/add-on.5a83fc0e.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./AddBasedOnIcon.vue?vue&type=style&index=0&id=2494d1ac&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/switch-on.70cdd4b4.svg\";","module.exports = __webpack_public_path__ + \"img/cut.5b0b166e.svg\";","module.exports = __webpack_public_path__ + \"img/goal.dfe3dc4c.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"UsedBy_title_3F9En\",\"precondition\":\"UsedBy_precondition_1vpBY\",\"preconditionPath\":\"UsedBy_preconditionPath_3XvY1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"Preconditions_title_1ANO_\",\"precondition\":\"Preconditions_precondition_XjUJT\",\"preconditionPath\":\"Preconditions_preconditionPath_1K70l\"};","module.exports = __webpack_public_path__ + \"img/pin-off.addc500f.svg\";","module.exports = __webpack_public_path__ + \"img/pin-on.ae33cffa.svg\";","module.exports = __webpack_public_path__ + \"img/user.55fe760e.svg\";","<template>\n  <router-view />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { useStore, actions } from \"@/store\";\nexport default defineComponent({\n  setup() {\n    const store = useStore();\n    store.dispatch(actions.init);\n  }\n});\n</script>\n","import { Commit } from \"vuex\";\nimport { NodeRecordItem } from \"@/store/tree\";\n\nexport type Pins = Record<\n  string /* node_id of pinned node */,\n  string[] /* list of parents where this node_id is visible */\n>;\n\nexport interface State {\n  pins: Pins;\n  pinsReverse: Record<\n    string /* node_id of parent whose children contain pinned nodes (that must be visible) */,\n    string[] /* array of pins (= node ids) that is visible in this node_id */\n  >;\n}\n\nexport const mutations = {\n  SET_PINS: \"SET_PINS\",\n  ADD_TO_PINS: \"ADD_TO_PINS\",\n  REMOVE_PIN: \"REMOVE_PIN\",\n  ADD_TO_PINS_REVERSE: \"ADD_TO_PINS_REVERSE\"\n};\n\nexport const actions = {\n  AddPin: \"AddPin\",\n  RemovePin: \"RemovePin\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    pins: {},\n    pinsReverse: {}\n  },\n  actions: {\n    // had to use action instead of mutation to get access to rootState https://github.com/vuejs/vuex/issues/344\n    [actions.AddPin](\n      {\n        commit,\n        rootState\n      }: {\n        commit: Commit;\n        rootState: { tree: { nodeRecord: Record<string, NodeRecordItem> } };\n      },\n      v: { nodeId: string; parentId: string }\n    ) {\n      // get all parents of nodeId until parentID\n      let currentParent = rootState.tree.nodeRecord[v.nodeId].parent;\n      if (!currentParent) {\n        return;\n      }\n      const parentIds = [];\n      while (currentParent && currentParent.id != v.parentId) {\n        parentIds.push(currentParent.id);\n        currentParent = rootState.tree.nodeRecord[currentParent.id].parent;\n      }\n      parentIds.push(v.parentId);\n      // Set them to pins\n      commit(mutations.ADD_TO_PINS, { nodeId: v.nodeId, parentIds });\n\n      // And for each parent add pined node id to it\n      for (const parentId of parentIds) {\n        commit(mutations.ADD_TO_PINS_REVERSE, {\n          nodeId: parentId,\n          pinId: v.nodeId\n        });\n      }\n    },\n    [actions.RemovePin]({ commit }: { commit: Commit }, nodeId: string) {\n      commit(mutations.REMOVE_PIN, nodeId);\n    }\n  },\n  mutations: {\n    [mutations.SET_PINS](state: State, pins: Pins) {\n      state.pins = pins;\n      state.pinsReverse = {};\n      for (const pinId in pins) {\n        for (const parentId of pins[pinId]) {\n          if (!state.pinsReverse[parentId]) {\n            state.pinsReverse[parentId] = [];\n          }\n          state.pinsReverse[parentId].push(pinId);\n        }\n      }\n    },\n    [mutations.ADD_TO_PINS](\n      state: State,\n      v: { nodeId: string; parentIds: string[] }\n    ) {\n      state.pins[v.nodeId] = v.parentIds;\n    },\n    [mutations.ADD_TO_PINS_REVERSE](\n      state: State,\n      v: { nodeId: string; pinId: string }\n    ) {\n      if (!state.pinsReverse[v.nodeId]) {\n        state.pinsReverse[v.nodeId] = [];\n      }\n      state.pinsReverse[v.nodeId].push(v.pinId);\n    },\n    [mutations.REMOVE_PIN](state: State, nodeId: string) {\n      for (const parentId of state.pins[nodeId]) {\n        const index = state.pinsReverse[parentId].indexOf(nodeId);\n        state.pinsReverse[parentId].splice(index, 1);\n      }\n      delete state.pins[nodeId];\n    }\n  }\n};\n","/* eslint-disable  @typescript-eslint/no-explicit-any */\nimport { ErrorKV } from \"@/types/errorkv\";\n\nexport const UNAUTHORIZED = 401;\n\nexport default (\n  message: string,\n  kv: Record<string, any>,\n  code?: number\n): ErrorKV => {\n  const err = new Error(message);\n\n  return {\n    error: err,\n    kv: kv,\n    code\n  };\n};\n","export type Preconditions = Record<\n  string /* id of node with premises */,\n  string[] /* ids of premise nodes */\n>;\n\nexport type ReverseIndex = Record<\n  string /* id of node (A) */,\n  string[] /* ids nodes nodes that has node A as a premise */\n>;\n\nexport interface State {\n  preconditions: Preconditions;\n  reverseIndex: ReverseIndex; // reverse index for preconditions - i e reverseIndex[id1] as nodeID1 means that nodeID1 has id1 as its precondition\n}\n\nexport const mutations = {\n  SET_PRECONDITIONS: \"SET_PRECONDITIONS\",\n  UPDATE_PRECONDITIONS: \"UPDATE_PRECONDITIONS\",\n  REMOVE_PRECONDITION: \"REMOVE_PRECONDITION\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    preconditions: {} as Record<string, string[]>,\n    reverseIndex: {} as Record<string, string[]>\n  },\n  mutations: {\n    /**\n     * Set preconditions for all nodes\n     * @param state\n     * @param preconditions\n     */\n    [mutations.SET_PRECONDITIONS](state: State, preconditions: Preconditions) {\n      state.preconditions = preconditions;\n      state.reverseIndex = {};\n\n      // create reverseIndex\n      for (const id in preconditions) {\n        for (const precondID of preconditions[id]) {\n          if (typeof state.reverseIndex[precondID] === \"undefined\") {\n            state.reverseIndex[precondID] = [];\n          }\n          state.reverseIndex[precondID].push(id);\n        }\n      }\n    },\n\n    /**\n     * Set preconditions for one node\n     * @param state\n     * @param v\n     */\n    [mutations.UPDATE_PRECONDITIONS](\n      state: State,\n      v: { nodeID: string; preconditionIDs: Array<string> }\n    ) {\n      if (!state.preconditions[v.nodeID]) {\n        state.preconditions[v.nodeID] = [];\n      }\n      // remove from reverseIndex old preconditions\n      for (const id of state.preconditions[v.nodeID]) {\n        if (\n          state.reverseIndex[id] &&\n          state.reverseIndex[id].indexOf(v.nodeID) != -1\n        ) {\n          state.reverseIndex[id].splice(\n            state.reverseIndex[id].indexOf(v.nodeID),\n            1\n          );\n        }\n      }\n\n      state.preconditions[v.nodeID] = v.preconditionIDs;\n\n      // add to reverseIndex new preconditions\n      for (const precondID of state.preconditions[v.nodeID]) {\n        if (!state.reverseIndex[precondID]) {\n          state.reverseIndex[precondID] = [];\n        }\n        state.reverseIndex[precondID].push(v.nodeID);\n      }\n    },\n\n    /**\n     * Remove one precondition from one node\n     * @param state\n     * @param v\n     */\n    [mutations.REMOVE_PRECONDITION](\n      state: State,\n      v: { nodeID: string; preconditionID: string }\n    ) {\n      if (!state.preconditions[v.nodeID]) {\n        return;\n      }\n\n      const p = state.preconditions[v.nodeID];\n      if (!p) {\n        return;\n      }\n      if (p.indexOf(v.preconditionID) == -1) {\n        return;\n      }\n      p.splice(p.indexOf(v.preconditionID), 1);\n\n      // remove from reverseIndex\n      if (!state.reverseIndex[v.preconditionID]) {\n        return\n      }\n      if (state.reverseIndex[v.preconditionID].indexOf(v.nodeID) == -1) {\n        return;\n      }\n      state.reverseIndex[v.preconditionID].splice(state.reverseIndex[v.preconditionID].indexOf(v.nodeID), 1);\n    }\n  },\n\n};\n","import {DBImage} from \"@/api/types\";\n\nexport type Images =  Record<string, Record<string, DBImage>>;\n\nexport interface State {\n  images: Images;\n}\n\nexport const mutations = {\n  UPDATE_IMAGES: \"UPDATE_IMAGES\",\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    images: {} as Images,\n  },\n  mutations: {\n    [mutations.UPDATE_IMAGES](state: State, v: {nodeID: string, images: Record<string, DBImage>}) {\n        state.images[v.nodeID] = v.images\n    },\n  }\n};\n","import { DBMapNode } from \"@/api/types\";\nimport { Tree } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\n\n// convert children object to array\nexport function convertChildren(children: any): string[] {\n  let result: string[];\n\n  if (!children) {\n    result = [];\n  } else if (Array.isArray(children)) {\n    result = children.filter(childID => !!childID).sort();\n    result.forEach((childID, i, arr) => (arr[i] = childID.toString()));\n  } else {\n    result = Object.values(children)\n      .filter(childID => !!childID)\n      .sort() as string[];\n    result.forEach((childID, i, arr) => (arr[i] = childID.toString()));\n  }\n  return result;\n}\n\nexport function convertDBMapToTree(\n  dbNodes: Record<string, DBMapNode>\n): [Tree | null, ErrorKV] {\n  const root: Tree = {\n    id: dbNodes[\"0\"].id.toString(),\n    title: dbNodes[\"0\"].name,\n    position: dbNodes[\"0\"].position,\n    children: []\n  };\n  const stack = [root];\n\n  while (stack.length > 0) {\n    const node = stack.pop();\n    if (!node) {\n      continue;\n    }\n    if (!dbNodes[node.id]) {\n      return [\n        null,\n        NewErrorKV(\"Cannot find id in dbNodes\", { \"node.id\": node.id, dbNodes })\n      ];\n    }\n    dbNodes[node.id].children = convertChildren(dbNodes[node.id].children);\n    if (!dbNodes[node.id].children.length) {\n      continue;\n    }\n    const children: Tree[] = [];\n    for (const childID of dbNodes[node.id].children) {\n      if (!dbNodes[childID]) {\n        return [\n          null,\n          NewErrorKV(\"Cannot find child id in dbNodes\", {\n            childID,\n            parentID: node.id\n          })\n        ];\n      }\n      children.push({\n        id: childID.toString(),\n        title: dbNodes[childID].name,\n        position: dbNodes[childID].position,\n        children: []\n      });\n    }\n\n    node.children = children;\n    stack.push(...children);\n  }\n\n  return [root, null];\n}\n","import firebase from \"firebase/compat\";\nimport { Tree } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\nimport axios from \"axios\";\nimport { Pins } from \"@/store/pin\";\nimport {mutations as preconditionMutations, Preconditions} from \"@/store/precondition\";\nimport {mutations as imageMutations} from \"@/store/image\";\nimport { DBMapNode, DBImage} from \"@/api/types\";\nimport { convertChildren } from \"./helpers\";\nimport { NodeComment, NodeContent } from \"@/store/node_content\";\nimport emulatorConfig from \"../../firebase.json\";\nimport { debounce } from \"lodash\";\n\nimport { connectFirestoreEmulator, getFirestore } from \"firebase/firestore\";\nimport {store} from \"@/store\";\n\nconst MAP_FROM_STORAGE = false; // is storage is source for map (or database)\nlet FUNCTION_DOMAIN = \"https://us-central1-sci-map-1982.cloudfunctions.net/\";\n\nconst update = async (data: Record<string, any>): Promise<ErrorKV> => {\n  try {\n    await firebase\n      .database()\n      .ref()\n      .update(data);\n    return null;\n  } catch (e) {\n    return NewErrorKV(\"api: error in update\", { err: e });\n  }\n};\n\nconst debouncedUpdate = debounce(update, 2000);\n\nexport default {\n  ROOT_WIDTH: (2 * window.innerWidth) / 3,\n  ROOT_HEIGHT: window.innerHeight,\n  ROOT_CENTER_X: 0.3 * window.innerWidth + (0.7 * window.innerWidth) / 2,\n  ROOT_CENTER_Y: window.innerHeight / 2,\n  ST_WIDTH: 1000,\n  ST_HEIGHT: 1000,\n  initFirebase() {\n    // Your web app's Firebase configuration\n    // For Firebase JS SDK v7.20.0 and later, measurementId is optional\n    const firebaseConfig = {\n      apiKey: \"AIzaSyCP50k-WOkTeG8BYvRtu4Bo_x3T2RnVsxU\",\n      authDomain: \"sci-map-1982.firebaseapp.com\",\n      databaseURL: \"https://sci-map-1982.firebaseio.com\",\n      projectId: \"sci-map-1982\",\n      storageBucket: \"sci-map-1982.appspot.com\",\n      messagingSenderId: \"340899060236\",\n      appId: \"1:340899060236:web:b136e9289e342a8bb62c29\",\n      measurementId: \"G-TV74Q61H9P\"\n    };\n\n    // Initialize Firebase\n    firebase.initializeApp(firebaseConfig);\n    firebase.analytics();\n\n    if (process.env.VUE_APP_IS_EMULATOR === \"true\") {\n      console.log(\"Starting in emulator mode\");\n      firebase\n        .auth()\n        .useEmulator(`http://localhost:${emulatorConfig.emulators.auth.port}`);\n      firebase\n        .database()\n        .useEmulator(\"localhost\", emulatorConfig.emulators.database.port);\n      firebase\n        .storage()\n        .useEmulator(\"localhost\", emulatorConfig.emulators.storage.port);\n      connectFirestoreEmulator(\n        getFirestore(),\n        \"localhost\",\n        emulatorConfig.emulators.firestore.port\n      );\n      FUNCTION_DOMAIN = \"http://localhost:5001/sci-map-1982/us-central1/\";\n    }\n  },\n\n  async callFunction(\n    method: string,\n    params: Record<string, string>\n  ): Promise<[string, ErrorKV]> {\n    const currentUser = firebase.auth().currentUser;\n    if (!currentUser) {\n      return [\n        \"\",\n        NewErrorKV(\"callFunction: cannot determine current user\", {})\n      ];\n    }\n    params.idToken = await currentUser.getIdToken(true);\n    try {\n      const response = await axios.get(FUNCTION_DOMAIN + method, { params });\n      return [response.data, null];\n    } catch (e) {\n      return [\"\", NewErrorKV(\"Error in callFunction\", { method, params, e })];\n    }\n  },\n\n  async getMapFromDB(): Promise<[Record<string, DBMapNode> | null, ErrorKV]> {\n    const snapshot = await firebase\n      .database()\n      .ref(\"map\")\n      .get();\n    if (!snapshot.exists()) {\n      return [null, NewErrorKV(\"!snapshot.exists\", {})];\n    }\n    const map = snapshot.val();\n\n    return [map, null];\n  },\n\n  /**\n   * TODO: use it to cut costs on DB reads from read-only users\n   * @param user\n   */\n  async getMapFromStorage(\n    user: firebase.User | null\n  ): Promise<[Tree | null, ErrorKV]> {\n    const storage = firebase.storage().ref();\n    let ref = storage.child(`/map.json`);\n    if (user) {\n      ref = storage.child(`/user/${user.uid}/map.json`);\n    }\n    const url = await ref.getDownloadURL();\n\n    const response = await axios.get(url);\n    return [\n      {\n        id: \"0\",\n        title: \"\",\n        position: { x: this.ROOT_WIDTH / 2, y: this.ROOT_HEIGHT / 2 },\n        // children: apiTree.children\n        children: response.data\n      },\n      null\n    ];\n  },\n\n  async getMap(\n    user: firebase.User | null\n  ): Promise<[Record<string, DBMapNode> | null, ErrorKV]> {\n    try {\n      return await this.getMapFromDB();\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async getPins(user: firebase.User | null): Promise<[Pins | null, ErrorKV]> {\n    try {\n      if (user == null) {\n        // for anonymous use general pins\n        const storage = firebase.storage().ref();\n        const ref = storage.child(`/pins.json`);\n        const url = await ref.getDownloadURL();\n\n        const response = await axios.get(url);\n        return [response.data, null];\n      } else {\n        // for authenticated user use realtime database\n        const snapshot = await firebase\n          .database()\n          .ref(`user_data/${user.uid}/pins`)\n          .get();\n        if (!snapshot.exists()) {\n          return [null, NewErrorKV(\"!snapshot.exists\", {})];\n        }\n        return [snapshot.val(), null];\n      }\n\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async savePins(user: firebase.User, pins: Pins) {\n    if (!user) {\n      return;\n    }\n    await firebase\n      .database()\n      .ref(`user_data/${user.uid}/pins`).set(pins);\n  },\n\n  /**\n   * getSubscriptions\n   * @param user\n   */\n  async getSubscriptions(user: firebase.User | null): Promise<[Pins | null, ErrorKV]> {\n    if (!user) {\n      return [null, null]\n    }\n    try {\n      // for authenticated user use realtime database\n      const snapshot = await firebase\n        .database()\n        .ref(`user_subscription/${user.uid}`)\n        .get();\n      if (!snapshot.exists()) {\n        return [null, NewErrorKV(\"!snapshot.exists\", {})];\n      }\n      return [snapshot.val(), null];\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  /**\n   * setSubscription\n   * @param user\n   * @param v\n   */\n  async setSubscription(user: firebase.User | null, v:{nodeID: string, mode: number | null}) {\n    if (!user) {\n      return;\n    }\n    await firebase\n      .database()\n      .ref(`user_subscription/${user.uid}/${v.nodeID}`).set(v.mode);\n  },\n\n  async getPreconditions(\n    user: firebase.User | null\n  ): Promise<[Preconditions | null, ErrorKV]> {\n    try {\n      const snapshot = await firebase\n        .database()\n        .ref(\"precondition\")\n        .get();\n      if (!snapshot.exists()) {\n        return [null, NewErrorKV(\"!snapshot.exists\", {})];\n      }\n      const preconditions = snapshot.val();\n\n      return [preconditions, null];\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async savePreconditions(\n    user: firebase.User | null,\n    preconditions: { nodeId: string; preconditionIds: string[] }\n  ) {\n    if (!user) {\n      return;\n    }\n    await firebase\n      .database()\n      .ref(\"precondition/\" + preconditions.nodeId)\n      .set(preconditions.preconditionIds);\n  },\n\n  subscribeMapNodeChange(nodeID: string, cb: (a: DBMapNode) => any) {\n    this.subscribeDBChange(\n      `map/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const node = snap.val() as DBMapNode;\n        // console.log('got update for map node', node)\n        node.id = node.id.toString();\n        node.children = convertChildren(node.children);\n        cb(node);\n      }\n    );\n  },\n\n  subscribeNodeContentChange(\n    nodeID: string,\n    cb: (a: { nodeID: string; content: string }) => any\n  ) {\n    this.subscribeDBChange(\n      `node_content/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const node = snap.val() as { nodeID: string; content: string };\n        // console.log('got update for node content', node)\n        cb(node);\n      }\n    );\n  },\n\n  subscribePreconditionNodeChange(\n    nodeID: string,\n  ) {\n    this.subscribeDBChange(\n      `precondition/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const preconditionIDs = snap.val() as Array<string>;\n        store.commit(\n          `precondition/${preconditionMutations.UPDATE_PRECONDITIONS}`,\n          { nodeID: nodeID, preconditionIDs: preconditionIDs }\n        );\n      }\n    );\n  },\n\n  subscribeNodeImageChange(\n    nodeID: string,\n  ) {\n    this.subscribeDBChange(\n      `node_image/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const images = snap.val() as Record<string, DBImage>;\n        store.commit(\n          `image/${imageMutations.UPDATE_IMAGES}`,\n          {nodeID, images}\n        );\n      }\n    );\n  },\n\n  subscribeDBChange(\n    path: string,\n    cb: (a: firebase.database.DataSnapshot) => any\n  ) {\n    firebase\n      .database()\n      .ref(path)\n      .on(\"value\", cb);\n  },\n\n  unsubscribeDBChange(\n    path: string,\n    cb?: (a: firebase.database.DataSnapshot) => any\n  ) {\n    firebase\n      .database()\n      .ref(path)\n      .off(\"value\", cb);\n  },\n\n  async transaction(nodeID: string, update: (val: any) => any) {\n    await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .transaction(\n        update,\n        () => {\n          return;\n        },\n        false\n      );\n  },\n\n  async setPublicUserData(\n    userID: string,\n    displayName: string | null,\n    discordName: string | null\n  ) {\n    try {\n      await firebase\n        .database()\n        .ref(\"public_user_data/\" + userID)\n        .set({\n          displayName,\n          discordName\n        });\n    } catch (e) {\n      console.error(e);\n    }\n  },\n\n  async getMapNode(nodeID: string): Promise<DBMapNode | null> {\n    const pr = await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .get();\n    const node = pr.val();\n    if (!node) {\n      console.error(\"got null fetching from map/nodeID\", nodeID)\n      return null\n    }\n    node.id = node.id.toString();\n    node.children = convertChildren(node.children);\n    return node;\n  },\n\n  async getTrashNode(nodeID: string, type: string): Promise<DBMapNode | null> {\n    const pr = await firebase\n      .database()\n      .ref(`trash/${nodeID}/${type}`)\n      .get();\n    return pr.val();\n  },\n\n  generateKey(): string | null {\n    return firebase\n      .database()\n      .ref()\n      .push().key;\n  },\n\n  async findKeyInList(path: string, value: string): Promise<string | null> {\n    const snap = await firebase\n      .database()\n      .ref(path)\n      .orderByValue()\n      .equalTo(value)\n      .limitToFirst(1)\n      .get();\n    return snap.key;\n  },\n\n  async findKeyOfChild(\n    nodeID: string,\n    childID: string\n  ): Promise<string | null> {\n    const pr = await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .get();\n    const node = pr.val();\n    if (!node.children) {\n      return null;\n    }\n\n    for (const key in node.children) {\n      if (node.children[key].toString() === childID) {\n        return key;\n      }\n    }\n    return null;\n  },\n\n  update,\n  debouncedUpdate,\n\n  /**\n   * getUserSubscribePeriod\n   * @param user\n   */\n  async getUserSubscribePeriod(\n    user: firebase.User | null\n  ): Promise<string> {\n    if (!user) {\n      return ''\n    }\n    const userID = user.uid;\n    const snapshot = await firebase\n      .database()\n      .ref(`user_data/${userID}/subscribe_period`)\n      .get();\n    if (!snapshot.exists()) {\n      return '';\n    }\n    return snapshot.val();\n  },\n\n  /**\n   * setUserSubscribePeriod\n   * @param user\n   * @param period\n   */\n  async setUserSubscribePeriod(\n    user: firebase.User,\n    period: string,\n  ){\n    const userID = user.uid;\n    return await firebase\n      .database()\n      .ref(`user_data/${userID}/subscribe_period`)\n      .set(period);\n  },\n\n  /**\n   * setUserSearchPhrase\n   * @param userID\n   * @param searchPhrase\n   */\n  async setUserLastSearch(\n    userID: string,\n    searchPhrase: string,\n  ){\n    return await firebase\n      .database()\n      .ref(`user_data/${userID}/last_search`)\n      .set(searchPhrase);\n  },\n\n  async getUserComments(\n    user: firebase.User\n  ): Promise<[Record<string, NodeComment> | null, ErrorKV]> {\n    const userID = user.uid;\n    const snapshot = await firebase\n      .database()\n      .ref(`user_data/${userID}/comment`)\n      .get();\n    if (!snapshot.exists()) {\n      return [null, NewErrorKV(\"!snapshot.exists\", {})];\n    }\n    const nodeComment = snapshot.val();\n\n    return [nodeComment, null];\n  },\n\n  async getNodeContent(): Promise<\n    [Record<string, NodeContent> | null, ErrorKV]\n  > {\n    const snapshot = await firebase\n      .database()\n      .ref(`node_content`)\n      .get();\n\n    if (!snapshot.exists()) {\n      return [{}, null];\n    }\n\n    return [snapshot.val(), null];\n  }\n};\n","import { Commit } from \"vuex\";\nimport firebase from \"firebase/compat\";\nimport api from \"@/api/api\";\n\nexport type Subscriptions = Record<\n  string /* node_id user is subscribed on */,\n  number\n>;\n\nexport interface State {\n  subscriptions: Subscriptions;\n}\n\nexport const mutations = {\n  SET_SUBSCRIPTIONS: \"SET_SUBSCRIPTIONS\",\n  SET_SUBSCRIPTION: \"SET_SUBSCRIPTION\",\n};\n\nexport const actions = {\n  ToggleSubscription: \"ToggleSubscription\",\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    subscriptions: {},\n  },\n  actions: {\n    /**\n     * ToggleSubscription\n     * @param commit\n     * @param state\n     * @param rootState\n     * @param nodeID\n     */\n    [actions.ToggleSubscription](\n      {\n        commit, state, rootState\n      }: {\n        commit: Commit;\n        state: State;\n        rootState: { user: { user: firebase.User | null } };\n      },\n      nodeID: string\n    ) {\n      const v = {nodeID: nodeID, mode: 0} as {nodeID: string, mode: number | null}\n      if (!state.subscriptions[nodeID] || state.subscriptions[nodeID] == 0) {\n        v.mode = 1\n      } else if (state.subscriptions[nodeID] == 1) {\n        v.mode = null\n      }\n      commit(mutations.SET_SUBSCRIPTION, v);\n      api.setSubscription(rootState.user.user, v);\n    },\n  },\n  mutations: {\n    /**\n     * SET_SUBSCRIPTIONS\n     * @param state\n     * @param subscriptions\n     */\n    [mutations.SET_SUBSCRIPTIONS](state: State, subscriptions: Subscriptions) {\n      if (!subscriptions) {\n        state.subscriptions = {};\n      } else {\n        state.subscriptions = subscriptions\n      }\n    },\n\n    /**\n     * SET_SUBSCRIPTION\n     * @param state\n     * @param v\n     */\n    [mutations.SET_SUBSCRIPTION](\n      state: State,\n      v: {nodeID: string, mode: number}\n    ) {\n      if (v.mode>0) {\n        state.subscriptions[v.nodeID] = v.mode;\n      } else {\n        delete state.subscriptions[v.nodeID];\n      }\n    },\n  }\n};\n","export type TitleBox = {\n  position: {\n    x: number;\n    y: number;\n  };\n  bbox: {\n    width: number;\n    height: number;\n  };\n};\n\nexport type TitleBoxMap = Record<\n  string /* node_id */,\n  TitleBox /* title box attributes */\n>;\n\nexport interface State {\n  layerMap: Record<string, TitleBoxMap>;\n}\n\nexport const mutations = {\n  SET_MAP: \"SET_MAP\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    layerMap: {}\n  },\n  mutations: {\n    [mutations.SET_MAP](\n      state: State,\n      v: { layerName: string; titleBoxMap: TitleBoxMap }\n    ) {\n      state.layerMap[v.layerName] = v.titleBoxMap;\n    }\n  }\n};\n","/**\n * This store contains nodeIDs that is permitted to move (change positions)\n * The idea is to restrict position change only for just added nodes and its neighbours\n * Otherwise there is risk that everybody will to do little tweaks in node coordinates that will\n * sum up in constant map visual mess\n */\nimport { Commit, Dispatch } from \"vuex\";\nconst PERMISSION_TIMEOUT = 60 * 60 * 1000; // time after which permit is revoked (in milliseconds)\n\nexport const mutations = {\n  ADD_NODES: \"ADD_NODES\",\n  REMOVE_NODES: \"REMOVE_NODES\"\n};\n\nexport const actions = {\n  CheckNodeID: \"CheckNodeID\"\n};\n\nexport interface State {\n  permittedNodeIDs: Record<string, number>; // key is nodeID, value is created_at\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    permittedNodeIDs: {}\n  },\n  mutations: {\n    [mutations.ADD_NODES](state: State, nodeIDs: string) {\n      for (const nodeID of nodeIDs) {\n        state.permittedNodeIDs[nodeID] = new Date().getTime();\n      }\n    },\n    [mutations.REMOVE_NODES](state: State, nodeIDs: string) {\n      for (const nodeID of nodeIDs) {\n        delete state.permittedNodeIDs[nodeID];\n      }\n    }\n  },\n  actions: {\n    [actions.CheckNodeID](\n      { commit, state }: { commit: Commit; state: State },\n      nodeID: string\n    ) {\n      if (\n        !!state.permittedNodeIDs[nodeID] &&\n        new Date().getTime() <\n          state.permittedNodeIDs[nodeID] + PERMISSION_TIMEOUT\n      ) {\n        return true;\n      }\n      if (state.permittedNodeIDs[nodeID]) {\n        commit(mutations.REMOVE_NODES, [nodeID]);\n      }\n      return false;\n    }\n  }\n};\n","import { cloneDeep } from \"lodash\";\nimport { Point, Tree, TreeSkeleton, Viewport } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\nimport { getBoundingBorders, getVoronoiCells } from \"../tools/graphics\";\n\nexport const ROUND_EPSILON = 0;\n\n/**\n * Correct modulo on negative numbers\n * @param n\n * @param m\n */\nexport function mod(n: number, m: number): number {\n  return ((n % m) + m) % m;\n}\n\nexport function round(num: number): number {\n  const t = Math.pow(10, ROUND_EPSILON);\n  return Math.round(num * t) / t;\n}\n\nexport function sleep(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/* eslint-disable  @typescript-eslint/no-explicit-any */\nexport function clone(v: any): any {\n  return cloneDeep(v);\n}\n\nexport function generateTreeSkeleton(\n  levelsNum: number,\n  numOnLevel: number\n): TreeSkeleton {\n  let globalID = 0;\n  const root = { id: String(globalID), children: [] };\n  let toProcess: TreeSkeleton[] = [root];\n  for (let i = 1; i < levelsNum; i++) {\n    const nextToProcess = [];\n    while (toProcess.length) {\n      const node = toProcess.shift();\n      node!.children = [];\n      for (let j = 0; j < numOnLevel; j++) {\n        globalID++;\n        const child = { id: String(globalID) };\n        node!.children.push(child);\n        nextToProcess.push(child);\n      }\n    }\n    toProcess = nextToProcess;\n  }\n\n  return root;\n}\n\n/**\n * Fill TreeSkeleton with default values to make real Tree\n * @param sk\n */\nexport function skeletonToTree(sk: TreeSkeleton, idAsTitle: boolean): Tree {\n  const res = clone(sk);\n  const stack: TreeSkeleton[] = [res];\n  while (stack.length) {\n    const node = stack.pop();\n    if (!node) {\n      continue;\n    }\n    node.id = String(node.id);\n    if (!node.title) {\n      node.title = idAsTitle ? String(node.id) : \"\";\n    }\n    if (!node.position) {\n      node.position = { x: 0, y: 0 };\n    }\n    if (!node.children) {\n      node.children = [];\n    }\n    stack.push(...node.children);\n  }\n  return res;\n}\n\n/**\n * Traverse tree and fill position\n */\nexport function fillTreePositions(\n  tree: Tree,\n  rootWH: Viewport\n): ErrorKV | null {\n  if (tree.id !== \"0\") {\n    return NewErrorKV(\"fillTreePositions: root node id must be '0'\", { tree });\n  }\n  tree.position = { x: rootWH.width / 2, y: rootWH.height / 2 };\n  const nodeBorders: Record<string, { topLeft: Point; bottomRight: Point }> = {\n    0: {\n      topLeft: { x: 0, y: 0 },\n      bottomRight: { x: rootWH.width, y: rootWH.height }\n    }\n  };\n  const stack: Tree[] = [tree];\n  while (stack.length) {\n    const node = stack.pop();\n    if (!node || !node.children || !node.children.length) {\n      continue;\n    }\n    const borderBox = nodeBorders[node.id];\n    const height = borderBox.bottomRight.y - borderBox.topLeft.y;\n    const width = borderBox.bottomRight.x - borderBox.topLeft.x;\n    if (height > width) {\n      for (const i in node.children) {\n        node.children[i].position = {\n          x: node.position!.x,\n          y:\n            borderBox.topLeft.y +\n            (Number(i) + 1 / 2) * (height / node.children.length)\n        };\n      }\n    } else {\n      for (const i in node.children) {\n        node.children[i].position = {\n          x:\n            borderBox.topLeft.x +\n            ((Number(i) + 1 / 2) * width) / node.children.length,\n          y: node.position!.y\n        };\n      }\n    }\n\n    // compute children borders as voronoi cells bounding boxes\n    const [cells, err] = getVoronoiCells(\n      [\n        { x: borderBox.topLeft.x, y: borderBox.topLeft.y },\n        { x: borderBox.bottomRight.x, y: borderBox.topLeft.y },\n        { x: borderBox.bottomRight.x, y: borderBox.bottomRight.y },\n        { x: borderBox.topLeft.x, y: borderBox.bottomRight.y }\n      ],\n      node.children.map(ch => ch.position)\n    );\n    if (err) {\n      return NewErrorKV(\"fillTreePositions: error in getVoronoiCells\", { err });\n    }\n    for (const i in cells) {\n      const cellBBox = getBoundingBorders(cells[i].border);\n      nodeBorders[node.children[i].id] = {\n        topLeft: cellBBox.leftBottom,\n        bottomRight: cellBBox.rightTop\n      };\n    }\n\n    stack.push(...node.children);\n  }\n\n  return null;\n}\n\nexport function printError(msg: string, kv: any) {\n  if (!kv) {\n    console.error(msg);\n  }\n\n  // const callback = function(stackframes: StackFrame[]) {\n  //   const stringifiedStack = stackframes.map(function(sf) {\n  //     return sf.toString();\n  //   }).join('\\n');\n  //   console.error(msg, stringifiedStack);\n  // };\n  //\n  // const errBack = function(e: Error) { console.log(e.message); };\n  //\n  const kvArr = [];\n  for (const i in kv) {\n    kvArr.push(i, kv[i]);\n    // if (kv[i] instanceof Error) {\n    //   StackTrace.get({offline: true}).then(callback).catch(errBack);\n    // }\n  }\n\n  console.error(msg, ...kvArr);\n}\n","import { MapNode, Point, Tree } from \"@/types/graphics\";\nimport {\n  convertPosition,\n  getMaxDiagonal,\n  getVectorLength,\n  mergeMapNodeLayers,\n  treeToMapNodeLayers,\n  vectorOnNumber\n} from \"../../tools/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../../tools/errorkv\";\nimport { clone } from \"../../tools/utils\";\nimport { NodeRecordItem } from \"@/store/tree/index\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport function findMapNode(\n  id: string,\n  mapNodeLayers: Array<Record<string, MapNode>>\n): [MapNode | null, number | null] {\n  for (const level in mapNodeLayers) {\n    const layer = mapNodeLayers[Number(level)];\n    if (layer && layer[id]) {\n      return [layer[id], Number(level)];\n    }\n  }\n\n  return [null, null];\n}\n\nexport function findMapNodes(\n  ids: string[],\n  mapNodeLayers: Array<Record<string, MapNode>>\n): MapNode[] {\n  const result: MapNode[] = [];\n  for (const layer of mapNodeLayers) {\n    if (!layer) {\n      continue;\n    }\n    for (const id of ids) {\n      if (layer[id]) {\n        result.push(layer[id]);\n      }\n    }\n  }\n\n  return result;\n}\n\nexport function createNewNode(title: string, center: Point): Tree {\n  return {\n    id: uuidv4(),\n    position: center,\n    title: title,\n    children: []\n  } as Tree;\n}\n\n/**\n * Вычисляет где можно поставить центр для нового подузла узла parent\n *\n * Логика добавления следующая.\n * Обозначим координаты центра узла parent как (Xc, Yc)\n * Если в узле нет ни одного подузла, то находим наибольшее расстояние между (Xc, Yc)\n * и вершинами границы, делим вектор соединяющий (Xc, Yc) и эту вершину пополам\n * и ставим там центр нового подузла\n *\n * Если в узле есть подузлы, берем подузел с наибольшей диагональю,\n * находим в нем наибольшую диагональ соединяющую 2 вершины границы,\n * делим ее пополам, старый центр ставим в центре одной половины, новый в центре другой.\n *\n * Добавляем рандом (см баг https://sci-map.atlassian.net/browse/SM-118)\n * @param parent\n * @param mapNodeLayers\n * @param addRandom\n */\nexport function getNewNodeCenter(\n  parent: Tree,\n  mapNodeLayers: Array<Record<number, MapNode>>,\n  addRandom: boolean\n): [\n  Point | null, // new node center\n  Tree | null, // existing node with corrected center (if any)\n  ErrorKV // error (if any)\n] {\n  const [parentMapNode] = findMapNode(parent.id, mapNodeLayers);\n  if (parentMapNode === null) {\n    return [\n      null,\n      null,\n      NewErrorKV(\"getNewNodeCenter: cannot find mapNode for parent\", {\n        parentId: parent.id,\n        mapNodeLayers: mapNodeLayers\n      })\n    ];\n  }\n\n  if (parent.children.length === 0) {\n    const fromCenterVectors = parentMapNode.border.map(p => ({\n      from: parentMapNode.center,\n      to: p\n    }));\n    let maxFromCenterVector = fromCenterVectors[0];\n    for (const v of fromCenterVectors) {\n      if (getVectorLength(v) > getVectorLength(maxFromCenterVector)) {\n        maxFromCenterVector = v;\n      }\n    }\n\n    let coeff = 1 / 2;\n    if (addRandom) {\n      coeff = Math.random() * (1 / 2) + 1 / 4;\n    }\n\n    return [\n      {\n        x:\n          maxFromCenterVector.from.x +\n          coeff * (maxFromCenterVector.to.x - maxFromCenterVector.from.x),\n        y:\n          maxFromCenterVector.from.y +\n          coeff * (maxFromCenterVector.to.y - maxFromCenterVector.from.y)\n      },\n      null,\n      null\n    ];\n  } else {\n    const maxDiagChild = parent.children[0];\n    let [maxDiagChildMapNode] = findMapNode(maxDiagChild.id, mapNodeLayers);\n    if (maxDiagChildMapNode === null) {\n      return [\n        null,\n        null,\n        NewErrorKV(\"getNewNodeCenter: cannot find maxDiagChild in layers\", {\n          maxDiagChildId: maxDiagChild.id,\n          mapNodeLayers: mapNodeLayers\n        })\n      ];\n    }\n    for (const child of parent.children) {\n      const [childMapNode] = findMapNode(child.id, mapNodeLayers);\n      if (childMapNode === null) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: cannot find child in layers\", {\n            childId: child.id,\n            mapNodeLayers: mapNodeLayers\n          })\n        ];\n      }\n\n      const [childDiag, err1] = getMaxDiagonal(childMapNode.border);\n      if (err1) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: error getMaxDiagonal\", {\n            childMapNode,\n            err1\n          })\n        ];\n      }\n      const [maxDiag, err2] = getMaxDiagonal(maxDiagChildMapNode.border);\n      if (err2) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: error getMaxDiagonal\", {\n            maxDiagChildMapNode,\n            err2\n          })\n        ];\n      }\n      if (getVectorLength(childDiag) > getVectorLength(maxDiag)) {\n        maxDiagChildMapNode = childMapNode;\n      }\n    }\n\n    let coeff = 3 / 4;\n    if (addRandom) {\n      coeff = Math.random() * (1 / 4) + 2.5 / 4;\n    }\n\n    const [finalMaxDiag] = getMaxDiagonal(maxDiagChildMapNode.border);\n    const newNodeCenter = vectorOnNumber(finalMaxDiag!, coeff).to;\n    const modifiedNode = clone(maxDiagChild);\n    modifiedNode.position = vectorOnNumber(finalMaxDiag!, 1 / 4).to;\n    return [newNodeCenter, modifiedNode, null];\n  }\n}\n\nexport function updatePosition(\n  state: {\n    tree: Tree | null;\n    nodeRecord: Record<string, NodeRecordItem>;\n    mapNodeLayers: Array<Record<string, MapNode>>;\n  },\n  v: { nodeId: string; position: Point }\n): ErrorKV {\n  if (state.tree == null) {\n    return NewErrorKV(\"state.tree == null\", {});\n  }\n\n  const item = state.nodeRecord[v.nodeId];\n  if (!item) {\n    return NewErrorKV(\"updateNodePosition: cannot find node in nodeRecord\", {\n      \"v.nodeId\": v.nodeId,\n      \"state.nodeRecord\": state.nodeRecord\n    });\n  }\n\n  if (!item.parent) {\n    return NewErrorKV(\"updateNodePosition: cannot move root of tree\", {\n      \"v.nodeId\": v.nodeId\n    });\n  }\n\n  const [normalizedPosition] = convertPosition(\n    \"normalize\",\n    v.position,\n    item.parent.id,\n    state.mapNodeLayers\n  );\n  item.node.position = normalizedPosition!;\n\n  // Если мы меняем один узел, то могут поменяться границы всех соседей\n  // так что надо действовать так как будто поменялись границы всех подузлов родителя узла\n  const [parentMapNode, layerLevel] = findMapNode(\n    item.parent.id,\n    state.mapNodeLayers\n  );\n  if (!parentMapNode || layerLevel === null) {\n    return NewErrorKV(\"updateNodePosition: cannot find mapNode for parent\", {\n      id: item.parent.id,\n      \"state.mapNodeLayers\": state.mapNodeLayers\n    });\n  }\n  const [ls, err] = treeToMapNodeLayers(\n    item.parent,\n    parentMapNode.border,\n    parentMapNode.center\n  );\n  if (ls == null || err != null) {\n    return NewErrorKV(\"updateNodePosition: create layers for parent\", {\n      id: item.parent.id,\n      parentMapNode: parentMapNode\n    });\n  }\n  return mergeMapNodeLayers(state.mapNodeLayers, ls, layerLevel);\n}\n","import {\n  Tree,\n  Point,\n  Polygon,\n  VoronoiCell,\n  MapNode,\n  Vector,\n  Rectangle\n} from \"@/types/graphics\";\nimport * as turf from \"@turf/turf\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport { default as NewErrorKV } from \"../tools/errorkv\";\nimport { NodeRecordItem } from \"@/store/tree\";\nimport { polygonArea } from \"d3-polygon\";\nimport polygonClipping from \"polygon-clipping\";\nimport { clone, mod, round } from \"../tools/utils\";\nimport { findMapNode } from \"../store/tree/helpers\";\nimport api from \"../api/api\";\n\nconst NORMALIZED_BORDER = [\n  { x: 0, y: 0 },\n  { x: 0, y: api.ST_HEIGHT },\n  { x: api.ST_WIDTH, y: api.ST_HEIGHT },\n  { x: api.ST_WIDTH, y: 0 }\n];\n\nexport function getVectorLength(v: Vector): number {\n  return Math.sqrt(\n    Math.pow(v.from.x - v.to.x, 2) + Math.pow(v.from.y - v.to.y, 2)\n  );\n}\n\nexport function polygonToTurf(\n  p: Polygon\n): turf.Feature<turf.Polygon, turf.Properties> {\n  if (!p) {\n    throw new Error(\"polygonToTurf: p is empty\");\n  }\n  const pp = p.map(point => [point.x, point.y]);\n  pp.push([p[0].x, p[0].y]);\n  return turf.polygon([pp]);\n}\n\nexport function isInside(point: Point, polygon: Polygon): boolean {\n  return turf.booleanPointInPolygon(\n    turf.point([point.x, point.y]),\n    polygonToTurf(polygon)\n  );\n}\n\nexport function polygonToPCPolygon(p: Polygon): polygonClipping.Polygon {\n  const pp = p.map(point => [point.x, point.y] as polygonClipping.Pair);\n  pp.push([p[0].x, p[0].y]);\n  return [pp];\n}\n\nexport function area(p: Polygon): number {\n  return Math.abs(polygonArea(p.map(point => [point.x, point.y])));\n}\n\nexport function intersect(\n  p1: Polygon,\n  p2: Polygon\n): [Polygon[] | null, ErrorKV] {\n  // polygonClipping.intersection does not like digits after point\n  // so we find the least multiplier that gives area > 1000 for polygon\n  // and then round coordinates\n  let np1: Polygon = clone(p1);\n  let np2: Polygon = clone(p2);\n  let cf = 1;\n  while (area(np1) < 1000 && area(np2) < 1000) {\n    cf = cf * 10;\n    np1 = p1.map(p => ({ x: p.x * cf, y: p.y * cf }));\n    np2 = p2.map(p => ({ x: p.x * cf, y: p.y * cf }));\n  }\n  np1 = np1.map(p => ({ x: round(p.x), y: round(p.y) }));\n  np2 = np2.map(p => ({ x: round(p.x), y: round(p.y) }));\n\n  const tp1 = polygonToPCPolygon(np1);\n  const tp2 = polygonToPCPolygon(np2);\n  if (tp1 == null || tp2 == null) {\n    return [\n      null,\n      NewErrorKV(\"intersect: error in polygonToPCPolygon\", { p1: p1, p2: p2 })\n    ];\n  }\n\n  // polygonClipping.intersection\n  const polygonIntersect = polygonClipping.intersection(tp1, tp2);\n  if (polygonIntersect == null || !polygonIntersect.length) {\n    return [[], null];\n  }\n\n  const resultPolys = [];\n\n  for (const poly of polygonIntersect[0]) {\n    const resultPoly = [];\n    for (const p of poly) {\n      resultPoly.push({ x: p[0] / cf, y: p[1] / cf });\n    }\n    // удаляем последнюю точку полигона потому что она всегда совпадает с первой\n    resultPoly.pop();\n    resultPolys.push(resultPoly);\n  }\n\n  return [resultPolys, null];\n}\n\n// Возвращает левый нижний и правый верхний углы описанного вокруг Polygon квадрата\nexport function getBoundingBorders(border: Polygon): Rectangle {\n  if (!border) {\n    console.error(\"bad border\", border);\n  }\n  const minX = border.reduce((previousValue, currentValue) =>\n    previousValue.x > currentValue.x ? currentValue : previousValue\n  ).x;\n  const minY = border.reduce((previousValue, currentValue) =>\n    previousValue.y > currentValue.y ? currentValue : previousValue\n  ).y;\n  const maxX = border.reduce((previousValue, currentValue) =>\n    previousValue.x < currentValue.x ? currentValue : previousValue\n  ).x;\n  const maxY = border.reduce((previousValue, currentValue) =>\n    previousValue.y < currentValue.y ? currentValue : previousValue\n  ).y;\n  return {\n    leftBottom: { x: minX, y: minY },\n    rightTop: { x: maxX, y: maxY }\n  };\n}\n\nexport function getVoronoiCellsInSquare(\n  centers: Point[],\n  leftBottom: Point,\n  rightTop: Point\n): [Record<number, Polygon>, ErrorKV] {\n  const turfPoints = centers.map(p => turf.point([p.x, p.y]));\n  const collection = turf.featureCollection(turfPoints);\n  const cells = turf.voronoi(collection, {\n    bbox: [leftBottom.x, leftBottom.y, rightTop.x, rightTop.y]\n  });\n  const cellMap: Record<number, Polygon> = {};\n  let index = 0;\n  for (const cell of cells.features) {\n    if (!cell) {\n      return [\n        {},\n        NewErrorKV(\"getVoronoiCellsInSquare: undefined cell\", {\n          centers,\n          leftBottom,\n          rightTop,\n          cells\n        })\n      ];\n    }\n    const cellBorder = cell.geometry!.coordinates[0].map(p => ({\n      x: p[0],\n      y: p[1]\n    }));\n    cellBorder.pop(); // удаляем последнюю точку полигона потому что она всегда совпадает с первой\n    cellMap[index] = cellBorder;\n    index++;\n  }\n\n  return [cellMap, null];\n}\n\nexport function getVoronoiCells(\n  outerBorder: Polygon, //(граница массива точек)\n  centers: Point[] //(точки внутри этой границы)\n): [VoronoiCell[], ErrorKV] {\n  if (!outerBorder) {\n    return [\n      [],\n      NewErrorKV(\"getVoronoiCells: bad outerBorder\", { outerBorder, centers })\n    ];\n  }\n  const bb = getBoundingBorders(outerBorder);\n  const [cellMap, err] = getVoronoiCellsInSquare(\n    centers,\n    bb.leftBottom,\n    bb.rightTop\n  );\n  if (err) {\n    return [\n      [],\n      NewErrorKV(\"getVoronoiCells: error in getVoronoiCellsInSquare\", {\n        err,\n        bb,\n        centers\n      })\n    ];\n  }\n\n  const res = [];\n  for (const index in centers) {\n    if (!cellMap[index]) {\n      return [\n        [],\n        NewErrorKV(\"Cannot find index in cellMap\", {\n          index: index,\n          centers: centers,\n          cellMap: cellMap,\n          BoundingBorders: bb,\n          outerBorder\n        })\n      ];\n    }\n\n    const [intersections, err] = intersect(cellMap[index], outerBorder); // мы хотим чтобы граница всех cell совпадала с outerBorder\n    if (intersections == null || err != null) {\n      return [\n        [],\n        NewErrorKV(\"getVoronoiCells error\", {\n          err,\n          cellBorder: cellMap[index],\n          outerBorder\n        })\n      ];\n    }\n\n    if (intersections == []) {\n      return [\n        [],\n        NewErrorKV(\"Voronoi cell has no intersection with outerBorder\", {\n          point: centers[index]\n        })\n      ];\n    }\n    if (intersections.length > 1) {\n      return [\n        [],\n        NewErrorKV(\n          \"Voronoi cell has more than one intersection with outerBorder\",\n          { point: centers[index] }\n        )\n      ];\n    }\n    res.push({\n      border: intersections[0],\n      center: centers[index]\n    });\n  }\n\n  return [res, null];\n}\n\nexport function getVoronoiCellRecords(\n  outerBorder: Polygon, //(граница массива точек)\n  centers: Record<string, Point> //(точки внутри этой границы)\n): [Record<string, Polygon>, ErrorKV] {\n  const result: Record<string, Polygon> = {};\n  const ids: string[] = [];\n  const centersArray: Point[] = [];\n  for (const id in centers) {\n    ids.push(id);\n    centersArray.push(centers[id]);\n  }\n\n  const [cells, err] = getVoronoiCells(outerBorder, centersArray);\n  if (err !== null) {\n    return [{}, err];\n  }\n  for (const i in ids) {\n    result[ids[i]] = cells[i].border;\n  }\n\n  return [result, null];\n}\n\nexport function polygonFill(\n  selectedNodeId: string,\n  currentNodeId: string,\n  selectedNodePreconditionIds: string[]\n): string {\n  if (selectedNodeId && selectedNodeId == currentNodeId) {\n    return \"#f3afaf\";\n  }\n  if (\n    selectedNodePreconditionIds &&\n    selectedNodePreconditionIds.indexOf(currentNodeId) != -1\n  ) {\n    return \"#62f363\";\n  }\n  return \"transparent\";\n}\n\nexport function polygonFillOpacity(\n  selectedNodeId: string,\n  currentNodeId: string,\n  selectedNodePreconditionIds: string[]\n): string {\n  if (selectedNodeId && selectedNodeId == currentNodeId) {\n    return \"0.2\";\n  }\n  if (\n    selectedNodePreconditionIds &&\n    selectedNodePreconditionIds.indexOf(currentNodeId) != -1\n  ) {\n    return \"0.2\";\n  }\n  return \"0\";\n}\n\nexport function polygonToPath(polygon: Polygon): string {\n  return polygon.map((point: Point) => `${point.x} ${point.y}`).join(\",\");\n}\n\nexport function treeToNodeRecord(tree: Tree): Record<number, NodeRecordItem> {\n  const nodeRecord: Record<string, NodeRecordItem> = {};\n  const stack: NodeRecordItem[] = [{ node: tree, parent: null }];\n  while (stack.length) {\n    const item = stack.pop();\n    if (!item) {\n      break;\n    }\n    nodeRecord[item.node.id] = item;\n    stack.push(\n      ...item.node.children.map(child => ({\n        node: child,\n        parent: item.node\n      }))\n    );\n  }\n\n  return nodeRecord;\n}\n\nexport function transferToPoint(vector: Vector, point: Point): Vector {\n  return {\n    from: {\n      x: point.x,\n      y: point.y\n    },\n    to: {\n      x: point.x + (vector.to.x - vector.from.x),\n      y: point.y + (vector.to.y - vector.from.y)\n    }\n  };\n}\n\nexport function pointToVector(p: Point): Vector {\n  return { from: { x: 0, y: 0 }, to: p };\n}\n\nexport function addVector(a: Vector, b: Vector): Vector {\n  const bTransferred = transferToPoint(b, a.to);\n  return {\n    from: { x: a.from.x, y: a.from.y },\n    to: { x: bTransferred.to.x, y: bTransferred.to.y }\n  };\n}\n\nexport function subtractVector(a: Vector, b: Vector): Vector {\n  return transferToPoint(\n    addVector(\n      { from: { x: b.from.x, y: b.from.y }, to: { x: -b.to.x, y: -b.to.y } },\n      a\n    ),\n    transferToPoint(b, a.from).to\n  );\n}\n\nexport function vectorOnNumber(a: Vector, c: number): Vector {\n  const aTr = transferToPoint(a, { x: 0, y: 0 });\n  return transferToPoint(\n    { from: { x: 0, y: 0 }, to: { x: aTr.to.x * c, y: aTr.to.y * c } },\n    a.from\n  );\n}\n\nexport function getRectangleCenter(s: Rectangle): Point {\n  const diagonal = subtractVector(\n    pointToVector(s.rightTop),\n    pointToVector(s.leftBottom)\n  );\n  return vectorOnNumber(diagonal, 1 / 2).to;\n}\n\nexport function transferPointOnVector(p: Point, v: Vector): Point {\n  return transferToPoint(v, p).to;\n}\n\n// math: https://web.archive.org/web/20060911055655/http://local.wasp.uwa.edu.au/~pbourke/geometry/lineline2d/\nexport function getVectorIntersection(v1: Vector, v2: Vector): Point | null {\n  const x1 = v1.from.x;\n  const y1 = v1.from.y;\n  const x2 = v1.to.x;\n  const y2 = v1.to.y;\n  const x3 = v2.from.x;\n  const y3 = v2.from.y;\n  const x4 = v2.to.x;\n  const y4 = v2.to.y;\n  const denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);\n  const numeA = (x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3);\n  const numeB = (x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3);\n\n  if (denom == 0) {\n    return null;\n  }\n\n  const uA = numeA / denom;\n  const uB = numeB / denom;\n\n  if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\n    return {\n      x: x1 + uA * (x2 - x1),\n      y: y1 + uA * (y2 - y1)\n    };\n  }\n\n  return null;\n}\n\nexport function morphChildrenPoints(\n  oldBorder: Polygon,\n  newBorder: Polygon,\n  oldPoints: Record<string, Point>\n): [Record<string, Point> | null, ErrorKV] {\n  const oldCenterTf = turf.centerOfMass(polygonToTurf(oldBorder)).geometry;\n  if (oldCenterTf == null) {\n    return [\n      null,\n      NewErrorKV(\"morphChildrenPoints oldBorder centerOfMass error\", {\n        oldBorder: oldBorder,\n        oldPoints: oldPoints\n      })\n    ];\n  }\n  const newCenterTf = turf.centerOfMass(polygonToTurf(newBorder)).geometry;\n  if (newCenterTf == null) {\n    return [\n      null,\n      NewErrorKV(\"morphChildrenPoints newBorder centerOfMass error\", {\n        newBorder: newBorder,\n        oldPoints: oldPoints\n      })\n    ];\n  }\n  const oldCenter = {\n    x: oldCenterTf.coordinates[0],\n    y: oldCenterTf.coordinates[1]\n  };\n  const newCenter = {\n    x: newCenterTf.coordinates[0],\n    y: newCenterTf.coordinates[1]\n  };\n\n  // Move old node and its children to new node center\n  oldBorder = oldBorder.map(\n    (p): Point => {\n      return transferPointOnVector(p, { from: oldCenter, to: newCenter });\n    }\n  );\n  for (const id in oldPoints) {\n    oldPoints[id] = transferPointOnVector(oldPoints[id], {\n      from: oldCenter,\n      to: newCenter\n    });\n  }\n\n  // morph children\n  const maxDiameter = Math.max(\n    getVectorLength({\n      from: getBoundingBorders(oldBorder).leftBottom,\n      to: getBoundingBorders(oldBorder).rightTop\n    }),\n    getVectorLength({\n      from: getBoundingBorders(newBorder).leftBottom,\n      to: getBoundingBorders(newBorder).rightTop\n    })\n  );\n\n  const newPoints: Record<string, Point> = {};\n  for (const id in oldPoints) {\n    const oldPoint = oldPoints[id];\n    if (newCenter.x == oldPoint.x && newCenter.y == oldPoint.y) {\n      newPoints[id] = oldPoint;\n      continue;\n    }\n    let centerToPoint = { from: newCenter, to: oldPoints[id] };\n    // enlarge it to guarantee intersect with both newBorder and oldBorder (transferred to newBorder center)\n    centerToPoint = vectorOnNumber(\n      centerToPoint,\n      maxDiameter / getVectorLength(centerToPoint)\n    );\n    let oldBorderIntersection = null;\n    for (const i in oldBorder) {\n      const segment = {\n        from: oldBorder[i],\n        to: oldBorder[(Number(i) + 1) % oldBorder.length]\n      };\n      const p = getVectorIntersection(centerToPoint, segment);\n      if (p != null) {\n        oldBorderIntersection = p;\n        break;\n      }\n    }\n    if (oldBorderIntersection == null) {\n      return [\n        null,\n        NewErrorKV(\n          \"morphChildrenPoints cannot find intersection with oldBorder\",\n          {\n            centerToPoint: centerToPoint,\n            oldBorder: oldBorder\n          }\n        )\n      ];\n    }\n\n    let newBorderIntersection = null;\n    for (const i in newBorder) {\n      const segment = {\n        from: newBorder[i],\n        to: newBorder[(Number(i) + 1) % newBorder.length]\n      };\n      const p = getVectorIntersection(centerToPoint, segment);\n      if (p != null) {\n        newBorderIntersection = p;\n        break;\n      }\n    }\n    if (newBorderIntersection == null) {\n      return [\n        null,\n        NewErrorKV(\n          \"morphChildrenPoints cannot find intersection with newBorder\",\n          {\n            centerToPoint: centerToPoint,\n            newBorder: newBorder\n          }\n        )\n      ];\n    }\n\n    if (\n      oldBorderIntersection.x == newBorderIntersection.x &&\n      oldBorderIntersection.y == newBorderIntersection.y\n    ) {\n      newPoints[id] = oldPoint;\n      continue;\n    }\n\n    const coeff =\n      getVectorLength({ from: newCenter, to: newBorderIntersection }) /\n      getVectorLength({ from: newCenter, to: oldBorderIntersection });\n    newPoints[id] = vectorOnNumber({ from: newCenter, to: oldPoint }, coeff).to;\n  }\n\n  return [newPoints, null];\n}\n\nexport function NewEmptyVector(): Vector {\n  return { from: { x: 0, y: 0 }, to: { x: 0, y: 0 } };\n}\n\nexport function getMaxDiagonal(polygon: Polygon): [Vector, ErrorKV] {\n  if (!polygon || polygon.length < 3) {\n    return [\n      NewEmptyVector(),\n      NewErrorKV(\"getMaxDiagonal: bad polygon\", { polygon })\n    ];\n  }\n\n  const diagonals: Vector[] = [];\n  if (polygon.length == 3) {\n    // triangle does not has diagonals, so me emulate them\n    for (const i in polygon) {\n      const middle = vectorOnNumber(\n        {\n          from: polygon[mod(Number(i) - 1, polygon.length)],\n          to: polygon[mod(Number(i) + 1, polygon.length)]\n        },\n        1 / 2\n      );\n      diagonals.push({ from: polygon[i], to: middle.to });\n    }\n  } else {\n    for (const i in polygon) {\n      for (const j in polygon) {\n        if (\n          Number(j) != mod(Number(i) - 1, polygon.length) &&\n          Number(j) != Number(i) &&\n          Number(j) != mod(Number(i) + 1, polygon.length)\n        ) {\n          diagonals.push({ from: polygon[i], to: polygon[j] });\n        }\n      }\n    }\n  }\n\n  let maxDiagonal = diagonals[0];\n  for (const diag of diagonals) {\n    if (getVectorLength(diag) > getVectorLength(maxDiagonal)) {\n      maxDiagonal = diag;\n    }\n  }\n\n  return [maxDiagonal, null];\n}\n\nexport function convertPosition(\n  type: \"normalize\" | \"denormalize\",\n  position: Point,\n  parentID: string | null,\n  mapNodeLayers: Array<Record<string, MapNode>>\n): [Point | null, ErrorKV] {\n  let convertedPosition: Point;\n  if (parentID) {\n    const [parentMapNode] = findMapNode(parentID, mapNodeLayers);\n    if (!parentMapNode) {\n      return [\n        null,\n        NewErrorKV(\"UPDATE_NODE: Cannot findMapNode\", { id: parentID })\n      ];\n    }\n\n    let morphedPositions: Record<string, Point> | null, err: ErrorKV;\n    if (type === \"denormalize\") {\n      if (!isInside(position, NORMALIZED_BORDER)) {\n        return [\n          null,\n          NewErrorKV(\"convertPosition: position outside NORMALIZED_BORDER\", {\n            normalizedBorder: NORMALIZED_BORDER,\n            position,\n            parentID\n          })\n        ];\n      }\n      [morphedPositions, err] = morphChildrenPoints(\n        NORMALIZED_BORDER,\n        parentMapNode.border,\n        { tmp: position }\n      );\n    } else {\n      if (!isInside(position, parentMapNode.border)) {\n        return [\n          null,\n          NewErrorKV(\"convertPosition: position outside parentMapNode.border\", {\n            \"parentMapNode.border\": parentMapNode.border,\n            \"parentMapNode.center\": parentMapNode.center,\n            position,\n            parentID\n          })\n        ];\n      }\n      [morphedPositions, err] = morphChildrenPoints(\n        parentMapNode.border,\n        NORMALIZED_BORDER,\n        { tmp: position }\n      );\n      if (err !== null) {\n        return [\n          null,\n          NewErrorKV(\"UPDATE_NODE: Cannot morphChildrenPoints\", {\n            type: type,\n            normalizedBorder: NORMALIZED_BORDER,\n            \"parentMapNode.border\": parentMapNode.border,\n            \"dbNode.position\": position\n          })\n        ];\n      }\n      // make sure that after normalization position is strictly inside border\n      if (morphedPositions![\"tmp\"].x < 0) {\n        morphedPositions![\"tmp\"].x = 1;\n      }\n      if (morphedPositions![\"tmp\"].x > api.ST_WIDTH) {\n        morphedPositions![\"tmp\"].x = api.ST_WIDTH - 1;\n      }\n      if (morphedPositions![\"tmp\"].y < 0) {\n        morphedPositions![\"tmp\"].y = 1;\n      }\n      if (morphedPositions![\"tmp\"].y > api.ST_HEIGHT) {\n        morphedPositions![\"tmp\"].y = api.ST_HEIGHT - 1;\n      }\n    }\n    if (err !== null) {\n      return [\n        null,\n        NewErrorKV(\"UPDATE_NODE: Cannot morphChildrenPoints\", {\n          type: type,\n          normalizedBorder: NORMALIZED_BORDER,\n          \"parentMapNode.border\": parentMapNode.border,\n          \"dbNode.position\": position\n        })\n      ];\n    }\n    convertedPosition = morphedPositions![\"tmp\"];\n  } else {\n    if (type === \"denormalize\") {\n      convertedPosition = { x: api.ROOT_CENTER_X, y: api.ROOT_CENTER_Y };\n    } else {\n      convertedPosition = { x: api.ST_WIDTH / 2, y: api.ST_HEIGHT / 2 };\n    }\n  }\n\n  return [convertedPosition, null];\n}\n\n/**\n *\n * @param tree\n * @param rootBorder\n * @param rootPosition\n */\nexport function treeToMapNodeLayers(\n  tree: Tree,\n  rootBorder: Polygon,\n  rootPosition: Point\n): [Array<Record<string, MapNode>> | null, ErrorKV] {\n  if (Object.keys(tree).length == 0) {\n    return [[], null];\n  }\n  const treeLayers: Array<Array<Tree>> = [[tree]];\n  const mapNodeLayers: Array<Record<string, MapNode>> = [\n    {\n      [tree.id]: {\n        id: tree.id,\n        border: rootBorder,\n        title: tree.title,\n        center: rootPosition\n      }\n    }\n  ];\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    const lastTreeLayer = treeLayers[treeLayers.length - 1];\n    const lastMapNodeLayer = mapNodeLayers[treeLayers.length - 1];\n    const newTreeLayer = [];\n    const newMapNodeLayer: Record<string, MapNode> = {};\n    for (const treeNode of lastTreeLayer) {\n      if (!treeNode.children) {\n        return [\n          null,\n          NewErrorKV(\"treeToMapNodeLayers: treeNode with children undefined\", {\n            treeNode\n          })\n        ];\n      }\n      if (!treeNode.children.length) {\n        continue;\n      }\n\n      // check that no two children have the same center\n      const tmpMap = {} as Record<string, string>;\n      let strPos = \"\";\n      for (const i in treeNode.children) {\n        strPos = JSON.stringify(treeNode.children[i].position);\n        if (tmpMap[strPos] && tmpMap[strPos].length > 0) {\n          return [\n            null,\n            NewErrorKV(\"two children has the same center\", {\n              firstId: tmpMap[strPos],\n              secondId: treeNode.children[i].id\n            })\n          ];\n        } else {\n          tmpMap[strPos] = treeNode.children[i].id;\n        }\n      }\n\n      newTreeLayer.push(...treeNode.children);\n      if (!lastMapNodeLayer[treeNode.id]) {\n        return [\n          null,\n          NewErrorKV(\"Cannot find node in mapNodeLayers\", {\n            layer: mapNodeLayers[mapNodeLayers.length - 1],\n            treeNode: treeNode\n          })\n        ];\n      }\n\n      // denormalize positions\n      const treeNodeChildren = clone(treeNode.children) as Array<Tree>;\n      for (const child of treeNodeChildren) {\n        const [denormalizedPosition, err] = convertPosition(\n          \"denormalize\",\n          child.position,\n          treeNode.id,\n          [lastMapNodeLayer]\n        );\n        if (err) {\n          return [null, err];\n        }\n        child.position = denormalizedPosition!;\n      }\n      const [cells, error] = getVoronoiCells(\n        lastMapNodeLayer[treeNode.id].border,\n        treeNodeChildren.map(ch => ({ x: ch.position.x, y: ch.position.y }))\n      );\n      if (error != null) {\n        return [null, error];\n      }\n\n      for (const cell of cells) {\n        for (const child of treeNodeChildren) {\n          if (\n            child.position.x == cell.center.x &&\n            child.position.y == cell.center.y\n          ) {\n            newMapNodeLayer[child.id] = {\n              id: child.id,\n              title: child.title,\n              center: child.position,\n              border: cell.border\n            };\n          }\n        }\n      }\n    }\n\n    if (newTreeLayer.length) {\n      treeLayers.push(newTreeLayer);\n      mapNodeLayers.push(newMapNodeLayer);\n    } else {\n      return [mapNodeLayers, null];\n    }\n  }\n}\n\nexport function mergeMapNodeLayers(\n  recipientLayers: Record<string, MapNode>[],\n  insertedLayers: Record<string, MapNode>[],\n  startFromLevel: number\n): ErrorKV {\n  if (startFromLevel >= recipientLayers.length || startFromLevel < 0) {\n    return NewErrorKV(\n      \"startFromLevel >= recipientLayers.length or startFromLevel < 0\",\n      {\n        startFromLevel,\n        \"recipientLayers.length\": recipientLayers.length\n      }\n    );\n  }\n  let i = startFromLevel;\n  while (i < startFromLevel + insertedLayers.length) {\n    for (const id in insertedLayers[i - startFromLevel]) {\n      recipientLayers[i][id] = insertedLayers[i - startFromLevel][id];\n    }\n    i++;\n  }\n\n  return null;\n}\n","import { clone } from \"@/tools/utils\";\nimport { Commit } from \"vuex\";\nimport api from \"@/api/api\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport { State as UserState } from \"@/store/user\";\n\nexport type NodeContent = {\n  nodeID: string;\n  content: string;\n};\n\n// user private comment\nexport type NodeComment = {\n  nodeID: string;\n  comment: string;\n};\n\nexport interface State {\n  nodeContents: Record<string, NodeContent>;\n  userNodeComments: Record<string, NodeComment>;\n}\n\nexport const mutations = {\n  SET_CONTENTS: \"SET_CONTENTS\",\n  SET_USER_COMMENTS: \"SET_USER_COMMENTS\",\n  SET_NODE_CONTENT: \"SET_NODE_CONTENT\",\n  SET_NODE_COMMENT: \"SET_NODE_COMMENT\"\n};\n\nexport const actions = {\n  getNodeContent: \"getNodeContent\",\n  setNodeContent: \"setNodeContent\",\n  setNodeComment: \"setNodeComment\"\n};\n\nexport const EmptyNodeContent = {\n  nodeID: \"\",\n  content: \"\"\n} as NodeContent;\n\nfunction createContentIfNotExist(\n  nodeContents: Record<string, NodeContent>,\n  nodeID: string\n) {\n  if (!nodeContents[nodeID]) {\n    nodeContents[nodeID] = clone(EmptyNodeContent);\n    nodeContents[nodeID].nodeID = nodeID;\n  }\n}\n\nexport const EmptyNodeComment = {\n  nodeID: \"\",\n  comment: \"\"\n} as NodeComment;\n\nfunction createCommentIfNotExist(\n  userNodeComments: Record<string, NodeComment>,\n  nodeID: string\n) {\n  if (!userNodeComments[nodeID]) {\n    userNodeComments[nodeID] = clone(EmptyNodeComment);\n    userNodeComments[nodeID].nodeID = nodeID;\n  }\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    nodeContents: {} as Record<string, NodeContent>,\n    userNodeComments: {} as Record<string, NodeComment>\n  } as State,\n  actions: {\n    [actions.getNodeContent](\n      { state }: { state: State },\n      nodeID: string\n    ): NodeContent {\n      return state.nodeContents[nodeID];\n    },\n\n    /**\n     * setNodeComment\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.setNodeComment](\n      { commit, rootState }: { commit: Commit; rootState: { user: UserState } },\n      v: { nodeID: string; comment: string }\n    ): Promise<ErrorKV> {\n      // cannot save for unauthorized user\n      if (!rootState.user.user || rootState.user.user.isAnonymous) {\n        return null;\n      }\n\n      // add to DB\n      const err = await api.debouncedUpdate({\n        [`user_data/${rootState.user.user.uid}/comment/${v.nodeID}/nodeID`]: v.nodeID,\n        [`user_data/${rootState.user.user.uid}/comment/${v.nodeID}/comment`]: v.comment\n      });\n      if (err) {\n        return err;\n      }\n\n      // change in local store\n      commit(`${mutations.SET_NODE_COMMENT}`, v);\n\n      return null;\n    },\n\n    /**\n     * setNodeContent\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.setNodeContent](\n      { commit, state }: { commit: Commit; state: State },\n      v: { nodeID: string; content: string }\n    ): Promise<ErrorKV> {\n      // change in local store before adding to DB for comfortable textbox editing experience\n      commit(`${mutations.SET_NODE_CONTENT}`, v);\n\n      // add to DB\n      const err = await api.debouncedUpdate({\n        [`node_content/${v.nodeID}/nodeID`]: v.nodeID,\n        [`node_content/${v.nodeID}/content`]: v.content\n      });\n      if (err) {\n        return err;\n      }\n\n      return null;\n    }\n  },\n  mutations: {\n    /**\n     * SET_CONTENTS\n     * @param state\n     * @param nodeContents\n     */\n    [mutations.SET_CONTENTS](\n      state: State,\n      nodeContents: Record<string, NodeContent>\n    ) {\n      state.nodeContents = nodeContents;\n    },\n\n    /**\n     * SET_USER_CONTENTS\n     * @param state\n     * @param userNodeComments\n     */\n    [mutations.SET_USER_COMMENTS](\n      state: State,\n      userNodeComments: Record<string, NodeComment>\n    ) {\n      state.userNodeComments = userNodeComments;\n    },\n\n    /**\n     * SET_NODE_CONTENT\n     * @param state\n     * @param v\n     */\n    [mutations.SET_NODE_CONTENT](\n      state: State,\n      v: { nodeID: string; content: string }\n    ) {\n      createContentIfNotExist(state.nodeContents, v.nodeID);\n      state.nodeContents[v.nodeID].content = v.content;\n    },\n\n    /**\n     * SET_NODE_COMMENT\n     * @param state\n     * @param v\n     */\n    [mutations.SET_NODE_COMMENT](\n      state: State,\n      v: { nodeID: string; comment: string }\n    ) {\n      createCommentIfNotExist(state.userNodeComments, v.nodeID);\n      state.userNodeComments[v.nodeID].comment = v.comment;\n    }\n  }\n};\n","// FlexSearch for full-text search\n// @ts-ignore\nimport { Worker } from \"flexsearch\";\nconst index = new Worker({\n  language: \"en\",\n  tokenize: \"forward\"\n});\n\nexport function add(id: string, text: string) {\n  index.add(id, text);\n}\nexport function search(text: string): Promise<Array<string>> {\n  return index.search(text);\n}\n","import firebase from \"firebase/compat\";\nimport { Commit } from \"vuex\";\nimport api from \"@/api/api\";\n\nexport interface State {\n  user: firebase.User | null;\n  subscribePeriod: string;\n}\n\nexport const mutations = {\n  SET_USER: \"SET_USER\",\n  SET_SUBSCRIBE_PERIOD: \"SET_SUBSCRIBE_PERIOD\"\n};\nexport const actions = {\n  signIn: \"signIn\",\n  signOut: \"signOut\",\n  setSubscribePeriod: \"setSubscribePeriod\",\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    user: null,\n    subscribePeriod: '',\n  },\n  mutations: {\n    [mutations.SET_USER](state: State, user: firebase.User) {\n      state.user = user;\n    },\n    [mutations.SET_SUBSCRIBE_PERIOD](state: State, subscribePeriod: string) {\n      state.subscribePeriod = subscribePeriod;\n    },\n  },\n  actions: {\n    async [actions.signIn]({ commit }: { commit: Commit }) {\n      await firebase\n        .auth()\n        .signInWithPopup(new firebase.auth.GoogleAuthProvider());\n    },\n\n    async [actions.signOut]({ commit }: { commit: Commit }) {\n      await firebase.auth().signOut();\n      commit(mutations.SET_USER, null);\n    },\n\n    async [actions.setSubscribePeriod]({ commit, state }: { commit: Commit; state: State }, period: string) {\n      if (!state.user) {\n        return\n      }\n      commit(mutations.SET_SUBSCRIBE_PERIOD, period);\n      await api.setUserSubscribePeriod(state.user, period);\n    }\n  }\n};\n","import firebase from \"firebase/compat\";\nimport api from \"@/api/api\";\nimport {\n  mutations as treeMutations,\n  actions as treeActions\n} from \"@/store/tree\";\nimport { mutations as pinMutations } from \"@/store/pin\";\nimport { mutations as subscriptionsMutations } from \"@/store/subscriptions\";\nimport { mutations as preconditionMutations } from \"@/store/precondition\";\nimport {\n  mutations as nodeContentMutations,\n  NodeContent\n} from \"@/store/node_content\";\nimport { store } from \"@/store/index\";\nimport { printError } from \"@/tools/utils\";\nimport { convertDBMapToTree } from \"@/api/helpers\";\nimport { DBMapNode } from \"@/api/types\";\nimport { add as textSearchAdd } from \"@/tools/textsearch\";\nimport {mutations as userMutations} from \"@/store/user\";\n\n/**\n * 1) fetch map\n * 2) subscribe to changes\n * 3) convert to tree and set to internal store\n * @param user\n */\nexport async function initMap(user: firebase.User | null) {\n  const [map, err] = await api.getMap(user);\n  if (map === null || err) {\n    printError(\"fetchMap: cannot api.getMap(user)\", { err });\n  }\n  // create Tree with denormalized positions\n  const [tree, convErr] = convertDBMapToTree(map!);\n  if (convErr !== null) {\n    return [null, convErr];\n  }\n  store.commit(`tree/${treeMutations.SET_TREE}`, tree);\n\n  // subscribe on changes for every node in map\n  // General advice is to listen to specific paths (not root) and dynamically change subscribe/unsubscribe\n  // https://firebase.google.com/docs/database/usage/optimize#efficient-listeners\n  for (const id in map) {\n    subscribeNodeChanges(id)\n  }\n}\n\nexport function unSubscribeNodeChanges(id: string) {\n  api.unsubscribeDBChange(`map/${id}`)\n  api.unsubscribeDBChange(`node_content/${id}`)\n  api.unsubscribeDBChange(`precondition/${id}`)\n  api.unsubscribeDBChange(`node_image/${id}`)\n}\n\nexport function subscribeNodeChanges(id: string) {\n  // subscribe children, name or position change\n  api.subscribeMapNodeChange(id, (dbNode: DBMapNode) =>\n    store.dispatch(`tree/${treeActions.handleMapNodeUpdate}`, dbNode)\n  );\n\n  // subscribe node content change\n  api.subscribeNodeContentChange(\n    id,\n    (v: { nodeID: string; content: string }) => {\n      textSearchAdd(v.nodeID, v.content);\n      store.commit(`nodeContent/${nodeContentMutations.SET_NODE_CONTENT}`, v);\n    }\n  );\n\n  // subscribe on precondition changes for every node\n  api.subscribePreconditionNodeChange(id);\n\n  // subscribe image change\n  api.subscribeNodeImageChange(id)\n}\n\nexport async function fetchPins(user: firebase.User | null) {\n  let [pins, err] = await api.getPins(user);\n  if (pins == null) {\n    if (err) {\n      console.error(\"fetchPins\", err);\n    } else {\n      console.log(\"fetchPins: empty pins\");\n    }\n  }\n\n  if (user && !pins) {\n    [pins, err] = await api.getPins(null);\n    if (pins == null || err) {\n      console.error(err);\n      pins = {};\n    }\n  }\n\n  store.commit(`pin/${pinMutations.SET_PINS}`, pins);\n}\n\nexport async function fetchSubscribePeriod(user: firebase.User | null) {\n  if (!user) {\n    return\n  }\n  const period = await api.getUserSubscribePeriod(user);\n  store.commit(`user/${userMutations.SET_SUBSCRIBE_PERIOD}`, period);\n}\n\nexport async function fetchSubscriptions(user: firebase.User | null) {\n  const [subscriptions, err] = await api.getSubscriptions(user);\n  if (subscriptions == null) {\n    if (err) {\n      console.error(\"fetchSubscriptions\", err);\n    } else {\n      console.log(\"fetchSubscriptions: empty\");\n    }\n  }\n\n  store.commit(`subscriptions/${subscriptionsMutations.SET_SUBSCRIPTIONS}`, subscriptions);\n}\n\nexport async function initPreconditions(user: firebase.User | null) {\n  let [preconditions, err] = await api.getPreconditions(user);\n  if (preconditions == null || err) {\n    console.error(err);\n    preconditions = {};\n  }\n\n  if (user && !preconditions) {\n    [preconditions, err] = await api.getPreconditions(null);\n    if (preconditions == null || err) {\n      console.error(err);\n      preconditions = {};\n    }\n  }\n\n  store.commit(\n    `precondition/${preconditionMutations.SET_PRECONDITIONS}`,\n    preconditions\n  );\n}\n\n/**\n * Fetch all node content and subscribe for content change for each node\n * @param user\n */\nexport async function initNodeContents(user: firebase.User | null) {\n  // fetch node_content from general map\n  const [nodeContent, err] = await api.getNodeContent();\n  if (nodeContent == null || err) {\n    printError(\"fetchNodeContents error\", { err });\n    return;\n  }\n\n  const nodeContents: Record<string, NodeContent> = {};\n  for (const i in nodeContent) {\n    nodeContents[i] = {\n      nodeID: nodeContent[i].nodeID,\n      content: nodeContent[i].content\n    } as NodeContent;\n  }\n\n  store.commit(\n    `nodeContent/${nodeContentMutations.SET_CONTENTS}`,\n    nodeContents\n  );\n\n  if (user) {\n    const [userComments, err] = await api.getUserComments(user);\n    if (err) {\n      printError(\"fetch userComments error\", { err, user });\n      return;\n    }\n    if (userComments === null) {\n      return;\n    }\n\n    // fix in store\n    store.commit(\n      `nodeContent/${nodeContentMutations.SET_USER_COMMENTS}`,\n      userComments\n    );\n  }\n}\n\nexport async function initData(user: firebase.User | null) {\n  await initMap(user);\n  await fetchPins(user);\n  await fetchSubscribePeriod(user);\n  await fetchSubscriptions(user);\n  await initPreconditions(user);\n  await initNodeContents(user);\n}\n","import { MapNode, Point, Tree } from \"@/types/graphics\";\nimport {\n  convertPosition,\n  isInside,\n  treeToMapNodeLayers,\n  treeToNodeRecord\n} from \"@/tools/graphics\";\nimport { findMapNode, updatePosition } from \"@/store/tree/helpers\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { DBMapNode } from \"@/api/types\";\nimport { printError, round } from \"@/tools/utils\";\nimport api from \"@/api/api\";\nimport { Commit, Dispatch } from \"vuex\";\nimport {subscribeNodeChanges, unSubscribeNodeChanges} from \"@/store/helpers\";\n\n// Define root border for 2560x1600\nconst ROOT_WIDTH = 2560;\nconst ROOT_HEIGHT = 1600;\nconst cf = 1 / 3;\nconst ROOT_BORDER = [\n  { x: 0, y: cf * ROOT_HEIGHT },\n  { x: 0, y: 2 * cf * ROOT_HEIGHT },\n  { x: (cf / 2.5) * ROOT_WIDTH, y: (1 - cf / 4) * ROOT_HEIGHT },\n  { x: cf * ROOT_WIDTH, y: ROOT_HEIGHT },\n  { x: 2 * cf * ROOT_WIDTH, y: ROOT_HEIGHT },\n  { x: (1 - cf / 2.5) * ROOT_WIDTH, y: (1 - cf / 4) * ROOT_HEIGHT },\n  { x: ROOT_WIDTH, y: 2 * cf * ROOT_HEIGHT },\n  { x: ROOT_WIDTH, y: cf * ROOT_HEIGHT },\n  { x: (1 - cf / 2.5) * ROOT_WIDTH, y: (cf / 4) * ROOT_HEIGHT },\n  { x: 2 * cf * ROOT_WIDTH, y: 0 },\n  { x: cf * ROOT_WIDTH, y: 0 },\n  { x: (cf / 2.5) * ROOT_WIDTH, y: (cf / 4) * ROOT_HEIGHT }\n];\nconst ROOT_CENTER = { x: api.ROOT_CENTER_X, y: api.ROOT_CENTER_Y };\n\n// Scale root border proportionally to fit 2/3 of user browser viewport and move the left\nconst userFitCoefficient = Math.min(\n  api.ROOT_WIDTH / ROOT_WIDTH,\n  api.ROOT_HEIGHT / ROOT_HEIGHT\n);\nfor (const idx in ROOT_BORDER) {\n  ROOT_BORDER[idx].x =\n    userFitCoefficient * ROOT_BORDER[idx].x +\n    api.ROOT_CENTER_X -\n    (userFitCoefficient * ROOT_WIDTH) / 2;\n  ROOT_BORDER[idx].y =\n    userFitCoefficient * ROOT_BORDER[idx].y +\n    api.ROOT_CENTER_Y -\n    (userFitCoefficient * ROOT_HEIGHT) / 2;\n}\n\nexport interface NodeRecordItem {\n  node: Tree;\n  parent: Tree | null;\n}\n\nexport interface State {\n  tree: Tree | null;\n  nodeRecord: Record<string, NodeRecordItem>;\n  mapNodeLayers: Array<Record<string, MapNode>>;\n  selectedNodeId: string | null;\n}\n\nexport const mutations = {\n  SET_SELECTED_NODE_ID: \"SET_SELECTED_NODE_ID\",\n  SET_TREE: \"SET_TREE\",\n  UPDATE_NODE_POSITION: \"UPDATE_NODE_POSITION\",\n  REMOVE_NODE: \"REMOVE_NODE\"\n};\n\nexport const actions = {\n  handleMapNodeUpdate: \"handleMapNodeUpdate\"\n};\n\nexport const store = {\n  namespaced: true,\n  state() {\n    return {\n      tree: null,\n      nodeRecord: {} as Record<string, NodeRecordItem>, // id => NodeRecordItem\n      mapNodeLayers: [] as Array<Record<string, DBMapNode>>,\n      selectedNodeId: null\n    };\n  },\n\n  getters: {\n    selectedNode: (state: State) => {\n      if (!state.selectedNodeId) {\n        return null;\n      }\n      if (!state.nodeRecord[state.selectedNodeId]) {\n        return null;\n      }\n      return state.nodeRecord[state.selectedNodeId].node;\n    }\n  },\n\n  actions: {\n    /**\n     * Update tree and dependant structures on DBNode change\n     *\n     * После добавления нового узла мы не вносим изменения локально, а сохраняем в базу и ждем пока оттуда придет обновление\n     *\n     * Маппинг изменений в виде снэпшотов на изменения в формате store/history выглядит следующим образом.\n     * Мы сравниваем наш узел и пришедший новый снэпшот этого узла\n     *\n     * Если видим удаление child, то это либо перенос, либо удаление узла.\n     * В любом случае мы можем у себя удалить этот узел (мы не удаляем всю информацию, только из дерева - 'fake removal').\n     * Если это перенос, то мы либо получили событие добавления в другой узел\n     * до этого события, либо получим его после. Если получили до, то из этого узла уже должны были его удалить,\n     * так что остается вариант когда мы еще получим событие о добавлении. В этом случаем для нас это будет добавление нового узла.\n     * То есть мы запросим из базы этот узел и вставим его\n     *\n     * Если видим добавление child, то это либо перенос, либо добавление нового узла. Если мы не находим у себя child с таким id,\n     * то это добавление - нам нужно запросить из базы node с таким id и добавить его к себе.\n     * Если в nodeRecord есть такой узел, то это перенос - мы удаляем его из старого родителя и вставляем в новый\n     *\n     * Этими двумя кейсами покрываются события добавления, удаления и переноса.\n     * Событие изменения имени и позиции мапятся тривиально\n     *\n     * @param commit\n     * @param state\n     * @param dispatch\n     * @param dbNode\n     */\n    async [actions.handleMapNodeUpdate](\n      {\n        commit,\n        state,\n      }: { commit: Commit; state: State; dispatch: Dispatch },\n      dbNode: DBMapNode\n    ) {\n      const dbNodeRecord = state.nodeRecord[dbNode.id];\n      if (!dbNodeRecord) {\n        // if it is a new node, we will fetch it from its parent children update event\n        return;\n      }\n\n      const oldDBNode = {\n        id: dbNodeRecord.node.id,\n        parentID: dbNodeRecord.parent ? dbNodeRecord.parent.id : null,\n        name: dbNodeRecord.node.title,\n        children: dbNodeRecord.node.children.map(n => n.id).sort(),\n        position: dbNodeRecord.node.position\n      };\n\n      const newChildren = dbNode.children.filter(\n        x => !oldDBNode.children.includes(x)\n      );\n      const removedChildren = oldDBNode.children.filter(\n        x => !dbNode.children.includes(x)\n      );\n\n      // Add/move of new child\n      if (newChildren.length) {\n        for (const childID of newChildren) {\n          if (state.nodeRecord[childID]) {\n            console.log(\n              \"actions.handleDBUpdate: remove node for cut-and-paste\",\n              state.nodeRecord[childID]\n            );\n            // if we already have this node, then it is cut-and-paste new parent\n            // so we should remove node from old parent\n            const v = {\n              nodeID: childID,\n              returnError: null\n            };\n            commit(mutations.REMOVE_NODE, {\n              nodeID: childID,\n              returnError: null\n            });\n            if (v.returnError) {\n              printError(\"handleDBUpdate: cannot cut node\", {\n                err: v.returnError\n              });\n            }\n          }\n\n          // request node and its children from the server, fill in tree\n          const addedDBNode = await api.getMapNode(childID);\n          console.log(\n            \"actions.handleDBUpdate: add node for cut-and-paste\",\n            addedDBNode\n          );\n\n          const toProcess = [addedDBNode];\n          if (!addedDBNode) {\n            // we cannot find node for addition, remove it from parent\n            dbNode.children = dbNode.children.filter(id => id != childID);\n            printError(\"Cannot find node for addition\", { nodeID: childID });\n            continue;\n          }\n          while (toProcess.length) {\n            const inProcessNode = toProcess.pop();\n            if (!inProcessNode) {\n              continue;\n            }\n            // create new MapNode\n            const treeNode = {\n              id: inProcessNode.id,\n              title: inProcessNode.name,\n              position: inProcessNode.position,\n              children: []\n            } as Tree;\n            if (!state.nodeRecord[inProcessNode.parentID]) {\n              printError(\"Cannot find nodeID in nodeRecord\", {\n                nodeID: inProcessNode.parentID\n              });\n              return;\n            }\n            // make sure we have no duplicates\n            state.nodeRecord[\n              inProcessNode.parentID\n            ].node.children = state.nodeRecord[\n              inProcessNode.parentID\n            ].node.children.filter(n => n.id != treeNode.id);\n            // add child to parent\n            state.nodeRecord[inProcessNode.parentID].node.children.push(\n              treeNode\n            );\n            // add child to nodeRecord\n            state.nodeRecord[treeNode.id] = {\n              parent: state.nodeRecord[inProcessNode.parentID].node,\n              node: treeNode\n            };\n            // subscribe to new node changes\n            subscribeNodeChanges(treeNode.id);\n            for (const childID of inProcessNode.children) {\n              const childNode = await api.getMapNode(childID);\n              if (!childNode) {\n                // we cannot find node for addition, remove it from parent\n                inProcessNode.children = inProcessNode.children.filter(\n                  id => id != childID\n                );\n                printError(\"Cannot find node for addition\", {\n                  nodeID: childID\n                });\n                continue;\n              }\n              toProcess.push(childNode);\n            }\n          }\n        }\n      }\n\n      // Remove of child\n      if (removedChildren.length) {\n        for (const childID of removedChildren) {\n          if (!state.nodeRecord[childID] || !state.nodeRecord[childID].parent) {\n            // node was already removed somewhere\n            continue;\n          }\n          if (\n            state.nodeRecord[childID] &&\n            state.nodeRecord[childID].parent!.id !== dbNode.id\n          ) {\n            // node was already removed from this parent (this is cut-and-paste operation)\n            continue;\n          }\n          console.log(\n            \"actions.handleDBUpdate: removing children\",\n            state.nodeRecord[childID]\n          );\n          const v = { nodeID: childID, returnError: null };\n          commit(mutations.REMOVE_NODE, v);\n          if (v.returnError) {\n            printError(\"actions.handleDBUpdate: cannot remove node\", {\n              err: v.returnError,\n              id: childID\n            });\n          }\n          // unsubscribe from removed node changes\n          unSubscribeNodeChanges(childID);\n        }\n      }\n\n      if (removedChildren.length || newChildren.length) {\n        const [ls, err2] = treeToMapNodeLayers(\n          state.tree!,\n          ROOT_BORDER,\n          ROOT_CENTER\n        );\n        if (err2) {\n          printError(\"Cannot treeToMapNodeLayers\", { err: err2 });\n          return;\n        }\n        state.mapNodeLayers = ls!;\n      }\n\n      // Change of position\n      if (\n        round(dbNode.position.x) !== round(oldDBNode.position.x) ||\n        round(dbNode.position.y) !== round(oldDBNode.position.y)\n      ) {\n        // calculate denormalized position of dbNode\n        const [denormalizedPosition] = convertPosition(\n          \"denormalize\",\n          dbNode.position,\n          dbNodeRecord.parent ? dbNodeRecord.parent.id : null,\n          state.mapNodeLayers\n        );\n        if (oldDBNode.parentID == dbNode.parentID) {\n          // we do not want to process position change due to parent change - it is already processed by ADD_NODE\n          const v = {\n            nodeId: dbNode.id,\n            newCenter: denormalizedPosition,\n            returnError: null\n          };\n          commit(mutations.UPDATE_NODE_POSITION, v);\n          if (v.returnError !== null) {\n            printError(\n              \"actions.handleDBUpdate: cannot update node's position\",\n              { dbNode: dbNode, err: v.returnError }\n            );\n            return;\n          }\n        }\n      }\n\n      // Change of name\n      if (oldDBNode.name !== dbNode.name) {\n        dbNodeRecord.node.title = dbNode.name;\n        const [node] = findMapNode(oldDBNode.id, state.mapNodeLayers);\n        if (!node) {\n          return;\n        }\n        node.title = dbNode.name;\n      }\n    }\n  },\n  mutations: {\n    /**\n     * REMOVE_NODE\n     * @param state\n     * @param v\n     */\n    [mutations.REMOVE_NODE](\n      state: State,\n      v: { nodeID: string; returnError: ErrorKV }\n    ) {\n      if (state.tree === null) {\n        v.returnError = NewErrorKV(\"state.tree === null\", {});\n        return;\n      }\n\n      if (!state.nodeRecord[v.nodeID]) {\n        v.returnError = NewErrorKV(\n          \"REMOVE_NODE: cannot find nodeId in nodeRecord\",\n          { nodeID: v.nodeID, nodeRecord: state.nodeRecord }\n        );\n        return;\n      }\n      const parent = state.nodeRecord[v.nodeID].parent;\n      if (!parent) {\n        v.returnError = NewErrorKV(\"REMOVE_NODE: cannot remove root node\", {\n          nodeId: v.nodeID\n        });\n        return;\n      }\n\n      // remove node and its descendants from nodeRecord\n      const stack = [v.nodeID];\n      while (stack.length) {\n        const id = stack.pop();\n        if (!id) {\n          continue;\n        }\n        stack.push(...state.nodeRecord[id].node.children.map(node => node.id));\n        delete state.nodeRecord[id];\n      }\n\n      // remove from parent's children\n      const ind = parent.children.findIndex(node => node.id === v.nodeID);\n      parent.children.splice(ind, 1);\n    },\n\n    /**\n     * SET_SELECTED_NODE_ID\n     * @param state\n     * @param id\n     */\n    [mutations.SET_SELECTED_NODE_ID](state: State, id: string | null) {\n      state.selectedNodeId = id;\n    },\n\n    /**\n     * SET_TREE\n     * @param state\n     * @param tree\n     */\n    [mutations.SET_TREE](state: State, tree: Tree | null) {\n      if (tree == null) {\n        state.tree = null;\n        state.nodeRecord = {};\n        state.mapNodeLayers = [];\n        return;\n      }\n      state.tree = tree;\n\n      // traverse tree and fill in nodeRecord\n      state.nodeRecord = treeToNodeRecord(tree);\n\n      // fill state.mapNodeLayers\n      const [ls, err] = treeToMapNodeLayers(tree, ROOT_BORDER, ROOT_CENTER);\n      if (ls == null || err != null) {\n        console.error(err);\n        return;\n      }\n      state.mapNodeLayers = ls;\n    },\n\n    /**\n     * UPDATE_NODE_POSITION\n     * @param state\n     * @param v\n     */\n    [mutations.UPDATE_NODE_POSITION](\n      state: State,\n      v: {\n        nodeId: string;\n        newCenter: Point;\n        returnError: ErrorKV; // still waiting for vuex to implement mutation return values https://github.com/vuejs/vuex/issues/1437\n      }\n    ) {\n      // check that new position is inside parent borders\n      const parent = state.nodeRecord[v.nodeId].parent;\n      if (parent !== null) {\n        const [parentMapNode] = findMapNode(parent.id, state.mapNodeLayers);\n        if (!parentMapNode) {\n          v.returnError = NewErrorKV(\n            \"UPDATE_NODE_POSITION: cannot find parent mapNode\",\n            {\n              \"parent.id\": parent.id,\n              \"state.mapNodeLayers\": state.mapNodeLayers\n            }\n          );\n          return;\n        }\n\n        if (!isInside(v.newCenter, parentMapNode.border)) {\n          v.returnError = NewErrorKV(\"!isInside\", {\n            newCenter: v.newCenter,\n            \"parentMapNode.border\": parentMapNode.border\n          });\n          return;\n        }\n      }\n\n      v.returnError = updatePosition(state, {\n        nodeId: v.nodeId,\n        position: v.newCenter\n      });\n    }\n  }\n};\n","import { Point } from \"@/types/graphics\";\n\nexport const mutations = {\n  ADD_CUT_PASTE: \"ADD_CUT_PASTE\",\n  ADD_CREATE: \"ADD_CREATE\",\n  ADD_REMOVE: \"ADD_REMOVE\",\n  ADD_POSITION_CHANGE: \"ADD_POSITION_CHANGE\"\n};\n\nenum changeTypeEnum {\n  CUT_PASTE = \"CUT_PASTE\",\n  CREATE = \"CREATE\",\n  REMOVE = \"REMOVE\",\n  POSITION_CHANGE = \"POSITION_CHANGE\"\n}\n\nconst changeTypes = {\n  CUT_PASTE: \"CUT_PASTE\" as changeTypeEnum.CUT_PASTE,\n  CREATE: \"CREATE\" as changeTypeEnum.CREATE,\n  REMOVE: \"REMOVE\" as changeTypeEnum.REMOVE,\n  POSITION_CHANGE: \"POSITION_CHANGE\" as changeTypeEnum.POSITION_CHANGE\n};\n\nexport interface CHCutPaste {\n  nodeID: string; // object of change\n  oldParentID: string; // old parent\n  newParentID: string; // new parent\n}\n\nexport interface CHCreate {\n  nodeID: string; // object of change\n  parentID: string; // new parent\n}\n\nexport interface CHRemove {\n  nodeID: string; // object of change\n  parentID: string; // parent where object sits (we need it to revert this event)\n}\n\nexport interface CHPositionChange {\n  nodeID: string; // object of change\n  oldPosition: Point; // old position (we need it to revert this event)\n  newPosition: Point; // new position\n}\n\nexport type TreeChangeList = Record<\n  string,\n  {\n    [changeTypeEnum.CUT_PASTE]?: CHCutPaste;\n    [changeTypeEnum.CREATE]?: CHCreate;\n    [changeTypeEnum.REMOVE]?: CHRemove;\n    [changeTypeEnum.POSITION_CHANGE]?: CHPositionChange;\n  }\n>;\n\nexport interface State {\n  // список изменений который отличает текущую мастер ветку\n  // от того мастера с которого мы начали локальные изменения\n  stableChangeList: TreeChangeList;\n  // список локальных изменений\n  localChangeList: TreeChangeList;\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    stableChangeList: {},\n    localChangeList: {}\n  },\n  mutations: {\n    [mutations.ADD_CUT_PASTE](state: State, change: CHCutPaste) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      if (state.localChangeList[change.nodeID][changeTypes.CREATE]) {\n        // if user ADDed then MOVEd node then it is simply addition to CUT_PASTE newParentID\n        state.localChangeList[change.nodeID][changeTypes.CREATE]!.parentID =\n          change.newParentID;\n      } else {\n        state.localChangeList[change.nodeID][changeTypes.CUT_PASTE] = change;\n      }\n    },\n    [mutations.ADD_CREATE](state: State, change: CHCreate) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      state.localChangeList[change.nodeID][changeTypes.CREATE] = change;\n    },\n    [mutations.ADD_REMOVE](state: State, change: CHRemove) {\n      // clear changelist for this node because REMOVE vanishes them anyway\n      state.localChangeList[change.nodeID] = {};\n      state.localChangeList[change.nodeID][changeTypes.REMOVE] = change;\n    },\n    [mutations.ADD_POSITION_CHANGE](state: State, change: CHPositionChange) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      let firstOldPosition = change.oldPosition;\n      if (state.localChangeList[change.nodeID][changeTypes.POSITION_CHANGE]) {\n        firstOldPosition = state.localChangeList[change.nodeID][\n          changeTypes.POSITION_CHANGE\n        ]!.oldPosition;\n      }\n      state.localChangeList[change.nodeID][changeTypes.POSITION_CHANGE] = {\n        nodeID: change.nodeID,\n        oldPosition: firstOldPosition,\n        newPosition: change.newPosition\n      };\n    }\n  },\n  actions: {}\n};\n","import { Point, Vector } from \"@/types/graphics\";\nimport { addVector, vectorOnNumber } from \"@/tools/graphics\";\nimport { debounce } from \"lodash\";\n\nexport interface State {\n  zoom: number;\n  zoomCenter: Point;\n  pan: Point;\n  debouncedZoom: number;\n  debouncedPan: Point;\n}\n\nexport const mutations = {\n  ADD_ZOOM: \"ADD_ZOOM\",\n  ADD_PAN: \"ADD_PAN\",\n  SET_PAN: \"SET_PAN\",\n  SET_ZOOM_CENTER: \"SET_ZOOM_CENTER\",\n  RESET_ZOOM_AND_PAN: \"RESET_ZOOM_AND_PAN\"\n};\n\nconst zoomDebounce = debounce((state, value: number) => {\n  state.debouncedZoom = value;\n}, 100);\n\nconst panDebounce = debounce((state, value: Point) => {\n  state.debouncedPan = value;\n}, 100);\n\nconst ZOOM_SENSITIVITY = 1 / 500;\nconst PAN_SENSITIVITY = 1;\n\nexport const store = {\n  namespaced: true,\n  state: {\n    zoom: 1,\n    pan: { x: 0, y: 0 },\n    debouncedZoom: 1,\n    debouncedPan: { x: 0, y: 0 },\n    zoomCenter: { x: 0, y: 0 }\n  },\n  mutations: {\n    [mutations.SET_ZOOM_CENTER](state: State, center: Point) {\n      state.zoomCenter = center;\n    },\n    [mutations.ADD_ZOOM](state: State, delta: number) {\n      const newZoom = state.zoom * Math.pow(2, delta * ZOOM_SENSITIVITY);\n      if (newZoom < 0.5) {\n        // foolproof from too much zoom\n        return;\n      }\n      state.zoom = newZoom;\n      zoomDebounce(state, state.zoom);\n    },\n    [mutations.ADD_PAN](state: State, delta: Vector) {\n      state.pan = addVector(\n        { from: { x: 0, y: 0 }, to: state.pan },\n        vectorOnNumber(delta, PAN_SENSITIVITY)\n      ).to;\n      panDebounce(state, state.pan);\n    },\n    [mutations.SET_PAN](state: State, point: Point) {\n      state.pan = point;\n      panDebounce(state, state.pan);\n    },\n    [mutations.RESET_ZOOM_AND_PAN](state: State, point: Point) {\n      state.pan = {x:0, y:0};\n      panDebounce(state, state.pan);\n      state.zoom = 1;\n      zoomDebounce(state, state.zoom);\n    }\n  }\n};\n","export interface State {\n  nodeIDs: string[];\n}\n\nexport const mutations = {\n  SET_NODE_IDS: \"SET_NODE_IDS\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    nodeIDs: []\n  },\n  mutations: {\n    [mutations.SET_NODE_IDS](state: State, nodeIDs: Array<string>) {\n      // show only first 20 results\n      if (nodeIDs.length > 20) {\n        // TODO: show notification that only first 20 results are shown\n        state.nodeIDs = nodeIDs.slice(0, 20);\n      } else {\n        state.nodeIDs = nodeIDs;\n      }\n    }\n  }\n};\n","import {\n  Commit,\n  createStore,\n  Dispatch,\n  Store,\n  useStore as baseUseStore\n} from \"vuex\";\nimport { InjectionKey } from \"vue\";\n\nimport { store as pinStore, State as PinState } from \"./pin\";\nimport { store as subscriptionsStore, State as SubscriptionsState } from \"./subscriptions\";\n\nimport { store as titleBoxStore, State as TitleBoxState } from \"./title_box\";\n\nimport {\n  store as preconditionStore,\n  State as PreconditionState\n} from \"./precondition\";\n\nimport {\n  store as imageStore,\n  State as ImageState\n} from \"./image\";\n\nimport {\n  store as positionChangePermitsStore,\n  State as positionChangePermitsState\n} from \"./position_change_permits\";\n\nimport {\n  store as treeStore,\n  State as TreeState,\n  mutations as treeMutations\n} from \"./tree\";\n\nimport { store as zoomPanStore, State as ZoomPanState } from \"./zoom_pan\";\n\nimport {\n  store as userStore,\n  State as UserState,\n  mutations as userMutations,\n  actions as userActions\n} from \"./user\";\n\nimport {\n  store as historyStore,\n  State as HistoryState,\n  mutations as historyMutations\n} from \"./history\";\n\nimport {\n  store as nodeContentStore,\n  State as NodeContentState\n} from \"./node_content\";\n\nimport {\n  store as searchResultStore,\n  State as SearchResultState\n} from \"./search_result\";\n\nimport api from \"@/api/api\";\nimport { initData } from \"./helpers\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport {\n  createNewNode,\n  findMapNode,\n  getNewNodeCenter\n} from \"@/store/tree/helpers\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { addVector, convertPosition } from \"@/tools/graphics\";\nimport { debounce } from \"lodash\";\nimport { printError } from \"@/tools/utils\";\nimport firebase from \"firebase/compat\";\n\nexport type State = {\n  // root states\n  editModeOn: boolean;\n\n  // module states\n  titleBox: TitleBoxState;\n  pin: PinState;\n  subscriptions: SubscriptionsState;\n  image: ImageState;\n  precondition: PreconditionState;\n  positionChangePermits: positionChangePermitsState;\n  tree: TreeState;\n  user: UserState;\n  zoomPan: ZoomPanState;\n  history: HistoryState;\n  nodeContent: NodeContentState;\n  searchResult: SearchResultState;\n};\n\nexport const actions = {\n  init: \"init\",\n  updateNodePosition: \"updateNodePosition\",\n  createNode: \"createNode\",\n  cutPasteNode: \"cutPasteNode\",\n  removeNode: \"removeNode\",\n  setEditMode: \"setEditMode\",\n\n  // confirmSignInPopup\n  confirmSignInPopup: \"confirmSignInPopup\"\n};\n\nexport const mutations = {\n  SET_EDIT_MODE: \"SET_EDIT_MODE\",\n};\n\nconst debouncedPositionSet = debounce(\n  (\n    nodeID: string,\n    newCenter: Point,\n    parentID: string,\n    mapNodeLayers: Record<string, MapNode>[]\n  ) => {\n    const [normalizedNewNodeCenter] = convertPosition(\n      \"normalize\",\n      newCenter,\n      parentID,\n      mapNodeLayers\n    );\n\n    api.update({ [`map/${nodeID}/position`]: normalizedNewNodeCenter });\n  },\n  200\n);\n\nexport const key: InjectionKey<Store<State>> = Symbol();\n\nexport const store = createStore<State>({\n  state: {\n    editModeOn: false,\n  } as State,\n  mutations: {\n    [mutations.SET_EDIT_MODE](state: State, val: boolean) {\n      state.editModeOn = val;\n    },\n  },\n  actions: {\n    /**\n     * confirmSignInPopup\n     * @param commit\n     * @param val\n     */\n    async [actions.confirmSignInPopup](\n      { dispatch }: { dispatch: Dispatch; state: State },\n      val: {confirm:  {\n        require(args: {\n          message?: string;\n          target?: EventTarget;\n          group?: string;\n          icon?: string;\n          header?: string;\n          accept?: () => void;\n          reject?: () => void;\n          acceptLabel?: string;\n          rejectLabel?: string;\n          acceptIcon?: string;\n          rejectIcon?: string;\n          blockScroll?: boolean;\n          acceptClass?: string;\n          rejectClass?: string;\n        }): void;\n\n        close(): void;\n      },\n      message: string,\n      }\n    ) {\n      val.confirm.require({\n        message: val.message,\n        header: \"SignIn\",\n        acceptLabel: \"Ok, Sign In\",\n        rejectLabel: \"No, thanks, just watching\",\n        accept: async () => {\n          await dispatch(`user/${userActions.signIn}`);\n        },\n        reject: () => {\n          return;\n        }\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param val\n     */\n    [actions.setEditMode](\n      { commit }: { commit: Commit; state: State },\n      val: boolean\n    ) {\n      commit(mutations.SET_EDIT_MODE, val);\n    },\n\n    /**\n     *\n     * @param commit\n     */\n    async [actions.init]({ commit }: { commit: Commit }) {\n      api.initFirebase();\n      firebase.auth().onAuthStateChanged(user => {\n        if (user && !user.isAnonymous) {\n          api.setPublicUserData(user.uid, user.displayName, null);\n          commit(`user/${userMutations.SET_USER}`, user);\n          initData(user);\n        } else {\n          commit(`user/${userMutations.SET_USER}`, null);\n          initData(null);\n        }\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.createNode](\n      { commit, state }: { commit: Commit; state: State },\n      v: {\n        parentID: string;\n        title: string;\n      }\n    ) {\n      const parent = state.tree.nodeRecord[v.parentID].node;\n      const [newCenter, changedNode, err1] = getNewNodeCenter(\n        parent,\n        state.tree.mapNodeLayers,\n        true\n      );\n      if (err1 !== null) {\n        printError(\"Cannot create new center\", {\n          err: err1,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n\n      const [normalizedPosition, err2] = convertPosition(\n        \"normalize\",\n        newCenter!,\n        v.parentID,\n        state.tree.mapNodeLayers\n      );\n      if (err2) {\n        printError(\"createNode: cannot create new center\", {\n          err: err2,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n      const node = createNewNode(v.title, normalizedPosition!);\n      const newDBNode = {\n        id: node.id,\n        parentID: v.parentID,\n        name: v.title,\n        children: [],\n        position: normalizedPosition\n      };\n      const newKey = api.generateKey();\n      const updateMap: Record<string, any> = {\n        [`map/${newDBNode.id}`]: newDBNode,\n        [`map/${newDBNode.parentID}/children/${newKey}`]: newDBNode.id\n      };\n\n      if (changedNode) {\n        const [normalizedChangedCenter] = convertPosition(\n          \"normalize\",\n          changedNode.position,\n          v.parentID,\n          state.tree.mapNodeLayers\n        );\n        updateMap[`map/${changedNode.id}/position`] = normalizedChangedCenter;\n      }\n\n      // check that parent node still exists\n      // maybe its better to check this as security rule?\n      const pn = await api.getMapNode(v.parentID)\n      if (!pn) {\n        console.error(\"Cannot find parent to add node\", v.parentID)\n        return\n      }\n      await api.update(updateMap);\n\n      commit(`history/${historyMutations.ADD_CREATE}`, {\n        nodeID: node.id,\n        parentID: v.parentID\n      });\n\n      return node.id;\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.cutPasteNode](\n      { commit, state }: { commit: Commit; state: State },\n      v: {\n        nodeID: string;\n        parentID: string;\n      }\n    ) {\n      // remove nodeID from oldParent children,\n      // add to newParent children,\n      // recalculate position of node, normalize it and\n      // update DB with these three modifications in one transaction\n      const oldParent = state.tree.nodeRecord[v.nodeID].parent;\n      const newParent = state.tree.nodeRecord[v.parentID].node;\n      const [newCenter, changedNode, err1] = getNewNodeCenter(\n        newParent,\n        state.tree.mapNodeLayers,\n        true\n      );\n      if (err1) {\n        printError(\"cutPasteNode: cannot getNewNodeCenter\", { err: err1 });\n        return;\n      }\n      const [normalizedNewNodeCenter, err2] = convertPosition(\n        \"normalize\",\n        newCenter!,\n        v.parentID,\n        state.tree.mapNodeLayers\n      );\n      if (err2) {\n        printError(\"cutPasteNode: cannot create new center\", {\n          err: err2,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n      // generate key for new child in list of newParent\n      const newKey = api.generateKey();\n      // search for key of childID in children of oldParent\n      const oldKey = await api.findKeyOfChild(oldParent!.id, v.nodeID);\n      const updateMap = {\n        [`map/${v.nodeID}/parentID`]: newParent!.id,\n        [`map/${oldParent!.id}/children/${oldKey}`]: null, // remove from old parent children\n        [`map/${newParent!.id}/children/${newKey}`]: v.nodeID, // add to children of new parents\n        [`map/${v.nodeID}/position`]: normalizedNewNodeCenter\n      };\n      if (changedNode) {\n        const [normalizedChangedCenter] = convertPosition(\n          \"normalize\",\n          changedNode.position,\n          v.parentID,\n          state.tree.mapNodeLayers\n        );\n        updateMap[`map/${changedNode.id}/position`] = normalizedChangedCenter;\n      }\n      await api.update(updateMap);\n\n      commit(`history/${historyMutations.ADD_CUT_PASTE}`, {\n        nodeID: v.nodeID,\n        parentID: v.parentID\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param nodeID\n     */\n    async [actions.removeNode](\n      { commit, state }: { commit: Commit; state: State },\n      nodeID: string\n    ) {\n      const parent = state.tree.nodeRecord[nodeID].parent;\n      if (!parent) {\n        return;\n      }\n\n      // do main actions on backend (see functions/cmd_remove.js)\n      await api.update({ [`cmd/remove`]: nodeID });\n\n      commit(`history/${historyMutations.ADD_REMOVE}`, {\n        parentNodeID: parent.id,\n        nodeID: nodeID\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    [actions.updateNodePosition](\n      { commit, state }: { commit: Commit; state: State },\n      v: { nodeId: string; delta: Point }\n    ) {\n      if (!state.editModeOn) {\n        return;\n      }\n      const [mapNode] = findMapNode(v.nodeId, state.tree.mapNodeLayers);\n      if (!mapNode) {\n        return NewErrorKV(\"UPDATE_NODE_POSITION: cannot find mapNode\", {\n          \"v.nodeId\": v.nodeId,\n          \"state.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n      }\n      const newCenter = addVector(\n        { from: { x: 0, y: 0 }, to: mapNode.center },\n        { from: { x: 0, y: 0 }, to: v.delta }\n      ).to;\n\n      const args = { nodeId: v.nodeId, newCenter, returnError: null };\n      commit(`tree/${treeMutations.UPDATE_NODE_POSITION}`, args);\n      if (args.returnError === null) {\n        commit(`history/${historyMutations.ADD_POSITION_CHANGE}`, {\n          nodeID: v.nodeId,\n          oldPosition: mapNode.center,\n          newPosition: newCenter\n        });\n\n        // save to DB with debounce\n        debouncedPositionSet(\n          v.nodeId,\n          newCenter,\n          state.tree.nodeRecord[v.nodeId].parent!.id,\n          state.tree.mapNodeLayers\n        );\n      }\n    }\n  },\n  modules: {\n    pin: pinStore,\n    subscriptions: subscriptionsStore,\n    titleBox: titleBoxStore,\n    image: imageStore,\n    precondition: preconditionStore,\n    positionChangePermits: positionChangePermitsStore,\n    tree: treeStore,\n    user: userStore,\n    zoomPan: zoomPanStore,\n    history: historyStore,\n    nodeContent: nodeContentStore,\n    searchResult: searchResultStore\n  }\n});\n\n// define your own `useStore` composition function\nexport function useStore() {\n  return baseUseStore(key);\n}\n","\nimport { defineComponent } from \"vue\";\nimport { useStore, actions } from \"@/store\";\nexport default defineComponent({\n  setup() {\n    const store = useStore();\n    store.dispatch(actions.init);\n  }\n});\n","import { render } from \"./App.vue?vue&type=template&id=8c892ede\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  This section is just for test/emulator cases for now\n  <input id=\"email\" />\n  <input id=\"password\" />\n  <button @click=\"login\">login</button>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport api from \"@/api/api\";\nimport { mutations } from \"@/store/user\";\nimport firebase from \"firebase/compat\";\nimport { useStore } from \"@/store\";\n\nexport default defineComponent({\n  name: \"PasswordLogin\",\n\n  setup() {\n    const store = useStore();\n\n    return {\n      login: async () => {\n        const emailEl = document.getElementById(\"email\") as HTMLInputElement;\n        const passwordEl = document.getElementById(\n          \"password\"\n        ) as HTMLInputElement;\n        await firebase\n          .auth()\n          .signInWithEmailAndPassword(emailEl.value, passwordEl.value);\n      }\n    };\n  }\n});\n</script>\n","\nimport { defineComponent } from \"vue\";\nimport api from \"@/api/api\";\nimport { mutations } from \"@/store/user\";\nimport firebase from \"firebase/compat\";\nimport { useStore } from \"@/store\";\n\nexport default defineComponent({\n  name: \"PasswordLogin\",\n\n  setup() {\n    const store = useStore();\n\n    return {\n      login: async () => {\n        const emailEl = document.getElementById(\"email\") as HTMLInputElement;\n        const passwordEl = document.getElementById(\n          \"password\"\n        ) as HTMLInputElement;\n        await firebase\n          .auth()\n          .signInWithEmailAndPassword(emailEl.value, passwordEl.value);\n      }\n    };\n  }\n});\n","import { render } from \"./PasswordLogin.vue?vue&type=template&id=63c7a1a8\"\nimport script from \"./PasswordLogin.vue?vue&type=script&lang=ts\"\nexport * from \"./PasswordLogin.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <ConfirmDialog></ConfirmDialog>\n  <Toast position=\"bottom-left\">\n    <template #icon=\"slotProps\">\n      <div class=\"p-toast-message-icon\">\n        <span :class=\"slotProps.class\"></span>\n      </div>\n    </template>\n    <template #message=\"slotProps\">\n      <div class=\"p-toast-message-text\">\n        <span class=\"p-toast-summary\">{{slotProps.message.summary}}</span>\n        <div class=\"p-toast-detail\" v-html=\"slotProps.message.detail\" />\n      </div>\n    </template>\n  </Toast>\n  <NodeContent\n    :clickedTitleId=\"clickedTitleId\"\n    @select-precondition-is-on=\"setSelectPreconditionON\"\n    @select-precondition-is-off=\"setSelectPreconditionOFF\"\n    :show=\"!editModeOn\"\n    :selectedNodeId=\"selectedNodeId\"\n  />\n  <Menu\n      @restore-select-new-parent-is-on=\"setRestoreSelectNewParentON\"\n      @restore-select-new-parent-is-off=\"setRestoreSelectNewParentOFF\"\n      :clickedTitleId=\"clickedTitleId\"\n  />\n  <Map\n    :layers=\"visibleZoomedPanedLayers\"\n    :selectedNodeId=\"selectedNodeId\"\n    :selectedNodePreconditionIds=\"selectedNodePreconditionIds\"\n    :pin-nodes=\"pinNodes\"\n    :searchResultPinNodes=\"searchResultPinNodes\"\n    :searchResultNodeIDs=\"searchResultNodeIDs\"\n    @title-dragging=\"nodeDragging\"\n    @title-click=\"titleClick\"\n    @title-over=\"titleOver\"\n    @title-leave=\"titleLeave\"\n    @dragging-background=\"mapDragging\"\n    @wheel=\"zoom\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref, watch } from \"vue\";\nimport Map from \"@/components/map/Map.vue\";\nimport NodeContent from \"@/components/node_content/Index.vue\";\nimport ConfirmDialog from \"primevue/confirmdialog\";\nimport Toast from \"primevue/toast\";\nimport {\n  EventClickNode,\n  EventDraggingBackground,\n  EventDraggingNode,\n  EventWheel\n} from \"@/components/map/Map\";\nimport Menu from \"@/components/menu/Index.vue\";\nimport { useStore } from \"@/store\";\nimport { useRouter, useRoute, onBeforeRouteUpdate } from \"vue-router\";\nimport { mutations as treeMutations, NodeRecordItem } from \"@/store/tree\";\nimport { mutations as zoomPanMutations } from \"@/store/zoom_pan\";\nimport { actions } from \"@/store/\";\nimport {\n  filterNodesAndLayers,\n  findCentralNode,\n  zoomAndPanPoint,\n  zoomAnPanLayers\n} from \"@/views/Home\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { actions as positionChangePermitsActions } from \"@/store/position_change_permits\";\n\nexport default defineComponent({\n  name: \"Home\",\n\n  components: {\n    Map,\n    Menu,\n    NodeContent,\n    ConfirmDialog,\n    Toast\n  },\n\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const route = useRoute();\n    const treeState = store.state.tree;\n    const zoomPanState = store.state.zoomPan;\n    const pinState = store.state.pin;\n    const searchResultState = store.state.searchResult;\n    const clickedTitleId = ref(\"-1\");\n    let selectPreconditionIsOn = false;\n    let restoreSelectNewParentIsOn = false;\n    let titleOver = false;\n\n    // Set node from URL as selected\n    watch(\n      () => route.params.id,\n      () => {\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      { immediate: true }\n    );\n\n    /**\n     * Method updateLayers extracts visibleLayers and nodes from mapNodeLayers.\n     * These are the nodes that will be visible to the user\n     * (and are always just a small part of all nodes of the map).\n     * @param centralNodeId\n     * @param mapNodeLayers\n     * @param nodeRecord\n     */\n    const updateLayers = (\n      centralNodeId: string,\n      mapNodeLayers: Array<Record<string, MapNode>>,\n      nodeRecord: Record<string, NodeRecordItem>\n    ): Array<Record<number, MapNode>> => {\n      // Вычленяем слои и узлы которые мы хотим показывать учитывая что текущий видимый узел это centralNodeId\n      const [filteredLayers, err] = filterNodesAndLayers(\n        mapNodeLayers,\n        nodeRecord,\n        centralNodeId\n      );\n      if (err) {\n        printError(\"Home.vue: error in filterNodesAndLayers:\", { err });\n        return [];\n      }\n      return filteredLayers.reverse();\n    };\n\n    const centralNodeId = ref<string | null>(null);\n    // visibleLayers consists only from user visible nodes and visibleLayers of all (which is treeState.mapNodeLayers)\n    const visibleLayers = ref<Array<Record<string, MapNode>>>([]);\n\n    // Ugly hack to determine a first load of page\n    let isFirstPageLoad = true;\n    onBeforeRouteUpdate(async (to, from) => {\n      isFirstPageLoad = false;\n    });\n    // If this is isFirstPageLoad then pan map to node in URL\n    watch(\n      () => [treeState.mapNodeLayers],\n      () => {\n        if (\n          isFirstPageLoad &&\n          route.params.id.length > 0 &&\n          treeState.mapNodeLayers.length > 0\n        ) {\n          const [firstNode] = findMapNode(\n            route.params.id as string,\n            treeState.mapNodeLayers\n          );\n          if (firstNode != null) {\n            store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n              x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n              y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n            });\n          }\n        }\n      }\n    );\n\n    // Determine which nodes to show based on current pan and zoom\n    watch(\n      () => [\n        treeState.mapNodeLayers,\n        zoomPanState.debouncedZoom,\n        zoomPanState.debouncedPan\n      ],\n      () => {\n        const [newCentralNodeId, err] = findCentralNode(\n          treeState.mapNodeLayers,\n          treeState.nodeRecord,\n          { width: window.innerWidth, height: window.innerHeight },\n          zoomPanState.debouncedZoom,\n          zoomPanState.pan,\n            {x:window.innerWidth/2, y:window.innerHeight/2}\n          // zoomPanState.zoomCenter\n        );\n        if (err != null) {\n          printError(\"filterNodesAndLayers: error in findCurrentNode\", { err });\n        }\n\n        centralNodeId.value = newCentralNodeId;\n        visibleLayers.value = updateLayers(\n          newCentralNodeId,\n          treeState.mapNodeLayers,\n          treeState.nodeRecord\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    const visibleZoomedPanedLayers = ref<Array<Record<string, MapNode>>>([]);\n    watch(\n      () => [\n        zoomPanState.pan.x,\n        zoomPanState.pan.y,\n        zoomPanState.zoom,\n        visibleLayers\n      ],\n      () => {\n        // visibleLayers это всегда слои с zoom=1 и pan={0, 0} состоящий из только видимых прямо сейчас элементов.\n        // Мы применяем к этому объекту текущий zoomPanState, но сам эталон не трогаем, поэтому здесь clone\n        // Это не дорогая операция так как visibleLayers всегда содержит небольшое кол-во элементов\n        // видимых только прямо сейчас\n        const layersToZoomAndPan = clone(visibleLayers.value);\n        visibleZoomedPanedLayers.value = zoomAnPanLayers(\n          layersToZoomAndPan,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      /**\n       * pinNodes\n       */\n      pinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const pinNodeIDs = pinState.pinsReverse[centralNodeId.value];\n        if (!pinNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = pinNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                pinNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const pinMapNodes = findMapNodes(pinNodeIDs, treeState.mapNodeLayers);\n        const result = [];\n        for (const pinMapNode of pinMapNodes) {\n          const cl = clone(pinMapNode);\n          cl.center = zoomAndPanPoint(\n            pinMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      /**\n       * searchResultNodeIDs\n       */\n      searchResultNodeIDs: computed(() => {\n        return searchResultState.nodeIDs;\n      }),\n\n      /**\n       * searchResultPinNodes\n       */\n      searchResultPinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const searchResultNodeIDs = clone(searchResultState.nodeIDs);\n        if (!searchResultNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = searchResultNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                searchResultNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const searchResultMapNodes = findMapNodes(\n          searchResultNodeIDs,\n          treeState.mapNodeLayers\n        );\n        const result = [];\n        for (const searchResultMapNode of searchResultMapNodes) {\n          const cl = clone(searchResultMapNode);\n          cl.center = zoomAndPanPoint(\n            searchResultMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNodeId: computed(() => treeState.selectedNodeId),\n      selectedNodePreconditionIds: computed(() =>\n        treeState.selectedNodeId\n          ? store.state.precondition.preconditions[treeState.selectedNodeId]\n          : []\n      ),\n      visibleZoomedPanedLayers: visibleZoomedPanedLayers,\n      nodeDragging: async (e: EventDraggingNode) => {\n        const hasDragPermit = await store.dispatch(\n          `positionChangePermits/${positionChangePermitsActions.CheckNodeID}`,\n          e.id\n        );\n        if (!hasDragPermit) {\n          return;\n        }\n        await store.dispatch(`${actions.updateNodePosition}`, {\n          nodeId: e.id,\n          delta: {\n            x: e.delta.x / zoomPanState.zoom,\n            y: e.delta.y / zoomPanState.zoom\n          }\n        });\n      },\n      setSelectPreconditionON: () => {\n        selectPreconditionIsOn = true;\n      },\n      setSelectPreconditionOFF: () => {\n        selectPreconditionIsOn = false;\n        clickedTitleId.value = \"-1\"\n      },\n      setRestoreSelectNewParentON: () => {\n        restoreSelectNewParentIsOn = true;\n      },\n      setRestoreSelectNewParentOFF: () => {\n        restoreSelectNewParentIsOn = false;\n      },\n      clickedTitleId,\n      titleClick: (e: EventClickNode) => {\n        if (restoreSelectNewParentIsOn || selectPreconditionIsOn) {\n          clickedTitleId.value = e.id;\n        } else {\n          router.push({ name: \"node\", params: { id: e.id } });\n        }\n      },\n      titleOver: (e: EventClickNode) => {\n        titleOver = true;\n        store.commit(`tree/${treeMutations.SET_SELECTED_NODE_ID}`, e.id);\n      },\n      titleLeave: (e: EventClickNode) => {\n        titleOver = false;\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      mapDragging: (event: EventDraggingBackground) => {\n        if (store.state.editModeOn && titleOver) {\n          // to prevent pan while node position editing ( = title dragging in edit mode)\n          return;\n        }\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, event);\n      },\n      zoom: (event: EventWheel) => {\n        // initial value of center (when root.border == viewport)\n        const initial = {\n          x: (event.center.x - zoomPanState.pan.x) / zoomPanState.zoom,\n          y: (event.center.y - zoomPanState.pan.y) / zoomPanState.zoom\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_ZOOM}`, -1 * event.delta);\n        const after = {\n          x: initial.x * zoomPanState.zoom + zoomPanState.pan.x,\n          y: initial.y * zoomPanState.zoom + zoomPanState.pan.y\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, {\n          from: after,\n          to: event.center\n        });\n        store.commit(\n          `zoomPan/${zoomPanMutations.SET_ZOOM_CENTER}`,\n          event.center\n        );\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    :width=\"svgWidth\"\n    :height=\"svgHeight\"\n    :id=\"mapID\"\n    style=\"touch-action: none;\"\n  >\n    <MapLayer\n      v-for=\"(layer, index) of layers\"\n      :key=\"index\"\n      :layer-id=\"index\"\n      :map-nodes=\"layer\"\n      :border-color=\"borderColor(index)\"\n      :font-color=\"fontColor(index)\"\n      :font-size=\"fontSize(index)\"\n      :font-opacity=\"fontOpacity(index)\"\n      :selectedNodeId=\"selectedNodeId\"\n      :selectedNodePreconditionIds=\"selectedNodePreconditionIds\"\n      :searchResultNodeIDs=\"searchResultNodeIDs\"\n      :map-id=\"mapID\"\n      @title-dragging=\"draggingNode\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PreconditionLayer\n      :selectedNodeId=\"selectedNodeId\"\n      :visibleTitleIds=\"visibleTitleIds\"\n      :layer-id=\"`precondition`\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PinLayer\n      :pinNodes=\"pinNodes\"\n      :layer-id=\"`pinNodes`\"\n      color=\"pink\"\n      :font-size=\"8\"\n      font-weight=\"normal\"\n      text-decoration=\"none\"\n      :selectedNodeId=\"selectedNodeId\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PinLayer\n      :pinNodes=\"searchResultPinNodes\"\n      :layer-id=\"`searchResultPinNodes`\"\n      color=\"red\"\n      :font-size=\"10\"\n      font-weight=\"bold\"\n      text-decoration=\"underline\"\n      :selectedNodeId=\"selectedNodeId\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n  </svg>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, PropType } from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport MapLayer from \"@/components/map_layer/MapLayer.vue\";\nimport {\n  EventClickNode,\n  EventDraggingNode\n} from \"@/components/map_layer/MapLayer\";\nimport pan from \"./MapPan\";\nimport PinLayer from \"@/components/pin_layer/PinLayer.vue\";\nimport { printError } from \"@/tools/utils\";\nimport PreconditionLayer from \"@/components/precondition_layer/PreconditionLayer.vue\";\n\nconst mapID = \"mapID\";\n\nexport default defineComponent({\n  name: \"Map\",\n  emits: [\n    \"title-dragging\",\n    \"title-click\",\n    \"title-over\",\n    \"title-leave\",\n    \"dragging-background\",\n    \"wheel\"\n  ],\n  components: {\n    PreconditionLayer,\n    PinLayer,\n    MapLayer\n  },\n  props: {\n    layers: Object as PropType<Array<Record<string, MapNode>>>,\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    pinNodes: Object as PropType<MapNode[]>,\n    searchResultPinNodes: Object as PropType<MapNode[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n  setup(props, ctx) {\n    onMounted(() => {\n      const map = document.getElementById(mapID);\n      if (!map) {\n        printError(\"Map.vue: cannot find map id for event listener\", {});\n        return;\n      }\n\n      map.addEventListener(\"mousedown\", event => {\n        pan.mouseDown();\n      });\n      map.addEventListener(\"mouseup\", event => {\n        pan.mouseUp();\n      });\n      map.addEventListener(\"mousemove\", event => {\n        pan.mouseMove(ctx.emit, {\n          from: {\n            x: event.clientX - event.movementX,\n            y: event.clientY - event.movementY\n          },\n          to: { x: event.clientX, y: event.clientY }\n        });\n      });\n\n      // zoom with mouse wheel\n      map.addEventListener(\n        \"wheel\",\n        event => {\n          ctx.emit(\"wheel\", {\n            delta: event.deltaY,\n            center: { x: event.clientX, y: event.clientY }\n          });\n        },\n        { passive: true }\n      );\n\n      let prevDist = Infinity;\n      const prevPoint = { x: Infinity, y: Infinity };\n      map.addEventListener(\n        \"touchstart\",\n        event => {\n          pan.mouseDown();\n        },\n        { passive: true }\n      );\n      map.addEventListener(\"touchend\", event => {\n        prevDist = Infinity;\n        prevPoint.x = Infinity;\n        prevPoint.y = Infinity;\n        pan.mouseUp();\n      });\n\n      // mobile zoom\n      map.addEventListener(\n        \"touchmove\",\n        e => {\n          if (e.touches.length === 1) {\n            if (prevPoint.x != Infinity && prevPoint.y != Infinity) {\n              pan.mouseMove(ctx.emit, {\n                from: prevPoint,\n                to: { x: e.touches[0].clientX, y: e.touches[0].clientY }\n              });\n            }\n            prevPoint.x = e.touches[0].clientX;\n            prevPoint.y = e.touches[0].clientY;\n          } else if (e.touches.length === 2) {\n            let delta = 0;\n            const dist = Math.hypot(\n              e.touches[0].pageX - e.touches[1].pageX,\n              e.touches[0].pageY - e.touches[1].pageY\n            );\n            if (prevDist !== Infinity) {\n              delta = prevDist - dist;\n            }\n            prevDist = dist;\n\n            ctx.emit(\"wheel\", {\n              delta: delta,\n              center: {\n                x: (e.touches[0].pageX - e.touches[1].pageX) / 2,\n                y: (e.touches[0].pageY - e.touches[1].pageY) / 2\n              }\n            });\n          }\n        },\n        { passive: true }\n      );\n    });\n\n    return {\n      svgWidth: window.innerWidth,\n      // 0.99 because if svg == innerHeight then browser vertical scroll bar appears\n      svgHeight: 0.99 * window.innerHeight,\n      visibleTitleIds: computed(() => {\n        if (!props.layers) {\n          return [];\n        }\n        const ids = [];\n        for (const layer of props.layers) {\n          for (const idx in layer) {\n            if (layer[idx].title != \"\") {\n              ids.push(idx);\n            }\n          }\n        }\n        return ids;\n      }),\n      draggingNode: (e: EventDraggingNode) => {\n        ctx.emit(\"title-dragging\", {\n          id: e.nodeId,\n          delta: e.delta\n        });\n      },\n      titleClick: (e: EventClickNode) => {\n        ctx.emit(\"title-click\", { id: e.id });\n      },\n      titleOver: (e: EventClickNode) => {\n        ctx.emit(\"title-over\", { id: e.id });\n      },\n      titleLeave: (e: EventClickNode) => {\n        ctx.emit(\"title-leave\", { id: e.id });\n      },\n      mapID: mapID,\n      fontSize: (index: number): number => {\n        let size = 0;\n        const levelSizes: Record<number, number> = {\n          0: 0.4,\n          1: 0.73,\n          2: 1.4,\n          3: 1.86\n        };\n        if (props.layers!.length >= 4) {\n          size = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          size = levelSizes[index + 1];\n        }\n        return size;\n      },\n      fontOpacity: (index: number): number => {\n        let val = 0;\n        const levelSizes: Record<number, number> = {\n          0: 1,\n          1: 1,\n          2: 0.2,\n          3: 1\n        };\n        if (props.layers!.length >= 4) {\n          val = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          val = levelSizes[index + 1];\n        }\n        return val;\n      },\n      fontColor: (index: number): string => {\n        if (props.layers!.length >= 4) {\n          return `rgb(${200 - 100 * index},${200 - 100 * index},${200 -\n            100 * index})`;\n        }\n        if (props.layers!.length == 3) {\n          return `rgb(${200 - 100 * (index + 1)},${200 -\n            100 * (index + 1)},${200 - 100 * (index + 1)})`;\n        }\n        return \"\";\n      },\n      borderColor: (index: number): string => {\n        let color = 0;\n        const levelColors: Record<number, number> = {\n          0: 240,\n          1: 200,\n          2: 100,\n          3: 90\n        };\n        if (props.layers!.length >= 4) {\n          color = levelColors[index];\n        }\n        if (props.layers!.length == 3) {\n          color = levelColors[index + 1];\n        }\n        return `rgb(${color},${color},${color})`;\n      }\n    };\n  }\n});\n</script>\n\n<style scoped></style>\n","<template>\n  <polygon\n    v-for=\"(mapNode, i) of mapNodes\"\n    :key=\"i\"\n    :stroke=\"borderColor\"\n    :fill=\"polygonFill(selectedNodeId, mapNode.id, selectedNodePreconditionIds)\"\n    :fill-opacity=\"\n      polygonFillOpacity(\n        selectedNodeId,\n        mapNode.id,\n        selectedNodePreconditionIds\n      )\n    \"\n    stroke-width=\"2\"\n    :points=\"polygonToPath(mapNode.border)\"\n    pointer-events=\"none\"\n  />\n  <!--    <circle-->\n  <!--      v-for=\"mapNode of mapNodes\"-->\n  <!--      :key=\"mapNode.id\"-->\n  <!--      :cx=\"mapNode.center.x\"-->\n  <!--      :cy=\"mapNode.center.y\"-->\n  <!--      r=\"10\"-->\n  <!--      stroke=\"black\"-->\n  <!--      stroke-width=\"1\"-->\n  <!--      fill=\"red\"-->\n  <!--    />-->\n  <!--  <SVGTextBox> component shows unpredictable behaviour here and I didn't dig the reason so just used copy of SVGTextBox here -->\n  <text\n    v-for=\"mapNode of mapNodes\"\n    :id=\"`${TITLE_PREFIX}${mapNode.id}`\"\n    :key=\"mapNode.id\"\n    font-family=\"Roboto\"\n    :font-size=\"`${fontSize}vmax`\"\n    :font-weight=\"textWeight(mapNode.id, selectedNodeId)\"\n    :fill=\"textColor(mapNode.id, selectedNodeId)\"\n    :fill-opacity=\"fontOpacity\"\n    :text-decoration=\"textDecoration(mapNode.id)\"\n    class=\"text\"\n  >\n    <tspan\n      v-for=\"(line, i) of splitLines(mapNode.title, 20)\"\n      :key=\"i\"\n      :x=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.x : 0\"\n      :y=\"\n        titleBox[mapNode.id] && innerWidth>0\n          ? titleBox[mapNode.id].position.y + i * fontSize * Math.max(innerWidth, innerHeight)/100\n          : 0\n      \"\n      alignment-baseline=\"hanging\"\n    >\n      {{ line }}\n    </tspan>\n  </text>\n  <!-- Add rectangle to change cursor to pointer when hover on text -->\n  <rect\n    v-for=\"mapNode of mapNodes\"\n    :key=\"mapNode.id\"\n    :x=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.x : 0\"\n    :y=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.y : 0\"\n    :width=\"titleBox[mapNode.id] ? titleBox[mapNode.id].bbox.width : 0\"\n    :height=\"titleBox[mapNode.id] ? titleBox[mapNode.id].bbox.height : 0\"\n    fill=\"transparent\"\n    stroke-width=\"0\"\n    @mouseover=\"titleOver(mapNode.id)\"\n    @mouseleave=\"titleLeave(mapNode.id)\"\n    @click=\"titleClick(mapNode.id)\"\n    @mousedown=\"titleMouseDown(mapNode.id)\"\n    stroke=\"pink\"\n    cursor=\"pointer\"\n    pointer-events=\"fill\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport {\n  defineComponent,\n  PropType,\n  toRef,\n  onMounted,\n  onUnmounted,\n  computed\n} from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport {\n  polygonToPath,\n  polygonFill,\n  polygonFillOpacity\n} from \"@/tools/graphics\";\nimport {\n  setTitleBoxes,\n  MouseDownInfo,\n  mouseMoveListener,\n  mouseUpListener\n} from \"@/components/map_layer/MapLayer\";\nimport { printError } from \"@/tools/utils\";\nimport { splitLines } from \"@/components/SVGTextBox\";\nimport { useStore } from \"@/store\";\nimport { TitleBox, mutations as titleBoxMutations } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"title_\";\n\nexport default defineComponent({\n  name: \"MapLayer\",\n  emits: [\n    \"title-over\",\n    \"title-leave\",\n    \"title-click\",\n    \"title-drop\",\n    \"title-dragging\"\n  ],\n  props: {\n    layerId: {\n      type: Number\n    },\n    mapId: {\n      type: String,\n      required: true\n    },\n    mapNodes: {\n      type: Object as PropType<Record<string, MapNode>>,\n      required: true\n    },\n    borderColor: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontColor: {\n      type: String,\n      required: true\n    },\n    fontOpacity: {\n      type: Number,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n\n  setup(props, ctx) {\n    const mapNodes = toRef(props, \"mapNodes\");\n\n    const store = useStore();\n    const layerID = \"map_\" + props.layerId;\n    const titleBox = computed(() => {\n      return store.state.titleBox.layerMap[layerID];\n    });\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"center\",\n      mapNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    /**\n     * Send event on titleBox click, drag and drop\n     */\n    const titleMouseDownInfo: MouseDownInfo = {\n      nodeId: null,\n      dragStart: false\n    };\n    const mouseMove = (event: MouseEvent) =>\n      mouseMoveListener(ctx.emit, event, titleMouseDownInfo);\n    const mouseUp = () => mouseUpListener(ctx.emit, titleMouseDownInfo);\n    onMounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.addEventListener(\"mousemove\", mouseMove);\n      map.addEventListener(\"mouseup\", mouseUp);\n    });\n    onUnmounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.removeEventListener(\"mousemove\", mouseMove);\n      map.removeEventListener(\"mouseup\", mouseUp);\n    });\n\n    const searchResultNodeIDsMap = computed(() => {\n      const map = {} as Record<string, boolean>;\n      if (!props.searchResultNodeIDs) {\n        return map;\n      }\n      for (const id of props.searchResultNodeIDs) {\n        map[id] = true;\n      }\n      return map;\n    });\n\n    return {\n      TITLE_PREFIX,\n      titleBox,\n      innerWidth: window.innerWidth,\n      innerHeight: window.innerHeight,\n      textColor: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"#ffa500\";\n        }\n        if (\n          props.selectedNodePreconditionIds &&\n          props.selectedNodePreconditionIds?.indexOf(nodeID) != -1\n        ) {\n          return \"#ffa500\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"red\";\n        }\n\n        return props.fontColor;\n      },\n      textWeight: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"bold\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"bold\";\n        }\n\n        return \"normal\";\n      },\n      textDecoration: (nodeID: string) => {\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"underline\";\n        }\n\n        return \"none\";\n      },\n      titleClick: (nodeID: string) => {\n        ctx.emit(\"title-click\", {\n          id: nodeID\n        });\n      },\n      titleOver: (nodeID: string) => {\n        ctx.emit(\"title-over\", {\n          id: nodeID\n        });\n      },\n      titleLeave: (nodeID: string) => {\n        ctx.emit(\"title-leave\", {\n          id: nodeID\n        });\n      },\n      titleMouseDown: (id: string) => {\n        titleMouseDownInfo.nodeId = id;\n        titleMouseDownInfo.dragStart = false;\n      }\n    };\n  },\n\n  methods: {\n    splitLines,\n    polygonToPath,\n    polygonFill,\n    polygonFillOpacity\n  }\n});\n</script>\n\n<style scoped>\n.text {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n</style>\n","import { MapNode, Point } from \"@/types/graphics\";\nimport { nextTick, Ref, watch } from \"vue\";\n\nexport type EventClickNode = {\n  id: string;\n};\n\nexport type EventDraggingNode = {\n  nodeId: string;\n  delta: Point;\n};\n\nexport type MouseDownInfo = {\n  nodeId: string | null;\n  dragStart: boolean;\n};\n\ntype emitDragging = (\n  event: \"title-dragging\",\n  args: { nodeId: string; delta: Point }\n) => void;\ntype emitDrop = (event: \"title-drop\", args: { id: string }) => void;\n\ntype TitleBox = {\n  position: Point;\n  bbox: {\n    width: number;\n    height: number;\n  };\n};\n\nexport const mouseMoveListener = (\n  emit: emitDragging,\n  event: MouseEvent,\n  mouseDownInfo: MouseDownInfo\n) => {\n  if (mouseDownInfo.nodeId) {\n    mouseDownInfo.dragStart = true;\n    emit(\"title-dragging\", {\n      nodeId: mouseDownInfo.nodeId,\n      delta: {\n        x: event.movementX,\n        y: event.movementY\n      }\n    });\n  }\n};\n\nexport const mouseUpListener = (\n  emit: emitDrop,\n  mouseDownInfo: MouseDownInfo\n) => {\n  if (mouseDownInfo.nodeId) {\n    if (mouseDownInfo.dragStart) {\n      emit(\"title-drop\", { id: mouseDownInfo.nodeId });\n    }\n    mouseDownInfo.dragStart = false;\n    mouseDownInfo.nodeId = null;\n  }\n};\n\nexport const nodeToTitleBox = (\n  nodes: Record<string, MapNode>\n): Record<string, TitleBox> => {\n  const titleBox: Record<string, TitleBox> = {};\n  for (const i in nodes) {\n    const node = nodes[i];\n    titleBox[node.id] = {\n      position: node.center,\n      bbox: {\n        width: 0,\n        height: 0\n      }\n    };\n  }\n\n  return titleBox;\n};\n\nconst updateTitleBox = async (\n  titleIdPrefix: string,\n  position: \"center\" | \"left\",\n  mapNodes: Record<string, MapNode>\n): Promise<Record<string, TitleBox>> => {\n  const titleBox = {} as Record<string, TitleBox>;\n\n  // Code that will run only after the entire view has been rendered\n  await nextTick(() => {\n    // fill new ones\n    for (const i in mapNodes) {\n      const node = mapNodes[i];\n      const dom = document.getElementById(`${titleIdPrefix}${node.id}`);\n      if (dom == null) {\n        continue;\n      }\n      if (position == \"center\") {\n        titleBox[node.id] = {\n          position: {\n            x: node.center.x - dom.getBoundingClientRect().width / 2,\n            y: node.center.y - dom.getBoundingClientRect().height / 2\n          },\n          bbox: {\n            width: dom.getBoundingClientRect().width,\n            height: dom.getBoundingClientRect().height\n          }\n        };\n      } else if (position == \"left\") {\n        titleBox[node.id] = {\n          position: {\n            x: node.center.x - dom.getBoundingClientRect().width,\n            y: node.center.y - dom.getBoundingClientRect().height / 2\n          },\n          bbox: {\n            width: dom.getBoundingClientRect().width,\n            height: dom.getBoundingClientRect().height\n          }\n        };\n      }\n    }\n  });\n\n  return titleBox;\n};\n\nexport const setTitleBoxes = (\n  titleIdPrefix: string,\n  position: \"center\" | \"left\",\n  mapNodes: Ref<Record<string, MapNode>>,\n  cb: (titleBoxMap: Record<string, TitleBox>) => void\n) => {\n  cb(nodeToTitleBox(mapNodes.value));\n  /**\n   * Update titleBox on every prop change after DOM rerender\n   */\n  watch(\n    mapNodes,\n    async mps => {\n      return updateTitleBox(titleIdPrefix, position, mps).then(titleBoxMap =>\n        cb(titleBoxMap)\n      );\n    },\n    {\n      immediate: true\n    }\n  );\n};\n","export function splitLines(text: string, maxCharNum: number): string[] {\n  if (maxCharNum <= 0) {\n    return [];\n  }\n  if (text == \"\") {\n    return [];\n  }\n  const words = text.split(\" \");\n  const lines: string[] = [];\n  let currLine: string[] = [];\n  while (words.length) {\n    if (currLine.join(\" \").length > maxCharNum) {\n      const nextLine: string[] = [];\n      if (currLine.length > 1) {\n        nextLine.push(currLine.pop()!);\n      }\n      lines.push(currLine.join(\" \"));\n      currLine = nextLine;\n    } else {\n      currLine.push(words.shift()!);\n    }\n  }\n\n  if (currLine.join(\" \").length > maxCharNum) {\n    const nextLine: string[] = [];\n    if (currLine.length > 1) {\n      nextLine.push(currLine.pop()!);\n    }\n    lines.push(currLine.join(\" \"));\n    currLine = nextLine;\n  }\n  if (currLine.length) {\n    lines.push(currLine.join(\" \"));\n  }\n  return lines;\n}\n","\nimport {\n  defineComponent,\n  PropType,\n  toRef,\n  onMounted,\n  onUnmounted,\n  computed\n} from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport {\n  polygonToPath,\n  polygonFill,\n  polygonFillOpacity\n} from \"@/tools/graphics\";\nimport {\n  setTitleBoxes,\n  MouseDownInfo,\n  mouseMoveListener,\n  mouseUpListener\n} from \"@/components/map_layer/MapLayer\";\nimport { printError } from \"@/tools/utils\";\nimport { splitLines } from \"@/components/SVGTextBox\";\nimport { useStore } from \"@/store\";\nimport { TitleBox, mutations as titleBoxMutations } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"title_\";\n\nexport default defineComponent({\n  name: \"MapLayer\",\n  emits: [\n    \"title-over\",\n    \"title-leave\",\n    \"title-click\",\n    \"title-drop\",\n    \"title-dragging\"\n  ],\n  props: {\n    layerId: {\n      type: Number\n    },\n    mapId: {\n      type: String,\n      required: true\n    },\n    mapNodes: {\n      type: Object as PropType<Record<string, MapNode>>,\n      required: true\n    },\n    borderColor: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontColor: {\n      type: String,\n      required: true\n    },\n    fontOpacity: {\n      type: Number,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n\n  setup(props, ctx) {\n    const mapNodes = toRef(props, \"mapNodes\");\n\n    const store = useStore();\n    const layerID = \"map_\" + props.layerId;\n    const titleBox = computed(() => {\n      return store.state.titleBox.layerMap[layerID];\n    });\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"center\",\n      mapNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    /**\n     * Send event on titleBox click, drag and drop\n     */\n    const titleMouseDownInfo: MouseDownInfo = {\n      nodeId: null,\n      dragStart: false\n    };\n    const mouseMove = (event: MouseEvent) =>\n      mouseMoveListener(ctx.emit, event, titleMouseDownInfo);\n    const mouseUp = () => mouseUpListener(ctx.emit, titleMouseDownInfo);\n    onMounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.addEventListener(\"mousemove\", mouseMove);\n      map.addEventListener(\"mouseup\", mouseUp);\n    });\n    onUnmounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.removeEventListener(\"mousemove\", mouseMove);\n      map.removeEventListener(\"mouseup\", mouseUp);\n    });\n\n    const searchResultNodeIDsMap = computed(() => {\n      const map = {} as Record<string, boolean>;\n      if (!props.searchResultNodeIDs) {\n        return map;\n      }\n      for (const id of props.searchResultNodeIDs) {\n        map[id] = true;\n      }\n      return map;\n    });\n\n    return {\n      TITLE_PREFIX,\n      titleBox,\n      innerWidth: window.innerWidth,\n      innerHeight: window.innerHeight,\n      textColor: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"#ffa500\";\n        }\n        if (\n          props.selectedNodePreconditionIds &&\n          props.selectedNodePreconditionIds?.indexOf(nodeID) != -1\n        ) {\n          return \"#ffa500\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"red\";\n        }\n\n        return props.fontColor;\n      },\n      textWeight: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"bold\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"bold\";\n        }\n\n        return \"normal\";\n      },\n      textDecoration: (nodeID: string) => {\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"underline\";\n        }\n\n        return \"none\";\n      },\n      titleClick: (nodeID: string) => {\n        ctx.emit(\"title-click\", {\n          id: nodeID\n        });\n      },\n      titleOver: (nodeID: string) => {\n        ctx.emit(\"title-over\", {\n          id: nodeID\n        });\n      },\n      titleLeave: (nodeID: string) => {\n        ctx.emit(\"title-leave\", {\n          id: nodeID\n        });\n      },\n      titleMouseDown: (id: string) => {\n        titleMouseDownInfo.nodeId = id;\n        titleMouseDownInfo.dragStart = false;\n      }\n    };\n  },\n\n  methods: {\n    splitLines,\n    polygonToPath,\n    polygonFill,\n    polygonFillOpacity\n  }\n});\n","import { render } from \"./MapLayer.vue?vue&type=template&id=182e8a4c&scoped=true\"\nimport script from \"./MapLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./MapLayer.vue?vue&type=script&lang=ts\"\n\nimport \"./MapLayer.vue?vue&type=style&index=0&id=182e8a4c&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-182e8a4c\"\n\nexport default script","import { Vector } from \"@/types/graphics\";\n\nconst mouseDownBg = {\n  on: false\n};\n\nconst mouseDown = () => {\n  mouseDownBg.on = true;\n};\nconst mouseUp = () => {\n  mouseDownBg.on = false;\n};\n\nconst mouseMove = (\n  emit: (name: \"dragging-background\", o: any) => void,\n  vector: Vector\n) => {\n  if (!mouseDownBg.on) {\n    return;\n  }\n  emit(\"dragging-background\", vector);\n};\n\nexport default {\n  mouseDown,\n  mouseUp,\n  mouseMove\n};\n","<template>\n  <!--  <circle-->\n  <!--    v-for=\"node of pinNodes\"-->\n  <!--    :key=\"node.id\"-->\n  <!--    :cx=\"node.center.x\"-->\n  <!--    :cy=\"node.center.y\"-->\n  <!--    r=\"10\"-->\n  <!--    stroke=\"black\"-->\n  <!--    stroke-width=\"1\"-->\n  <!--    fill=\"red\"-->\n  <!--  />-->\n  <PinMarker\n    v-for=\"node of visiblePinNodes\"\n    :key=\"node.id\"\n    :x=\"node.center.x\"\n    :y=\"node.center.y\"\n    :color=\"color\"\n  />\n  <SVGTextBox\n    v-for=\"node of visiblePinNodes\"\n    :text=\"node.title\"\n    :id=\"`${TITLE_PREFIX}${node.id}`\"\n    :key=\"node.id\"\n    :useLineBreak=\"true\"\n    :x=\"titleXY[node.id].x\"\n    :y=\"titleXY[node.id].y\"\n    :line-height=\"8\"\n    :max-char-per-line=\"10\"\n    font-family=\"Roboto\"\n    :font-size=\"fontSize\"\n    :font-weight=\"fontWeight\"\n    :color=\"color\"\n    :text-decoration=\"textDecoration\"\n  />\n  <rect\n    v-for=\"node of pinNodes\"\n    :key=\"node.id\"\n    :x=\"titleXY[node.id].x\"\n    :y=\"titleXY[node.id].y\"\n    :width=\"titleBox[node.id] ? titleBox[node.id].bbox.width : 0\"\n    :height=\"titleBox[node.id] ? titleBox[node.id].bbox.height : 0\"\n    cursor=\"pointer\"\n    fill=\"transparent\"\n    @click=\"titleBoxClick(node.id)\"\n    @mouseover=\"titleOver(node.id)\"\n    @mouseleave=\"titleLeave(node.id)\"\n    stroke-width=\"0\"\n    stroke=\"pink\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from \"vue\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport PinMarker from \"@/components/pin_layer/PinMarker.vue\";\nimport {\n  WIDTH as PIN_MARKER_WIDTH,\n  HEIGHT as PIN_MARKER_HEIGHT\n} from \"@/components/pin_layer/PinMarker.vue\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { useStore } from \"@/store\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"pin_title_\";\n\nexport default defineComponent({\n  name: \"PinLayer\",\n  components: { SVGTextBox, PinMarker },\n  emits: [\"title-click\", \"title-over\", \"title-leave\"],\n  props: {\n    layerId: String,\n    pinNodes: {\n      type: Object as PropType<MapNode[]>,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    color: {\n      type: String\n    },\n    fontWeight: {\n      type: String\n    },\n    fontSize: {\n      type: Number\n    },\n    textDecoration: {\n      type: String\n    }\n  },\n  setup(props, ctx) {\n    const allPinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        result[node.id] = node;\n      }\n      return result;\n    });\n    const visiblePinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        if (node.id != props.selectedNodeId) {\n          result[node.id] = node;\n        }\n      }\n      return result;\n    });\n\n    const store = useStore();\n    const layerID = \"pin_\" + props.layerId;\n    const titleBox = computed(() => store.state.titleBox.layerMap[layerID]);\n    // watch pin nodes and set its title boxes to titleBox store\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      allPinNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    return {\n      TITLE_PREFIX,\n      PIN_MARKER_HEIGHT,\n      PIN_MARKER_WIDTH,\n      visiblePinNodes,\n      titleBox,\n      titleXY: computed(() => {\n        const alignedXY: Record<string, Point> = {};\n        for (const i in allPinNodes.value) {\n          const node = allPinNodes.value[i];\n          alignedXY[node.id] = {\n            x: titleBox.value[node.id] ? titleBox.value[node.id].position.x : 0,\n            y: titleBox.value[node.id] ? titleBox.value[node.id].position.y : 0\n          };\n        }\n        return alignedXY;\n      }),\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <g :transform=\"`translate(${x - WIDTH / 2} ${y - HEIGHT}) scale(0.05 0.05)`\">\n    <path\n      :fill=\"`${color}`\"\n      d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n        C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n        c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\n\nexport const WIDTH = 18;\nexport const HEIGHT = 26;\n\nexport default defineComponent({\n  name: \"PinMarker\",\n  props: {\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    return {\n      WIDTH,\n      HEIGHT\n    };\n  }\n});\n</script>\n","\nimport { defineComponent } from \"vue\";\n\nexport const WIDTH = 18;\nexport const HEIGHT = 26;\n\nexport default defineComponent({\n  name: \"PinMarker\",\n  props: {\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    return {\n      WIDTH,\n      HEIGHT\n    };\n  }\n});\n","import { render } from \"./PinMarker.vue?vue&type=template&id=d238f9c2\"\nimport script from \"./PinMarker.vue?vue&type=script&lang=ts\"\nexport * from \"./PinMarker.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <text\n    :id=\"id\"\n    :font-family=\"fontFamily\"\n    :font-size=\"fontSize\"\n    :font-weight=\"fontWeight\"\n    :fill=\"color\"\n    class=\"text\"\n  >\n    <tspan\n      v-for=\"(line, i) of lines\"\n      :key=\"i\"\n      :x=\"x\"\n      :y=\"y > 0 ? y + i * lineHeight : 0\"\n      alignment-baseline=\"hanging\"\n    >\n      {{ line }}\n    </tspan>\n  </text>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { splitLines } from \"@/components/SVGTextBox\";\n\nexport default defineComponent({\n  name: \"SVGTextBox\",\n  props: {\n    id: {\n      type: String,\n      required: true\n    },\n    useLineBreak: {\n      type: Boolean,\n      required: true\n    },\n    text: {\n      type: String,\n      required: true\n    },\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    lineHeight: {\n      type: Number,\n      required: true\n    },\n    maxCharPerLine: {\n      type: Number,\n      required: true\n    },\n    fontFamily: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontWeight: {\n      type: String,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let lines = [];\n    if (props.useLineBreak) {\n      lines = splitLines(props.text, props.maxCharPerLine);\n    } else {\n      lines = [props.text];\n    }\n    return {\n      lines\n    };\n  }\n});\n</script>\n\n<style scoped>\n.text {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n</style>\n","\nimport { defineComponent } from \"vue\";\nimport { splitLines } from \"@/components/SVGTextBox\";\n\nexport default defineComponent({\n  name: \"SVGTextBox\",\n  props: {\n    id: {\n      type: String,\n      required: true\n    },\n    useLineBreak: {\n      type: Boolean,\n      required: true\n    },\n    text: {\n      type: String,\n      required: true\n    },\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    lineHeight: {\n      type: Number,\n      required: true\n    },\n    maxCharPerLine: {\n      type: Number,\n      required: true\n    },\n    fontFamily: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontWeight: {\n      type: String,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let lines = [];\n    if (props.useLineBreak) {\n      lines = splitLines(props.text, props.maxCharPerLine);\n    } else {\n      lines = [props.text];\n    }\n    return {\n      lines\n    };\n  }\n});\n","import { render } from \"./SVGTextBox.vue?vue&type=template&id=3400d8a7&scoped=true\"\nimport script from \"./SVGTextBox.vue?vue&type=script&lang=ts\"\nexport * from \"./SVGTextBox.vue?vue&type=script&lang=ts\"\n\nimport \"./SVGTextBox.vue?vue&type=style&index=0&id=3400d8a7&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-3400d8a7\"\n\nexport default script","\nimport { computed, defineComponent, PropType } from \"vue\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport PinMarker from \"@/components/pin_layer/PinMarker.vue\";\nimport {\n  WIDTH as PIN_MARKER_WIDTH,\n  HEIGHT as PIN_MARKER_HEIGHT\n} from \"@/components/pin_layer/PinMarker.vue\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { useStore } from \"@/store\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"pin_title_\";\n\nexport default defineComponent({\n  name: \"PinLayer\",\n  components: { SVGTextBox, PinMarker },\n  emits: [\"title-click\", \"title-over\", \"title-leave\"],\n  props: {\n    layerId: String,\n    pinNodes: {\n      type: Object as PropType<MapNode[]>,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    color: {\n      type: String\n    },\n    fontWeight: {\n      type: String\n    },\n    fontSize: {\n      type: Number\n    },\n    textDecoration: {\n      type: String\n    }\n  },\n  setup(props, ctx) {\n    const allPinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        result[node.id] = node;\n      }\n      return result;\n    });\n    const visiblePinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        if (node.id != props.selectedNodeId) {\n          result[node.id] = node;\n        }\n      }\n      return result;\n    });\n\n    const store = useStore();\n    const layerID = \"pin_\" + props.layerId;\n    const titleBox = computed(() => store.state.titleBox.layerMap[layerID]);\n    // watch pin nodes and set its title boxes to titleBox store\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      allPinNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    return {\n      TITLE_PREFIX,\n      PIN_MARKER_HEIGHT,\n      PIN_MARKER_WIDTH,\n      visiblePinNodes,\n      titleBox,\n      titleXY: computed(() => {\n        const alignedXY: Record<string, Point> = {};\n        for (const i in allPinNodes.value) {\n          const node = allPinNodes.value[i];\n          alignedXY[node.id] = {\n            x: titleBox.value[node.id] ? titleBox.value[node.id].position.x : 0,\n            y: titleBox.value[node.id] ? titleBox.value[node.id].position.y : 0\n          };\n        }\n        return alignedXY;\n      }),\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n","import { render } from \"./PinLayer.vue?vue&type=template&id=4510c475\"\nimport script from \"./PinLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PinLayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <defs>\n    <marker\n      id=\"preconditionArrowHead\"\n      markerWidth=\"6\"\n      markerHeight=\"7\"\n      refX=\"3\"\n      refY=\"3.5\"\n      orient=\"auto\"\n    >\n      <polygon fill=\"#aae3b9\" stroke=\"#aae3b9\" points=\"0 0, 6 3.5, 0 7\" />\n    </marker>\n  </defs>\n  <PreconditionArrow\n    v-for=\"precondition of preconditions\"\n    :key=\"precondition.id\"\n    markerId=\"preconditionArrow\"\n    :from=\"precondition.center\"\n    :to=\"selectedNode ? selectedNode.center : null\"\n    color=\"#aae3b9\"\n  />\n  <SVGTextBox\n    v-for=\"node of visibleTitleNodes\"\n    :text=\"node.title\"\n    :id=\"`${TITLE_PREFIX}${node.id}`\"\n    :key=\"node.id\"\n    :useLineBreak=\"true\"\n    :x=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.x\n        : 0\n    \"\n    :y=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.y\n        : 0\n    \"\n    :line-height=\"8\"\n    :max-char-per-line=\"10\"\n    font-family=\"Roboto\"\n    :font-size=\"8\"\n    font-weight=\"normal\"\n    color=\"#ffa500\"\n  />\n  <rect\n    v-for=\"node of visibleTitleNodes\"\n    :key=\"node.id\"\n    :x=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.x\n        : 0\n    \"\n    :y=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.y\n        : 0\n    \"\n    :width=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].bbox.width\n        : 0\n    \"\n    :height=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].bbox.height\n        : 0\n    \"\n    cursor=\"pointer\"\n    fill=\"transparent\"\n    @click=\"titleBoxClick(node.id)\"\n    @mouseover=\"titleBoxOver(node.id)\"\n    @mouseleave=\"titleBoxLeave(node.id)\"\n    stroke-width=\"0\"\n    stroke=\"pink\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, ref, watchEffect } from \"vue\";\nimport PreconditionArrow from \"@/components/precondition_layer/PreconditionArrow.vue\";\nimport { useStore } from \"@/store\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\nimport { zoomAndPanPoint } from \"@/views/Home\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"precondition_title_\";\n\nexport default defineComponent({\n  name: \"PreconditionLayer\",\n  emits: [\"title-over\", \"title-leave\", \"title-click\"],\n  components: { SVGTextBox, PreconditionArrow },\n  props: {\n    layerId: String,\n    selectedNodeId: String,\n    visibleTitleIds: Object as PropType<Array<string>> // all visible titles on page\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const zoomPanState = store.state.zoomPan;\n\n    /**\n     * compute selectedNode\n     */\n    const selectedNode = computed(() => {\n      if (props.selectedNodeId && store.state.tree.mapNodeLayers) {\n        const [mapNode] = findMapNode(\n          props.selectedNodeId,\n          store.state.tree.mapNodeLayers\n        );\n        if (!mapNode) {\n          return null;\n        }\n        const zoomedPannedSelectedNode = clone(mapNode);\n        zoomedPannedSelectedNode.center = zoomAndPanPoint(\n          zoomedPannedSelectedNode.center,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n        return zoomedPannedSelectedNode;\n      } else {\n        return null;\n      }\n    });\n\n    /**\n     * compute selectedNodePreconditions\n     */\n    const preconditions = ref<Record<string, MapNode>>({});\n    const extraPreconditionTitles = ref<Record<string, MapNode>>({});\n\n    const layerID = \"precondition\";\n    const visibleTitleNodeBoxes = computed(\n      () => store.state.titleBox.layerMap[layerID]\n    );\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      extraPreconditionTitles,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    watchEffect(() => {\n      preconditions.value = {};\n      // some precondition nodes may be not visible on current layout\n      // so collect these extra titles into extraPreconditionTitles and show them\n      extraPreconditionTitles.value = {};\n      if (\n        props.selectedNodeId &&\n        store.state.precondition.preconditions[props.selectedNodeId] &&\n        store.state.tree.mapNodeLayers\n      ) {\n        const nodes = clone(\n          findMapNodes(\n            store.state.precondition.preconditions[props.selectedNodeId],\n            store.state.tree.mapNodeLayers\n          )\n        );\n        for (const node of nodes) {\n          node.center = zoomAndPanPoint(\n            node.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          preconditions.value[node.id] = node;\n        }\n      }\n      for (const id in preconditions.value) {\n        if (props.visibleTitleIds?.indexOf(id) == -1) {\n          extraPreconditionTitles.value[id] = preconditions.value[id];\n        }\n      }\n      if (\n        props.selectedNodeId &&\n        selectedNode.value &&\n        store.state.tree.mapNodeLayers &&\n        props.visibleTitleIds?.indexOf(props.selectedNodeId) == -1\n      ) {\n        extraPreconditionTitles.value[props.selectedNodeId] = selectedNode.value;\n      }\n    });\n\n    return {\n      TITLE_PREFIX,\n      selectedNode,\n      preconditions,\n      visibleTitleNodes: extraPreconditionTitles,\n      visibleTitleNodeBoxes,\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleBoxOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleBoxLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <line\n    v-if=\"from && to\"\n    :x1=\"from.x\"\n    :y1=\"from.y\"\n    :x2=\"to.x\"\n    :y2=\"to.y\"\n    :stroke=\"color\"\n    stroke-width=\"1\"\n    marker-end=\"url(#preconditionArrowHead)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from \"vue\";\nimport { Point } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"PreconditionArrow\",\n  props: {\n    markerId: String,\n    color: String,\n    from: Object as PropType<Point>,\n    to: Object as PropType<Point> || null\n  }\n});\n</script>\n","\nimport { defineComponent, PropType } from \"vue\";\nimport { Point } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"PreconditionArrow\",\n  props: {\n    markerId: String,\n    color: String,\n    from: Object as PropType<Point>,\n    to: Object as PropType<Point> || null\n  }\n});\n","import { render } from \"./PreconditionArrow.vue?vue&type=template&id=005525a2\"\nimport script from \"./PreconditionArrow.vue?vue&type=script&lang=ts\"\nexport * from \"./PreconditionArrow.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { MapNode, Point, Polygon, Viewport } from \"@/types/graphics\";\nimport { area, getVectorLength, isInside } from \"@/tools/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { NodeRecordItem } from \"@/store/tree\";\nimport { findMapNode } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\n\nconst MIN_VISIBLE_NODES_NUM = 3;\n\nexport function zoomAndPanPoint(p: Point, zoom: number, pan: Point): Point {\n  return { x: p.x * zoom + pan.x, y: p.y * zoom + pan.y };\n}\n\nexport function zoomAndPanPolygon(\n  p: Polygon,\n  zoom: number,\n  pan: Point\n): Polygon {\n  return p.map(point => zoomAndPanPoint(point, zoom, pan));\n}\n\n/**\n * CentralNode вычисляется следующим образом.\n * Начинаем смотреть с самого верхнего слоя.\n * Для каждого узла слоя применяем zoomFactor, затем pan\n * Потом смотрим находиться ли focusPoint внутри него.\n * Если да, то это претендент на currentNode (назовем его N).\n * Мы берем его полную площадь и умножаем на MIN_VISIBLE_NODES_NUM.\n * Если получившееся значение ≤ площади экрана, то мы считаем что currentNode это parent узла N\n * Если больше, то повторяем итерацию, но только с детьми N.\n * @param layers\n * @param nodeRecord\n * @param viewport\n * @param zoomFactor\n * @param pan\n * @param focusPoint\n */\nexport function findCentralNode(\n  layers: Array<Record<string, MapNode>>,\n  nodeRecord: Record<string, NodeRecordItem>,\n  viewport: Viewport,\n  zoomFactor: number,\n  pan: Point,\n  focusPoint: Point\n): [string, ErrorKV] {\n  if (!layers || layers.length == 0) {\n    return [\"\", null];\n  }\n\n  let underFocusPointNodeId = null;\n  const viewportArea = viewport.width * viewport.height;\n  let nodesToCheck = layers[0];\n  while (Object.keys(nodesToCheck).length) {\n    underFocusPointNodeId = \"\";\n\n    for (const nodeId in nodesToCheck) {\n      const borderToCheck = zoomAndPanPolygon(\n        nodesToCheck[nodeId].border,\n        zoomFactor,\n        pan\n      );\n      if (isInside(focusPoint, borderToCheck)) {\n        underFocusPointNodeId = nodeId;\n        break;\n      }\n    }\n\n    if (underFocusPointNodeId === \"\") {\n      // if focusPoint is outside a map, take the closest node\n      let minDist = Infinity;\n      for (const nodeId in nodesToCheck) {\n        const nodeCenter = zoomAndPanPoint(\n          nodesToCheck[nodeId].center,\n          zoomFactor,\n          pan\n        );\n        const dist = getVectorLength({ from: nodeCenter, to: focusPoint });\n        if (dist < minDist) {\n          minDist = dist;\n          underFocusPointNodeId = nodeId;\n        }\n      }\n    }\n\n    const underCursorNodeArea = area(\n      zoomAndPanPolygon(nodesToCheck[underFocusPointNodeId].border, zoomFactor, pan)\n    );\n    if (\n      Math.floor(underCursorNodeArea)*MIN_VISIBLE_NODES_NUM <= Math.floor(viewportArea)\n    ) {\n      if (nodeRecord[underFocusPointNodeId].parent == null) {\n        return [underFocusPointNodeId, null];\n      }\n      return [nodeRecord[underFocusPointNodeId].parent!.id, null];\n    } else {\n      nodesToCheck = {};\n      if (!nodeRecord[underFocusPointNodeId]) {\n        return [\n          \"\",\n          NewErrorKV(\n            \"findCurrentNode: cannot find underFocusPointNodeId in nodeRecord\",\n            { maxIntersectNodeId: underFocusPointNodeId, nodeRecord }\n          )\n        ];\n      }\n      for (const child of nodeRecord[underFocusPointNodeId].node.children) {\n        const [mapNode] = findMapNode(child.id, layers);\n        if (mapNode == null) {\n          return [\n            \"\",\n            NewErrorKV(\"filterNodesAndLayers: Cannot find node in layers\", {\n              \"child.id\": child.id,\n              layers: layers\n            })\n          ];\n        }\n        nodesToCheck[child.id] = mapNode;\n      }\n\n      if (Object.keys(nodesToCheck).length === 0) {\n        return [underFocusPointNodeId, null];\n      }\n    }\n  }\n\n  return [\"\", NewErrorKV(\"filterNodesAndLayers: unknown error\", {})];\n}\n\n/**\n * Мы показываем слой в котором находится currentNode (без названий) плюс еще 3.\n * Причем полноценно мы показываем только подузлы currentNode.\n * Узлы слоя currentNode отображаются только если у них тот же parent что и у\n * currentNode. Плюс подузлы НЕ ИЗ currentNode мы отображаем только одного следующего слоя.\n * @param layers\n * @param nodeRecord\n * @param currentNodeId\n */\nexport function filterNodesAndLayers(\n  layers: Array<Record<string, MapNode>>,\n  nodeRecord: Record<string, NodeRecordItem>,\n  currentNodeId: string\n): [Array<Record<number, MapNode>>, ErrorKV] {\n  if (!layers || !layers.length) {\n    return [[], null];\n  }\n  const resultLayers = [];\n\n  // узнаем какой слой у currentNode\n  const [currentNode, level] = findMapNode(currentNodeId, layers);\n  if (currentNode == null || level == null) {\n    return [\n      [],\n      NewErrorKV(\"filterNodesAndLayers-currentNode: error in findMapNode\", {\n        currentNodeId,\n        layers\n      })\n    ];\n  }\n\n  // убираем из этого слоя все кроме детей currentNode.parent\n  const upperLayer: Record<string, MapNode> = {};\n  if (nodeRecord[currentNode.id].parent == null) {\n    upperLayer[currentNode.id] = clone(currentNode);\n  } else {\n    for (const child of nodeRecord[currentNode.id].parent!.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-upperLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            level,\n            layers: [layers[level]]\n          })\n        ];\n      }\n      upperLayer[child.id] = clone(mapNode);\n      upperLayer[child.id].title = \"\";\n    }\n  }\n  resultLayers.push(upperLayer);\n\n  // следующий слой это дети всех узлов из upperLayer, но дети всех кроме currentNode не имеют названий\n  const firstLayer: Record<string, MapNode> = {};\n  for (const nodeId in upperLayer) {\n    for (const child of nodeRecord[nodeId].node.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level + 1]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-firstLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            layers: [layers[level + 1]]\n          })\n        ];\n      }\n      if (nodeId != currentNodeId) {\n        firstLayer[child.id] = clone(mapNode);\n        firstLayer[child.id].title = \"\";\n      } else {\n        firstLayer[child.id] = clone(mapNode);\n      }\n    }\n  }\n\n  if (Object.keys(firstLayer).length > 0) {\n    resultLayers.push(firstLayer);\n  }\n\n  // следующий слой это дети детей currentNode\n  const secondLayer: Record<string, MapNode> = {};\n  //for (const childId in firstLayer) {\n  for (const child of nodeRecord[currentNodeId].node.children) {\n    for (const childOfChild of nodeRecord[child.id].node.children) {\n      const [mapNode, l] = findMapNode(childOfChild.id, [layers[level + 2]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-secondLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            layers: [layers[level + 2]]\n          })\n        ];\n      }\n      secondLayer[childOfChild.id] = clone(mapNode);\n    }\n  }\n\n  if (Object.keys(secondLayer).length > 0) {\n    resultLayers.push(secondLayer);\n  }\n\n  // следующий это дети узлов из secondLayer и у них нет названий\n  const thirdLayer: Record<string, MapNode> = {};\n  for (const nodeId in secondLayer) {\n    for (const child of nodeRecord[nodeId].node.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level + 3]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-thirdLayer:cannot findMapNode\", {\n            \"child.id\": child.id,\n            level: level + 3,\n            layers: [layers[level + 3]]\n          })\n        ];\n      }\n      thirdLayer[child.id] = clone(mapNode);\n      thirdLayer[child.id].title = \"\";\n    }\n  }\n\n  if (Object.keys(thirdLayer).length > 0) {\n    resultLayers.push(thirdLayer);\n  }\n\n  return [resultLayers, null];\n}\n\nexport function zoomAnPanLayers(\n  layers: Array<Record<number, MapNode>>,\n  zoom: number,\n  pan: Point\n): Array<Record<number, MapNode>> {\n  if (!layers || layers.length == 0) {\n    return [];\n  }\n  for (const layer of layers) {\n    for (const id in layer) {\n      const node = layer[id];\n      node.center = zoomAndPanPoint(node.center, zoom, pan);\n      node.border = zoomAndPanPolygon(node.border, zoom, pan);\n    }\n  }\n\n  return layers;\n}\n","\nimport { computed, defineComponent, PropType, ref, watchEffect } from \"vue\";\nimport PreconditionArrow from \"@/components/precondition_layer/PreconditionArrow.vue\";\nimport { useStore } from \"@/store\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\nimport { zoomAndPanPoint } from \"@/views/Home\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"precondition_title_\";\n\nexport default defineComponent({\n  name: \"PreconditionLayer\",\n  emits: [\"title-over\", \"title-leave\", \"title-click\"],\n  components: { SVGTextBox, PreconditionArrow },\n  props: {\n    layerId: String,\n    selectedNodeId: String,\n    visibleTitleIds: Object as PropType<Array<string>> // all visible titles on page\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const zoomPanState = store.state.zoomPan;\n\n    /**\n     * compute selectedNode\n     */\n    const selectedNode = computed(() => {\n      if (props.selectedNodeId && store.state.tree.mapNodeLayers) {\n        const [mapNode] = findMapNode(\n          props.selectedNodeId,\n          store.state.tree.mapNodeLayers\n        );\n        if (!mapNode) {\n          return null;\n        }\n        const zoomedPannedSelectedNode = clone(mapNode);\n        zoomedPannedSelectedNode.center = zoomAndPanPoint(\n          zoomedPannedSelectedNode.center,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n        return zoomedPannedSelectedNode;\n      } else {\n        return null;\n      }\n    });\n\n    /**\n     * compute selectedNodePreconditions\n     */\n    const preconditions = ref<Record<string, MapNode>>({});\n    const extraPreconditionTitles = ref<Record<string, MapNode>>({});\n\n    const layerID = \"precondition\";\n    const visibleTitleNodeBoxes = computed(\n      () => store.state.titleBox.layerMap[layerID]\n    );\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      extraPreconditionTitles,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    watchEffect(() => {\n      preconditions.value = {};\n      // some precondition nodes may be not visible on current layout\n      // so collect these extra titles into extraPreconditionTitles and show them\n      extraPreconditionTitles.value = {};\n      if (\n        props.selectedNodeId &&\n        store.state.precondition.preconditions[props.selectedNodeId] &&\n        store.state.tree.mapNodeLayers\n      ) {\n        const nodes = clone(\n          findMapNodes(\n            store.state.precondition.preconditions[props.selectedNodeId],\n            store.state.tree.mapNodeLayers\n          )\n        );\n        for (const node of nodes) {\n          node.center = zoomAndPanPoint(\n            node.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          preconditions.value[node.id] = node;\n        }\n      }\n      for (const id in preconditions.value) {\n        if (props.visibleTitleIds?.indexOf(id) == -1) {\n          extraPreconditionTitles.value[id] = preconditions.value[id];\n        }\n      }\n      if (\n        props.selectedNodeId &&\n        selectedNode.value &&\n        store.state.tree.mapNodeLayers &&\n        props.visibleTitleIds?.indexOf(props.selectedNodeId) == -1\n      ) {\n        extraPreconditionTitles.value[props.selectedNodeId] = selectedNode.value;\n      }\n    });\n\n    return {\n      TITLE_PREFIX,\n      selectedNode,\n      preconditions,\n      visibleTitleNodes: extraPreconditionTitles,\n      visibleTitleNodeBoxes,\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleBoxOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleBoxLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n","import { render } from \"./PreconditionLayer.vue?vue&type=template&id=16932f4f\"\nimport script from \"./PreconditionLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PreconditionLayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, onMounted, PropType } from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport MapLayer from \"@/components/map_layer/MapLayer.vue\";\nimport {\n  EventClickNode,\n  EventDraggingNode\n} from \"@/components/map_layer/MapLayer\";\nimport pan from \"./MapPan\";\nimport PinLayer from \"@/components/pin_layer/PinLayer.vue\";\nimport { printError } from \"@/tools/utils\";\nimport PreconditionLayer from \"@/components/precondition_layer/PreconditionLayer.vue\";\n\nconst mapID = \"mapID\";\n\nexport default defineComponent({\n  name: \"Map\",\n  emits: [\n    \"title-dragging\",\n    \"title-click\",\n    \"title-over\",\n    \"title-leave\",\n    \"dragging-background\",\n    \"wheel\"\n  ],\n  components: {\n    PreconditionLayer,\n    PinLayer,\n    MapLayer\n  },\n  props: {\n    layers: Object as PropType<Array<Record<string, MapNode>>>,\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    pinNodes: Object as PropType<MapNode[]>,\n    searchResultPinNodes: Object as PropType<MapNode[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n  setup(props, ctx) {\n    onMounted(() => {\n      const map = document.getElementById(mapID);\n      if (!map) {\n        printError(\"Map.vue: cannot find map id for event listener\", {});\n        return;\n      }\n\n      map.addEventListener(\"mousedown\", event => {\n        pan.mouseDown();\n      });\n      map.addEventListener(\"mouseup\", event => {\n        pan.mouseUp();\n      });\n      map.addEventListener(\"mousemove\", event => {\n        pan.mouseMove(ctx.emit, {\n          from: {\n            x: event.clientX - event.movementX,\n            y: event.clientY - event.movementY\n          },\n          to: { x: event.clientX, y: event.clientY }\n        });\n      });\n\n      // zoom with mouse wheel\n      map.addEventListener(\n        \"wheel\",\n        event => {\n          ctx.emit(\"wheel\", {\n            delta: event.deltaY,\n            center: { x: event.clientX, y: event.clientY }\n          });\n        },\n        { passive: true }\n      );\n\n      let prevDist = Infinity;\n      const prevPoint = { x: Infinity, y: Infinity };\n      map.addEventListener(\n        \"touchstart\",\n        event => {\n          pan.mouseDown();\n        },\n        { passive: true }\n      );\n      map.addEventListener(\"touchend\", event => {\n        prevDist = Infinity;\n        prevPoint.x = Infinity;\n        prevPoint.y = Infinity;\n        pan.mouseUp();\n      });\n\n      // mobile zoom\n      map.addEventListener(\n        \"touchmove\",\n        e => {\n          if (e.touches.length === 1) {\n            if (prevPoint.x != Infinity && prevPoint.y != Infinity) {\n              pan.mouseMove(ctx.emit, {\n                from: prevPoint,\n                to: { x: e.touches[0].clientX, y: e.touches[0].clientY }\n              });\n            }\n            prevPoint.x = e.touches[0].clientX;\n            prevPoint.y = e.touches[0].clientY;\n          } else if (e.touches.length === 2) {\n            let delta = 0;\n            const dist = Math.hypot(\n              e.touches[0].pageX - e.touches[1].pageX,\n              e.touches[0].pageY - e.touches[1].pageY\n            );\n            if (prevDist !== Infinity) {\n              delta = prevDist - dist;\n            }\n            prevDist = dist;\n\n            ctx.emit(\"wheel\", {\n              delta: delta,\n              center: {\n                x: (e.touches[0].pageX - e.touches[1].pageX) / 2,\n                y: (e.touches[0].pageY - e.touches[1].pageY) / 2\n              }\n            });\n          }\n        },\n        { passive: true }\n      );\n    });\n\n    return {\n      svgWidth: window.innerWidth,\n      // 0.99 because if svg == innerHeight then browser vertical scroll bar appears\n      svgHeight: 0.99 * window.innerHeight,\n      visibleTitleIds: computed(() => {\n        if (!props.layers) {\n          return [];\n        }\n        const ids = [];\n        for (const layer of props.layers) {\n          for (const idx in layer) {\n            if (layer[idx].title != \"\") {\n              ids.push(idx);\n            }\n          }\n        }\n        return ids;\n      }),\n      draggingNode: (e: EventDraggingNode) => {\n        ctx.emit(\"title-dragging\", {\n          id: e.nodeId,\n          delta: e.delta\n        });\n      },\n      titleClick: (e: EventClickNode) => {\n        ctx.emit(\"title-click\", { id: e.id });\n      },\n      titleOver: (e: EventClickNode) => {\n        ctx.emit(\"title-over\", { id: e.id });\n      },\n      titleLeave: (e: EventClickNode) => {\n        ctx.emit(\"title-leave\", { id: e.id });\n      },\n      mapID: mapID,\n      fontSize: (index: number): number => {\n        let size = 0;\n        const levelSizes: Record<number, number> = {\n          0: 0.4,\n          1: 0.73,\n          2: 1.4,\n          3: 1.86\n        };\n        if (props.layers!.length >= 4) {\n          size = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          size = levelSizes[index + 1];\n        }\n        return size;\n      },\n      fontOpacity: (index: number): number => {\n        let val = 0;\n        const levelSizes: Record<number, number> = {\n          0: 1,\n          1: 1,\n          2: 0.2,\n          3: 1\n        };\n        if (props.layers!.length >= 4) {\n          val = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          val = levelSizes[index + 1];\n        }\n        return val;\n      },\n      fontColor: (index: number): string => {\n        if (props.layers!.length >= 4) {\n          return `rgb(${200 - 100 * index},${200 - 100 * index},${200 -\n            100 * index})`;\n        }\n        if (props.layers!.length == 3) {\n          return `rgb(${200 - 100 * (index + 1)},${200 -\n            100 * (index + 1)},${200 - 100 * (index + 1)})`;\n        }\n        return \"\";\n      },\n      borderColor: (index: number): string => {\n        let color = 0;\n        const levelColors: Record<number, number> = {\n          0: 240,\n          1: 200,\n          2: 100,\n          3: 90\n        };\n        if (props.layers!.length >= 4) {\n          color = levelColors[index];\n        }\n        if (props.layers!.length == 3) {\n          color = levelColors[index + 1];\n        }\n        return `rgb(${color},${color},${color})`;\n      }\n    };\n  }\n});\n","import { render } from \"./Map.vue?vue&type=template&id=6aa6394b\"\nimport script from \"./Map.vue?vue&type=script&lang=ts\"\nexport * from \"./Map.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div v-if=\"show && selectedNode\" class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <!-- Image -->\n      <TitleImage\n        :nodeID=\"selectedNodeContent ? selectedNodeContent.nodeID : ''\"\n        :nodeContent=\"selectedNodeContent ? selectedNodeContent.content : ''\"\n      />\n\n      <!-- Content -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 240px\"></div>\n        </div>\n        <div class=\"p-col-9\">\n          <Title\n            :content=\"selectedNodeContent ? selectedNode.title : ''\"\n            @content-changed=\"changeNodeTitle($event)\"\n          />\n        </div>\n        <div class=\"p-col-1\">\n          <SubscribeButton :nodeID=\"selectedNodeContent ? selectedNodeContent.nodeID : ''\" />\n        </div>\n        <div class=\"p-col-2\">\n          <PinButton />\n        </div>\n        <div class=\"p-col-12\">\n          <Markdown\n            :content=\"selectedNodeContent ? selectedNodeContent.content : ''\"\n            :rows=\"20\"\n            @content-changed=\"changeContent($event)\"\n          />\n        </div>\n      </div>\n\n      <!-- Comment -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12 p-md-12\">\n          <TextArea\n            id=\"comment\"\n            placeholder=\"Your notes (visible only to you)\"\n            :autoResize=\"true\"\n            rows=\"2\"\n            :value=\"selectedNodeComment\"\n            @update:modelValue=\"changeComment($event)\"\n            v-on:keydown=\"checkAuthorized\"\n          />\n        </div>\n      </div>\n\n      <!-- 'Based on' section -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-10 section p-pt-2\">\n          based on\n        </div>\n        <div class=\"p-col-2\">\n          <AddBasedOnButton\n            :clickedTitleId=\"clickedTitleId\"\n            @select-precondition-is-on=\"$emit('select-precondition-is-on')\"\n            @select-precondition-is-off=\"$emit('select-precondition-is-off')\"\n          />\n        </div>\n      </div>\n      <SectionPreconditions\n        v-if=\"selectedNodeContent\"\n        :node-id=\"selectedNode.id\"\n      />\n\n      <!-- 'Basis for' section -->\n      <div v-if=\"selectedNodeContent && usedBy && usedBy.length > 0\">\n        <div class=\"p-field p-grid\">\n          <div class=\"p-col-12 section p-pt-5\">\n            basis for\n          </div>\n        </div>\n        <SectionUsedBy :nodeIDs=\"usedBy\" />\n      </div>\n\n      <!-- ChangeLog section -->\n      <ChangeLog :node-id=\"selectedNode.id\" />\n    </div>\n  </div>\n  <div v-else-if=\"editModeOn\" class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 60px;\"></div>\n        </div>\n        <div class=\"p-col-12\">\n          <div class=\"title\">\n            Map edit mode is on\n          </div>\n        </div>\n        <div class=\"p-col-12 list\">\n          In this mode you can change map structure but cannot edit contents of individual nodes. To return back to content editing push \"edit map\" button again.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n              alt=\"logo\"\n              src=\"../../assets/images/add-off.svg\"\n              style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To add new node 1) select parent node on map and then 2) click \"add\" button in upper menu.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/remove-off.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To remove node 1) select it on map and 2) click \"delete\" button in upper menu.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/cut.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To move node 1) select it on map, then 2) press \"cut\" button, then 3) select its new parent and 4) press \"paste\" button.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/log.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          You can use \"log\" to see log of map edits and revert or complain any unfortunate edit.\n        </div>\n        <div class=\"p-col-12 list\">\n            After add, paste or remove you can drag node title and its neighbours to adjust node centers position.\n        </div>\n      </div>\n    </div>\n  </div>\n  <div v-else class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 60px;\"></div>\n        </div>\n        <div class=\"p-col-12\">\n          <iframe width=\"400\" height=\"210\" src=\"https://www.youtube.com/embed/DuiTlnrK6G4?si=HuVA4cs5U86H9E3l\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/sign-in.svg\"\n            style=\"width: 25px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Sign in to edit map\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/goal.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div v-tooltip=\"{ escape:false,\n         autoHide: false,\n         pt: {\n          root: {\n            style: {\n              'max-width': 'fit-content',\n            },\n          },\n          arrow: {\n            style: {\n              borderRightColor: '#dcdcde',\n              borderBottomColor: 'rgb(255 255 255 / 0)',\n              borderTopColor: 'rgb(255 255 255 / 0)'\n            }\n          },\n          text: {\n            style: {\n              'background-color': '#dcdcde',\n              'color': 'black'\n            }\n          }\n         },\n        value: `\n<div style='padding-left: 20px; width:370px;height:550px;'>\n  Use <a target='_blank' href='https://markdown-it.github.io/'>markdown</a> to format text\n  and <a target='_blank' href='https://katex.org/docs/supported.html'>katex</a> notation to write formulas.\n For example write\n <textarea rows='3' cols='40'>$$\n\\\\sum_{\\\\mathclap{1\\\\le i\\\\le j\\\\le n}} x_{ij}\n$$</textarea>\n  to render formula:\n  ${md.render(`$$\n\\\\sum_{\\\\mathclap{1\\\\le i\\\\le j\\\\le n}} x_{ij}\n$$`)}\n  <div style='margin-top: -4em;'>\n  Or write\n   <textarea rows='3' cols='40'>![](https://cdn.scimap.org/images/default.jpg =340x)</textarea>\n   to insert image:\n   ${md.render(`![](https://cdn.scimap.org/images/default.jpg =340x)`)}\n   </div>\n</div>`\n        }\" class=\"p-col-11 list\">\n          Keep node content <b>focused and simple but profound</b> (you can use <a target='_blank' href='https://markdown-it.github.io/'>markdown</a> and <a target='_blank' href='https://katex.org/docs/supported.html'>katex</a>&nbsp;<img\n            alt=\"logo\"\n            src=\"../../assets/images/question.svg\"\n            style=\"width: 20px; margin-bottom:-5px;\"\n        />)\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/plugin.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Use <b>\"based on\"</b> to link nodes that are necessary for solid\n          understanding of your description\n        </div>\n        <div class=\"p-col-1 icon\" style=\"color: #3B6BF9; padding-left:15px; font-weight: bold;\">\n          W\n        </div>\n        <div class=\"p-col-11 list\">\n          Use Wikipedia core content policies: neutral point of view, verifiability, and no original research\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/pin-on.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Pin nodes that you are currently interested in\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/eye-on.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Subscribe to node changes to receive updates on email\n        </div>\n        <div class=\"p-col-1 icon\" style=\"color: #3B6BF9;\">\n          [ORG]\n        </div>\n        <div class=\"p-col-11 list\">\n          If you know actions one can take to push\n          knowledge further (jobs, crowdsourcing, etc.) - you can also add it!\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/chat.svg\"\n            style=\"width: 20px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Talk to your coauthors in <a target=\"_blank\" href=\"https://discord.com/channels/1171118046543347782/1171118047587745953\">chat</a> to adapt community rules and create a great content\n        </div>\n        <div class=\"p-col-12 list\">\n          <i>Because one of the greatest impact one can do is to nudge millions of others to discover the truth</i>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { actions, useStore } from \"@/store\";\nimport { actions as nodeContentActions } from \"@/store/node_content\";\nimport { computed, defineComponent } from \"vue\";\nimport TextArea from \"primevue/textarea\";\nimport SectionPreconditions from \"./Preconditions.vue\";\nimport SectionUsedBy from \"./UsedBy.vue\";\nimport { Tree } from \"@/types/graphics\";\nimport { EmptyNodeContent, NodeContent } from \"@/store/node_content\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { useConfirm } from \"primevue/useconfirm\";\nimport api from \"@/api/api\";\nimport Markdown from \"./Markdown.vue\";\nimport ChangeLog from \"./ChangeLog.vue\";\nimport PinButton from \"./PinButton.vue\";\nimport SubscribeButton from \"./SubscribeButton.vue\";\nimport Title from \"@/components/node_content/Title.vue\";\nimport AddBasedOnButton from \"@/components/node_content/AddBasedOnButton.vue\";\nimport TitleImage from \"@/components/node_content/TitleImage.vue\";\nimport MarkdownIt from \"markdown-it\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd\n  .use(mdKatex, { output: \"html\" })\n  .use(mdImsize);\n\nexport default defineComponent({\n  name: \"NodeContent\",\n  components: {\n    TitleImage,\n    AddBasedOnButton,\n    Title,\n    SectionUsedBy,\n    Markdown,\n    TextArea,\n    SectionPreconditions,\n    ChangeLog,\n    PinButton,\n    SubscribeButton,\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    show: {\n      type: Boolean,\n      required: true\n    },\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const tree = store.state.tree;\n\n    const selectedNode = computed<Tree | null>(() =>\n      props.selectedNodeId && tree.nodeRecord[props.selectedNodeId]\n        ? tree.nodeRecord[props.selectedNodeId].node\n        : null\n    );\n\n    const selectedNodeContent = computed<NodeContent | null>(() => {\n      if (\n        props.selectedNodeId &&\n        store.state.nodeContent.nodeContents[props.selectedNodeId]\n      ) {\n        return store.state.nodeContent.nodeContents[props.selectedNodeId];\n      }\n      const newContent = clone(EmptyNodeContent);\n      newContent.nodeID = props.selectedNodeId;\n      return newContent;\n    });\n\n    const selectedNodeComment = computed<string>(() =>\n      props.selectedNodeId &&\n      store.state.nodeContent.userNodeComments[props.selectedNodeId]\n        ? store.state.nodeContent.userNodeComments[props.selectedNodeId].comment\n        : \"\"\n    );\n\n    return {\n      md,\n      usedBy: computed(() => store.state.precondition.reverseIndex[props.selectedNodeId]),\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNode,\n      selectedNodeContent,\n      checkAuthorized: async (e: Event) => {\n        if (!store.state.user.user || store.state.user.user.isAnonymous) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to add comments and edit content\"});\n          e.preventDefault();\n        }\n      },\n      selectedNodeComment,\n      changeNodeTitle: async (value: string) => {\n        if (!selectedNode.value || !selectedNode.value.id) {\n          return;\n        }\n        const err = await api.debouncedUpdate({\n          [`map/${selectedNode.value.id}/name`]: value\n        });\n\n        if (err) {\n          printError(err.error.message, err.kv);\n        }\n      },\n      changeContent: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeContent}`,\n          {\n            nodeID: selectedNode.value!.id,\n            content: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      },\n      changeComment: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeComment}`,\n          {\n            nodeID: selectedNode.value!.id,\n            comment: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      }\n    };\n  }\n});\n</script>\n\n<style scoped>\n.wrapper {\n  position: absolute;\n  width: 30%;\n  height: 100%;\n  padding: 24px;\n  overflow-y: scroll;\n  background-color: rgba(255, 255, 255, 1);\n  font-family: Roboto, Arial, sans-serif;\n  color: rgb(73, 80, 87);\n\n  border-right: 1px solid rgb(218, 220, 224);\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\n  clip-path: inset(0px -5px 0px 0px);\n}\n.title {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1.250rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  line-height: 1.75rem;\n  color: #202124;\n  margin-bottom: 20px;\n}\n.list {\n  font-family: Roboto, Arial, sans-serif;\n  font-size: 0.875rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  padding-left: 20px;\n  margin-bottom: 10px;\n  margin-top: 10px;\n}\n.icon {\n  margin-top: 9px;\n}\n.section {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1rem;\n  font-weight: 500;\n  letter-spacing: 0;\n  line-height: 1.5rem;\n}\n</style>\n","<template>\n  <div\n    v-for=\"precondition of preconditions\"\n    :class=\"`p-grid ${$style.precondition} p-p-md-0`\"\n    :key=\"precondition.id\"\n  >\n    <div class=\"p-col-10 p-pl-md-2\">\n        <p :class=\"`${$style.preconditionPath}`\">\n          {{preconditionPaths[precondition.id]}}\n        </p>\n        <p :class=\"`${$style.title}`\">\n          <Link :nodeID=\"precondition.id\" :nodeTitle=\"precondition.title\" />\n        </p>\n    </div>\n    <div class=\"p-col-2 p-p-md-0\">\n      <RemoveIcon @click=\"remove(precondition.id)\" />\n    </div>\n  </div>\n\n</template>\n\n<script lang=\"ts\">\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport {actions, useStore} from \"@/store\";\nimport api from \"@/api/api\";\nimport { Tree } from \"@/types/graphics\";\nimport RemoveIcon from \"@/components/node_content/RemoveIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\nimport {mutations as preconditionMutations} from \"@/store/precondition\";\nimport {getTreePathString} from \"../helpers\";\nimport Link from \"@/components/Link.vue\";\n\nexport default defineComponent({\n  name: \"Preconditions\",\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Link,\n    RemoveIcon\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const preconditions = ref<Array<Tree>>([]);\n    const preconditionPaths = ref<Record<string, string>>({});\n    watchEffect(() => {\n      preconditions.value = [];\n      preconditionPaths.value = {};\n      if (\n        props.nodeId &&\n        store.state.precondition.preconditions[props.nodeId]\n      ) {\n        for (const id of store.state.precondition.preconditions[props.nodeId]) {\n          preconditions.value.push(store.state.tree.nodeRecord[id].node);\n          preconditionPaths.value[id] = getTreePathString(id, store.state.tree.nodeRecord)\n        }\n      }\n    });\n\n    return {\n      preconditions,\n      preconditionPaths,\n      remove: async (id: string) => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n\n        store.commit(`precondition/${preconditionMutations.REMOVE_PRECONDITION}`, {\n          nodeID: props.nodeId,\n          preconditionID: id,\n        });\n        api.savePreconditions(store.state.user.user, {\n          nodeId: props.nodeId,\n          preconditionIds: store.state.precondition.preconditions[props.nodeId]\n        });\n      }\n    };\n  }\n});\n</script>\n\n<style module>\n.title {\n  margin: 0;\n  padding: 0;\n}\n.precondition {\n  margin: 0;\n}\n.precondition:hover {\n  background-color: rgb(3, 219, 252, 0.2);\n}\n.preconditionPath {\n  margin: 0;\n  padding: 0;\n  font-size: 0.8rem;\n}\n</style>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"mouseOver\" class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/remove-on.svg\"\n      />\n    </div>\n    <div v-else class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/remove-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"RemoveIcon\",\n  setup() {\n    const mouseOver = ref(false);\n    return {\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.custom {\n  margin-top: 8px;\n  margin-left: 22px;\n}\n</style>\n","import { render } from \"./RemoveIcon.vue?vue&type=template&id=154fe046&scoped=true\"\nimport script from \"./RemoveIcon.vue?vue&type=script&lang=js\"\nexport * from \"./RemoveIcon.vue?vue&type=script&lang=js\"\n\nimport \"./RemoveIcon.vue?vue&type=style&index=0&id=154fe046&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-154fe046\"\n\nexport default script","import {NodeRecordItem} from \"@/store/tree\";\nimport { Tree } from \"@/types/graphics\";\n\nexport function idToLink(id: string, nodeRecord: Record<string, NodeRecordItem>): string {\n  return `<a href='/${id}'>${nodeRecord[id] ? nodeRecord[id].node.title : 'undefined'}</a>`\n}\n\nexport function getArrayDiff(beforeArr: Array<string>, afterArr: Array<string>) {\n  const beforeMap = {} as Record<string, boolean>\n  for (const idx in beforeArr) {\n    beforeMap[beforeArr[idx]] = true\n  }\n  const afterMap = {} as Record<string, boolean>\n  for (const idx in afterArr) {\n    afterMap[afterArr[idx]] = true\n  }\n  const added = []\n  for (const id in afterMap) {\n    if (!beforeMap[id]) {\n      added.push(id)\n    }\n  }\n  const removed = []\n  for (const id in beforeMap) {\n    if (!afterMap[id]) {\n      removed.push(id)\n    }\n  }\n\n  return [added, removed]\n}\n\nexport function getTreePathNodes(id: string,  records: Record<string, NodeRecordItem>): Array<Tree> {\n  if (!records[id] || records[id].parent == null) {\n    return []\n  }\n  const result = []\n  let parent = records[records[id].parent!.id]\n  while (parent !== null) {\n    result.push(parent.node)\n    if (parent.parent == null) {\n      break;\n    }\n    parent = records[parent.parent.id]\n  }\n  return result\n}\n\nexport function getTreePathString(id: string,  records: Record<string, NodeRecordItem>): string {\n  return getTreePathNodes(id, records).filter((node)=>node.id !== '0').map((node)=>node.title).reverse().join('/')\n}\n","<template>\n  <a href=\"#\" @click=\"goto($event, nodeID)\">{{ nodeTitle }}</a>\n</template>\n\n<script lang=\"ts\">\nimport {useRouter} from \"vue-router\";\nimport {defineComponent} from \"vue\";\nimport {useStore} from \"@/store\";\nimport { findMapNode } from \"@/store/tree/helpers\";\nimport {mutations as zoomPanMutations} from \"@/store/zoom_pan\";\n\nexport default defineComponent({\n  name: \"Link\",\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    },\n    nodeTitle: {\n      type: String,\n      required: true\n    },\n  },\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const treeState = store.state.tree;\n\n    return {\n      goto: (event: Event, id: string) => {\n        event.preventDefault();\n        const [firstNode] = findMapNode(\n            id,\n            treeState.mapNodeLayers\n        );\n        if (firstNode != null) {\n          router.push({ name: \"node\", params: { id } });\n          store.commit(`zoomPan/${zoomPanMutations.RESET_ZOOM_AND_PAN}`)\n          store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n            x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n            y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n          });\n        }\n      },\n    }\n  }\n})\n</script>\n","\nimport {useRouter} from \"vue-router\";\nimport {defineComponent} from \"vue\";\nimport {useStore} from \"@/store\";\nimport { findMapNode } from \"@/store/tree/helpers\";\nimport {mutations as zoomPanMutations} from \"@/store/zoom_pan\";\n\nexport default defineComponent({\n  name: \"Link\",\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    },\n    nodeTitle: {\n      type: String,\n      required: true\n    },\n  },\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const treeState = store.state.tree;\n\n    return {\n      goto: (event: Event, id: string) => {\n        event.preventDefault();\n        const [firstNode] = findMapNode(\n            id,\n            treeState.mapNodeLayers\n        );\n        if (firstNode != null) {\n          router.push({ name: \"node\", params: { id } });\n          store.commit(`zoomPan/${zoomPanMutations.RESET_ZOOM_AND_PAN}`)\n          store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n            x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n            y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n          });\n        }\n      },\n    }\n  }\n})\n","import { render } from \"./Link.vue?vue&type=template&id=4c2537d2\"\nimport script from \"./Link.vue?vue&type=script&lang=ts\"\nexport * from \"./Link.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport {actions, useStore} from \"@/store\";\nimport api from \"@/api/api\";\nimport { Tree } from \"@/types/graphics\";\nimport RemoveIcon from \"@/components/node_content/RemoveIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\nimport {mutations as preconditionMutations} from \"@/store/precondition\";\nimport {getTreePathString} from \"../helpers\";\nimport Link from \"@/components/Link.vue\";\n\nexport default defineComponent({\n  name: \"Preconditions\",\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Link,\n    RemoveIcon\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const preconditions = ref<Array<Tree>>([]);\n    const preconditionPaths = ref<Record<string, string>>({});\n    watchEffect(() => {\n      preconditions.value = [];\n      preconditionPaths.value = {};\n      if (\n        props.nodeId &&\n        store.state.precondition.preconditions[props.nodeId]\n      ) {\n        for (const id of store.state.precondition.preconditions[props.nodeId]) {\n          preconditions.value.push(store.state.tree.nodeRecord[id].node);\n          preconditionPaths.value[id] = getTreePathString(id, store.state.tree.nodeRecord)\n        }\n      }\n    });\n\n    return {\n      preconditions,\n      preconditionPaths,\n      remove: async (id: string) => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n\n        store.commit(`precondition/${preconditionMutations.REMOVE_PRECONDITION}`, {\n          nodeID: props.nodeId,\n          preconditionID: id,\n        });\n        api.savePreconditions(store.state.user.user, {\n          nodeId: props.nodeId,\n          preconditionIds: store.state.precondition.preconditions[props.nodeId]\n        });\n      }\n    };\n  }\n});\n","import { render } from \"./Preconditions.vue?vue&type=template&id=c5b277c6\"\nimport script from \"./Preconditions.vue?vue&type=script&lang=ts\"\nexport * from \"./Preconditions.vue?vue&type=script&lang=ts\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Preconditions.vue?vue&type=style&index=0&id=c5b277c6&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <div v-for=\"usedByNode of usedBy\"\n       :class=\"`p-grid ${$style.precondition} p-p-md-0`\"\n       :key=\"usedByNode.id\"\n  >\n    <div class=\"p-col-12\">\n      <p :class=\"`${$style.preconditionPath}`\">\n        {{usedByPaths[usedByNode.id]}}\n      </p>\n      <p :class=\"`${$style.title}`\">\n        <Link :nodeID=\"usedByNode.id\" :nodeTitle=\"usedByNode.title\" />\n      </p>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {ref, watchEffect, defineComponent, PropType} from \"vue\";\nimport { useStore } from \"@/store\";\nimport { Tree } from \"@/types/graphics\";\nimport {getTreePathString} from \"@/components/helpers\";\nimport Link from \"@/components/Link.vue\";\n\nexport default defineComponent({\n  name: \"UsedBy\",\n  components: {\n    Link,\n  },\n  props: {\n    nodeIDs: Object as PropType<Array<string>>\n  },\n  setup(props) {\n    const store = useStore();\n    const usedBy = ref<Array<Tree>>([]);\n    const usedByPaths = ref<Record<string, string>>({});\n    watchEffect(() => {\n      usedBy.value = [];\n      usedByPaths.value = {};\n      if (props.nodeIDs) {\n        for (const id of props.nodeIDs) {\n          if (!store.state.tree.nodeRecord[id]) {\n            console.log(\"UsedBy: cannot find id in nodeRecord\", id);\n          } else {\n            usedBy.value.push(store.state.tree.nodeRecord[id].node);\n            usedByPaths.value[id] = getTreePathString(id, store.state.tree.nodeRecord)\n          }\n        }\n      }\n    });\n\n    return {\n      usedBy,\n      usedByPaths,\n    };\n  }\n});\n</script>\n\n\n<style module>\n.title {\n  margin: 0;\n  padding: 0;\n}\n.precondition {\n  margin: 0;\n}\n.precondition:hover {\n  background-color: rgb(3, 219, 252, 0.2);\n}\n.preconditionPath {\n  margin: 0;\n  padding: 0;\n  font-size: 0.8rem;\n}\n</style>\n","\nimport {ref, watchEffect, defineComponent, PropType} from \"vue\";\nimport { useStore } from \"@/store\";\nimport { Tree } from \"@/types/graphics\";\nimport {getTreePathString} from \"@/components/helpers\";\nimport Link from \"@/components/Link.vue\";\n\nexport default defineComponent({\n  name: \"UsedBy\",\n  components: {\n    Link,\n  },\n  props: {\n    nodeIDs: Object as PropType<Array<string>>\n  },\n  setup(props) {\n    const store = useStore();\n    const usedBy = ref<Array<Tree>>([]);\n    const usedByPaths = ref<Record<string, string>>({});\n    watchEffect(() => {\n      usedBy.value = [];\n      usedByPaths.value = {};\n      if (props.nodeIDs) {\n        for (const id of props.nodeIDs) {\n          if (!store.state.tree.nodeRecord[id]) {\n            console.log(\"UsedBy: cannot find id in nodeRecord\", id);\n          } else {\n            usedBy.value.push(store.state.tree.nodeRecord[id].node);\n            usedByPaths.value[id] = getTreePathString(id, store.state.tree.nodeRecord)\n          }\n        }\n      }\n    });\n\n    return {\n      usedBy,\n      usedByPaths,\n    };\n  }\n});\n","import { render } from \"./UsedBy.vue?vue&type=template&id=b8b30aac\"\nimport script from \"./UsedBy.vue?vue&type=script&lang=ts\"\nexport * from \"./UsedBy.vue?vue&type=script&lang=ts\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./UsedBy.vue?vue&type=style&index=0&id=b8b30aac&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <p v-if=\"isAuthorized\"\n    v-show=\"!editOn\"\n    v-html=\"renderedContent\"\n    @click=\"setEditOn(true)\"\n    class=\"renderedContent\"\n  />\n  <p v-else\n    v-html=\"renderedContent\"\n    class=\"renderedContent\"\n  />\n  <textarea\n    class=\"rawContent p-inputtextarea p-inputtext p-component p-inputtextarea-resizable\"\n    style=\"display: none\"\n    ref=\"txtarea\"\n    :rows=\"rows\"\n    :value=\"content\"\n    @input=\"changeContent($event.target.value)\"\n    @focusout=\"setEditOn(false)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref } from \"vue\";\nimport MarkdownIt from \"markdown-it\";\nimport {useStore} from \"@/store\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst mdContainer = require('markdown-it-container'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd.use(mdKatex, { output: \"html\" })\n  .use(mdImsize)\n  .use(mdContainer, \"warning\", {\n    validate: function(params: any) {\n      console.log(\"validate\", params.trim(), params.trim() == \"warning\");\n      return params.trim().match(/^warning$/);\n    },\n    render: function(tokens: any, idx: any) {\n      const m = tokens[idx].info.trim().match(/^warning(.*)$/);\n      if (tokens[idx].nesting === 1) {\n        // opening tag\n        return (\n          '<div style=\"background-color: #c6f68d; padding: 8px;\">' +\n          md.utils.escapeHtml(m[1]) +\n          \"\\n\"\n        );\n      } else {\n        // closing tag\n        return \"</div>\\n\";\n      }\n    }\n  });\n\nexport default {\n  name: \"Markdown\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    },\n    rows: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const store = useStore();\n    const renderedContent = computed(() => {\n      return md.render(props.content);\n    });\n    const editOn = ref(false);\n\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n</script>\n\n<style scoped>\n@import \"../../../node_modules/katex/dist/katex.min.css\";\n.renderedContent {\n  color: rgb(32, 33, 36);\n  font-family: Roboto, Arial, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  letter-spacing: normal;\n  line-height: 20px;\n  margin-right: 4px;\n  text-align: left;\n  text-wrap: wrap;\n  overflow-y: scroll;\n  height: 300px;\n  table :is(td, th) {\n    border-top: 1px solid black;\n    padding: 0.3em;\n  }\n  table {\n    border-spacing: 0;\n    border-collapse: collapse;\n  }\n  tr:nth-child(even) {\n    background-color: #f9f9f9;\n  }\n}\n.rawContent {\n  overflow-y: scroll;\n  height: 100%;\n}\n</style>\n","\nimport { computed, ref } from \"vue\";\nimport MarkdownIt from \"markdown-it\";\nimport {useStore} from \"@/store\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst mdContainer = require('markdown-it-container'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd.use(mdKatex, { output: \"html\" })\n  .use(mdImsize)\n  .use(mdContainer, \"warning\", {\n    validate: function(params: any) {\n      console.log(\"validate\", params.trim(), params.trim() == \"warning\");\n      return params.trim().match(/^warning$/);\n    },\n    render: function(tokens: any, idx: any) {\n      const m = tokens[idx].info.trim().match(/^warning(.*)$/);\n      if (tokens[idx].nesting === 1) {\n        // opening tag\n        return (\n          '<div style=\"background-color: #c6f68d; padding: 8px;\">' +\n          md.utils.escapeHtml(m[1]) +\n          \"\\n\"\n        );\n      } else {\n        // closing tag\n        return \"</div>\\n\";\n      }\n    }\n  });\n\nexport default {\n  name: \"Markdown\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    },\n    rows: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const store = useStore();\n    const renderedContent = computed(() => {\n      return md.render(props.content);\n    });\n    const editOn = ref(false);\n\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n","import { render } from \"./Markdown.vue?vue&type=template&id=22c74c27&scoped=true\"\nimport script from \"./Markdown.vue?vue&type=script&lang=ts\"\nexport * from \"./Markdown.vue?vue&type=script&lang=ts\"\n\nimport \"./Markdown.vue?vue&type=style&index=0&id=22c74c27&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-22c74c27\"\n\nexport default script","<template>\n  <ChangeLogComplain\n    :show=\"complainModalVisible\"\n    :complainChangeLink=\"complainChangeLink\"\n    @hide=\"complainModalVisible = false\"\n  />\n  <Fieldset\n    legend=\"change log\"\n    :toggleable=\"true\"\n    :collapsed=\"collapsed\"\n    @update:collapsed=\"toggle($event)\"\n    :pt=\"{\n      legend: { class: 'bg-primary' }\n    }\"\n  >\n    <div v-if=\"!isAuthorized\">\n      Sign in to see node change log\n    </div>\n    <div v-else class=\"m-0\">\n      <Card v-for=\"(event, i) of changes\" :key=\"i\" class=\"mt-3\">\n        <template #title>\n          {{ new Date(event.timestamp).toLocaleDateString() }}\n          {{ new Date(event.timestamp).toLocaleTimeString() }} /\n          {{ event.action }} change\n        </template>\n        <template #subtitle>\n          {{\n            !!event.userDisplayName\n              ? event.userDisplayName\n              : `user id ${event.userID}`\n          }}\n          / <a href=\"#\" @click=\"showComplain(event.changeLogID)\">Complain</a>\n        </template>\n        <template #content v-if=\"event.action == ActionType.Name\">\n          {{ event.newName }}\n        </template>\n        <template #content v-else-if=\"event.action == ActionType.Content\">\n          <Markdown :content=\"event.newContent\" :rows=\"10\" />\n        </template>\n        <template #content v-else-if=\"event.action == ActionType.Precondition\">\n          <div v-html=\"getContent(event)\" />\n        </template>\n      </Card>\n    </div>\n  </Fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Fieldset from \"primevue/fieldset\";\nimport Card from \"primevue/card\";\nimport { subscribeChangeLogEnriched, GetNodeUrl } from \"@/api/change_log\";\nimport { computed, reactive, ref, watch, defineComponent } from \"vue\";\nimport {\n  ActionType,\n  ChangeLogEnriched,\n  ChangeLogNodePrecondition\n} from \"@/store/change_log\";\nimport { useStore } from \"@/store\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default defineComponent({\n  name: \"ChangeLog\",\n  computed: {\n    ActionType() {\n      return ActionType;\n    }\n  },\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Markdown,\n    ChangeLogComplain,\n    Fieldset,\n    Card\n  },\n  setup(props) {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const collapsed = ref(true);\n    const changes = reactive([]) as Array<ChangeLogEnriched>;\n    let unsubscribe = () => {\n      /**/\n    };\n    watch(\n      () => [props.nodeId, collapsed.value],\n      async (newArgs, oldArgs) => {\n        if (newArgs[0] != oldArgs[0]) {\n          collapsed.value = true;\n        }\n        unsubscribe();\n        unsubscribe = () => {\n          /**/\n        };\n        if (collapsed.value == false) {\n          unsubscribe = await subscribeChangeLogEnriched(\n            [ActionType.Name, ActionType.Content, ActionType.Precondition],\n            [props.nodeId],\n            changeLogs => {\n              changes.splice(0, changes.length, ...changeLogs);\n            }\n          );\n        }\n      }\n    );\n    return {\n      changes,\n      collapsed,\n      toggle: (event: boolean) => {\n        collapsed.value = event;\n      },\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      getContent: (event: ChangeLogEnriched) => {\n        event = event as ChangeLogNodePrecondition;\n        const removed = [];\n        for (const cd of event.removed) {\n          removed.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n        const added = [];\n        for (const cd of event.added) {\n          added.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n\n        let result = \"\";\n        if (removed.length > 0) {\n          result += `removed: ${removed.join(\", \")}`;\n        }\n        if (added.length > 0) {\n          result += `<br> added: ${added.join(\", \")}`;\n        }\n        return result;\n      },\n      complainModalVisible,\n      complainChangeLink,\n      isAuthorized\n    };\n  }\n});\n</script>\n","export enum ActionType {\n  /**\n   * /map\n   */\n  Name = \"name\",\n  ParentID = \"parentID\",\n\n  /**\n   * /node_content\n   */\n  Content = \"content\",\n\n  /**\n   * /precondition\n   */\n  Precondition = \"precondition\",\n\n  /**\n   * /cmd/remove\n   */\n  Remove = \"remove\",\n\n  /**\n   * /cmd/restore\n   */\n  Restore = \"restore\",\n}\n\nexport type Node = {\n  id: string;\n  idPath: string;\n  name: string;\n};\n\nexport type ChangeLog = {\n  changeLogID: string;\n  nodeID: string;\n  userID: string;\n  timestamp: number;\n  action: ActionType;\n  attributes: {\n    value: any;\n    valueBefore: any;\n    valueAfter: any;\n    added: any;\n    removed: any;\n    parentNodeID: any;\n  };\n};\n\nexport type ChangeLogNodePrecondition = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  removed: Array<Node>;\n  added: Array<Node>;\n};\n\nexport type ChangeLogNodeContent = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  node: Node;\n\n  newContent: string;\n};\n\nexport type ChangeLogNodeName = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  node: Node;\n\n  newName: string;\n};\n\nexport type ChangeLogNodeParent = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  parentNodeBefore: Node | null;\n  parentNodeAfter: Node | null;\n  node: Node;\n\n  isRemoved: boolean;\n  isAdded: boolean;\n};\n\nexport type ChangeLogEnriched =\n  | ChangeLogNodeContent\n  | ChangeLogNodeName\n  | ChangeLogNodePrecondition\n  | ChangeLogNodeParent;\n","import { ActionType, ChangeLog, ChangeLogEnriched } from \"@/store/change_log\";\nimport { QueryFilterConstraint } from \"@firebase/firestore\";\nimport {\n  and,\n  collection,\n  getFirestore,\n  onSnapshot,\n  orderBy,\n  query,\n  where\n} from \"firebase/firestore\";\nimport firebase from \"firebase/compat\";\n\n/**\n * TODO: add limit\n * @param actions\n * @param nodeIDs\n * @param cb\n */\nexport async function subscribeChangeLog(\n  actions: Array<ActionType>,\n  nodeIDs: Array<string>,\n  cb: (changeLogs: Array<ChangeLog>) => void\n) {\n  const andConditions = [] as Array<QueryFilterConstraint>;\n  if (nodeIDs.length) {\n    andConditions.push(where(\"node_id\", \"in\", nodeIDs));\n  }\n  if (actions.length) {\n    andConditions.push(where(\"action\", \"in\", actions));\n  }\n  // 'remove' and 'restore' changes is made by firebase functions (but logged anyway in firestore)\n  // here we skip most details made by function and show only action made by user\n  andConditions.push(where(\"user_id\", \"!=\", \"function\"));\n  const q = query(\n    collection(getFirestore(), \"changes\"),\n    and(...andConditions),\n    orderBy(\"timestamp\", \"desc\")\n  );\n\n  return onSnapshot(q, snapshot => {\n    const changeLogs = [] as Array<ChangeLog>;\n    snapshot.forEach(doc => {\n      changeLogs.push({\n        changeLogID: doc.id,\n        nodeID: doc.get(\"node_id\"),\n        userID: doc.get(\"user_id\"),\n        timestamp: doc.get(\"timestamp\"),\n        action: doc.get(\"action\"),\n        attributes: {\n          value: doc.get(\"attributes.value\"),\n          valueBefore: doc.get(\"attributes.valueBefore\"),\n          valueAfter: doc.get(\"attributes.valueAfter\"),\n          added: doc.get(\"attributes.added\"),\n          removed: doc.get(\"attributes.removed\"),\n          parentNodeID: doc.get(\"attributes.parentNodeID\"),\n        }\n      });\n    });\n    cb(changeLogs);\n  });\n}\n\n/**\n * @param nodeID\n */\nexport async function getNodeName(\n  nodeID: string\n): Promise<Record<string, string>> {\n  const nodeName = {} as Record<string, string>;\n  const pr = await firebase\n    .database()\n    .ref(`map/${nodeID}/name`)\n    .get();\n  if (pr.exists()) {\n    nodeName[`map/${nodeID}`] = pr.val();\n  } else {\n    const prTrash = await firebase\n      .database()\n      .ref(`trash/${nodeID}/map/name`)\n      .get();\n    if (prTrash.exists()) {\n      nodeName[`trash/${nodeID}`] = prTrash.val();\n    }\n  }\n\n  return nodeName;\n}\n\n/**\n * @param userID\n */\nexport async function getUserDisplayName(\n  userID: string\n): Promise<Record<string, string>> {\n  const userName = {} as Record<string, string>;\n  const pr = await firebase\n    .database()\n    .ref(`public_user_data/${userID}/displayName`)\n    .get();\n  if (pr.exists()) {\n    userName[`${userID}`] = pr.val();\n  }\n  return userName;\n}\n\nexport async function getUserDisplayNames(\n  userIDs: Array<string>\n): Promise<Record<string, string>> {\n  const fetches = [];\n  for (const userID of userIDs) {\n    fetches.push(getUserDisplayName(userID));\n  }\n  const responses = await Promise.all(fetches);\n  const result = {} as Record<string, string>;\n  for (const response of responses) {\n    result[Object.keys(response)[0]] = Object.values(response)[0];\n  }\n  return result;\n}\n\n// Note: realtime database charges for bandwidth and does not have batch fetch for multiple paths\n// If someday we switch to Firestore this must be implemented in other way\nexport async function getNodeNames(\n  nodeIDs: Array<string>\n): Promise<Record<string, string>> {\n  const fetches = [];\n  for (const nodeID of nodeIDs) {\n    fetches.push(getNodeName(nodeID));\n  }\n  const responses = await Promise.all(fetches);\n  const result = {} as Record<string, string>;\n  for (const response of responses) {\n    result[Object.keys(response)[0]] = Object.values(response)[0];\n  }\n  return result;\n}\n\nfunction getPathFromNodeName(\n  nodeID: string | null,\n  nodeNames: Record<string, string>\n): string {\n  if (nodeID == null) {\n    return \"\";\n  }\n  let nodePath = \"\";\n  if (nodeNames[`map/${nodeID}`] != null) {\n    nodePath = `map/${nodeID}`;\n  } else if (nodeNames[`trash/${nodeID}`] != null) {\n    nodePath = `trash/${nodeID}`;\n  }\n  return nodePath;\n}\n\n/**\n * Same as subscribeChangeLog but enriched with username\n * @param actions\n * @param nodeIDs\n * @param cb\n */\nexport async function subscribeChangeLogEnriched(\n  actions: Array<ActionType>,\n  nodeIDs: Array<string>,\n  cb: (changeLogsEnriched: Array<ChangeLogEnriched>) => void\n) {\n  return subscribeChangeLog(\n    actions,\n    nodeIDs,\n    (changeLogs: Array<ChangeLog>) => {\n      // collect userIDs to request names\n      // and nodeIDs to request node names\n      const userNames = {} as Record<string, string>;\n      const nodeNames = {} as Record<string, string>;\n      for (const changeLog of changeLogs) {\n        userNames[changeLog.userID] = \"\";\n        nodeNames[changeLog.nodeID] = \"\";\n        if (changeLog.action == ActionType.ParentID) {\n          if (changeLog.attributes.valueBefore != null) {\n            nodeNames[changeLog.attributes.valueBefore] = \"\";\n          }\n          if (changeLog.attributes.valueAfter != null) {\n            nodeNames[changeLog.attributes.valueAfter] = \"\";\n          }\n        }\n        if (changeLog.action == ActionType.Restore) {\n          if (changeLog.attributes.parentNodeID != null) {\n            nodeNames[changeLog.attributes.parentNodeID] = \"\";\n          }\n        }\n        if (changeLog.action == ActionType.Precondition) {\n          if (changeLog.attributes.removed != null) {\n            for (const id of changeLog.attributes.removed) {\n              nodeNames[id] = \"\";\n            }\n          }\n          if (changeLog.attributes.added != null) {\n            for (const id of changeLog.attributes.added) {\n              nodeNames[id] = \"\";\n            }\n          }\n        }\n      }\n      // fetch node and usernames\n      const nodeIDs = [];\n      for (const nodeID in nodeNames) {\n        nodeIDs.push(nodeID);\n      }\n      const userIDs = [];\n      for (const userID in userNames) {\n        userIDs.push(userID);\n      }\n      Promise.all([getNodeNames(nodeIDs), getUserDisplayNames(userIDs)]).then(\n        resp => {\n          const nodeNames = resp[0];\n          const userNames = resp[1];\n          const changeLogsEnriched = [] as Array<ChangeLogEnriched>;\n          changeLogs.forEach(log => {\n            const nodePath = getPathFromNodeName(log.nodeID, nodeNames);\n            if (log.action == ActionType.Name) {\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                newName: log.attributes.value\n              });\n            } else if (log.action == ActionType.Content) {\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                newContent: log.attributes.value\n              });\n            } else if (log.action == ActionType.Precondition) {\n              const removed = [];\n              if (log.attributes.removed) {\n                for (const id of log.attributes.removed) {\n                  removed.push({\n                    id: id,\n                    idPath: getPathFromNodeName(id, nodeNames),\n                    name: nodeNames[getPathFromNodeName(id, nodeNames)]\n                  });\n                }\n              }\n              const added = [];\n              if (log.attributes.added) {\n                for (const id of log.attributes.added) {\n                  added.push({\n                    id: id,\n                    idPath: getPathFromNodeName(id, nodeNames),\n                    name: nodeNames[getPathFromNodeName(id, nodeNames)]\n                  });\n                }\n              }\n\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                removed,\n                added\n              });\n            } else if (log.action == ActionType.ParentID && log.attributes.valueAfter !== null) {\n              const beforePath = getPathFromNodeName(\n                log.attributes.valueBefore,\n                nodeNames\n              );\n              const afterPath = getPathFromNodeName(\n                log.attributes.valueAfter,\n                nodeNames\n              );\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                parentNodeBefore: {\n                  id: log.attributes.valueBefore,\n                  idPath: beforePath,\n                  name: nodeNames[beforePath]\n                },\n\n                parentNodeAfter: {\n                  id: log.attributes.valueAfter,\n                  idPath: afterPath,\n                  name: nodeNames[afterPath]\n                },\n\n                isRemoved: false,\n                isAdded: log.attributes.valueBefore == null\n              });\n            } else if (log.action == ActionType.Remove) {\n              const beforePath = getPathFromNodeName(\n                log.attributes.parentNodeID,\n                nodeNames\n              );\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                parentNodeBefore: {\n                  id: log.attributes.parentNodeID,\n                  idPath: beforePath,\n                  name: nodeNames[beforePath]\n                },\n\n                parentNodeAfter: null,\n\n                isRemoved: true,\n                isAdded: false\n              });\n            } else if (log.action == ActionType.Restore) {\n              const afterPath = getPathFromNodeName(\n                log.attributes.parentNodeID,\n                nodeNames\n              );\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                parentNodeBefore: null,\n\n                parentNodeAfter: {\n                  id: log.attributes.parentNodeID,\n                  idPath: afterPath,\n                  name: nodeNames[afterPath]\n                },\n\n                isRemoved: false,\n                isAdded: true\n              });\n            }\n          });\n          cb(changeLogsEnriched);\n        }\n      );\n    }\n  );\n}\n\nexport function IsNodeInTrash(nodeIDPath: string): boolean {\n  return nodeIDPath.startsWith(\"trash\")\n}\n\nexport function GetNodeUrl(\n  nodeIDPath: string,\n  nodeID: string,\n  nodeName: string\n): string {\n  if (IsNodeInTrash(nodeIDPath)) {\n    return `<a target=\"_blank\" href=\"/node_description/${nodeID}\">${nodeName}</a>`;\n  } else {\n    return `<a target=\"_blank\" href=\"/${nodeID}\">${nodeName}</a>`;\n  }\n}\n","<template>\n  <Dialog\n    v-model:visible=\"complainModalVisible\"\n    @hide=\"$emit('hide')\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{\n          `Please use our discord channel to complain about inappropriate changes`\n        }}\n      </h3>\n    </template>\n    <h3>\n      <a\n        target=\"_blank\"\n        href=\"https://discord.com/channels/1171118046543347782/1196694554791915600\"\n        >Discord edit-complains channel</a\n      >\n    </h3>\n    <p>\n      You can use the following text:\n    </p>\n    <code>\n      Hi, I think I found changes that was inappropriate because ... <br />\n      Here is the changes I am talking about {{ complainChangeLink }} <br />\n      This is the ...st time I found inappropriate changes from this user.\n      <br />\n    </code>\n    <template #footer> </template>\n  </Dialog>\n</template>\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport { ref, watch, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"ChangeLogComplain\",\n  props: {\n    show: Boolean,\n    complainChangeLink: String\n  },\n  components: {\n    Dialog\n  },\n  emits: [\"hide\"],\n  setup(props) {\n    const complainModalVisible = ref(false);\n    watch(\n      () => [props.show],\n      async (newArgs, oldArgs) => {\n        complainModalVisible.value = newArgs[0];\n      }\n    );\n    return {\n      complainModalVisible\n    };\n  }\n});\n</script>\n","\nimport Dialog from \"primevue/dialog\";\nimport { ref, watch, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"ChangeLogComplain\",\n  props: {\n    show: Boolean,\n    complainChangeLink: String\n  },\n  components: {\n    Dialog\n  },\n  emits: [\"hide\"],\n  setup(props) {\n    const complainModalVisible = ref(false);\n    watch(\n      () => [props.show],\n      async (newArgs, oldArgs) => {\n        complainModalVisible.value = newArgs[0];\n      }\n    );\n    return {\n      complainModalVisible\n    };\n  }\n});\n","import { render } from \"./ChangeLogComplain.vue?vue&type=template&id=0a57cd10\"\nimport script from \"./ChangeLogComplain.vue?vue&type=script&lang=ts\"\nexport * from \"./ChangeLogComplain.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport Fieldset from \"primevue/fieldset\";\nimport Card from \"primevue/card\";\nimport { subscribeChangeLogEnriched, GetNodeUrl } from \"@/api/change_log\";\nimport { computed, reactive, ref, watch, defineComponent } from \"vue\";\nimport {\n  ActionType,\n  ChangeLogEnriched,\n  ChangeLogNodePrecondition\n} from \"@/store/change_log\";\nimport { useStore } from \"@/store\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default defineComponent({\n  name: \"ChangeLog\",\n  computed: {\n    ActionType() {\n      return ActionType;\n    }\n  },\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Markdown,\n    ChangeLogComplain,\n    Fieldset,\n    Card\n  },\n  setup(props) {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const collapsed = ref(true);\n    const changes = reactive([]) as Array<ChangeLogEnriched>;\n    let unsubscribe = () => {\n      /**/\n    };\n    watch(\n      () => [props.nodeId, collapsed.value],\n      async (newArgs, oldArgs) => {\n        if (newArgs[0] != oldArgs[0]) {\n          collapsed.value = true;\n        }\n        unsubscribe();\n        unsubscribe = () => {\n          /**/\n        };\n        if (collapsed.value == false) {\n          unsubscribe = await subscribeChangeLogEnriched(\n            [ActionType.Name, ActionType.Content, ActionType.Precondition],\n            [props.nodeId],\n            changeLogs => {\n              changes.splice(0, changes.length, ...changeLogs);\n            }\n          );\n        }\n      }\n    );\n    return {\n      changes,\n      collapsed,\n      toggle: (event: boolean) => {\n        collapsed.value = event;\n      },\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      getContent: (event: ChangeLogEnriched) => {\n        event = event as ChangeLogNodePrecondition;\n        const removed = [];\n        for (const cd of event.removed) {\n          removed.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n        const added = [];\n        for (const cd of event.added) {\n          added.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n\n        let result = \"\";\n        if (removed.length > 0) {\n          result += `removed: ${removed.join(\", \")}`;\n        }\n        if (added.length > 0) {\n          result += `<br> added: ${added.join(\", \")}`;\n        }\n        return result;\n      },\n      complainModalVisible,\n      complainChangeLink,\n      isAuthorized\n    };\n  }\n});\n","import { render } from \"./ChangeLog.vue?vue&type=template&id=1f629591\"\nimport script from \"./ChangeLog.vue?vue&type=script&lang=ts\"\nexport * from \"./ChangeLog.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <PinIcon @click=\"clickPin\"/>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{ `Choose parent from which pin will be visible` }}\n      </h3>\n    </template>\n\n    <Listbox v-model=\"selectedParent\" :options=\"parents\" optionLabel=\"title\" />\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport Listbox from \"primevue/listbox\";\nimport {actions, useStore} from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { actions as pinActions } from \"@/store/pin\";\nimport api from \"@/api/api\";\nimport PinIcon from \"@/components/node_content/PinIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\n\nexport default {\n  name: \"PinButton\",\n  components: {\n    PinIcon,\n    Dialog,\n    Button,\n    Listbox\n  },\n  setup() {\n    const store = useStore();\n    const confirm = useConfirm();\n    const treeState = store.state.tree;\n    const addDialogVisible = ref(false);\n    const selectedParent = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const newNodeTitle = ref(\"\");\n    const parents = computed(() => {\n      const selectedNodeParents = [];\n      let currentParent = treeState.nodeRecord[treeState.selectedNodeId].parent;\n      while (treeState.nodeRecord[currentParent.id].parent) {\n        selectedNodeParents.push({\n          title: currentParent.title,\n          id: currentParent.id\n        });\n        currentParent = treeState.nodeRecord[currentParent.id].parent;\n      }\n      selectedNodeParents.push({ title: \"root\", id: 0 });\n      return selectedNodeParents;\n    });\n\n    return {\n      clickPin: async () => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to pin nodes\"});\n          return\n        }\n        if (\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n        ) {\n          store.dispatch(\n            `pin/${pinActions.RemovePin}`,\n            store.state.tree.selectedNodeId\n          );\n          api.savePins(store.state.user.user, store.state.pin.pins);\n        } else {\n          addDialogVisible.value = !addDialogVisible.value;\n        }\n      },\n      selectedParent,\n      parents,\n      add: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`pin/${pinActions.AddPin}`, {\n          parentId: selectedParent.value.id,\n          nodeId: selectedNode.value.id\n        });\n        api.savePins(store.state.user.user, store.state.pin.pins);\n        selectedParent.value = null;\n      },\n      cancelAdd: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible,\n      newNodeTitle\n    };\n  }\n};\n</script>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"isPinned || mouseOver\" class=\"pin\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/pin-on.svg\"\n      />\n    </div>\n    <div v-else class=\"pin\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/pin-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from \"@/store\";\nimport {computed, ref, watch} from \"vue\";\n\nexport default {\n  name: \"PinIcon\",\n  setup() {\n    const store = useStore();\n    const mouseOver = ref(false);\n    watch(\n        () => store.state.tree.selectedNodeId,\n        async () => {\n          mouseOver.value = false;\n        }\n    )\n    return {\n      isPinned: computed(\n        () =>\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n      ),\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.pin {\n  margin-top: 15px;\n  margin-left: 15px;\n}\n</style>\n","import { render } from \"./PinIcon.vue?vue&type=template&id=4ed46db5&scoped=true\"\nimport script from \"./PinIcon.vue?vue&type=script&lang=js\"\nexport * from \"./PinIcon.vue?vue&type=script&lang=js\"\n\nimport \"./PinIcon.vue?vue&type=style&index=0&id=4ed46db5&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-4ed46db5\"\n\nexport default script","import { render } from \"./PinButton.vue?vue&type=template&id=60471805\"\nimport script from \"./PinButton.vue?vue&type=script&lang=js\"\nexport * from \"./PinButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <SubscribeIcon @click=\"toggleSubscribe\" :is-on=\"isOn\"/>\n</template>\n<script lang=\"ts\">\nimport {computed, defineComponent} from \"vue\";\nimport SubscribeIcon from \"@/components/node_content/SubscribeIcon.vue\";\nimport { actions as subscriptionsActions } from \"@/store/subscriptions\";\nimport {useStore} from \"@/store\";\n\nexport default defineComponent({\n  name: \"SubscribeButton\",\n  components: {\n    SubscribeIcon,\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const store = useStore();\n    return {\n      isOn: computed(\n          () => !!store.state.subscriptions.subscriptions[props.nodeID] && store.state.subscriptions.subscriptions[props.nodeID] == 1\n      ),\n      toggleSubscribe: () => {\n        store.dispatch(`subscriptions/${subscriptionsActions.ToggleSubscription}`, props.nodeID)\n      }\n    }\n  }\n})\n</script>\n","<template>\n  <div\n      style=\"cursor: pointer;\"\n      @mouseenter=\"mouseOver = true\"\n      @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"isOn || mouseOver\" class=\"subscribe\">\n      <img\n          style=\"height: 35px\"\n          alt=\"img\"\n          src=\"../../assets/images/eye-on.svg\"\n      />\n    </div>\n    <div v-else class=\"subscribe\">\n      <img\n          style=\"height: 35px\"\n          alt=\"img\"\n          src=\"../../assets/images/eye-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"SubscribeIcon\",\n  props: {\n    isOn: Boolean,\n  },\n  setup() {\n    const mouseOver = ref(false);\n    return {\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.subscribe {\n  margin-top: 15px;\n}\n</style>\n","import { render } from \"./SubscribeIcon.vue?vue&type=template&id=5d02b387&scoped=true\"\nimport script from \"./SubscribeIcon.vue?vue&type=script&lang=js\"\nexport * from \"./SubscribeIcon.vue?vue&type=script&lang=js\"\n\nimport \"./SubscribeIcon.vue?vue&type=style&index=0&id=5d02b387&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-5d02b387\"\n\nexport default script","\nimport {computed, defineComponent} from \"vue\";\nimport SubscribeIcon from \"@/components/node_content/SubscribeIcon.vue\";\nimport { actions as subscriptionsActions } from \"@/store/subscriptions\";\nimport {useStore} from \"@/store\";\n\nexport default defineComponent({\n  name: \"SubscribeButton\",\n  components: {\n    SubscribeIcon,\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props) {\n    const store = useStore();\n    return {\n      isOn: computed(\n          () => !!store.state.subscriptions.subscriptions[props.nodeID] && store.state.subscriptions.subscriptions[props.nodeID] == 1\n      ),\n      toggleSubscribe: () => {\n        store.dispatch(`subscriptions/${subscriptionsActions.ToggleSubscription}`, props.nodeID)\n      }\n    }\n  }\n})\n","import { render } from \"./SubscribeButton.vue?vue&type=template&id=252cc317\"\nimport script from \"./SubscribeButton.vue?vue&type=script&lang=ts\"\nexport * from \"./SubscribeButton.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <p\n    v-show=\"!editOn\"\n    v-html=\"renderedContent\"\n    @click=\"setEditOn(true)\"\n    class=\"title\"\n  />\n  <textarea\n    class=\"title rawTitle p-inputtextarea p-inputtext p-component p-inputtextarea-resizable\"\n    style=\"display: none\"\n    ref=\"txtarea\"\n    rows=\"1\"\n    :value=\"content\"\n    @input=\"changeContent($event.target.value)\"\n    @focusout=\"setEditOn(false)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref } from \"vue\";\nimport {useStore} from \"@/store\";\n\nexport default {\n  name: \"Title\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const renderedContent = computed(() => {\n      return props.content;\n    });\n    const editOn = ref(false);\n    const store = useStore();\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        if (!store.state.user ||\n            !store.state.user.user ||\n            store.state.user.user.isAnonymous) {\n          return\n        }\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n</script>\n\n<style scoped>\n.title {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1.375rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  line-height: 1.75rem;\n}\n.rawTitle {\n  margin-top: 10px;\n}\n</style>\n","\nimport { computed, ref } from \"vue\";\nimport {useStore} from \"@/store\";\n\nexport default {\n  name: \"Title\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const renderedContent = computed(() => {\n      return props.content;\n    });\n    const editOn = ref(false);\n    const store = useStore();\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        if (!store.state.user ||\n            !store.state.user.user ||\n            store.state.user.user.isAnonymous) {\n          return\n        }\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n","import { render } from \"./Title.vue?vue&type=template&id=00857be5&scoped=true\"\nimport script from \"./Title.vue?vue&type=script&lang=ts\"\nexport * from \"./Title.vue?vue&type=script&lang=ts\"\n\nimport \"./Title.vue?vue&type=style&index=0&id=00857be5&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-00857be5\"\n\nexport default script","<template>\n  <AddBasedOnIcon @click=\"showAddBanner\" />\n  <Dialog\n    v-model:visible=\"addBannerVisible\"\n    :dismissableMask=\"false\"\n    :closable=\"true\"\n    :modal=\"false\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        Set \"{{\n          preconditionNode.title\n            ? preconditionNode.title\n            : selectedNode\n            ? selectedNode.title\n            : \"\"\n        }}\" as precondition for \"{{ targetNode ? targetNode.title : \"\" }}\"\n      </h3>\n    </template>\n\n    <template #footer>\n      <Button\n        label=\"Cancel\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Done\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport {actions, useStore} from \"@/store\";\nimport { computed, ref, watch } from \"vue\";\nimport api from \"@/api/api\";\nimport AddBasedOnIcon from \"@/components/node_content/AddBasedOnIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\n\nexport default {\n  name: \"AddBasedOnButton\",\n  components: {\n    Dialog,\n    Button,\n    AddBasedOnIcon\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const addBannerVisible = ref(false);\n    const targetNode = ref({}); // node where precondition must be added\n    const preconditionNode = ref({}); // node where precondition must be added\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]); // current selected node\n\n    watch(\n      () => props.clickedTitleId,\n      () => {\n        if (addBannerVisible.value &&\n          props.clickedTitleId !== \"-1\" &&\n          store.state.tree.nodeRecord[props.clickedTitleId]\n        ) {\n          preconditionNode.value =\n            store.state.tree.nodeRecord[props.clickedTitleId].node;\n        }\n      },\n      { immediate: true }\n    );\n\n    return {\n      showAddBanner: async () => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n        ctx.emit(\"select-precondition-is-on\");\n        targetNode.value = store.getters[\"tree/selectedNode\"];\n        addBannerVisible.value = !addBannerVisible.value;\n      },\n      add: () => {\n        let preconditionsIDs = [];\n        if (store.state.precondition.preconditions[targetNode.value.id]) {\n          preconditionsIDs =\n            store.state.precondition.preconditions[targetNode.value.id];\n        }\n        preconditionsIDs.push(preconditionNode.value.id);\n\n        api.savePreconditions(store.state.user.user, {\n          nodeId: targetNode.value.id,\n          preconditionIds: preconditionsIDs\n        });\n        ctx.emit(\"select-precondition-is-off\");\n        addBannerVisible.value = false;\n        preconditionNode.value = {};\n      },\n      cancelAdd: () => {\n        addBannerVisible.value = false;\n        preconditionNode.value = {};\n        ctx.emit(\"select-precondition-is-off\");\n      },\n      addBannerVisible,\n      targetNode,\n      preconditionNode,\n      selectedNode\n    };\n  }\n};\n</script>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"mouseOver\" class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/add-on.svg\"\n      />\n    </div>\n    <div v-else class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/add-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"AddBasedOnIcon\",\n  setup() {\n    const mouseOver = ref(false);\n    return {\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.custom {\n  margin-left: 15px;\n}\n</style>\n","import { render } from \"./AddBasedOnIcon.vue?vue&type=template&id=2494d1ac&scoped=true\"\nimport script from \"./AddBasedOnIcon.vue?vue&type=script&lang=js\"\nexport * from \"./AddBasedOnIcon.vue?vue&type=script&lang=js\"\n\nimport \"./AddBasedOnIcon.vue?vue&type=style&index=0&id=2494d1ac&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-2494d1ac\"\n\nexport default script","import { render } from \"./AddBasedOnButton.vue?vue&type=template&id=a23459a8\"\nimport script from \"./AddBasedOnButton.vue?vue&type=script&lang=js\"\nexport * from \"./AddBasedOnButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <img v-if=\"isAuthorized\"\n    style=\"position: absolute; left:0; top:0; width: 100%; height: 240px; cursor: pointer;\"\n    alt=\"welcome\"\n    :src=\"defaultImageURL\"\n    @click=\"toggleAddDialog\"\n  />\n  <img v-else\n       style=\"position: absolute; left:0; top:0; width: 100%; height: 240px;\"\n       alt=\"welcome\"\n       :src=\"defaultImageURL\"\n  />\n  <input\n    type=\"file\"\n    ref=\"input\"\n    style=\"display: none\"\n    @change=\"onInputChange\"\n    accept=\"image/*\"\n  />\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <div style=\"width:431px; padding-right:10px;\">\n        Press \"copy markdown link\" button to add image into this node description\n      </div>\n    </template>\n    <Button rounded @click=\"triggerUpload\">upload</Button>\n    <div style=\"height:10px;\"></div>\n    <ProgressBar v-if=\"showProgressBar\" mode=\"indeterminate\" style=\"height: 6px\"></ProgressBar>\n    <div style=\"height:10px;\"></div>\n    <Card v-for=\"(item, i) of items\" :key=\"i\" class=\"p-mt-1\">\n      <template #content>\n        <img alt=\"image\" :src=\"item.url\" style=\"width:431px;\" />\n      </template>\n      <template #footer>\n        <div style=\"display:flex; flex-direction: row; justify-content: space-between;\">\n          <Button rounded @click=\"setAsDefault(item.url)\">set as default</Button>\n          <Button rounded @click=\"copyMDLink(item.url)\">copy markdown link</Button>\n          <Button v-if=\"showRemoveButton(item.id)\" @click=\"toTrash(item.id)\" severity=\"danger\" text raised rounded aria-label=\"Delete\">\n            <template v-slot:icon>\n              <span class=\"material-symbols-outlined\">delete</span>\n            </template>\n          </Button>\n        </div>\n      </template>\n    </Card>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport Button from \"primevue/button\";\nimport {computed, defineComponent, ref, watchEffect} from \"vue\";\nimport { useStore } from \"@/store\";\nimport firebase from \"firebase/compat\";\nimport { useToast } from \"primevue/usetoast\";\nimport ProgressBar from 'primevue/progressbar';\nimport { fromBlob } from 'image-resize-compress';\nconst fileFormat = 'webp'\nimport { useConfirm } from \"primevue/useconfirm\";\n\nexport default defineComponent({\n  name: \"TitleImage\",\n  components: {\n    Button,\n    Card,\n    Dialog,\n    ProgressBar,\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    },\n    nodeContent: {\n      type: String,\n      required: true\n    },\n  },\n  setup(props) {\n    const toast = useToast();\n    const store = useStore();\n    const confirm = useConfirm();\n    const addDialogVisible = ref(false);\n    const input = ref();\n    const defaultURL = \"https://cdn.scimap.org/images/default.jpg\";\n    const items = ref([] as Array<{\n      id: string,\n      timestamp: number, // it is also a unique key of image\n      name: string,\n      url: string,\n      removed: number,\n    }>);\n    const showProgressBar = ref(false);\n    const defaultImageURL = ref(defaultURL);\n    const dbNodeImgPath = computed(() => `/node_image/${props.nodeID}`);\n    watchEffect(\n        () => {\n          const images = store.state.image.images[props.nodeID]\n          items.value = []\n          items.value.push({\n            id: \"\",\n            timestamp: Infinity,\n            name: \"default\",\n            url: defaultURL,\n            removed: 0,\n          })\n          defaultImageURL.value = defaultURL\n          for (const key in images) {\n            if (key == \"default\") {\n              defaultImageURL.value =  images[key].url;\n              continue;\n            }\n            items.value.push({\n              id: key,\n              timestamp: Number(key),\n              name: images[key].name,\n              url: process.env.VUE_APP_IS_EMULATOR === \"true\" ? images[key].url : 'https://cdn.scimap.org'+images[key].path,\n              removed: images[key].removed,\n            });\n          }\n          // desc sort by timestamp\n          items.value = items.value.filter((item)=>!item.removed).sort((a,b) => b.timestamp - a.timestamp);\n        }\n    )\n    return {\n      items,\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      defaultImageURL,\n      setAsDefault: async (url: string) => {\n        await firebase\n          .database()\n          .ref(`${dbNodeImgPath.value}`)\n          .update({\n            default: {\n              url,\n              name: \"\"\n            }\n          });\n      },\n      copyMDLink: async (url: string) => {\n        await navigator.clipboard.writeText(`![](${url} =350x)`);\n        toast.add({\n          severity: \"info\",\n          summary: \"Copied\",\n          detail: \"You can now paste it into node description. Please, do not use this link in other node description as someone can remove it from this node images as not used!\",\n          life: 1000\n        });\n      },\n      showRemoveButton: (id: string) => {\n        if (!id) {\n          // if there is no id it is the default stub image\n          return false\n        }\n        // check that image is not used in node description\n        if (props.nodeContent.length && props.nodeContent.includes(id)) {\n          return false\n        }\n\n        return true\n      },\n      toTrash: async (id: string) => {\n        confirm.require({\n          message: 'Are you sure you want to delete this image?',\n          header: 'Confirmation',\n          icon: 'pi pi-exclamation-triangle',\n          rejectClass: 'p-button-secondary p-button-outlined',\n          rejectLabel: 'Cancel',\n          acceptLabel: 'Delete',\n          accept: async () => {\n            await firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${id}`)\n                .update({removed: new Date().getTime()});\n            toast.add({ severity: 'info', summary: 'Image was deleted', detail: '', life: 3000 });\n          },\n          // reject: () => {}\n        });\n\n      },\n      toggleAddDialog: () => {\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      addDialogVisible,\n      input,\n      triggerUpload: () => {\n        input.value.click();\n      },\n      showProgressBar,\n      onInputChange: async (event: {\n        target: {\n          files: Array<File>;\n        };\n      }) => {\n        if (\n          !store.state.user ||\n          !store.state.user.user ||\n          store.state.user.user.isAnonymous ||\n          props.nodeID.length == 0\n        ) {\n          return;\n        }\n        showProgressBar.value = true;\n\n        const imgFile = event.target.files[0] as File;\n        let compressedBlob = await fromBlob(imgFile, 90, 0, 0, fileFormat)\n        if (compressedBlob.size > 500_000) {\n          // try to resize\n          compressedBlob = await fromBlob(imgFile, 90, 1200, 'auto', fileFormat)\n          if (compressedBlob.size > 500_000) {\n            // if still large, then give up\n            toast.add({\n              severity: \"info\",\n              summary: \"Sorry\",\n              detail: \"Cannot compress file, please try to resize/compress it to less than 500Kb\",\n              life: 3000\n            });\n            return;\n          }\n        }\n\n        const name = imgFile.name;\n        const fileName = new Date().getTime();\n        const filePath = `/user/${store.state.user.user.uid}/image/${fileName}.${fileFormat}`\n        const storageRef = firebase\n          .storage()\n          .ref(filePath)\n          .put(compressedBlob);\n        storageRef.on(\n          \"state_changed\",\n          snapshot => {\n            // uploadProgress.value = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          },\n          error => {\n            console.log(error.message);\n          },\n          () => {\n            showProgressBar.value = false;\n            storageRef.snapshot.ref.getDownloadURL().then(url => {\n              let parsedURL = {} as URL\n              try {\n                parsedURL = new URL(url);\n              } catch (error) {\n                console.log(error);\n                return\n              }\n              // removed token=... from url\n              const preparedURL = parsedURL.protocol+'//'+parsedURL.hostname+(parsedURL.port == '' ? '' : ':'+parsedURL.port)+parsedURL.pathname+'?alt=media';\n              firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${fileName}`)\n                .update({\n                  name,\n                  path: filePath,\n                  url: preparedURL,\n                });\n            });\n          }\n        );\n      }\n    };\n  }\n});\n</script>\n","\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport Button from \"primevue/button\";\nimport {computed, defineComponent, ref, watchEffect} from \"vue\";\nimport { useStore } from \"@/store\";\nimport firebase from \"firebase/compat\";\nimport { useToast } from \"primevue/usetoast\";\nimport ProgressBar from 'primevue/progressbar';\nimport { fromBlob } from 'image-resize-compress';\nconst fileFormat = 'webp'\nimport { useConfirm } from \"primevue/useconfirm\";\n\nexport default defineComponent({\n  name: \"TitleImage\",\n  components: {\n    Button,\n    Card,\n    Dialog,\n    ProgressBar,\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    },\n    nodeContent: {\n      type: String,\n      required: true\n    },\n  },\n  setup(props) {\n    const toast = useToast();\n    const store = useStore();\n    const confirm = useConfirm();\n    const addDialogVisible = ref(false);\n    const input = ref();\n    const defaultURL = \"https://cdn.scimap.org/images/default.jpg\";\n    const items = ref([] as Array<{\n      id: string,\n      timestamp: number, // it is also a unique key of image\n      name: string,\n      url: string,\n      removed: number,\n    }>);\n    const showProgressBar = ref(false);\n    const defaultImageURL = ref(defaultURL);\n    const dbNodeImgPath = computed(() => `/node_image/${props.nodeID}`);\n    watchEffect(\n        () => {\n          const images = store.state.image.images[props.nodeID]\n          items.value = []\n          items.value.push({\n            id: \"\",\n            timestamp: Infinity,\n            name: \"default\",\n            url: defaultURL,\n            removed: 0,\n          })\n          defaultImageURL.value = defaultURL\n          for (const key in images) {\n            if (key == \"default\") {\n              defaultImageURL.value =  images[key].url;\n              continue;\n            }\n            items.value.push({\n              id: key,\n              timestamp: Number(key),\n              name: images[key].name,\n              url: process.env.VUE_APP_IS_EMULATOR === \"true\" ? images[key].url : 'https://cdn.scimap.org'+images[key].path,\n              removed: images[key].removed,\n            });\n          }\n          // desc sort by timestamp\n          items.value = items.value.filter((item)=>!item.removed).sort((a,b) => b.timestamp - a.timestamp);\n        }\n    )\n    return {\n      items,\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      defaultImageURL,\n      setAsDefault: async (url: string) => {\n        await firebase\n          .database()\n          .ref(`${dbNodeImgPath.value}`)\n          .update({\n            default: {\n              url,\n              name: \"\"\n            }\n          });\n      },\n      copyMDLink: async (url: string) => {\n        await navigator.clipboard.writeText(`![](${url} =350x)`);\n        toast.add({\n          severity: \"info\",\n          summary: \"Copied\",\n          detail: \"You can now paste it into node description. Please, do not use this link in other node description as someone can remove it from this node images as not used!\",\n          life: 1000\n        });\n      },\n      showRemoveButton: (id: string) => {\n        if (!id) {\n          // if there is no id it is the default stub image\n          return false\n        }\n        // check that image is not used in node description\n        if (props.nodeContent.length && props.nodeContent.includes(id)) {\n          return false\n        }\n\n        return true\n      },\n      toTrash: async (id: string) => {\n        confirm.require({\n          message: 'Are you sure you want to delete this image?',\n          header: 'Confirmation',\n          icon: 'pi pi-exclamation-triangle',\n          rejectClass: 'p-button-secondary p-button-outlined',\n          rejectLabel: 'Cancel',\n          acceptLabel: 'Delete',\n          accept: async () => {\n            await firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${id}`)\n                .update({removed: new Date().getTime()});\n            toast.add({ severity: 'info', summary: 'Image was deleted', detail: '', life: 3000 });\n          },\n          // reject: () => {}\n        });\n\n      },\n      toggleAddDialog: () => {\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      addDialogVisible,\n      input,\n      triggerUpload: () => {\n        input.value.click();\n      },\n      showProgressBar,\n      onInputChange: async (event: {\n        target: {\n          files: Array<File>;\n        };\n      }) => {\n        if (\n          !store.state.user ||\n          !store.state.user.user ||\n          store.state.user.user.isAnonymous ||\n          props.nodeID.length == 0\n        ) {\n          return;\n        }\n        showProgressBar.value = true;\n\n        const imgFile = event.target.files[0] as File;\n        let compressedBlob = await fromBlob(imgFile, 90, 0, 0, fileFormat)\n        if (compressedBlob.size > 500_000) {\n          // try to resize\n          compressedBlob = await fromBlob(imgFile, 90, 1200, 'auto', fileFormat)\n          if (compressedBlob.size > 500_000) {\n            // if still large, then give up\n            toast.add({\n              severity: \"info\",\n              summary: \"Sorry\",\n              detail: \"Cannot compress file, please try to resize/compress it to less than 500Kb\",\n              life: 3000\n            });\n            return;\n          }\n        }\n\n        const name = imgFile.name;\n        const fileName = new Date().getTime();\n        const filePath = `/user/${store.state.user.user.uid}/image/${fileName}.${fileFormat}`\n        const storageRef = firebase\n          .storage()\n          .ref(filePath)\n          .put(compressedBlob);\n        storageRef.on(\n          \"state_changed\",\n          snapshot => {\n            // uploadProgress.value = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          },\n          error => {\n            console.log(error.message);\n          },\n          () => {\n            showProgressBar.value = false;\n            storageRef.snapshot.ref.getDownloadURL().then(url => {\n              let parsedURL = {} as URL\n              try {\n                parsedURL = new URL(url);\n              } catch (error) {\n                console.log(error);\n                return\n              }\n              // removed token=... from url\n              const preparedURL = parsedURL.protocol+'//'+parsedURL.hostname+(parsedURL.port == '' ? '' : ':'+parsedURL.port)+parsedURL.pathname+'?alt=media';\n              firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${fileName}`)\n                .update({\n                  name,\n                  path: filePath,\n                  url: preparedURL,\n                });\n            });\n          }\n        );\n      }\n    };\n  }\n});\n","import { render } from \"./TitleImage.vue?vue&type=template&id=6948403b\"\nimport script from \"./TitleImage.vue?vue&type=script&lang=ts\"\nexport * from \"./TitleImage.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { actions, useStore } from \"@/store\";\nimport { actions as nodeContentActions } from \"@/store/node_content\";\nimport { computed, defineComponent } from \"vue\";\nimport TextArea from \"primevue/textarea\";\nimport SectionPreconditions from \"./Preconditions.vue\";\nimport SectionUsedBy from \"./UsedBy.vue\";\nimport { Tree } from \"@/types/graphics\";\nimport { EmptyNodeContent, NodeContent } from \"@/store/node_content\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { useConfirm } from \"primevue/useconfirm\";\nimport api from \"@/api/api\";\nimport Markdown from \"./Markdown.vue\";\nimport ChangeLog from \"./ChangeLog.vue\";\nimport PinButton from \"./PinButton.vue\";\nimport SubscribeButton from \"./SubscribeButton.vue\";\nimport Title from \"@/components/node_content/Title.vue\";\nimport AddBasedOnButton from \"@/components/node_content/AddBasedOnButton.vue\";\nimport TitleImage from \"@/components/node_content/TitleImage.vue\";\nimport MarkdownIt from \"markdown-it\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd\n  .use(mdKatex, { output: \"html\" })\n  .use(mdImsize);\n\nexport default defineComponent({\n  name: \"NodeContent\",\n  components: {\n    TitleImage,\n    AddBasedOnButton,\n    Title,\n    SectionUsedBy,\n    Markdown,\n    TextArea,\n    SectionPreconditions,\n    ChangeLog,\n    PinButton,\n    SubscribeButton,\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    show: {\n      type: Boolean,\n      required: true\n    },\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const tree = store.state.tree;\n\n    const selectedNode = computed<Tree | null>(() =>\n      props.selectedNodeId && tree.nodeRecord[props.selectedNodeId]\n        ? tree.nodeRecord[props.selectedNodeId].node\n        : null\n    );\n\n    const selectedNodeContent = computed<NodeContent | null>(() => {\n      if (\n        props.selectedNodeId &&\n        store.state.nodeContent.nodeContents[props.selectedNodeId]\n      ) {\n        return store.state.nodeContent.nodeContents[props.selectedNodeId];\n      }\n      const newContent = clone(EmptyNodeContent);\n      newContent.nodeID = props.selectedNodeId;\n      return newContent;\n    });\n\n    const selectedNodeComment = computed<string>(() =>\n      props.selectedNodeId &&\n      store.state.nodeContent.userNodeComments[props.selectedNodeId]\n        ? store.state.nodeContent.userNodeComments[props.selectedNodeId].comment\n        : \"\"\n    );\n\n    return {\n      md,\n      usedBy: computed(() => store.state.precondition.reverseIndex[props.selectedNodeId]),\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNode,\n      selectedNodeContent,\n      checkAuthorized: async (e: Event) => {\n        if (!store.state.user.user || store.state.user.user.isAnonymous) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to add comments and edit content\"});\n          e.preventDefault();\n        }\n      },\n      selectedNodeComment,\n      changeNodeTitle: async (value: string) => {\n        if (!selectedNode.value || !selectedNode.value.id) {\n          return;\n        }\n        const err = await api.debouncedUpdate({\n          [`map/${selectedNode.value.id}/name`]: value\n        });\n\n        if (err) {\n          printError(err.error.message, err.kv);\n        }\n      },\n      changeContent: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeContent}`,\n          {\n            nodeID: selectedNode.value!.id,\n            content: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      },\n      changeComment: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeComment}`,\n          {\n            nodeID: selectedNode.value!.id,\n            comment: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      }\n    };\n  }\n});\n","import { render } from \"./Index.vue?vue&type=template&id=57571194&scoped=true\"\nimport script from \"./Index.vue?vue&type=script&lang=ts\"\nexport * from \"./Index.vue?vue&type=script&lang=ts\"\n\nimport \"./Index.vue?vue&type=style&index=0&id=57571194&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-57571194\"\n\nexport default script","<template>\n  <div :class=\"$style.textSearch\">\n    <TextSearch />\n  </div>\n  <div :class=\"$style.wrapper\">\n    <div v-if=\"email\" style=\"width:100%\">\n      <div style=\"position: absolute; right: 2rem;\">\n        <MenuButton @click=\"toggleUserMenu\">\n          <img\n            alt=\"user\"\n            src=\"../../assets/images/user.svg\"\n            style=\"width: 20px\"\n          />\n        </MenuButton>\n        <PrimeMenu ref=\"menu\" id=\"overlay_menu\" :model=\"items\" :popup=\"true\" />\n      </div>\n      <div style=\"position: absolute; right: 6.1rem;\">\n        <Feedback />\n      </div>\n      <EditMode style=\"position: absolute; right: 12.5rem;\" />\n      <div\n          v-if=\"editModeOn\"\n          style=\"position: absolute; right: 20.6rem;\"\n      >\n        <MapChangeLog\n            @restore-select-new-parent-is-on=\"$emit('restore-select-new-parent-is-on')\"\n            @restore-select-new-parent-is-off=\"$emit('restore-select-new-parent-is-off')\"\n            :clickedTitleId=\"clickedTitleId\"\n        />\n      </div>\n      <div v-if=\"editModeOn\" style=\"position: absolute; right: 26.6rem;\">\n        <AddNode />\n      </div>\n      <div v-if=\"editModeOn\" style=\"position: absolute; right: 32.6rem;\">\n        <RemoveNode />\n      </div>\n      <div\n        v-if=\"editModeOn\"\n        style=\"position: absolute; right: 39.6rem;\"\n      >\n        <CutPaste />\n      </div>\n    </div>\n    <div v-else>\n      <Button\n        @click=\"signIn\"\n        style=\"position: absolute; right: 2rem;\"\n        rounded\n        size=\"small\"\n        icon=\"pi pi-sign-in\"\n        label=\"sign in\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { actions as userActions } from \"@/store/user\";\nimport AddNode from \"./AddNode\";\nimport RemoveNode from \"./RemoveNode\";\nimport EditMode from \"./EditMode\";\nimport CutPaste from \"@/components/menu/CutPaste\";\nimport Feedback from \"@/components/menu/Feedback\";\nimport TextSearch from \"@/components/menu/Textsearch\";\nimport MapChangeLog from \"@/components/menu/MapChangeLog\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport PrimeMenu from \"primevue/tieredmenu\";\nimport Button from \"primevue/button\";\n\nexport default {\n  name: \"Menu\",\n  components: {\n    Button,\n    PrimeMenu,\n    MenuButton,\n    Feedback,\n    CutPaste,\n    AddNode,\n    RemoveNode,\n    EditMode,\n    TextSearch,\n    MapChangeLog\n  },\n  emits: [\"restore-select-new-parent-is-on\", \"restore-select-new-parent-is-off\"],\n  props: {\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    const store = useStore();\n    const user = store.state.user;\n    const menu = ref();\n\n    // user info\n    const userPhotoURL = computed(() =>\n      user.user && user.user.photoURL\n        ? user.user.photoURL\n        : \"../../assets/images/user.svg\"\n    );\n    const email = computed(() => (user.user ? user.user.email : null));\n    const items = computed(() => {\n      return [\n        {\n          label: email.value,\n        },\n        {\n          separator: true\n        },\n        {\n          label: \"email changes - \"+(user.subscribePeriod ? user.subscribePeriod : 'weekly'),\n          icon: \"pi pi-eye\",\n          items: [\n            {\n              label: \"weekly\",\n              icon: \"pi pi-calendar\",\n              command: () => {\n                store.dispatch(`user/${userActions.setSubscribePeriod}`, 'weekly');\n              }\n            },\n            {\n              label: \"daily\",\n              icon: \"pi pi-tablet\",\n              command: () => {\n                store.dispatch(`user/${userActions.setSubscribePeriod}`, 'daily');\n              }\n            },\n            {\n              label: \"on pause\",\n              icon: \"pi pi-pause\",\n              command: () => {\n                store.dispatch(`user/${userActions.setSubscribePeriod}`, 'on pause');\n              }\n            },\n          ]\n        },\n        {\n          label: \"sign out\",\n          icon: \"pi pi-sign-out\",\n          command: () => {\n            store.dispatch(`user/${userActions.signOut}`);\n          }\n        },\n      ];\n    });\n    return {\n      email,\n      userPhotoURL,\n      editModeOn: computed(() => store.state.editModeOn),\n      isNodeSelected: computed(() => store.state.tree.selectedNodeId),\n      isPinned: computed(\n        () =>\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n      ),\n      // SignIn\n      signIn: () => store.dispatch(`user/${userActions.signIn}`),\n      // User Menu\n      menu,\n      toggleUserMenu: event => {\n        menu.value.toggle(event);\n      },\n      items\n    };\n  }\n};\n</script>\n\n<style module>\n.wrapper {\n  position: fixed;\n  display: flex;\n  top: 0;\n  right: 0;\n  padding: 8px;\n  background-color: rgba(255, 255, 255, 0.2);\n  width: 70%;\n}\n.textSearch {\n  position: fixed;\n  display: flex;\n  top: 0;\n  left: 0;\n  width: 30%;\n  padding: 15px 20px;\n  background: linear-gradient(rgba(120, 120, 120, 0.4), rgba(120, 120, 120, 0));\n}\n</style>\n","<template>\n  <MenuButton @click=\"toggleAddDialog\">\n    <img alt=\"icon\" src=\"../../assets/images/add-off.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">add</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        {{\n          selectedNodeTitle\n            ? `Add subsection to ${selectedNodeTitle}`\n            : `Add section`\n        }}\n      </h3>\n    </template>\n\n    <Input type=\"text\" v-model=\"newNodeTitle\" />\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport Input from \"primevue/inputtext\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"AddNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button,\n    Input\n  },\n  setup() {\n    const store = useStore();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const newNodeTitle = ref(\"\");\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      add: async () => {\n        const newNodeID = await store.dispatch(`${actions.createNode}`, {\n          parentID: selectedNode.value ? selectedNode.value.id : 0,\n          title: newNodeTitle.value\n        });\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          [\n            newNodeID,\n            ...store.state.tree.nodeRecord[\n              selectedNode.value.id\n            ].node.children.map(node => node.id)\n          ]\n        );\n        newNodeTitle.value = \"\";\n        addDialogVisible.value = false;\n      },\n      cancelAdd: () => {\n        newNodeTitle.value = \"\";\n        addDialogVisible.value = false;\n      },\n      addDialogVisible,\n      newNodeTitle\n    };\n  }\n};\n</script>\n","<template>\n  <Button\n    size=\"small\"\n    rounded\n    @mouseenter=\"mouseover = true\"\n    @mouseleave=\"mouseover = false\"\n    :style=\"\n      (mouseover\n        ? `background-color: #03dbfc; `\n        : bgColor\n        ? `background-color: ${bgColor};`\n        : `background-color: white;`) + `color: black; border-color:#3B6BF9;`\n    \"\n  >\n    <slot></slot>\n  </Button>\n</template>\n\n<script>\nimport Button from \"primevue/button\";\nimport { ref, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"MenuButton\",\n  components: {\n    Button\n  },\n  props: {\n    bgColor: String\n  },\n  setup() {\n    const mouseover = ref(false);\n    return {\n      mouseover\n    };\n  }\n});\n</script>\n","import { render } from \"./MenuButton.vue?vue&type=template&id=4db6f65c\"\nimport script from \"./MenuButton.vue?vue&type=script&lang=js\"\nexport * from \"./MenuButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./AddNode.vue?vue&type=template&id=294721ad\"\nimport script from \"./AddNode.vue?vue&type=script&lang=js\"\nexport * from \"./AddNode.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton @click=\"toggleDialog\" :disabled=\"!selectedNodeTitle\">\n    <img alt=\"icon\" src=\"../../assets/images/remove-off.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">delete</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{ `Remove \"${selectedNodeTitle}\" and all its descendants?` }}\n      </h3>\n    </template>\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancel\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"remove\" />\n    </template>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport {mutations as treeMutations} from \"@/store/tree\";\nimport {useToast} from \"primevue/usetoast\";\nimport {getArrayDiff, idToLink} from \"../helpers\";\n\nexport default {\n  name: \"RemoveNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button\n  },\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleDialog: () => {\n        const nodeID = selectedNode.value.id\n\n        // collect all children IDs recursively\n        let stack = [nodeID];\n        const allChildrenIDs = [];\n        while (stack.length>0) {\n          const id = stack.pop()\n          allChildrenIDs.push(id)\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // collect all nodes where nodeID or its children were set as preconditions for nodes outside allChildrenIDs\n        stack = [nodeID];\n        const usedByNodes = {} as Record<string, Array<string>>;\n        while (stack.length>0) {\n          const id = stack.pop()\n          const [added, removed] = getArrayDiff(allChildrenIDs, store.state.precondition.reverseIndex[id])\n          if (store.state.precondition.reverseIndex[id] && added.length>0\n          ) {\n            usedByNodes[id] = added\n          }\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // show deny message\n        if (Object.keys(usedByNodes).length > 0) {\n          const nr = store.state.tree.nodeRecord\n          let detailText = ''\n          for (const id in usedByNodes) {\n            detailText += `<div>- remove ${idToLink(id, nr)} from 'based on' of ${usedByNodes[id].map((id)=>idToLink(id, nr)).join(', ')}</div>`\n          }\n          toast.add({\n            severity: \"info\",\n            summary: \"Cannot remove node until some other nodes use it or its children in their 'based on'\",\n            detail: \"If you are sure you want to remove it, please: \"+detailText,\n            life: 30000\n          });\n\n          return\n        }\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      remove: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`${actions.removeNode}`, selectedNode.value.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          store.state.tree.nodeRecord[\n            selectedNode.value.id\n          ].parent!.children.map(node => node.id)\n        );\n        // switch selectedNodeId to parent of removed node\n        store.commit(\n            `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n            store.state.tree.nodeRecord[\n                selectedNode.value.id\n                ].parent!.id\n        );\n      },\n      cancel: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible\n    };\n  }\n};\n</script>\n","\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport {mutations as treeMutations} from \"@/store/tree\";\nimport {useToast} from \"primevue/usetoast\";\nimport {getArrayDiff, idToLink} from \"../helpers\";\n\nexport default {\n  name: \"RemoveNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button\n  },\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleDialog: () => {\n        const nodeID = selectedNode.value.id\n\n        // collect all children IDs recursively\n        let stack = [nodeID];\n        const allChildrenIDs = [];\n        while (stack.length>0) {\n          const id = stack.pop()\n          allChildrenIDs.push(id)\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // collect all nodes where nodeID or its children were set as preconditions for nodes outside allChildrenIDs\n        stack = [nodeID];\n        const usedByNodes = {} as Record<string, Array<string>>;\n        while (stack.length>0) {\n          const id = stack.pop()\n          const [added, removed] = getArrayDiff(allChildrenIDs, store.state.precondition.reverseIndex[id])\n          if (store.state.precondition.reverseIndex[id] && added.length>0\n          ) {\n            usedByNodes[id] = added\n          }\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // show deny message\n        if (Object.keys(usedByNodes).length > 0) {\n          const nr = store.state.tree.nodeRecord\n          let detailText = ''\n          for (const id in usedByNodes) {\n            detailText += `<div>- remove ${idToLink(id, nr)} from 'based on' of ${usedByNodes[id].map((id)=>idToLink(id, nr)).join(', ')}</div>`\n          }\n          toast.add({\n            severity: \"info\",\n            summary: \"Cannot remove node until some other nodes use it or its children in their 'based on'\",\n            detail: \"If you are sure you want to remove it, please: \"+detailText,\n            life: 30000\n          });\n\n          return\n        }\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      remove: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`${actions.removeNode}`, selectedNode.value.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          store.state.tree.nodeRecord[\n            selectedNode.value.id\n          ].parent!.children.map(node => node.id)\n        );\n        // switch selectedNodeId to parent of removed node\n        store.commit(\n            `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n            store.state.tree.nodeRecord[\n                selectedNode.value.id\n                ].parent!.id\n        );\n      },\n      cancel: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible\n    };\n  }\n};\n","import { render } from \"./RemoveNode.vue?vue&type=template&id=09e0cfb6\"\nimport script from \"./RemoveNode.vue?vue&type=script&lang=ts\"\nexport * from \"./RemoveNode.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div>\n    <MenuButton v-if=\"!editModeOn\" @click=\"on\" style=\"height:35px\">\n      <img\n        alt=\"icon\"\n        src=\"../../assets/images/switch-on.svg\"\n        style=\"width: 20px\"\n      />\n      <span class=\"p-ml-2\">edit map</span>\n    </MenuButton>\n    <MenuButton v-if=\"editModeOn\" @click=\"off\" style=\"height:35px;\" bg-color=\"#03dbfc;\">\n      <img\n        alt=\"icon\"\n        src=\"../../assets/images/switch-off.svg\"\n        style=\"width: 20px\"\n      />\n      <span class=\"p-ml-2\">edit map</span>\n    </MenuButton>\n  </div>\n</template>\n\n<script>\nimport { actions, useStore } from \"@/store\";\nimport { computed } from \"vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"EditMode\",\n  components: {\n    MenuButton\n  },\n  setup() {\n    const store = useStore();\n\n    return {\n      editModeOn: computed(() => store.state.editModeOn),\n      on: () => {\n        store.dispatch(`${actions.setEditMode}`, true);\n      },\n      off: () => {\n        store.dispatch(`${actions.setEditMode}`, false);\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./EditMode.vue?vue&type=template&id=f2d82bb8\"\nimport script from \"./EditMode.vue?vue&type=script&lang=js\"\nexport * from \"./EditMode.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton v-if=\"cutNodeID == null\" @click=\"cut\" :disabled=\"!selectedNode\">\n    <img alt=\"icon\" src=\"../../assets/images/cut.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">cut</span>\n  </MenuButton>\n  <MenuButton v-if=\"cutNodeID != null\" @click=\"paste\">\n    <img alt=\"icon\" src=\"../../assets/images/paste.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">paste</span>\n  </MenuButton>\n</template>\n\n<script>\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"CutPaste\",\n  components: { MenuButton },\n  setup() {\n    const store = useStore();\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const cutNodeID = ref(null);\n\n    return {\n      selectedNode,\n      cutNodeID,\n      cut: () => {\n        cutNodeID.value = selectedNode.value.id;\n      },\n      paste: () => {\n        // permit to move children of both new and old parents\n        const oldParentChildrenID = store.state.tree.nodeRecord[\n          cutNodeID.value\n        ].parent.children.map(node => node.id);\n        const newParentChildrenID = store.state.tree.nodeRecord[\n          selectedNode.value.id\n        ].node.children.map(node => node.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          [...oldParentChildrenID, ...newParentChildrenID]\n        );\n\n        // do cut and paste of node\n        store.dispatch(`${actions.cutPasteNode}`, {\n          nodeID: cutNodeID.value,\n          parentID: selectedNode.value.id\n        });\n\n        cutNodeID.value = null;\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./CutPaste.vue?vue&type=template&id=44f29dda\"\nimport script from \"./CutPaste.vue?vue&type=script&lang=js\"\nexport * from \"./CutPaste.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton @click=\"send\">\n    <img alt=\"icon\" src=\"../../assets/images/chat.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">chat</span>\n  </MenuButton>\n</template>\n\n<script>\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"Feedback\",\n  components: {\n    MenuButton\n  },\n  setup() {\n    return {\n      send: () => {\n        window.open(\n          \"https://discord.com/channels/1171118046543347782/1171118047105396749\",\n          \"_blank\"\n        );\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./Feedback.vue?vue&type=template&id=60cc13ba\"\nimport script from \"./Feedback.vue?vue&type=script&lang=js\"\nexport * from \"./Feedback.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <span class=\"p-input-icon-right\" style=\"width: 100%\">\n    <i class=\"pi pi-times\" style=\"right: 1.2rem; cursor: pointer;\" @click=\"clearBox\" />\n    <InputText\n      :class=\"$style['searchBox']\"\n      placeholder=\"Search SciMap\"\n      v-model=\"value\"\n      @update:modelValue=\"doSearch($event)\"\n    />\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport InputText from \"primevue/inputtext\";\nimport { search } from \"@/tools/textsearch\";\nimport { mutations as searchMutations } from \"@/store/search_result\";\nimport { useStore } from \"@/store\";\nimport { ref } from \"vue\";\nimport api from \"@/api/api\";\nimport { debounce } from \"lodash\";\n\nexport default {\n  name: \"TextSearch\",\n  components: {\n    InputText\n  },\n\n  setup() {\n    const value = ref(\"\");\n    const store = useStore();\n    const debouncedLog = debounce(api.setUserLastSearch, 2000)\n    const doSearch = async(value: string) => {\n      const res = await search(value);\n      store.commit(`searchResult/${searchMutations.SET_NODE_IDS}`, res);\n      if (value.length > 0) {\n        debouncedLog(store.state.user.user!.uid, value);\n      }\n      return res;\n    }\n\n    return {\n      doSearch,\n      value,\n      clearBox: async () => {\n        value.value = \"\";\n        await doSearch('')\n      }\n    };\n  }\n};\n</script>\n\n<style module>\n.searchBox {\n  border-radius: 2rem !important;\n  padding: 0.8rem 2rem !important;\n  width: 100%;\n}\n</style>\n","\nimport InputText from \"primevue/inputtext\";\nimport { search } from \"@/tools/textsearch\";\nimport { mutations as searchMutations } from \"@/store/search_result\";\nimport { useStore } from \"@/store\";\nimport { ref } from \"vue\";\nimport api from \"@/api/api\";\nimport { debounce } from \"lodash\";\n\nexport default {\n  name: \"TextSearch\",\n  components: {\n    InputText\n  },\n\n  setup() {\n    const value = ref(\"\");\n    const store = useStore();\n    const debouncedLog = debounce(api.setUserLastSearch, 2000)\n    const doSearch = async(value: string) => {\n      const res = await search(value);\n      store.commit(`searchResult/${searchMutations.SET_NODE_IDS}`, res);\n      if (value.length > 0) {\n        debouncedLog(store.state.user.user!.uid, value);\n      }\n      return res;\n    }\n\n    return {\n      doSearch,\n      value,\n      clearBox: async () => {\n        value.value = \"\";\n        await doSearch('')\n      }\n    };\n  }\n};\n","import { render } from \"./Textsearch.vue?vue&type=template&id=01a2cb92\"\nimport script from \"./Textsearch.vue?vue&type=script&lang=ts\"\nexport * from \"./Textsearch.vue?vue&type=script&lang=ts\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Textsearch.vue?vue&type=style&index=0&id=01a2cb92&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <ChangeLogComplain\n    :show=\"complainModalVisible\"\n    :complainChangeLink=\"complainChangeLink\"\n    @hide=\"complainModalVisible = false\"\n  />\n  <MenuButton @click=\"toggleAddDialog\">\n    <img alt=\"icon\" src=\"../../assets/images/log.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">log</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"false\"\n    :closable=\"true\"\n    :modal=\"false\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        Map change log\n      </h3>\n    </template>\n    <Card v-for=\"(event, i) of changes\" :key=\"i\" class=\"p-mt-3\">\n      <template #title>\n        <div class=\"p-grid\">\n          <div class=\"p-col-1\">\n            <img alt=\"add_icon\" v-if=\"event.isAdded\" src=\"../../assets/images/add-off.svg\"  style=\"width: 20px\"/>\n            <img alt=\"add_icon\" v-else-if=\"event.isRemoved\" src=\"../../assets/images/remove-off.svg\"  style=\"width: 20px\"/>\n            <img alt=\"add_icon\" v-else src=\"../../assets/images/move.svg\"  style=\"width: 20px\"/>\n          </div>\n          <div class=\"p-col-6\">\n            {{ new Date(event.timestamp).toLocaleDateString() }}\n            {{ new Date(event.timestamp).toLocaleTimeString() }}\n          </div>\n          <div class=\"p-col-5\">\n            <RestoreNode\n                @restore-select-new-parent-is-on=\"$emit('restore-select-new-parent-is-on')\"\n                @restore-select-new-parent-is-off=\"$emit('restore-select-new-parent-is-off')\"\n                :clickedTitleId=\"clickedTitleId\"\n                :event=\"event\"\n            />\n          </div>\n        </div>\n      </template>\n      <template #subtitle>\n        {{ event.userDisplayName }} /\n        <a href=\"#\" @click=\"showComplain(event.changeLogID)\">Complain</a>\n      </template>\n      <template #content>\n        <div style=\"width:20rem;\" v-html=\"getActionDescription(event)\"></div>\n      </template>\n    </Card>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport {defineComponent, reactive, ref} from \"vue\";\nimport {ActionType, ChangeLogNodeParent} from \"@/store/change_log\";\nimport {GetNodeUrl, subscribeChangeLogEnriched} from \"@/api/change_log\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport RestoreNode from \"@/components/menu/RestoreNode.vue\";\n\nexport default defineComponent({\n  name: \"MapChangeLog\",\n  components: {\n    RestoreNode,\n    MenuButton,\n    ChangeLogComplain,\n    Card,\n    Dialog\n  },\n  emits: [\"restore-select-new-parent-is-on\", \"restore-select-new-parent-is-off\"],\n  props: {\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const addDialogVisible = ref(false);\n    const changes = reactive([]) as Array<ChangeLogNodeParent>;\n    subscribeChangeLogEnriched([ActionType.ParentID, ActionType.Remove, ActionType.Restore], [], changeLogs => {\n      changes.splice(\n        0,\n        changes.length,\n        ...(changeLogs as Array<ChangeLogNodeParent>)\n      );\n    });\n\n    return {\n      complainChangeLink,\n      complainModalVisible,\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      addDialogVisible,\n      changes,\n      getActionDescription: (event: ChangeLogNodeParent): string => {\n        if (event.action === ActionType.Restore) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was restored to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isAdded) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was added to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isRemoved) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was removed from ${GetNodeUrl(\n            event.parentNodeBefore!.idPath,\n            event.parentNodeBefore!.id,\n            event.parentNodeBefore!.name\n          )}`;\n        }\n\n        return `node ${GetNodeUrl(\n          event.node.idPath,\n          event.node.id,\n          event.node.name\n        )} was moved from ${GetNodeUrl(\n          event.parentNodeBefore!.idPath,\n          event.parentNodeBefore!.id,\n          event.parentNodeBefore!.name\n        )} to ${GetNodeUrl(\n          event.parentNodeAfter!.idPath,\n          event.parentNodeAfter!.id,\n          event.parentNodeAfter!.name\n        )}`;\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <img\n      alt=\"add_icon\"\n      v-if=\"event.isRemoved && IsNodeInTrash(event.node.idPath)\"\n      src=\"../../assets/images/revert.svg\"\n      style=\"width: 30px; cursor: pointer;\"\n      @click=\"revertRemove(event)\"\n  />\n<!--  In case parent node was deleted show Dialog to select new parent -->\n  <Dialog\n      v-model:visible=\"newParentDialogVisible\"\n      :dismissableMask=\"false\"\n      :closable=\"true\"\n      :modal=\"false\"\n      :closeOnEscape=\"true\"\n      @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        Parent node of this node was deleted, please select new parent.\n      </h3>\n    </template>\n    Set \"{{\n      newParentNode && newParentNode.title\n          ? newParentNode.title\n          : \"\"\n    }}\" as new parent node.\n    <template #footer>\n      <Button\n          label=\"Cancel\"\n          icon=\"pi pi-times\"\n          class=\"p-button-text\"\n          @click=\"cancelAdd\"\n      />\n      <Button label=\"Done\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport {defineComponent, PropType, ref, watch} from \"vue\";\nimport {ChangeLogNodeParent} from \"@/store/change_log\";\nimport {IsNodeInTrash} from \"@/api/change_log\";\nimport api from \"@/api/api\";\nimport {useStore} from \"@/store\";\nimport {Tree} from \"@/types/graphics\";\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\n\nexport default defineComponent({\n  name: \"RestoreNode\",\n  components: {\n    Dialog,\n    Button,\n  },\n  emits: [\"restore-select-new-parent-is-on\", \"restore-select-new-parent-is-off\"],\n  props: {\n    event: {\n      type: Object as PropType<ChangeLogNodeParent>,\n      required: true,\n    },\n    clickedTitleId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props, ctx) {\n    // select new parent Dialog stuff\n    const store = useStore();\n    const newParentDialogVisible = ref(false);\n    const newParentNode = ref(null as Tree | null);\n    const nodeIdToRestore = ref(\"\");\n    watch(\n        () => props.clickedTitleId,\n        () => {\n          if (\n              newParentDialogVisible.value &&\n              nodeIdToRestore.value &&\n              props.clickedTitleId !== \"-1\" &&\n              store.state.tree.nodeRecord[props.clickedTitleId]\n          ) {\n            newParentNode.value =\n                store.state.tree.nodeRecord[props.clickedTitleId].node;\n          }\n        },\n        { immediate: true }\n    );\n\n    const restoreNodeWithChildren = async (nodeID: string, parentID: string) => {\n      // do main actions on backend (see functions/cmd_restore.js)\n      return await api.update({ [`cmd/restore`]: {\n          nodeID,\n          parentID,\n        }\n      });\n    }\n    return {\n      newParentDialogVisible,\n      newParentNode,\n      cancelAdd: () => {\n        newParentDialogVisible.value = false;\n        nodeIdToRestore.value = \"\";\n        newParentNode.value = null;\n        ctx.emit(\"restore-select-new-parent-is-off\");\n      },\n      add: async () => {\n        await restoreNodeWithChildren(nodeIdToRestore.value, newParentNode.value!.id)\n        ctx.emit(\"restore-select-new-parent-is-off\");\n        newParentDialogVisible.value = false;\n        nodeIdToRestore.value = \"\";\n        newParentNode.value = null;\n      },\n      IsNodeInTrash,\n      revertRemove: async (event: ChangeLogNodeParent) => {\n        if (!event.isRemoved) {\n          return\n        }\n\n        if (event.parentNodeBefore && !IsNodeInTrash(event.parentNodeBefore.idPath)) {\n          if (IsNodeInTrash(event.node.idPath)) {\n            await restoreNodeWithChildren(event.node.id, event.parentNodeBefore.id)\n          }\n        } else {\n          // parent node is in trash - let user choose new parent\n          ctx.emit('restore-select-new-parent-is-on');\n          newParentDialogVisible.value = true;\n          nodeIdToRestore.value = event.node.id;\n        }\n      },\n    }\n  }\n})\n</script>\n","\nimport {defineComponent, PropType, ref, watch} from \"vue\";\nimport {ChangeLogNodeParent} from \"@/store/change_log\";\nimport {IsNodeInTrash} from \"@/api/change_log\";\nimport api from \"@/api/api\";\nimport {useStore} from \"@/store\";\nimport {Tree} from \"@/types/graphics\";\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\n\nexport default defineComponent({\n  name: \"RestoreNode\",\n  components: {\n    Dialog,\n    Button,\n  },\n  emits: [\"restore-select-new-parent-is-on\", \"restore-select-new-parent-is-off\"],\n  props: {\n    event: {\n      type: Object as PropType<ChangeLogNodeParent>,\n      required: true,\n    },\n    clickedTitleId: {\n      type: String,\n      required: true,\n    },\n  },\n  setup(props, ctx) {\n    // select new parent Dialog stuff\n    const store = useStore();\n    const newParentDialogVisible = ref(false);\n    const newParentNode = ref(null as Tree | null);\n    const nodeIdToRestore = ref(\"\");\n    watch(\n        () => props.clickedTitleId,\n        () => {\n          if (\n              newParentDialogVisible.value &&\n              nodeIdToRestore.value &&\n              props.clickedTitleId !== \"-1\" &&\n              store.state.tree.nodeRecord[props.clickedTitleId]\n          ) {\n            newParentNode.value =\n                store.state.tree.nodeRecord[props.clickedTitleId].node;\n          }\n        },\n        { immediate: true }\n    );\n\n    const restoreNodeWithChildren = async (nodeID: string, parentID: string) => {\n      // do main actions on backend (see functions/cmd_restore.js)\n      return await api.update({ [`cmd/restore`]: {\n          nodeID,\n          parentID,\n        }\n      });\n    }\n    return {\n      newParentDialogVisible,\n      newParentNode,\n      cancelAdd: () => {\n        newParentDialogVisible.value = false;\n        nodeIdToRestore.value = \"\";\n        newParentNode.value = null;\n        ctx.emit(\"restore-select-new-parent-is-off\");\n      },\n      add: async () => {\n        await restoreNodeWithChildren(nodeIdToRestore.value, newParentNode.value!.id)\n        ctx.emit(\"restore-select-new-parent-is-off\");\n        newParentDialogVisible.value = false;\n        nodeIdToRestore.value = \"\";\n        newParentNode.value = null;\n      },\n      IsNodeInTrash,\n      revertRemove: async (event: ChangeLogNodeParent) => {\n        if (!event.isRemoved) {\n          return\n        }\n\n        if (event.parentNodeBefore && !IsNodeInTrash(event.parentNodeBefore.idPath)) {\n          if (IsNodeInTrash(event.node.idPath)) {\n            await restoreNodeWithChildren(event.node.id, event.parentNodeBefore.id)\n          }\n        } else {\n          // parent node is in trash - let user choose new parent\n          ctx.emit('restore-select-new-parent-is-on');\n          newParentDialogVisible.value = true;\n          nodeIdToRestore.value = event.node.id;\n        }\n      },\n    }\n  }\n})\n","import { render } from \"./RestoreNode.vue?vue&type=template&id=97fa8c6e\"\nimport script from \"./RestoreNode.vue?vue&type=script&lang=ts\"\nexport * from \"./RestoreNode.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport {defineComponent, reactive, ref} from \"vue\";\nimport {ActionType, ChangeLogNodeParent} from \"@/store/change_log\";\nimport {GetNodeUrl, subscribeChangeLogEnriched} from \"@/api/change_log\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport RestoreNode from \"@/components/menu/RestoreNode.vue\";\n\nexport default defineComponent({\n  name: \"MapChangeLog\",\n  components: {\n    RestoreNode,\n    MenuButton,\n    ChangeLogComplain,\n    Card,\n    Dialog\n  },\n  emits: [\"restore-select-new-parent-is-on\", \"restore-select-new-parent-is-off\"],\n  props: {\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const addDialogVisible = ref(false);\n    const changes = reactive([]) as Array<ChangeLogNodeParent>;\n    subscribeChangeLogEnriched([ActionType.ParentID, ActionType.Remove, ActionType.Restore], [], changeLogs => {\n      changes.splice(\n        0,\n        changes.length,\n        ...(changeLogs as Array<ChangeLogNodeParent>)\n      );\n    });\n\n    return {\n      complainChangeLink,\n      complainModalVisible,\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      addDialogVisible,\n      changes,\n      getActionDescription: (event: ChangeLogNodeParent): string => {\n        if (event.action === ActionType.Restore) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was restored to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isAdded) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was added to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isRemoved) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was removed from ${GetNodeUrl(\n            event.parentNodeBefore!.idPath,\n            event.parentNodeBefore!.id,\n            event.parentNodeBefore!.name\n          )}`;\n        }\n\n        return `node ${GetNodeUrl(\n          event.node.idPath,\n          event.node.id,\n          event.node.name\n        )} was moved from ${GetNodeUrl(\n          event.parentNodeBefore!.idPath,\n          event.parentNodeBefore!.id,\n          event.parentNodeBefore!.name\n        )} to ${GetNodeUrl(\n          event.parentNodeAfter!.idPath,\n          event.parentNodeAfter!.id,\n          event.parentNodeAfter!.name\n        )}`;\n      }\n    };\n  }\n});\n","import { render } from \"./MapChangeLog.vue?vue&type=template&id=388bfcf8\"\nimport script from \"./MapChangeLog.vue?vue&type=script&lang=ts\"\nexport * from \"./MapChangeLog.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { render } from \"./Index.vue?vue&type=template&id=2db44821\"\nimport script from \"./Index.vue?vue&type=script&lang=js\"\nexport * from \"./Index.vue?vue&type=script&lang=js\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Index.vue?vue&type=style&index=0&id=2db44821&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, ref, watch } from \"vue\";\nimport Map from \"@/components/map/Map.vue\";\nimport NodeContent from \"@/components/node_content/Index.vue\";\nimport ConfirmDialog from \"primevue/confirmdialog\";\nimport Toast from \"primevue/toast\";\nimport {\n  EventClickNode,\n  EventDraggingBackground,\n  EventDraggingNode,\n  EventWheel\n} from \"@/components/map/Map\";\nimport Menu from \"@/components/menu/Index.vue\";\nimport { useStore } from \"@/store\";\nimport { useRouter, useRoute, onBeforeRouteUpdate } from \"vue-router\";\nimport { mutations as treeMutations, NodeRecordItem } from \"@/store/tree\";\nimport { mutations as zoomPanMutations } from \"@/store/zoom_pan\";\nimport { actions } from \"@/store/\";\nimport {\n  filterNodesAndLayers,\n  findCentralNode,\n  zoomAndPanPoint,\n  zoomAnPanLayers\n} from \"@/views/Home\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { actions as positionChangePermitsActions } from \"@/store/position_change_permits\";\n\nexport default defineComponent({\n  name: \"Home\",\n\n  components: {\n    Map,\n    Menu,\n    NodeContent,\n    ConfirmDialog,\n    Toast\n  },\n\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const route = useRoute();\n    const treeState = store.state.tree;\n    const zoomPanState = store.state.zoomPan;\n    const pinState = store.state.pin;\n    const searchResultState = store.state.searchResult;\n    const clickedTitleId = ref(\"-1\");\n    let selectPreconditionIsOn = false;\n    let restoreSelectNewParentIsOn = false;\n    let titleOver = false;\n\n    // Set node from URL as selected\n    watch(\n      () => route.params.id,\n      () => {\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      { immediate: true }\n    );\n\n    /**\n     * Method updateLayers extracts visibleLayers and nodes from mapNodeLayers.\n     * These are the nodes that will be visible to the user\n     * (and are always just a small part of all nodes of the map).\n     * @param centralNodeId\n     * @param mapNodeLayers\n     * @param nodeRecord\n     */\n    const updateLayers = (\n      centralNodeId: string,\n      mapNodeLayers: Array<Record<string, MapNode>>,\n      nodeRecord: Record<string, NodeRecordItem>\n    ): Array<Record<number, MapNode>> => {\n      // Вычленяем слои и узлы которые мы хотим показывать учитывая что текущий видимый узел это centralNodeId\n      const [filteredLayers, err] = filterNodesAndLayers(\n        mapNodeLayers,\n        nodeRecord,\n        centralNodeId\n      );\n      if (err) {\n        printError(\"Home.vue: error in filterNodesAndLayers:\", { err });\n        return [];\n      }\n      return filteredLayers.reverse();\n    };\n\n    const centralNodeId = ref<string | null>(null);\n    // visibleLayers consists only from user visible nodes and visibleLayers of all (which is treeState.mapNodeLayers)\n    const visibleLayers = ref<Array<Record<string, MapNode>>>([]);\n\n    // Ugly hack to determine a first load of page\n    let isFirstPageLoad = true;\n    onBeforeRouteUpdate(async (to, from) => {\n      isFirstPageLoad = false;\n    });\n    // If this is isFirstPageLoad then pan map to node in URL\n    watch(\n      () => [treeState.mapNodeLayers],\n      () => {\n        if (\n          isFirstPageLoad &&\n          route.params.id.length > 0 &&\n          treeState.mapNodeLayers.length > 0\n        ) {\n          const [firstNode] = findMapNode(\n            route.params.id as string,\n            treeState.mapNodeLayers\n          );\n          if (firstNode != null) {\n            store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n              x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n              y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n            });\n          }\n        }\n      }\n    );\n\n    // Determine which nodes to show based on current pan and zoom\n    watch(\n      () => [\n        treeState.mapNodeLayers,\n        zoomPanState.debouncedZoom,\n        zoomPanState.debouncedPan\n      ],\n      () => {\n        const [newCentralNodeId, err] = findCentralNode(\n          treeState.mapNodeLayers,\n          treeState.nodeRecord,\n          { width: window.innerWidth, height: window.innerHeight },\n          zoomPanState.debouncedZoom,\n          zoomPanState.pan,\n            {x:window.innerWidth/2, y:window.innerHeight/2}\n          // zoomPanState.zoomCenter\n        );\n        if (err != null) {\n          printError(\"filterNodesAndLayers: error in findCurrentNode\", { err });\n        }\n\n        centralNodeId.value = newCentralNodeId;\n        visibleLayers.value = updateLayers(\n          newCentralNodeId,\n          treeState.mapNodeLayers,\n          treeState.nodeRecord\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    const visibleZoomedPanedLayers = ref<Array<Record<string, MapNode>>>([]);\n    watch(\n      () => [\n        zoomPanState.pan.x,\n        zoomPanState.pan.y,\n        zoomPanState.zoom,\n        visibleLayers\n      ],\n      () => {\n        // visibleLayers это всегда слои с zoom=1 и pan={0, 0} состоящий из только видимых прямо сейчас элементов.\n        // Мы применяем к этому объекту текущий zoomPanState, но сам эталон не трогаем, поэтому здесь clone\n        // Это не дорогая операция так как visibleLayers всегда содержит небольшое кол-во элементов\n        // видимых только прямо сейчас\n        const layersToZoomAndPan = clone(visibleLayers.value);\n        visibleZoomedPanedLayers.value = zoomAnPanLayers(\n          layersToZoomAndPan,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      /**\n       * pinNodes\n       */\n      pinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const pinNodeIDs = pinState.pinsReverse[centralNodeId.value];\n        if (!pinNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = pinNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                pinNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const pinMapNodes = findMapNodes(pinNodeIDs, treeState.mapNodeLayers);\n        const result = [];\n        for (const pinMapNode of pinMapNodes) {\n          const cl = clone(pinMapNode);\n          cl.center = zoomAndPanPoint(\n            pinMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      /**\n       * searchResultNodeIDs\n       */\n      searchResultNodeIDs: computed(() => {\n        return searchResultState.nodeIDs;\n      }),\n\n      /**\n       * searchResultPinNodes\n       */\n      searchResultPinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const searchResultNodeIDs = clone(searchResultState.nodeIDs);\n        if (!searchResultNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = searchResultNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                searchResultNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const searchResultMapNodes = findMapNodes(\n          searchResultNodeIDs,\n          treeState.mapNodeLayers\n        );\n        const result = [];\n        for (const searchResultMapNode of searchResultMapNodes) {\n          const cl = clone(searchResultMapNode);\n          cl.center = zoomAndPanPoint(\n            searchResultMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNodeId: computed(() => treeState.selectedNodeId),\n      selectedNodePreconditionIds: computed(() =>\n        treeState.selectedNodeId\n          ? store.state.precondition.preconditions[treeState.selectedNodeId]\n          : []\n      ),\n      visibleZoomedPanedLayers: visibleZoomedPanedLayers,\n      nodeDragging: async (e: EventDraggingNode) => {\n        const hasDragPermit = await store.dispatch(\n          `positionChangePermits/${positionChangePermitsActions.CheckNodeID}`,\n          e.id\n        );\n        if (!hasDragPermit) {\n          return;\n        }\n        await store.dispatch(`${actions.updateNodePosition}`, {\n          nodeId: e.id,\n          delta: {\n            x: e.delta.x / zoomPanState.zoom,\n            y: e.delta.y / zoomPanState.zoom\n          }\n        });\n      },\n      setSelectPreconditionON: () => {\n        selectPreconditionIsOn = true;\n      },\n      setSelectPreconditionOFF: () => {\n        selectPreconditionIsOn = false;\n        clickedTitleId.value = \"-1\"\n      },\n      setRestoreSelectNewParentON: () => {\n        restoreSelectNewParentIsOn = true;\n      },\n      setRestoreSelectNewParentOFF: () => {\n        restoreSelectNewParentIsOn = false;\n      },\n      clickedTitleId,\n      titleClick: (e: EventClickNode) => {\n        if (restoreSelectNewParentIsOn || selectPreconditionIsOn) {\n          clickedTitleId.value = e.id;\n        } else {\n          router.push({ name: \"node\", params: { id: e.id } });\n        }\n      },\n      titleOver: (e: EventClickNode) => {\n        titleOver = true;\n        store.commit(`tree/${treeMutations.SET_SELECTED_NODE_ID}`, e.id);\n      },\n      titleLeave: (e: EventClickNode) => {\n        titleOver = false;\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      mapDragging: (event: EventDraggingBackground) => {\n        if (store.state.editModeOn && titleOver) {\n          // to prevent pan while node position editing ( = title dragging in edit mode)\n          return;\n        }\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, event);\n      },\n      zoom: (event: EventWheel) => {\n        // initial value of center (when root.border == viewport)\n        const initial = {\n          x: (event.center.x - zoomPanState.pan.x) / zoomPanState.zoom,\n          y: (event.center.y - zoomPanState.pan.y) / zoomPanState.zoom\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_ZOOM}`, -1 * event.delta);\n        const after = {\n          x: initial.x * zoomPanState.zoom + zoomPanState.pan.x,\n          y: initial.y * zoomPanState.zoom + zoomPanState.pan.y\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, {\n          from: after,\n          to: event.center\n        });\n        store.commit(\n          `zoomPan/${zoomPanMutations.SET_ZOOM_CENTER}`,\n          event.center\n        );\n      }\n    };\n  }\n});\n","import { render } from \"./Home.vue?vue&type=template&id=73da55b4\"\nimport script from \"./Home.vue?vue&type=script&lang=ts\"\nexport * from \"./Home.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1 v-if=\"!isAuthorized\">Only authorized users can view changes</h1>\n  <div v-else>\n    <div><b>id:</b> {{ route.params.id }}</div>\n    <div>\n      <b>timestamp:</b>\n      {{ new Date(change[\"timestamp\"]).toLocaleDateString() }}\n      {{ new Date(change[\"timestamp\"]).toLocaleTimeString() }}\n    </div>\n    <div><b>action:</b> {{ change[\"action\"] }}</div>\n    <div><b>node_id:</b> {{ change[\"node_id\"] }}</div>\n    <div><b>user_id:</b> {{ change[\"user_id\"] }}</div>\n    <b>value:</b>\n    <Markdown\n      v-if=\"['content', 'name'].indexOf(change['action']) != -1\"\n      :content=\"change['attributes']['value']\"\n      :rows=\"20\"\n    />\n    <div v-else>{{ JSON.stringify(change[\"attributes\"]) }}</div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport { doc, getDoc, getFirestore } from \"firebase/firestore\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default {\n  name: \"Change\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const change = ref({});\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = doc(\n            getFirestore(),\n            \"changes\",\n            route.params.id as string\n          );\n          const docSnap = await getDoc(docRef);\n\n          if (docSnap.exists()) {\n            change.value = docSnap.data();\n          }\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized,\n      route,\n      change\n    };\n  }\n};\n</script>\n","\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport { doc, getDoc, getFirestore } from \"firebase/firestore\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default {\n  name: \"Change\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const change = ref({});\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = doc(\n            getFirestore(),\n            \"changes\",\n            route.params.id as string\n          );\n          const docSnap = await getDoc(docRef);\n\n          if (docSnap.exists()) {\n            change.value = docSnap.data();\n          }\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized,\n      route,\n      change\n    };\n  }\n};\n","import { render } from \"./Change.vue?vue&type=template&id=14f8614f\"\nimport script from \"./Change.vue?vue&type=script&lang=ts\"\nexport * from \"./Change.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1 v-if=\"!isAuthorized\">Please, <a href=\"#\" @click=\"store.dispatch(`user/${userActions.signIn}`)\">Sign in</a> to unsubscribe</h1>\n  <div v-else>\n    You successfully unsubscribed from scimap.org digest!\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {store, useStore} from \"@/store\";\nimport {computed, watch} from \"vue\";\nimport {actions as userActions} from \"@/store/user\";\n\nexport default {\n  name: \"UnsubscribeDigest\",\n  computed: {\n    store() {\n      return store\n    },\n    userActions() {\n      return userActions\n    }\n  },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n        () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n\n    watch(\n        () => store.state.user.user && !store.state.user.user.isAnonymous,\n        () => {\n          if (isAuthorized.value) {\n            store.dispatch(`user/${userActions.setSubscribePeriod}`, 'on pause')\n          }\n        },\n        { immediate: true }\n    );\n\n    return {\n      isAuthorized,\n    };\n  }\n};\n</script>\n","\nimport {store, useStore} from \"@/store\";\nimport {computed, watch} from \"vue\";\nimport {actions as userActions} from \"@/store/user\";\n\nexport default {\n  name: \"UnsubscribeDigest\",\n  computed: {\n    store() {\n      return store\n    },\n    userActions() {\n      return userActions\n    }\n  },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n        () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n\n    watch(\n        () => store.state.user.user && !store.state.user.user.isAnonymous,\n        () => {\n          if (isAuthorized.value) {\n            store.dispatch(`user/${userActions.setSubscribePeriod}`, 'on pause')\n          }\n        },\n        { immediate: true }\n    );\n\n    return {\n      isAuthorized,\n    };\n  }\n};\n","import { render } from \"./UnsubscribeDigest.vue?vue&type=template&id=41e17b94\"\nimport script from \"./UnsubscribeDigest.vue?vue&type=script&lang=ts\"\nexport * from \"./UnsubscribeDigest.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1 v-if=\"!isAuthorized\">Only authorized users can view node profile</h1>\n  <div v-else>\n    <div><b>id:</b> {{ route.params.id }}</div>\n    <div><b>is removed from map:</b> {{ node[\"is_in_trash\"] }}</div>\n    <div>\n      <b>parent_id:</b>\n      <a target=\"_blank\" :href=\"node['map']['parentID']\">{{\n        node[\"map\"][\"parentID\"]\n      }}</a>\n    </div>\n    <div><b>name:</b> {{ node[\"map\"][\"name\"] }}</div>\n    <b>content:</b>\n    <Markdown\n      :content=\"node['node_content'] ? node['node_content']['content'] : ''\"\n      :rows=\"20\"\n    />\n    <div>\n      <b>precondition:</b>\n      <div v-for=\"id of node['precondition']\" :key=\"id\">\n        <a target=\"_blank\" :href=\"id\">{{ id }}</a>\n      </div>\n    </div>\n    <div>\n      <b>children:</b>\n      <div v-for=\"id of node['map']['children']\" :key=\"id\">\n        <a target=\"_blank\" :href=\"id\">{{ id }}</a>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\nimport firebase from \"firebase/compat\";\n\nexport default {\n  name: \"NodeDescription\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const node = ref({} as any);\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = firebase\n            .database()\n            .ref(`/map/${route.params.id}`)\n            .once(\"value\", data => {\n              if (data.exists()) {\n                // not in /trash, try to get from /map, /node_content, /precondition\n                node.value[\"is_in_trash\"] = false;\n\n                // map\n                node.value[\"map\"] = data.val();\n\n                // node_content\n                firebase\n                    .database()\n                    .ref(`/node_content/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"node_content\"] = data.val();\n                      }\n                    });\n\n                // precondition\n                firebase\n                    .database()\n                    .ref(`/precondition/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"precondition\"] = data.val();\n                      }\n                    });\n              } else {\n                firebase\n                    .database()\n                    .ref(`/trash/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value = data.val();\n                        node.value[\"is_in_trash\"] = true;\n                      }\n                    });\n              }\n            });\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized: isAuthorized,\n      route,\n      node\n    };\n  }\n};\n</script>\n","\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\nimport firebase from \"firebase/compat\";\n\nexport default {\n  name: \"NodeDescription\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const node = ref({} as any);\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = firebase\n            .database()\n            .ref(`/map/${route.params.id}`)\n            .once(\"value\", data => {\n              if (data.exists()) {\n                // not in /trash, try to get from /map, /node_content, /precondition\n                node.value[\"is_in_trash\"] = false;\n\n                // map\n                node.value[\"map\"] = data.val();\n\n                // node_content\n                firebase\n                    .database()\n                    .ref(`/node_content/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"node_content\"] = data.val();\n                      }\n                    });\n\n                // precondition\n                firebase\n                    .database()\n                    .ref(`/precondition/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"precondition\"] = data.val();\n                      }\n                    });\n              } else {\n                firebase\n                    .database()\n                    .ref(`/trash/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value = data.val();\n                        node.value[\"is_in_trash\"] = true;\n                      }\n                    });\n              }\n            });\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized: isAuthorized,\n      route,\n      node\n    };\n  }\n};\n","import { render } from \"./NodeDescription.vue?vue&type=template&id=1c35b6c0\"\nimport script from \"./NodeDescription.vue?vue&type=script&lang=ts\"\nexport * from \"./NodeDescription.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1>Oops, it looks like the page you're looking for doesn't exist.</h1>\n</template>\n","import { render } from \"./NotFound.vue?vue&type=template&id=600d9e34\"\nconst script = {}\nscript.render = render\n\nexport default script","<template>\n  <div style=\"padding: 2em 2em 2em 2em\">\n    <h1>Sorry, SciMap do not ready for mobile yet, please reopen it on you laptop/desktop</h1>\n\n    You can\n    <ul>\n      <li>still <a :href=\"url\">try desktop version on mobile</a> without any warranties</li>\n      <li>or watch video about SciMap</li>\n    </ul>\n    <div style=\"text-align: center;\">\n      <iframe src=\"https://www.youtube.com/embed/DuiTlnrK6G4?si=HuVA4cs5U86H9E3l\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nexport default {\n  setup() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    const from = new URL(decodeURI(urlParams.get('from')!));\n    from.searchParams.append('forceDesktopOnMobile', 'true');\n\n    return {\n      url: from.href,\n    };\n  }\n}\n</script>\n","\nexport default {\n  setup() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    const from = new URL(decodeURI(urlParams.get('from')!));\n    from.searchParams.append('forceDesktopOnMobile', 'true');\n\n    return {\n      url: from.href,\n    };\n  }\n}\n","import { render } from \"./MobileWarning.vue?vue&type=template&id=43fe06b3\"\nimport script from \"./MobileWarning.vue?vue&type=script&lang=ts\"\nexport * from \"./MobileWarning.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { createRouter, createWebHistory, RouteRecordRaw } from \"vue-router\";\nimport PasswordLogin from \"../views/PasswordLogin.vue\";\nimport Home from \"../views/Home.vue\";\nimport Change from \"../views/Change.vue\";\nimport UnsubscribeDigest from \"../views/UnsubscribeDigest.vue\";\nimport NodeDescription from \"../views/NodeDescription.vue\";\nimport NotFound from \"../views/NotFound.vue\";\nimport MobileWarning from \"../views/MobileWarning.vue\";\n\nconst routes: Array<RouteRecordRaw> = [\n  {\n    path: \"/passwordLogin\",\n    component: PasswordLogin\n  },\n  {\n    path: \"/mobile_warning\",\n    component: MobileWarning\n  },\n  {\n    path: \"/node_description/:id?\",\n    name: \"node_description\",\n    component: NodeDescription\n  },\n  {\n    path: \"/change/:id?\",\n    name: \"change\",\n    component: Change\n  },\n  {\n    path: \"/unsubscribe_digest\",\n    name: \"unsubscribe_digest\",\n    component: UnsubscribeDigest\n  },\n  {\n    path: \"/:id?\",\n    name: \"node\",\n    component: Home\n  },\n  {\n    path: \"/:catchAll(.*)\",\n    component: NotFound\n  }\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\nexport default router;\n","import { createApp } from \"vue\";\nimport App from \"./App.vue\";\nimport PrimeVue from \"primevue/config\";\nimport ConfirmationService from \"primevue/confirmationservice\";\nimport ToastService from \"primevue/toastservice\";\nimport router from \"./router\";\nimport { store, key } from \"./store\";\n// primevue ui stuff\nimport \"primevue/resources/themes/aura-light-green/theme.css\"; //theme\nimport \"primevue/resources/primevue.min.css\"; //core css\nimport \"primeicons/primeicons.css\"; //icons\nimport \"primeflex/primeflex.css\";\nimport Tooltip from 'primevue/tooltip';\n\ncreateApp(App)\n  .use(store, key)\n  .use(router)\n  .use(PrimeVue)\n  .use(ConfirmationService)\n  .use(ToastService)\n  .directive('tooltip', Tooltip)\n  .mount(\"#app\");\n","var map = {\n\t\"./bmp\": \"0dcc\",\n\t\"./bmp.js\": \"0dcc\",\n\t\"./gif\": \"c416\",\n\t\"./gif.js\": \"c416\",\n\t\"./jpg\": \"135b\",\n\t\"./jpg.js\": \"135b\",\n\t\"./png\": \"e9ef\",\n\t\"./png.js\": \"e9ef\",\n\t\"./psd\": \"520c\",\n\t\"./psd.js\": \"520c\",\n\t\"./svg\": \"b0bf\",\n\t\"./svg.js\": \"b0bf\",\n\t\"./tiff\": \"f270\",\n\t\"./tiff.js\": \"f270\",\n\t\"./webp\": \"cf1e\",\n\t\"./webp.js\": \"cf1e\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"cd50\";","module.exports = __webpack_public_path__ + \"img/eye-off.d2cfd862.svg\";","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Textsearch.vue?vue&type=style&index=0&id=01a2cb92&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Textsearch.vue?vue&type=style&index=0&id=01a2cb92&module=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/move.bbe00c47.svg\";","module.exports = __webpack_public_path__ + \"img/add-off.32a0c20b.svg\";","module.exports = __webpack_public_path__ + \"img/question.df174033.svg\";"],"sourceRoot":""}