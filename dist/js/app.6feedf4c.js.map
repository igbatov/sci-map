{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/assets/images/sign-in.svg","webpack:///./src/components/node_content/RemoveIcon.vue?1c8d","webpack:///./src/components/node_content/Title.vue?1654","webpack:///./src/assets/images/chat.svg","webpack:///./src/assets/images/action.svg","webpack:///./src/components/SVGTextBox.vue?6701","webpack:///./src/assets/images/plugin.svg","webpack:///./src/assets/images/talk.svg","webpack:///./src/assets/images/log.svg","webpack:///./src/components/node_content/Preconditions.vue?e34f","webpack:///./src/components/node_content/Index.vue?6ad0","webpack:///./src/assets/images/switch-off.svg","webpack:///./src/assets/images/remove-off.svg","webpack:///./src/assets/images/revert.svg","webpack:///./src/components/menu/Index.vue?cb10","webpack:///./src/components/node_content/Markdown.vue?57f7","webpack:///./src/assets/images/remove-on.svg","webpack:///./src/assets/images/paste.svg","webpack:///./src/assets/images/add-on.svg","webpack:///./src/components/node_content/AddBasedOnIcon.vue?e31f","webpack:///./src/assets/images/switch-on.svg","webpack:///./src/assets/images/cut.svg","webpack:///./src/assets/images/goal.svg","webpack:///./src/components/menu/Textsearch.vue?5f83","webpack:///./src/components/node_content/PinIcon.vue?95b8","webpack:///./src/assets/images/pin-off.svg","webpack:///./src/assets/images/pin-on.svg","webpack:///./src/components/menu/Textsearch.vue?938e","webpack:///./src/assets/images/user.svg","webpack:///./src/App.vue","webpack:///./src/store/pin/index.ts","webpack:///./src/store/title_box/index.ts","webpack:///./src/store/precondition/index.ts","webpack:///./src/store/image/index.ts","webpack:///./src/store/position_change_permits/index.ts","webpack:///./src/tools/errorkv.ts","webpack:///./src/tools/utils.ts","webpack:///./src/store/tree/helpers.ts","webpack:///./src/api/helpers.ts","webpack:///./src/api/api.ts","webpack:///./src/tools/graphics.ts","webpack:///./src/store/node_content/index.ts","webpack:///./src/tools/textsearch.ts","webpack:///./src/store/helpers.ts","webpack:///./src/store/tree/index.ts","webpack:///./src/store/history/index.ts","webpack:///./src/store/zoom_pan/index.ts","webpack:///./src/store/user/index.ts","webpack:///./src/store/search_result/index.ts","webpack:///./src/store/index.ts","webpack:///./src/App.vue?3acc","webpack:///./src/App.vue?dfb6","webpack:///./src/views/PasswordLogin.vue","webpack:///./src/views/PasswordLogin.vue?76a3","webpack:///./src/views/PasswordLogin.vue?e3c1","webpack:///./src/views/Home.vue","webpack:///./src/components/map/Map.vue","webpack:///./src/components/map_layer/MapLayer.vue","webpack:///./src/components/map_layer/MapLayer.ts","webpack:///./src/components/SVGTextBox.ts","webpack:///./src/components/map_layer/MapLayer.vue?1431","webpack:///./src/components/map_layer/MapLayer.vue?0796","webpack:///./src/components/map/MapPan.ts","webpack:///./src/components/pin_layer/PinLayer.vue","webpack:///./src/components/pin_layer/PinMarker.vue","webpack:///./src/components/pin_layer/PinMarker.vue?bbb0","webpack:///./src/components/pin_layer/PinMarker.vue?9aa1","webpack:///./src/components/SVGTextBox.vue","webpack:///./src/components/SVGTextBox.vue?ae08","webpack:///./src/components/SVGTextBox.vue?ec46","webpack:///./src/components/pin_layer/PinLayer.vue?738a","webpack:///./src/components/pin_layer/PinLayer.vue?8bd0","webpack:///./src/components/precondition_layer/PreconditionLayer.vue","webpack:///./src/components/precondition_layer/PreconditionArrow.vue","webpack:///./src/components/precondition_layer/PreconditionArrow.vue?e51e","webpack:///./src/components/precondition_layer/PreconditionArrow.vue?74c6","webpack:///./src/views/Home.ts","webpack:///./src/components/precondition_layer/PreconditionLayer.vue?6cdc","webpack:///./src/components/precondition_layer/PreconditionLayer.vue?73c2","webpack:///./src/components/map/Map.vue?b432","webpack:///./src/components/map/Map.vue?8505","webpack:///./src/components/node_content/Index.vue","webpack:///./src/components/node_content/Preconditions.vue","webpack:///./src/components/node_content/RemoveIcon.vue","webpack:///./src/components/node_content/RemoveIcon.vue?f4ef","webpack:///./src/components/node_content/Preconditions.vue?b5b4","webpack:///./src/components/node_content/Preconditions.vue?c4ee","webpack:///./src/components/node_content/UsedBy.vue","webpack:///./src/components/node_content/UsedBy.vue?fc09","webpack:///./src/components/node_content/UsedBy.vue?0024","webpack:///./src/components/node_content/Markdown.vue","webpack:///./src/components/node_content/Markdown.vue?6e5c","webpack:///./src/components/node_content/Markdown.vue?9efd","webpack:///./src/components/node_content/ChangeLog.vue","webpack:///./src/store/change_log/index.ts","webpack:///./src/api/change_log.ts","webpack:///./src/components/node_content/ChangeLogComplain.vue","webpack:///./src/components/node_content/ChangeLogComplain.vue?d4d1","webpack:///./src/components/node_content/ChangeLogComplain.vue?5b6f","webpack:///./src/components/node_content/ChangeLog.vue?ff01","webpack:///./src/components/node_content/ChangeLog.vue?5753","webpack:///./src/components/node_content/PinButton.vue","webpack:///./src/components/node_content/PinIcon.vue","webpack:///./src/components/node_content/PinIcon.vue?7cf5","webpack:///./src/components/node_content/PinButton.vue?f1ab","webpack:///./src/components/node_content/Title.vue","webpack:///./src/components/node_content/Title.vue?1578","webpack:///./src/components/node_content/Title.vue?f8bb","webpack:///./src/components/node_content/AddBasedOnButton.vue","webpack:///./src/components/node_content/AddBasedOnIcon.vue","webpack:///./src/components/node_content/AddBasedOnIcon.vue?6da1","webpack:///./src/components/node_content/AddBasedOnButton.vue?6d44","webpack:///./src/components/node_content/TitleImage.vue","webpack:///./src/components/node_content/TitleImage.vue?36f1","webpack:///./src/components/node_content/TitleImage.vue?6fb7","webpack:///./src/components/node_content/Index.vue?70b7","webpack:///./src/components/node_content/Index.vue?1dc7","webpack:///./src/components/menu/Index.vue","webpack:///./src/components/menu/AddNode.vue","webpack:///./src/components/menu/MenuButton.vue","webpack:///./src/components/menu/MenuButton.vue?30bd","webpack:///./src/components/menu/AddNode.vue?9c98","webpack:///./src/components/menu/RemoveNode.vue","webpack:///./src/components/helpers.ts","webpack:///./src/components/menu/RemoveNode.vue?4610","webpack:///./src/components/menu/RemoveNode.vue?2cae","webpack:///./src/components/menu/EditMode.vue","webpack:///./src/components/menu/EditMode.vue?1f8e","webpack:///./src/components/menu/CutPaste.vue","webpack:///./src/components/menu/CutPaste.vue?91c8","webpack:///./src/components/menu/Feedback.vue","webpack:///./src/components/menu/Feedback.vue?098b","webpack:///./src/components/menu/Textsearch.vue","webpack:///./src/components/menu/Textsearch.vue?1edb","webpack:///./src/components/menu/Textsearch.vue?31d6","webpack:///./src/components/menu/MapChangeLog.vue","webpack:///./src/components/menu/RestoreNode.vue","webpack:///./src/components/menu/RestoreNode.vue?51ab","webpack:///./src/components/menu/RestoreNode.vue?1d4e","webpack:///./src/components/menu/MapChangeLog.vue?c7fd","webpack:///./src/components/menu/MapChangeLog.vue?978e","webpack:///./src/components/menu/Index.vue?075d","webpack:///./src/views/Home.vue?d5e7","webpack:///./src/views/Home.vue?ab8c","webpack:///./src/views/Change.vue","webpack:///./src/views/Change.vue?708d","webpack:///./src/views/Change.vue?8302","webpack:///./src/views/NodeDescription.vue","webpack:///./src/views/NodeDescription.vue?fd3e","webpack:///./src/views/NodeDescription.vue?8bca","webpack:///./src/views/NotFound.vue","webpack:///./src/views/NotFound.vue?8fd3","webpack:///./src/router/index.ts","webpack:///./src/main.ts","webpack:///./node_modules/markdown-it-imsize/lib/imsize/types sync ^\\.\\/.*$","webpack:///./src/components/map_layer/MapLayer.vue?d9ad","webpack:///./src/assets/images/pin-on-map.svg","webpack:///./src/components/menu/Index.vue?9511","webpack:///./src/components/node_content/Preconditions.vue?db6c","webpack:///./src/assets/images/move.svg","webpack:///./src/assets/images/add-off.svg"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","mutations","SET_PINS","ADD_TO_PINS","REMOVE_PIN","ADD_TO_PINS_REVERSE","AddPin","RemovePin","namespaced","state","pins","pinsReverse","actions","v","commit","rootState","currentParent","tree","nodeRecord","nodeId","parent","parentIds","id","parentId","pinId","index","indexOf","SET_MAP","layerMap","layerName","titleBoxMap","SET_PRECONDITIONS","UPDATE_PRECONDITIONS","REMOVE_PRECONDITION","preconditions","reverseIndex","precondID","nodeID","preconditionIDs","preconditionID","UPDATE_IMAGES","images","PERMISSION_TIMEOUT","ADD_NODES","REMOVE_NODES","CheckNodeID","permittedNodeIDs","nodeIDs","Date","getTime","message","kv","code","err","Error","error","ROUND_EPSILON","mod","round","num","Math","pow","clone","printError","msg","console","kvArr","findMapNode","mapNodeLayers","level","layer","Number","findMapNodes","ids","createNewNode","title","center","position","children","getNewNodeCenter","addRandom","parentMapNode","fromCenterVectors","border","map","from","to","maxFromCenterVector","getVectorLength","coeff","random","x","y","maxDiagChild","maxDiagChildMapNode","maxDiagChildId","child","childMapNode","childId","getMaxDiagonal","childDiag","err1","maxDiag","err2","finalMaxDiag","newNodeCenter","vectorOnNumber","modifiedNode","updatePosition","item","convertPosition","normalizedPosition","node","layerLevel","treeToMapNodeLayers","ls","mergeMapNodeLayers","convertChildren","Array","isArray","filter","childID","sort","forEach","arr","toString","values","convertDBMapToTree","dbNodes","root","stack","pop","parentID","FUNCTION_DOMAIN","database","ref","update","debouncedUpdate","ROOT_WIDTH","innerWidth","ROOT_HEIGHT","innerHeight","ROOT_CENTER_X","ROOT_CENTER_Y","ST_WIDTH","ST_HEIGHT","initFirebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","analytics","callFunction","method","params","currentUser","auth","getIdToken","idToken","a","response","e","getMapFromDB","snapshot","exists","val","getMapFromStorage","user","storage","uid","getDownloadURL","url","getMap","getPins","savePins","set","getPreconditions","savePreconditions","preconditionIds","subscribeMapNodeChange","cb","this","subscribeDBChange","snap","subscribeNodeContentChange","subscribePreconditionNodeChange","subscribeNodeImageChange","path","on","unsubscribeDBChange","off","transaction","setPublicUserData","userID","displayName","discordName","getMapNode","pr","getTrashNode","type","generateKey","findKeyInList","orderByValue","equalTo","limitToFirst","findKeyOfChild","getUserComments","nodeComment","getNodeContent","NORMALIZED_BORDER","api","sqrt","polygonToTurf","pp","point","isInside","polygon","polygonToPCPolygon","abs","intersect","p1","p2","np1","np2","cf","tp1","tp2","polygonIntersect","intersection","resultPolys","poly","resultPoly","getBoundingBorders","minX","reduce","previousValue","currentValue","minY","maxX","maxY","leftBottom","rightTop","getVoronoiCellsInSquare","centers","turfPoints","collection","cells","bbox","cellMap","features","cell","cellBorder","geometry","coordinates","getVoronoiCells","outerBorder","bb","res","BoundingBorders","intersections","polygonFill","selectedNodeId","currentNodeId","selectedNodePreconditionIds","polygonFillOpacity","polygonToPath","join","treeToNodeRecord","transferToPoint","vector","addVector","b","bTransferred","aTr","transferPointOnVector","getVectorIntersection","v1","v2","x1","y1","x2","y2","x3","y3","x4","y4","denom","numeA","numeB","uA","uB","morphChildrenPoints","oldBorder","newBorder","oldPoints","oldCenterTf","newCenterTf","oldCenter","newCenter","maxDiameter","max","newPoints","oldPoint","centerToPoint","oldBorderIntersection","segment","newBorderIntersection","NewEmptyVector","diagonals","middle","maxDiagonal","diag","convertedPosition","morphedPositions","normalizedBorder","tmp","rootBorder","rootPosition","keys","treeLayers","lastTreeLayer","lastMapNodeLayer","newTreeLayer","newMapNodeLayer","treeNode","tmpMap","strPos","JSON","stringify","firstId","secondId","treeNodeChildren","denormalizedPosition","ch","recipientLayers","insertedLayers","startFromLevel","SET_CONTENTS","SET_USER_COMMENTS","SET_NODE_CONTENT","SET_NODE_COMMENT","setNodeContent","setNodeComment","EmptyNodeContent","content","createContentIfNotExist","nodeContents","EmptyNodeComment","comment","createCommentIfNotExist","userNodeComments","isAnonymous","language","tokenize","text","add","search","initMap","convErr","SET_TREE","subscribeNodeChanges","unSubscribeNodeChanges","dbNode","dispatch","handleMapNodeUpdate","fetchPins","log","initPreconditions","initNodeContents","nodeContent","userComments","initData","ROOT_BORDER","ROOT_CENTER","userFitCoefficient","min","changeTypeEnum","SET_SELECTED_NODE_ID","UPDATE_NODE_POSITION","REMOVE_NODE","getters","selectedNode","dbNodeRecord","oldDBNode","newChildren","includes","removedChildren","returnError","addedDBNode","toProcess","inProcessNode","childNode","ind","findIndex","ADD_ZOOM","ADD_PAN","SET_PAN","SET_ZOOM_CENTER","zoomDebounce","debouncedZoom","panDebounce","debouncedPan","ZOOM_SENSITIVITY","PAN_SENSITIVITY","zoom","pan","zoomCenter","delta","newZoom","SET_USER","signIn","signOut","signInWithPopup","GoogleAuthProvider","ADD_CUT_PASTE","ADD_CREATE","ADD_REMOVE","ADD_POSITION_CHANGE","changeTypes","CUT_PASTE","CREATE","REMOVE","POSITION_CHANGE","stableChangeList","localChangeList","change","newParentID","firstOldPosition","oldPosition","newPosition","SET_NODE_IDS","init","updateNodePosition","createNode","cutPasteNode","removeNode","setEditMode","confirmSignInPopup","SET_EDIT_MODE","debouncedPositionSet","normalizedNewNodeCenter","editModeOn","confirm","require","header","acceptLabel","rejectLabel","accept","reject","onAuthStateChanged","changedNode","newDBNode","newKey","updateMap","normalizedChangedCenter","oldParent","newParent","oldKey","parentNodeID","mapNode","args","pin","titleBox","image","precondition","positionChangePermits","zoomPan","history","searchResult","useStore","setup","store","render","login","emailEl","document","getElementById","passwordEl","signInWithEmailAndPassword","class","icon","slotProps","summary","detail","clickedTitleId","setSelectPreconditionON","setSelectPreconditionOFF","show","layers","visibleZoomedPanedLayers","pin-nodes","pinNodes","searchResultPinNodes","searchResultNodeIDs","nodeDragging","titleClick","titleOver","titleLeave","mapDragging","xmlns","width","svgWidth","height","svgHeight","mapID","style","layer-id","map-nodes","border-color","borderColor","font-color","fontColor","font-size","fontSize","font-opacity","fontOpacity","map-id","draggingNode","visibleTitleIds","color","font-weight","text-decoration","mapNodes","stroke","fill","fill-opacity","stroke-width","points","pointer-events","TITLE_PREFIX","font-family","textWeight","textColor","textDecoration","splitLines","line","alignment-baseline","titleMouseDown","cursor","mouseMoveListener","emit","event","mouseDownInfo","dragStart","movementX","movementY","mouseUpListener","nodeToTitleBox","nodes","updateTitleBox","titleIdPrefix","dom","getBoundingClientRect","mps","then","immediate","maxCharNum","words","split","lines","currLine","nextLine","emits","props","layerId","mapId","String","required","validator","prop","ctx","layerID","titleMouseDownInfo","mouseMove","mouseUp","addEventListener","removeEventListener","searchResultNodeIDsMap","methods","__scopeId","mouseDownBg","mouseDown","visiblePinNodes","useLineBreak","titleXY","line-height","max-char-per-line","fontWeight","titleBoxClick","transform","WIDTH","HEIGHT","fontFamily","lineHeight","Boolean","maxCharPerLine","components","SVGTextBox","PinMarker","allPinNodes","PIN_MARKER_HEIGHT","PIN_MARKER_WIDTH","alignedXY","markerWidth","markerHeight","refX","refY","orient","markerId","visibleTitleNodes","titleBoxOver","titleBoxLeave","marker-end","MIN_VISIBLE_NUM_IN_LAYER","zoomAndPanPoint","zoomAndPanPolygon","findCentralNode","viewport","zoomFactor","underCursorNodeId","viewportArea","nodesToCheck","borderToCheck","minDist","Infinity","nodeCenter","dist","underCursorNodeArea","floor","maxIntersectNodeId","filterNodesAndLayers","resultLayers","currentNode","upperLayer","firstLayer","secondLayer","childOfChild","thirdLayer","zoomAnPanLayers","PreconditionArrow","zoomPanState","zoomedPannedSelectedNode","extraPreconditionTitles","visibleTitleNodeBoxes","PreconditionLayer","PinLayer","MapLayer","clientX","clientY","deltaY","passive","prevDist","prevPoint","touches","hypot","pageX","pageY","idx","size","levelSizes","0","1","2","3","levelColors","alt","src","frameborder","allow","allowfullscreen","target","href","selectedNodeContent","changeNodeTitle","$event","rows","changeContent","placeholder","autoResize","selectedNodeComment","changeComment","checkAuthorized","$emit","node-id","$style","remove","mouseOver","RemoveIcon","cssModules","__cssModules","usedBy","usedByNode","isAuthorized","renderedContent","setEditOn","editOn","mdKatex","mdImsize","mdContainer","md","use","output","validate","trim","match","tokens","info","nesting","utils","escapeHtml","txtarea","display","focus","complainModalVisible","complainChangeLink","legend","toggleable","collapsed","toggle","pt","changes","timestamp","toLocaleDateString","toLocaleTimeString","action","subtitle","userDisplayName","showComplain","changeLogID","ActionType","Name","newName","Content","newContent","Precondition","getContent","subscribeChangeLog","andConditions","q","changeLogs","doc","attributes","valueBefore","valueAfter","added","removed","getNodeName","nodeName","prTrash","getUserDisplayName","userName","getUserDisplayNames","userIDs","fetches","Promise","all","responses","getNodeNames","getPathFromNodeName","nodeNames","nodePath","subscribeChangeLogEnriched","userNames","changeLog","ParentID","resp","changeLogsEnriched","idPath","beforePath","afterPath","parentNodeBefore","parentNodeAfter","isRemoved","isAdded","Remove","IsNodeInTrash","nodeIDPath","startsWith","GetNodeUrl","visible","dismissableMask","closable","modal","closeOnEscape","footer","Dialog","newArgs","oldArgs","computed","Markdown","ChangeLogComplain","Fieldset","Card","unsubscribe","cd","clickPin","addDialogVisible","label","cancelAdd","selectedParent","options","parents","optionLabel","isPinned","undefined","PinIcon","Button","Listbox","treeState","newNodeTitle","selectedNodeParents","showAddBanner","addBannerVisible","preconditionNode","targetNode","AddBasedOnIcon","preconditionsIDs","defaultImageURL","toggleAddDialog","onInputChange","rounded","triggerUpload","items","setAsDefault","copyURL","toast","input","defaultURL","uploadProgress","dbNodeImgPath","default","navigator","clipboard","writeText","click","imgFile","files","severity","life","ext","substring","lastIndexOf","fileName","filePath","storageRef","put","bytesTransferred","totalBytes","parsedURL","URL","preparedURL","protocol","hostname","port","pathname","TitleImage","AddBasedOnButton","Title","SectionUsedBy","TextArea","SectionPreconditions","ChangeLog","PinButton","preventDefault","textSearch","wrapper","email","toggleUserMenu","model","popup","selectedNodeTitle","mouseover","bgColor","MenuButton","Input","newNodeID","toggleDialog","disabled","cancel","idToLink","getArrayDiff","beforeArr","afterArr","beforeMap","afterMap","allChildrenIDs","usedByNodes","nr","detailText","cutNodeID","cut","paste","oldParentChildrenID","newParentChildrenID","send","open","clearBox","doSearch","InputText","clicked-title-id","getActionDescription","revertRemove","restoreNodeWithChildren","queue","isEmpty","nodeContentNode","nodeImage","RestoreNode","PrimeMenu","Feedback","CutPaste","AddNode","RemoveNode","EditMode","TextSearch","MapChangeLog","menu","userPhotoURL","photoURL","command","isNodeSelected","Map","Menu","NodeContent","ConfirmDialog","Toast","router","route","pinState","searchResultState","selectPreconditionIsOn","updateLayers","centralNodeId","filteredLayers","reverse","visibleLayers","isFirstPageLoad","firstNode","newCentralNodeId","deep","layersToZoomAndPan","pinNodeIDs","pinMapNodes","pinMapNode","cl","searchResultMapNodes","searchResultMapNode","hasDragPermit","initial","after","docRef","docSnap","once","script","routes","component","PasswordLogin","NodeDescription","Change","Home","NotFound","App","mount","webpackContext","req","webpackContextResolve","resolve"],"mappings":"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","file":"js/app.6feedf4c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = __webpack_public_path__ + \"img/sign-in.857c8105.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./RemoveIcon.vue?vue&type=style&index=0&id=fb1a5bf4&scoped=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Title.vue?vue&type=style&index=0&id=00857be5&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/chat.b54d0730.svg\";","module.exports = __webpack_public_path__ + \"img/action.885d4d13.svg\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./SVGTextBox.vue?vue&type=style&index=0&id=3400d8a7&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/plugin.71b16b67.svg\";","module.exports = __webpack_public_path__ + \"img/talk.636aebb1.svg\";","module.exports = __webpack_public_path__ + \"img/log.2b2ea6d0.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"Preconditions_title_1ANO_\"};","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=17638f3a&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/switch-off.17f7401d.svg\";","module.exports = __webpack_public_path__ + \"img/remove-off.9d54941e.svg\";","module.exports = __webpack_public_path__ + \"img/revert.3fe2bc78.svg\";","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=19114622&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Index.vue?vue&type=style&index=0&id=19114622&module=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Markdown.vue?vue&type=style&index=0&id=14a19a31&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/remove-on.9d54941e.svg\";","module.exports = __webpack_public_path__ + \"img/paste.c9ceeece.svg\";","module.exports = __webpack_public_path__ + \"img/add-on.5a83fc0e.svg\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./AddBasedOnIcon.vue?vue&type=style&index=0&id=2494d1ac&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/switch-on.70cdd4b4.svg\";","module.exports = __webpack_public_path__ + \"img/cut.5b0b166e.svg\";","module.exports = __webpack_public_path__ + \"img/goal.3f563b24.svg\";","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Textsearch.vue?vue&type=style&index=0&id=e144fd9c&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Textsearch.vue?vue&type=style&index=0&id=e144fd9c&module=true&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PinIcon.vue?vue&type=style&index=0&id=5b15f4ff&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/pin-off.730bd912.svg\";","module.exports = __webpack_public_path__ + \"img/pin-on.0b6013a3.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"searchBox\":\"Textsearch_searchBox_1SbLb\"};","module.exports = __webpack_public_path__ + \"img/user.55fe760e.svg\";","<template>\n  <router-view />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { useStore, actions } from \"@/store\";\nexport default defineComponent({\n  setup() {\n    const store = useStore();\n    store.dispatch(actions.init);\n  }\n});\n</script>\n","import { Commit } from \"vuex\";\nimport { NodeRecordItem } from \"@/store/tree\";\n\nexport type Pins = Record<\n  string /* node_id of pinned node */,\n  string[] /* list of parents where this node_id is visible */\n>;\n\nexport interface State {\n  pins: Pins;\n  pinsReverse: Record<\n    string /* node_id of parent whose children contain pinned nodes (that must be visible) */,\n    string[] /* array of pins (= node ids) that is visible in this node_id */\n  >;\n}\n\nexport const mutations = {\n  SET_PINS: \"SET_PINS\",\n  ADD_TO_PINS: \"ADD_TO_PINS\",\n  REMOVE_PIN: \"REMOVE_PIN\",\n  ADD_TO_PINS_REVERSE: \"ADD_TO_PINS_REVERSE\"\n};\n\nexport const actions = {\n  AddPin: \"AddPin\",\n  RemovePin: \"RemovePin\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    pins: {},\n    pinsReverse: {}\n  },\n  actions: {\n    // had to use action instead of mutation to get access to rootState https://github.com/vuejs/vuex/issues/344\n    [actions.AddPin](\n      {\n        commit,\n        rootState\n      }: {\n        commit: Commit;\n        rootState: { tree: { nodeRecord: Record<string, NodeRecordItem> } };\n      },\n      v: { nodeId: string; parentId: string }\n    ) {\n      // get all parents of nodeId until parentID\n      let currentParent = rootState.tree.nodeRecord[v.nodeId].parent;\n      if (!currentParent) {\n        return;\n      }\n      const parentIds = [];\n      while (currentParent && currentParent.id != v.parentId) {\n        parentIds.push(currentParent.id);\n        currentParent = rootState.tree.nodeRecord[currentParent.id].parent;\n      }\n      parentIds.push(v.parentId);\n      // Set them to pins\n      commit(mutations.ADD_TO_PINS, { nodeId: v.nodeId, parentIds });\n\n      // And for each parent add pined node id to it\n      for (const parentId of parentIds) {\n        commit(mutations.ADD_TO_PINS_REVERSE, {\n          nodeId: parentId,\n          pinId: v.nodeId\n        });\n      }\n    },\n    [actions.RemovePin]({ commit }: { commit: Commit }, nodeId: string) {\n      commit(mutations.REMOVE_PIN, nodeId);\n    }\n  },\n  mutations: {\n    [mutations.SET_PINS](state: State, pins: Pins) {\n      state.pins = pins;\n      state.pinsReverse = {};\n      for (const pinId in pins) {\n        for (const parentId of pins[pinId]) {\n          if (!state.pinsReverse[parentId]) {\n            state.pinsReverse[parentId] = [];\n          }\n          state.pinsReverse[parentId].push(pinId);\n        }\n      }\n    },\n    [mutations.ADD_TO_PINS](\n      state: State,\n      v: { nodeId: string; parentIds: string[] }\n    ) {\n      state.pins[v.nodeId] = v.parentIds;\n    },\n    [mutations.ADD_TO_PINS_REVERSE](\n      state: State,\n      v: { nodeId: string; pinId: string }\n    ) {\n      if (!state.pinsReverse[v.nodeId]) {\n        state.pinsReverse[v.nodeId] = [];\n      }\n      state.pinsReverse[v.nodeId].push(v.pinId);\n    },\n    [mutations.REMOVE_PIN](state: State, nodeId: string) {\n      for (const parentId of state.pins[nodeId]) {\n        const index = state.pinsReverse[parentId].indexOf(nodeId);\n        state.pinsReverse[parentId].splice(index, 1);\n      }\n      delete state.pins[nodeId];\n    }\n  }\n};\n","export type TitleBox = {\n  position: {\n    x: number;\n    y: number;\n  };\n  bbox: {\n    width: number;\n    height: number;\n  };\n};\n\nexport type TitleBoxMap = Record<\n  string /* node_id */,\n  TitleBox /* title box attributes */\n>;\n\nexport interface State {\n  layerMap: Record<string, TitleBoxMap>;\n}\n\nexport const mutations = {\n  SET_MAP: \"SET_MAP\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    layerMap: {}\n  },\n  mutations: {\n    [mutations.SET_MAP](\n      state: State,\n      v: { layerName: string; titleBoxMap: TitleBoxMap }\n    ) {\n      state.layerMap[v.layerName] = v.titleBoxMap;\n    }\n  }\n};\n","export type Preconditions = Record<\n  string /* id of node with premises */,\n  string[] /* ids of premise nodes */\n>;\n\nexport type ReverseIndex = Record<\n  string /* id of node (A) */,\n  string[] /* ids nodes nodes that has node A as a premise */\n>;\n\nexport interface State {\n  preconditions: Preconditions;\n  reverseIndex: ReverseIndex; // reverse index for preconditions - i e reverseIndex[id1] as nodeID1 means that nodeID1 has id1 as its precondition\n}\n\nexport const mutations = {\n  SET_PRECONDITIONS: \"SET_PRECONDITIONS\",\n  UPDATE_PRECONDITIONS: \"UPDATE_PRECONDITIONS\",\n  REMOVE_PRECONDITION: \"REMOVE_PRECONDITION\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    preconditions: {} as Record<string, string[]>,\n    reverseIndex: {} as Record<string, string[]>\n  },\n  mutations: {\n    /**\n     * Set preconditions for all nodes\n     * @param state\n     * @param preconditions\n     */\n    [mutations.SET_PRECONDITIONS](state: State, preconditions: Preconditions) {\n      state.preconditions = preconditions;\n      state.reverseIndex = {};\n\n      // create reverseIndex\n      for (const id in preconditions) {\n        for (const precondID of preconditions[id]) {\n          if (typeof state.reverseIndex[precondID] === \"undefined\") {\n            state.reverseIndex[precondID] = [];\n          }\n          state.reverseIndex[precondID].push(id);\n        }\n      }\n    },\n\n    /**\n     * Set preconditions for one node\n     * @param state\n     * @param v\n     */\n    [mutations.UPDATE_PRECONDITIONS](\n      state: State,\n      v: { nodeID: string; preconditionIDs: Array<string> }\n    ) {\n      if (!state.preconditions[v.nodeID]) {\n        state.preconditions[v.nodeID] = [];\n      }\n      // remove from reverseIndex old preconditions\n      for (const id of state.preconditions[v.nodeID]) {\n        if (\n          state.reverseIndex[id] &&\n          state.reverseIndex[id].indexOf(v.nodeID) != -1\n        ) {\n          state.reverseIndex[id].splice(\n            state.reverseIndex[id].indexOf(v.nodeID),\n            1\n          );\n        }\n      }\n\n      state.preconditions[v.nodeID] = v.preconditionIDs;\n\n      // add to reverseIndex new preconditions\n      for (const precondID of state.preconditions[v.nodeID]) {\n        if (!state.reverseIndex[precondID]) {\n          state.reverseIndex[precondID] = [];\n        }\n        state.reverseIndex[precondID].push(v.nodeID);\n      }\n    },\n\n    /**\n     * Remove one precondition from one node\n     * @param state\n     * @param v\n     */\n    [mutations.REMOVE_PRECONDITION](\n      state: State,\n      v: { nodeID: string; preconditionID: string }\n    ) {\n      if (!state.preconditions[v.nodeID]) {\n        return;\n      }\n\n      const p = state.preconditions[v.nodeID];\n      if (!p) {\n        return;\n      }\n      if (p.indexOf(v.preconditionID) == -1) {\n        return;\n      }\n      p.splice(p.indexOf(v.preconditionID), 1);\n\n      // remove from reverseIndex\n      if (!state.reverseIndex[v.preconditionID]) {\n        return\n      }\n      if (state.reverseIndex[v.preconditionID].indexOf(v.nodeID) == -1) {\n        return;\n      }\n      state.reverseIndex[v.preconditionID].splice(state.reverseIndex[v.preconditionID].indexOf(v.nodeID), 1);\n    }\n  },\n\n};\n","import {DBImage} from \"@/api/types\";\n\nexport type Images =  Record<string, Record<string, DBImage>>;\n\nexport interface State {\n  images: Images;\n}\n\nexport const mutations = {\n  UPDATE_IMAGES: \"UPDATE_IMAGES\",\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    images: {} as Images,\n  },\n  mutations: {\n    [mutations.UPDATE_IMAGES](state: State, v: {nodeID: string, images: Record<string, DBImage>}) {\n        state.images[v.nodeID] = v.images\n    },\n  }\n};\n","/**\n * This store contains nodeIDs that is permitted to move (change positions)\n * The idea is to restrict position change only for just added nodes and its neighbours\n * Otherwise there is risk that everybody will to do little tweaks in node coordinates that will\n * sum up in constant map visual mess\n */\nimport { Commit, Dispatch } from \"vuex\";\nconst PERMISSION_TIMEOUT = 60 * 60 * 1000; // time after which permit is revoked (in milliseconds)\n\nexport const mutations = {\n  ADD_NODES: \"ADD_NODES\",\n  REMOVE_NODES: \"REMOVE_NODES\"\n};\n\nexport const actions = {\n  CheckNodeID: \"CheckNodeID\"\n};\n\nexport interface State {\n  permittedNodeIDs: Record<string, number>; // key is nodeID, value is created_at\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    permittedNodeIDs: {}\n  },\n  mutations: {\n    [mutations.ADD_NODES](state: State, nodeIDs: string) {\n      for (const nodeID of nodeIDs) {\n        state.permittedNodeIDs[nodeID] = new Date().getTime();\n      }\n    },\n    [mutations.REMOVE_NODES](state: State, nodeIDs: string) {\n      for (const nodeID of nodeIDs) {\n        delete state.permittedNodeIDs[nodeID];\n      }\n    }\n  },\n  actions: {\n    [actions.CheckNodeID](\n      { commit, state }: { commit: Commit; state: State },\n      nodeID: string\n    ) {\n      if (\n        !!state.permittedNodeIDs[nodeID] &&\n        new Date().getTime() <\n          state.permittedNodeIDs[nodeID] + PERMISSION_TIMEOUT\n      ) {\n        return true;\n      }\n      if (state.permittedNodeIDs[nodeID]) {\n        commit(mutations.REMOVE_NODES, [nodeID]);\n      }\n      return false;\n    }\n  }\n};\n","/* eslint-disable  @typescript-eslint/no-explicit-any */\nimport { ErrorKV } from \"@/types/errorkv\";\n\nexport const UNAUTHORIZED = 401;\n\nexport default (\n  message: string,\n  kv: Record<string, any>,\n  code?: number\n): ErrorKV => {\n  const err = new Error(message);\n\n  return {\n    error: err,\n    kv: kv,\n    code\n  };\n};\n","import { cloneDeep } from \"lodash\";\nimport { Point, Tree, TreeSkeleton, Viewport } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\nimport { getBoundingBorders, getVoronoiCells } from \"../tools/graphics\";\n\nexport const ROUND_EPSILON = 0;\n\n/**\n * Correct modulo on negative numbers\n * @param n\n * @param m\n */\nexport function mod(n: number, m: number): number {\n  return ((n % m) + m) % m;\n}\n\nexport function round(num: number): number {\n  const t = Math.pow(10, ROUND_EPSILON);\n  return Math.round(num * t) / t;\n}\n\nexport function sleep(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/* eslint-disable  @typescript-eslint/no-explicit-any */\nexport function clone(v: any): any {\n  return cloneDeep(v);\n}\n\nexport function generateTreeSkeleton(\n  levelsNum: number,\n  numOnLevel: number\n): TreeSkeleton {\n  let globalID = 0;\n  const root = { id: String(globalID), children: [] };\n  let toProcess: TreeSkeleton[] = [root];\n  for (let i = 1; i < levelsNum; i++) {\n    const nextToProcess = [];\n    while (toProcess.length) {\n      const node = toProcess.shift();\n      node!.children = [];\n      for (let j = 0; j < numOnLevel; j++) {\n        globalID++;\n        const child = { id: String(globalID) };\n        node!.children.push(child);\n        nextToProcess.push(child);\n      }\n    }\n    toProcess = nextToProcess;\n  }\n\n  return root;\n}\n\n/**\n * Fill TreeSkeleton with default values to make real Tree\n * @param sk\n */\nexport function skeletonToTree(sk: TreeSkeleton, idAsTitle: boolean): Tree {\n  const res = clone(sk);\n  const stack: TreeSkeleton[] = [res];\n  while (stack.length) {\n    const node = stack.pop();\n    if (!node) {\n      continue;\n    }\n    node.id = String(node.id);\n    if (!node.title) {\n      node.title = idAsTitle ? String(node.id) : \"\";\n    }\n    if (!node.position) {\n      node.position = { x: 0, y: 0 };\n    }\n    if (!node.children) {\n      node.children = [];\n    }\n    stack.push(...node.children);\n  }\n  return res;\n}\n\n/**\n * Traverse tree and fill position\n */\nexport function fillTreePositions(\n  tree: Tree,\n  rootWH: Viewport\n): ErrorKV | null {\n  if (tree.id !== \"0\") {\n    return NewErrorKV(\"fillTreePositions: root node id must be '0'\", { tree });\n  }\n  tree.position = { x: rootWH.width / 2, y: rootWH.height / 2 };\n  const nodeBorders: Record<string, { topLeft: Point; bottomRight: Point }> = {\n    0: {\n      topLeft: { x: 0, y: 0 },\n      bottomRight: { x: rootWH.width, y: rootWH.height }\n    }\n  };\n  const stack: Tree[] = [tree];\n  while (stack.length) {\n    const node = stack.pop();\n    if (!node || !node.children || !node.children.length) {\n      continue;\n    }\n    const borderBox = nodeBorders[node.id];\n    const height = borderBox.bottomRight.y - borderBox.topLeft.y;\n    const width = borderBox.bottomRight.x - borderBox.topLeft.x;\n    if (height > width) {\n      for (const i in node.children) {\n        node.children[i].position = {\n          x: node.position!.x,\n          y:\n            borderBox.topLeft.y +\n            (Number(i) + 1 / 2) * (height / node.children.length)\n        };\n      }\n    } else {\n      for (const i in node.children) {\n        node.children[i].position = {\n          x:\n            borderBox.topLeft.x +\n            ((Number(i) + 1 / 2) * width) / node.children.length,\n          y: node.position!.y\n        };\n      }\n    }\n\n    // compute children borders as voronoi cells bounding boxes\n    const [cells, err] = getVoronoiCells(\n      [\n        { x: borderBox.topLeft.x, y: borderBox.topLeft.y },\n        { x: borderBox.bottomRight.x, y: borderBox.topLeft.y },\n        { x: borderBox.bottomRight.x, y: borderBox.bottomRight.y },\n        { x: borderBox.topLeft.x, y: borderBox.bottomRight.y }\n      ],\n      node.children.map(ch => ch.position)\n    );\n    if (err) {\n      return NewErrorKV(\"fillTreePositions: error in getVoronoiCells\", { err });\n    }\n    for (const i in cells) {\n      const cellBBox = getBoundingBorders(cells[i].border);\n      nodeBorders[node.children[i].id] = {\n        topLeft: cellBBox.leftBottom,\n        bottomRight: cellBBox.rightTop\n      };\n    }\n\n    stack.push(...node.children);\n  }\n\n  return null;\n}\n\nexport function printError(msg: string, kv: any) {\n  if (!kv) {\n    console.error(msg);\n  }\n\n  // const callback = function(stackframes: StackFrame[]) {\n  //   const stringifiedStack = stackframes.map(function(sf) {\n  //     return sf.toString();\n  //   }).join('\\n');\n  //   console.error(msg, stringifiedStack);\n  // };\n  //\n  // const errBack = function(e: Error) { console.log(e.message); };\n  //\n  const kvArr = [];\n  for (const i in kv) {\n    kvArr.push(i, kv[i]);\n    // if (kv[i] instanceof Error) {\n    //   StackTrace.get({offline: true}).then(callback).catch(errBack);\n    // }\n  }\n\n  console.error(msg, ...kvArr);\n}\n","import { MapNode, Point, Tree } from \"@/types/graphics\";\nimport {\n  convertPosition,\n  getMaxDiagonal,\n  getVectorLength,\n  mergeMapNodeLayers,\n  treeToMapNodeLayers,\n  vectorOnNumber\n} from \"../../tools/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../../tools/errorkv\";\nimport { clone } from \"../../tools/utils\";\nimport { NodeRecordItem } from \"@/store/tree/index\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport function findMapNode(\n  id: string,\n  mapNodeLayers: Array<Record<string, MapNode>>\n): [MapNode | null, number | null] {\n  for (const level in mapNodeLayers) {\n    const layer = mapNodeLayers[Number(level)];\n    if (layer && layer[id]) {\n      return [layer[id], Number(level)];\n    }\n  }\n\n  return [null, null];\n}\n\nexport function findMapNodes(\n  ids: string[],\n  mapNodeLayers: Array<Record<string, MapNode>>\n): MapNode[] {\n  const result: MapNode[] = [];\n  for (const layer of mapNodeLayers) {\n    if (!layer) {\n      continue;\n    }\n    for (const id of ids) {\n      if (layer[id]) {\n        result.push(layer[id]);\n      }\n    }\n  }\n\n  return result;\n}\n\nexport function createNewNode(title: string, center: Point): Tree {\n  return {\n    id: uuidv4(),\n    position: center,\n    title: title,\n    children: []\n  } as Tree;\n}\n\n/**\n * Вычисляет где можно поставить центр для нового подузла узла parent\n *\n * Логика добавления следующая.\n * Обозначим координаты центра узла parent как (Xc, Yc)\n * Если в узле нет ни одного подузла, то находим наибольшее расстояние между (Xc, Yc)\n * и вершинами границы, делим вектор соединяющий (Xc, Yc) и эту вершину пополам\n * и ставим там центр нового подузла\n *\n * Если в узле есть подузлы, берем подузел с наибольшей диагональю,\n * находим в нем наибольшую диагональ соединяющую 2 вершины границы,\n * делим ее пополам, старый центр ставим в центре одной половины, новый в центре другой.\n *\n * Добавляем рандом (см баг https://sci-map.atlassian.net/browse/SM-118)\n * @param parent\n * @param mapNodeLayers\n * @param addRandom\n */\nexport function getNewNodeCenter(\n  parent: Tree,\n  mapNodeLayers: Array<Record<number, MapNode>>,\n  addRandom: boolean\n): [\n  Point | null, // new node center\n  Tree | null, // existing node with corrected center (if any)\n  ErrorKV // error (if any)\n] {\n  const [parentMapNode] = findMapNode(parent.id, mapNodeLayers);\n  if (parentMapNode === null) {\n    return [\n      null,\n      null,\n      NewErrorKV(\"getNewNodeCenter: cannot find mapNode for parent\", {\n        parentId: parent.id,\n        mapNodeLayers: mapNodeLayers\n      })\n    ];\n  }\n\n  if (parent.children.length === 0) {\n    const fromCenterVectors = parentMapNode.border.map(p => ({\n      from: parentMapNode.center,\n      to: p\n    }));\n    let maxFromCenterVector = fromCenterVectors[0];\n    for (const v of fromCenterVectors) {\n      if (getVectorLength(v) > getVectorLength(maxFromCenterVector)) {\n        maxFromCenterVector = v;\n      }\n    }\n\n    let coeff = 1 / 2;\n    if (addRandom) {\n      coeff = Math.random() * (1 / 2) + 1 / 4;\n    }\n\n    return [\n      {\n        x:\n          maxFromCenterVector.from.x +\n          coeff * (maxFromCenterVector.to.x - maxFromCenterVector.from.x),\n        y:\n          maxFromCenterVector.from.y +\n          coeff * (maxFromCenterVector.to.y - maxFromCenterVector.from.y)\n      },\n      null,\n      null\n    ];\n  } else {\n    const maxDiagChild = parent.children[0];\n    let [maxDiagChildMapNode] = findMapNode(maxDiagChild.id, mapNodeLayers);\n    if (maxDiagChildMapNode === null) {\n      return [\n        null,\n        null,\n        NewErrorKV(\"getNewNodeCenter: cannot find maxDiagChild in layers\", {\n          maxDiagChildId: maxDiagChild.id,\n          mapNodeLayers: mapNodeLayers\n        })\n      ];\n    }\n    for (const child of parent.children) {\n      const [childMapNode] = findMapNode(child.id, mapNodeLayers);\n      if (childMapNode === null) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: cannot find child in layers\", {\n            childId: child.id,\n            mapNodeLayers: mapNodeLayers\n          })\n        ];\n      }\n\n      const [childDiag, err1] = getMaxDiagonal(childMapNode.border);\n      if (err1) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: error getMaxDiagonal\", {\n            childMapNode,\n            err1\n          })\n        ];\n      }\n      const [maxDiag, err2] = getMaxDiagonal(maxDiagChildMapNode.border);\n      if (err2) {\n        return [\n          null,\n          null,\n          NewErrorKV(\"getNewNodeCenter: error getMaxDiagonal\", {\n            maxDiagChildMapNode,\n            err2\n          })\n        ];\n      }\n      if (getVectorLength(childDiag) > getVectorLength(maxDiag)) {\n        maxDiagChildMapNode = childMapNode;\n      }\n    }\n\n    let coeff = 3 / 4;\n    if (addRandom) {\n      coeff = Math.random() * (1 / 4) + 2.5 / 4;\n    }\n\n    const [finalMaxDiag] = getMaxDiagonal(maxDiagChildMapNode.border);\n    const newNodeCenter = vectorOnNumber(finalMaxDiag!, coeff).to;\n    const modifiedNode = clone(maxDiagChild);\n    modifiedNode.position = vectorOnNumber(finalMaxDiag!, 1 / 4).to;\n    return [newNodeCenter, modifiedNode, null];\n  }\n}\n\nexport function updatePosition(\n  state: {\n    tree: Tree | null;\n    nodeRecord: Record<string, NodeRecordItem>;\n    mapNodeLayers: Array<Record<string, MapNode>>;\n  },\n  v: { nodeId: string; position: Point }\n): ErrorKV {\n  if (state.tree == null) {\n    return NewErrorKV(\"state.tree == null\", {});\n  }\n\n  const item = state.nodeRecord[v.nodeId];\n  if (!item) {\n    return NewErrorKV(\"updateNodePosition: cannot find node in nodeRecord\", {\n      \"v.nodeId\": v.nodeId,\n      \"state.nodeRecord\": state.nodeRecord\n    });\n  }\n\n  if (!item.parent) {\n    return NewErrorKV(\"updateNodePosition: cannot move root of tree\", {\n      \"v.nodeId\": v.nodeId\n    });\n  }\n\n  const [normalizedPosition] = convertPosition(\n    \"normalize\",\n    v.position,\n    item.parent.id,\n    state.mapNodeLayers\n  );\n  item.node.position = normalizedPosition!;\n\n  // Если мы меняем один узел, то могут поменяться границы всех соседей\n  // так что надо действовать так как будто поменялись границы всех подузлов родителя узла\n  const [parentMapNode, layerLevel] = findMapNode(\n    item.parent.id,\n    state.mapNodeLayers\n  );\n  if (!parentMapNode || layerLevel === null) {\n    return NewErrorKV(\"updateNodePosition: cannot find mapNode for parent\", {\n      id: item.parent.id,\n      \"state.mapNodeLayers\": state.mapNodeLayers\n    });\n  }\n  const [ls, err] = treeToMapNodeLayers(\n    item.parent,\n    parentMapNode.border,\n    parentMapNode.center\n  );\n  if (ls == null || err != null) {\n    return NewErrorKV(\"updateNodePosition: create layers for parent\", {\n      id: item.parent.id,\n      parentMapNode: parentMapNode\n    });\n  }\n  return mergeMapNodeLayers(state.mapNodeLayers, ls, layerLevel);\n}\n","import { DBMapNode } from \"@/api/types\";\nimport { Tree } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\n\n// convert children object to array\nexport function convertChildren(children: any): string[] {\n  let result: string[];\n\n  if (!children) {\n    result = [];\n  } else if (Array.isArray(children)) {\n    result = children.filter(childID => !!childID).sort();\n    result.forEach((childID, i, arr) => (arr[i] = childID.toString()));\n  } else {\n    result = Object.values(children)\n      .filter(childID => !!childID)\n      .sort() as string[];\n    result.forEach((childID, i, arr) => (arr[i] = childID.toString()));\n  }\n  return result;\n}\n\nexport function convertDBMapToTree(\n  dbNodes: Record<string, DBMapNode>\n): [Tree | null, ErrorKV] {\n  const root: Tree = {\n    id: dbNodes[\"0\"].id.toString(),\n    title: dbNodes[\"0\"].name,\n    position: dbNodes[\"0\"].position,\n    children: []\n  };\n  const stack = [root];\n\n  while (stack.length > 0) {\n    const node = stack.pop();\n    if (!node) {\n      continue;\n    }\n    if (!dbNodes[node.id]) {\n      return [\n        null,\n        NewErrorKV(\"Cannot find id in dbNodes\", { \"node.id\": node.id, dbNodes })\n      ];\n    }\n    dbNodes[node.id].children = convertChildren(dbNodes[node.id].children);\n    if (!dbNodes[node.id].children.length) {\n      continue;\n    }\n    const children: Tree[] = [];\n    for (const childID of dbNodes[node.id].children) {\n      if (!dbNodes[childID]) {\n        return [\n          null,\n          NewErrorKV(\"Cannot find child id in dbNodes\", {\n            childID,\n            parentID: node.id\n          })\n        ];\n      }\n      children.push({\n        id: childID.toString(),\n        title: dbNodes[childID].name,\n        position: dbNodes[childID].position,\n        children: []\n      });\n    }\n\n    node.children = children;\n    stack.push(...children);\n  }\n\n  return [root, null];\n}\n","import firebase from \"firebase/compat\";\nimport { Tree } from \"@/types/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"../tools/errorkv\";\nimport axios from \"axios\";\nimport { Pins } from \"@/store/pin\";\nimport {mutations as preconditionMutations, Preconditions} from \"@/store/precondition\";\nimport {mutations as imageMutations} from \"@/store/image\";\nimport { DBMapNode, DBImage} from \"@/api/types\";\nimport { convertChildren } from \"./helpers\";\nimport { NodeComment, NodeContent } from \"@/store/node_content\";\nimport emulatorConfig from \"../../firebase.json\";\nimport { debounce } from \"lodash\";\n\nimport { connectFirestoreEmulator, getFirestore } from \"firebase/firestore\";\nimport {store} from \"@/store\";\n\nconst MAP_FROM_STORAGE = false; // is storage is source for map (or database)\nlet FUNCTION_DOMAIN = \"https://us-central1-sci-map-1982.cloudfunctions.net/\";\n\nconst update = async (data: Record<string, any>): Promise<ErrorKV> => {\n  try {\n    await firebase\n      .database()\n      .ref()\n      .update(data);\n    return null;\n  } catch (e) {\n    return NewErrorKV(\"api: error in update\", { err: e });\n  }\n};\n\nconst debouncedUpdate = debounce(update, 2000);\n\nexport default {\n  ROOT_WIDTH: (2 * window.innerWidth) / 3,\n  ROOT_HEIGHT: window.innerHeight,\n  ROOT_CENTER_X: 0.3 * window.innerWidth + (0.7 * window.innerWidth) / 2,\n  ROOT_CENTER_Y: window.innerHeight / 2,\n  ST_WIDTH: 1000,\n  ST_HEIGHT: 1000,\n  initFirebase() {\n    // Your web app's Firebase configuration\n    // For Firebase JS SDK v7.20.0 and later, measurementId is optional\n    const firebaseConfig = {\n      apiKey: \"AIzaSyCP50k-WOkTeG8BYvRtu4Bo_x3T2RnVsxU\",\n      authDomain: \"sci-map-1982.firebaseapp.com\",\n      databaseURL: \"https://sci-map-1982.firebaseio.com\",\n      projectId: \"sci-map-1982\",\n      storageBucket: \"sci-map-1982.appspot.com\",\n      messagingSenderId: \"340899060236\",\n      appId: \"1:340899060236:web:b136e9289e342a8bb62c29\",\n      measurementId: \"G-TV74Q61H9P\"\n    };\n\n    // Initialize Firebase\n    firebase.initializeApp(firebaseConfig);\n    firebase.analytics();\n\n    if (process.env.VUE_APP_IS_EMULATOR === \"true\") {\n      console.log(\"Starting in emulator mode\");\n      firebase\n        .auth()\n        .useEmulator(`http://localhost:${emulatorConfig.emulators.auth.port}`);\n      firebase\n        .database()\n        .useEmulator(\"localhost\", emulatorConfig.emulators.database.port);\n      firebase\n        .storage()\n        .useEmulator(\"localhost\", emulatorConfig.emulators.storage.port);\n      connectFirestoreEmulator(\n        getFirestore(),\n        \"localhost\",\n        emulatorConfig.emulators.firestore.port\n      );\n      FUNCTION_DOMAIN = \"http://localhost:5001/sci-map-1982/us-central1/\";\n    }\n  },\n\n  async callFunction(\n    method: string,\n    params: Record<string, string>\n  ): Promise<[string, ErrorKV]> {\n    const currentUser = firebase.auth().currentUser;\n    if (!currentUser) {\n      return [\n        \"\",\n        NewErrorKV(\"callFunction: cannot determine current user\", {})\n      ];\n    }\n    params.idToken = await currentUser.getIdToken(true);\n    try {\n      const response = await axios.get(FUNCTION_DOMAIN + method, { params });\n      return [response.data, null];\n    } catch (e) {\n      return [\"\", NewErrorKV(\"Error in callFunction\", { method, params, e })];\n    }\n  },\n\n  async getMapFromDB(): Promise<[Record<string, DBMapNode> | null, ErrorKV]> {\n    const snapshot = await firebase\n      .database()\n      .ref(\"map\")\n      .get();\n    if (!snapshot.exists()) {\n      return [null, NewErrorKV(\"!snapshot.exists\", {})];\n    }\n    const map = snapshot.val();\n\n    return [map, null];\n  },\n\n  /**\n   * TODO: use it to cut costs on DB reads from read-only users\n   * @param user\n   */\n  async getMapFromStorage(\n    user: firebase.User | null\n  ): Promise<[Tree | null, ErrorKV]> {\n    const storage = firebase.storage().ref();\n    let ref = storage.child(`/map.json`);\n    if (user) {\n      ref = storage.child(`/user/${user.uid}/map.json`);\n    }\n    const url = await ref.getDownloadURL();\n\n    const response = await axios.get(url);\n    return [\n      {\n        id: \"0\",\n        title: \"\",\n        position: { x: this.ROOT_WIDTH / 2, y: this.ROOT_HEIGHT / 2 },\n        // children: apiTree.children\n        children: response.data\n      },\n      null\n    ];\n  },\n\n  async getMap(\n    user: firebase.User | null\n  ): Promise<[Record<string, DBMapNode> | null, ErrorKV]> {\n    try {\n      return await this.getMapFromDB();\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async getPins(user: firebase.User | null): Promise<[Pins | null, ErrorKV]> {\n    try {\n      if (user == null) {\n        // for anonymous use general pins\n        const storage = firebase.storage().ref();\n        const ref = storage.child(`/pins.json`);\n        const url = await ref.getDownloadURL();\n\n        const response = await axios.get(url);\n        return [response.data, null];\n      } else {\n        // for authenticated user use realtime database\n        const snapshot = await firebase\n          .database()\n          .ref(`user_data/${user.uid}/pins`)\n          .get();\n        if (!snapshot.exists()) {\n          return [null, NewErrorKV(\"!snapshot.exists\", {})];\n        }\n        return [snapshot.val(), null];\n      }\n\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async savePins(user: firebase.User, pins: Pins) {\n    if (!user) {\n      return;\n    }\n\n    await firebase\n      .database()\n      .ref(`user_data/${user.uid}/pins`).set(pins);\n  },\n\n  async getPreconditions(\n    user: firebase.User | null\n  ): Promise<[Preconditions | null, ErrorKV]> {\n    try {\n      const snapshot = await firebase\n        .database()\n        .ref(\"precondition\")\n        .get();\n      if (!snapshot.exists()) {\n        return [null, NewErrorKV(\"!snapshot.exists\", {})];\n      }\n      const preconditions = snapshot.val();\n\n      return [preconditions, null];\n    } catch (e) {\n      return [null, NewErrorKV(e.message, { e: e })];\n    }\n  },\n\n  async savePreconditions(\n    user: firebase.User | null,\n    preconditions: { nodeId: string; preconditionIds: string[] }\n  ) {\n    if (!user) {\n      return;\n    }\n    await firebase\n      .database()\n      .ref(\"precondition/\" + preconditions.nodeId)\n      .set(preconditions.preconditionIds);\n  },\n\n  subscribeMapNodeChange(nodeID: string, cb: (a: DBMapNode) => any) {\n    this.subscribeDBChange(\n      `map/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const node = snap.val() as DBMapNode;\n        // console.log('got update for map node', node)\n        node.id = node.id.toString();\n        node.children = convertChildren(node.children);\n        cb(node);\n      }\n    );\n  },\n\n  subscribeNodeContentChange(\n    nodeID: string,\n    cb: (a: { nodeID: string; content: string }) => any\n  ) {\n    this.subscribeDBChange(\n      `node_content/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const node = snap.val() as { nodeID: string; content: string };\n        // console.log('got update for node content', node)\n        cb(node);\n      }\n    );\n  },\n\n  subscribePreconditionNodeChange(\n    nodeID: string,\n  ) {\n    this.subscribeDBChange(\n      `precondition/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const preconditionIDs = snap.val() as Array<string>;\n        store.commit(\n          `precondition/${preconditionMutations.UPDATE_PRECONDITIONS}`,\n          { nodeID: nodeID, preconditionIDs: preconditionIDs }\n        );\n      }\n    );\n  },\n\n  subscribeNodeImageChange(\n    nodeID: string,\n  ) {\n    this.subscribeDBChange(\n      `node_image/${nodeID}`,\n      (snap: firebase.database.DataSnapshot) => {\n        if (!snap.exists()) {\n          return;\n        }\n        const images = snap.val() as Record<string, DBImage>;\n        store.commit(\n          `image/${imageMutations.UPDATE_IMAGES}`,\n          {nodeID, images}\n        );\n      }\n    );\n  },\n\n  subscribeDBChange(\n    path: string,\n    cb: (a: firebase.database.DataSnapshot) => any\n  ) {\n    firebase\n      .database()\n      .ref(path)\n      .on(\"value\", cb);\n  },\n\n  unsubscribeDBChange(\n    path: string,\n    cb?: (a: firebase.database.DataSnapshot) => any\n  ) {\n    firebase\n      .database()\n      .ref(path)\n      .off(\"value\", cb);\n  },\n\n  async transaction(nodeID: string, update: (val: any) => any) {\n    await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .transaction(\n        update,\n        () => {\n          return;\n        },\n        false\n      );\n  },\n\n  async setPublicUserData(\n    userID: string,\n    displayName: string | null,\n    discordName: string | null\n  ) {\n    try {\n      await firebase\n        .database()\n        .ref(\"public_user_data/\" + userID)\n        .set({\n          displayName,\n          discordName\n        });\n    } catch (e) {\n      console.error(e);\n    }\n  },\n\n  async getMapNode(nodeID: string): Promise<DBMapNode | null> {\n    const pr = await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .get();\n    const node = pr.val();\n    if (!node) {\n      console.error(\"got null fetching from map/nodeID\", nodeID)\n    }\n    node.id = node.id.toString();\n    node.children = convertChildren(node.children);\n    return node;\n  },\n\n  async getTrashNode(nodeID: string, type: string): Promise<DBMapNode | null> {\n    const pr = await firebase\n      .database()\n      .ref(`trash/${nodeID}/${type}`)\n      .get();\n    return pr.val();\n  },\n\n  generateKey(): string | null {\n    return firebase\n      .database()\n      .ref()\n      .push().key;\n  },\n\n  async findKeyInList(path: string, value: string): Promise<string | null> {\n    const snap = await firebase\n      .database()\n      .ref(path)\n      .orderByValue()\n      .equalTo(value)\n      .limitToFirst(1)\n      .get();\n    return snap.key;\n  },\n\n  async findKeyOfChild(\n    nodeID: string,\n    childID: string\n  ): Promise<string | null> {\n    const pr = await firebase\n      .database()\n      .ref(\"map/\" + nodeID)\n      .get();\n    const node = pr.val();\n    if (!node.children) {\n      return null;\n    }\n\n    for (const key in node.children) {\n      if (node.children[key].toString() === childID) {\n        return key;\n      }\n    }\n    return null;\n  },\n\n  update,\n  debouncedUpdate,\n\n  async getUserComments(\n    user: firebase.User\n  ): Promise<[Record<string, NodeComment> | null, ErrorKV]> {\n    const userID = user.uid;\n    const snapshot = await firebase\n      .database()\n      .ref(`user_data/${userID}/comment`)\n      .get();\n    if (!snapshot.exists()) {\n      return [null, NewErrorKV(\"!snapshot.exists\", {})];\n    }\n    const nodeComment = snapshot.val();\n\n    return [nodeComment, null];\n  },\n\n  async getNodeContent(): Promise<\n    [Record<string, NodeContent> | null, ErrorKV]\n  > {\n    const snapshot = await firebase\n      .database()\n      .ref(`node_content`)\n      .get();\n\n    if (!snapshot.exists()) {\n      return [{}, null];\n    }\n\n    return [snapshot.val(), null];\n  }\n};\n","import {\n  Tree,\n  Point,\n  Polygon,\n  VoronoiCell,\n  MapNode,\n  Vector,\n  Rectangle\n} from \"@/types/graphics\";\nimport * as turf from \"@turf/turf\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport { default as NewErrorKV } from \"../tools/errorkv\";\nimport { NodeRecordItem } from \"@/store/tree\";\nimport { polygonArea } from \"d3-polygon\";\nimport polygonClipping from \"polygon-clipping\";\nimport { clone, mod, round } from \"../tools/utils\";\nimport { findMapNode } from \"../store/tree/helpers\";\nimport api from \"../api/api\";\n\nconst NORMALIZED_BORDER = [\n  { x: 0, y: 0 },\n  { x: 0, y: api.ST_HEIGHT },\n  { x: api.ST_WIDTH, y: api.ST_HEIGHT },\n  { x: api.ST_WIDTH, y: 0 }\n];\n\nexport function getVectorLength(v: Vector): number {\n  return Math.sqrt(\n    Math.pow(v.from.x - v.to.x, 2) + Math.pow(v.from.y - v.to.y, 2)\n  );\n}\n\nexport function polygonToTurf(\n  p: Polygon\n): turf.Feature<turf.Polygon, turf.Properties> {\n  if (!p) {\n    throw new Error(\"polygonToTurf: p is empty\");\n  }\n  const pp = p.map(point => [point.x, point.y]);\n  pp.push([p[0].x, p[0].y]);\n  return turf.polygon([pp]);\n}\n\nexport function isInside(point: Point, polygon: Polygon): boolean {\n  return turf.booleanPointInPolygon(\n    turf.point([point.x, point.y]),\n    polygonToTurf(polygon)\n  );\n}\n\nexport function polygonToPCPolygon(p: Polygon): polygonClipping.Polygon {\n  const pp = p.map(point => [point.x, point.y] as polygonClipping.Pair);\n  pp.push([p[0].x, p[0].y]);\n  return [pp];\n}\n\nexport function area(p: Polygon): number {\n  return Math.abs(polygonArea(p.map(point => [point.x, point.y])));\n}\n\nexport function intersect(\n  p1: Polygon,\n  p2: Polygon\n): [Polygon[] | null, ErrorKV] {\n  // polygonClipping.intersection does not like digits after point\n  // so we find the least multiplier that gives area > 1000 for polygon\n  // and then round coordinates\n  let np1: Polygon = clone(p1);\n  let np2: Polygon = clone(p2);\n  let cf = 1;\n  while (area(np1) < 1000 && area(np2) < 1000) {\n    cf = cf * 10;\n    np1 = p1.map(p => ({ x: p.x * cf, y: p.y * cf }));\n    np2 = p2.map(p => ({ x: p.x * cf, y: p.y * cf }));\n  }\n  np1 = np1.map(p => ({ x: round(p.x), y: round(p.y) }));\n  np2 = np2.map(p => ({ x: round(p.x), y: round(p.y) }));\n\n  const tp1 = polygonToPCPolygon(np1);\n  const tp2 = polygonToPCPolygon(np2);\n  if (tp1 == null || tp2 == null) {\n    return [\n      null,\n      NewErrorKV(\"intersect: error in polygonToPCPolygon\", { p1: p1, p2: p2 })\n    ];\n  }\n\n  // polygonClipping.intersection\n  const polygonIntersect = polygonClipping.intersection(tp1, tp2);\n  if (polygonIntersect == null || !polygonIntersect.length) {\n    return [[], null];\n  }\n\n  const resultPolys = [];\n\n  for (const poly of polygonIntersect[0]) {\n    const resultPoly = [];\n    for (const p of poly) {\n      resultPoly.push({ x: p[0] / cf, y: p[1] / cf });\n    }\n    // удаляем последнюю точку полигона потому что она всегда совпадает с первой\n    resultPoly.pop();\n    resultPolys.push(resultPoly);\n  }\n\n  return [resultPolys, null];\n}\n\n// Возвращает левый нижний и правый верхний углы описанного вокруг Polygon квадрата\nexport function getBoundingBorders(border: Polygon): Rectangle {\n  if (!border) {\n    console.error(\"bad border\", border);\n  }\n  const minX = border.reduce((previousValue, currentValue) =>\n    previousValue.x > currentValue.x ? currentValue : previousValue\n  ).x;\n  const minY = border.reduce((previousValue, currentValue) =>\n    previousValue.y > currentValue.y ? currentValue : previousValue\n  ).y;\n  const maxX = border.reduce((previousValue, currentValue) =>\n    previousValue.x < currentValue.x ? currentValue : previousValue\n  ).x;\n  const maxY = border.reduce((previousValue, currentValue) =>\n    previousValue.y < currentValue.y ? currentValue : previousValue\n  ).y;\n  return {\n    leftBottom: { x: minX, y: minY },\n    rightTop: { x: maxX, y: maxY }\n  };\n}\n\nexport function getVoronoiCellsInSquare(\n  centers: Point[],\n  leftBottom: Point,\n  rightTop: Point\n): [Record<number, Polygon>, ErrorKV] {\n  const turfPoints = centers.map(p => turf.point([p.x, p.y]));\n  const collection = turf.featureCollection(turfPoints);\n  const cells = turf.voronoi(collection, {\n    bbox: [leftBottom.x, leftBottom.y, rightTop.x, rightTop.y]\n  });\n  const cellMap: Record<number, Polygon> = {};\n  let index = 0;\n  for (const cell of cells.features) {\n    if (!cell) {\n      return [\n        {},\n        NewErrorKV(\"getVoronoiCellsInSquare: undefined cell\", {\n          centers,\n          leftBottom,\n          rightTop,\n          cells\n        })\n      ];\n    }\n    const cellBorder = cell.geometry!.coordinates[0].map(p => ({\n      x: p[0],\n      y: p[1]\n    }));\n    cellBorder.pop(); // удаляем последнюю точку полигона потому что она всегда совпадает с первой\n    cellMap[index] = cellBorder;\n    index++;\n  }\n\n  return [cellMap, null];\n}\n\nexport function getVoronoiCells(\n  outerBorder: Polygon, //(граница массива точек)\n  centers: Point[] //(точки внутри этой границы)\n): [VoronoiCell[], ErrorKV] {\n  if (!outerBorder) {\n    return [\n      [],\n      NewErrorKV(\"getVoronoiCells: bad outerBorder\", { outerBorder, centers })\n    ];\n  }\n  const bb = getBoundingBorders(outerBorder);\n  const [cellMap, err] = getVoronoiCellsInSquare(\n    centers,\n    bb.leftBottom,\n    bb.rightTop\n  );\n  if (err) {\n    return [\n      [],\n      NewErrorKV(\"getVoronoiCells: error in getVoronoiCellsInSquare\", {\n        err,\n        bb,\n        centers\n      })\n    ];\n  }\n\n  const res = [];\n  for (const index in centers) {\n    if (!cellMap[index]) {\n      return [\n        [],\n        NewErrorKV(\"Cannot find index in cellMap\", {\n          index: index,\n          centers: centers,\n          cellMap: cellMap,\n          BoundingBorders: bb,\n          outerBorder\n        })\n      ];\n    }\n\n    const [intersections, err] = intersect(cellMap[index], outerBorder); // мы хотим чтобы граница всех cell совпадала с outerBorder\n    if (intersections == null || err != null) {\n      return [\n        [],\n        NewErrorKV(\"getVoronoiCells error\", {\n          err,\n          cellBorder: cellMap[index],\n          outerBorder\n        })\n      ];\n    }\n\n    if (intersections == []) {\n      return [\n        [],\n        NewErrorKV(\"Voronoi cell has no intersection with outerBorder\", {\n          point: centers[index]\n        })\n      ];\n    }\n    if (intersections.length > 1) {\n      return [\n        [],\n        NewErrorKV(\n          \"Voronoi cell has more than one intersection with outerBorder\",\n          { point: centers[index] }\n        )\n      ];\n    }\n    res.push({\n      border: intersections[0],\n      center: centers[index]\n    });\n  }\n\n  return [res, null];\n}\n\nexport function getVoronoiCellRecords(\n  outerBorder: Polygon, //(граница массива точек)\n  centers: Record<string, Point> //(точки внутри этой границы)\n): [Record<string, Polygon>, ErrorKV] {\n  const result: Record<string, Polygon> = {};\n  const ids: string[] = [];\n  const centersArray: Point[] = [];\n  for (const id in centers) {\n    ids.push(id);\n    centersArray.push(centers[id]);\n  }\n\n  const [cells, err] = getVoronoiCells(outerBorder, centersArray);\n  if (err !== null) {\n    return [{}, err];\n  }\n  for (const i in ids) {\n    result[ids[i]] = cells[i].border;\n  }\n\n  return [result, null];\n}\n\nexport function polygonFill(\n  selectedNodeId: string,\n  currentNodeId: string,\n  selectedNodePreconditionIds: string[]\n): string {\n  if (selectedNodeId && selectedNodeId == currentNodeId) {\n    return \"#f3afaf\";\n  }\n  if (\n    selectedNodePreconditionIds &&\n    selectedNodePreconditionIds.indexOf(currentNodeId) != -1\n  ) {\n    return \"#62f363\";\n  }\n  return \"transparent\";\n}\n\nexport function polygonFillOpacity(\n  selectedNodeId: string,\n  currentNodeId: string,\n  selectedNodePreconditionIds: string[]\n): string {\n  if (selectedNodeId && selectedNodeId == currentNodeId) {\n    return \"0.2\";\n  }\n  if (\n    selectedNodePreconditionIds &&\n    selectedNodePreconditionIds.indexOf(currentNodeId) != -1\n  ) {\n    return \"0.2\";\n  }\n  return \"0\";\n}\n\nexport function polygonToPath(polygon: Polygon): string {\n  return polygon.map((point: Point) => `${point.x} ${point.y}`).join(\",\");\n}\n\nexport function treeToNodeRecord(tree: Tree): Record<number, NodeRecordItem> {\n  const nodeRecord: Record<string, NodeRecordItem> = {};\n  const stack: NodeRecordItem[] = [{ node: tree, parent: null }];\n  while (stack.length) {\n    const item = stack.pop();\n    if (!item) {\n      break;\n    }\n    nodeRecord[item.node.id] = item;\n    stack.push(\n      ...item.node.children.map(child => ({\n        node: child,\n        parent: item.node\n      }))\n    );\n  }\n\n  return nodeRecord;\n}\n\nexport function transferToPoint(vector: Vector, point: Point): Vector {\n  return {\n    from: {\n      x: point.x,\n      y: point.y\n    },\n    to: {\n      x: point.x + (vector.to.x - vector.from.x),\n      y: point.y + (vector.to.y - vector.from.y)\n    }\n  };\n}\n\nexport function pointToVector(p: Point): Vector {\n  return { from: { x: 0, y: 0 }, to: p };\n}\n\nexport function addVector(a: Vector, b: Vector): Vector {\n  const bTransferred = transferToPoint(b, a.to);\n  return {\n    from: { x: a.from.x, y: a.from.y },\n    to: { x: bTransferred.to.x, y: bTransferred.to.y }\n  };\n}\n\nexport function subtractVector(a: Vector, b: Vector): Vector {\n  return transferToPoint(\n    addVector(\n      { from: { x: b.from.x, y: b.from.y }, to: { x: -b.to.x, y: -b.to.y } },\n      a\n    ),\n    transferToPoint(b, a.from).to\n  );\n}\n\nexport function vectorOnNumber(a: Vector, c: number): Vector {\n  const aTr = transferToPoint(a, { x: 0, y: 0 });\n  return transferToPoint(\n    { from: { x: 0, y: 0 }, to: { x: aTr.to.x * c, y: aTr.to.y * c } },\n    a.from\n  );\n}\n\nexport function getRectangleCenter(s: Rectangle): Point {\n  const diagonal = subtractVector(\n    pointToVector(s.rightTop),\n    pointToVector(s.leftBottom)\n  );\n  return vectorOnNumber(diagonal, 1 / 2).to;\n}\n\nexport function transferPointOnVector(p: Point, v: Vector): Point {\n  return transferToPoint(v, p).to;\n}\n\n// math: https://web.archive.org/web/20060911055655/http://local.wasp.uwa.edu.au/~pbourke/geometry/lineline2d/\nexport function getVectorIntersection(v1: Vector, v2: Vector): Point | null {\n  const x1 = v1.from.x;\n  const y1 = v1.from.y;\n  const x2 = v1.to.x;\n  const y2 = v1.to.y;\n  const x3 = v2.from.x;\n  const y3 = v2.from.y;\n  const x4 = v2.to.x;\n  const y4 = v2.to.y;\n  const denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);\n  const numeA = (x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3);\n  const numeB = (x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3);\n\n  if (denom == 0) {\n    return null;\n  }\n\n  const uA = numeA / denom;\n  const uB = numeB / denom;\n\n  if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\n    return {\n      x: x1 + uA * (x2 - x1),\n      y: y1 + uA * (y2 - y1)\n    };\n  }\n\n  return null;\n}\n\nexport function morphChildrenPoints(\n  oldBorder: Polygon,\n  newBorder: Polygon,\n  oldPoints: Record<string, Point>\n): [Record<string, Point> | null, ErrorKV] {\n  const oldCenterTf = turf.centerOfMass(polygonToTurf(oldBorder)).geometry;\n  if (oldCenterTf == null) {\n    return [\n      null,\n      NewErrorKV(\"morphChildrenPoints oldBorder centerOfMass error\", {\n        oldBorder: oldBorder,\n        oldPoints: oldPoints\n      })\n    ];\n  }\n  const newCenterTf = turf.centerOfMass(polygonToTurf(newBorder)).geometry;\n  if (newCenterTf == null) {\n    return [\n      null,\n      NewErrorKV(\"morphChildrenPoints newBorder centerOfMass error\", {\n        newBorder: newBorder,\n        oldPoints: oldPoints\n      })\n    ];\n  }\n  const oldCenter = {\n    x: oldCenterTf.coordinates[0],\n    y: oldCenterTf.coordinates[1]\n  };\n  const newCenter = {\n    x: newCenterTf.coordinates[0],\n    y: newCenterTf.coordinates[1]\n  };\n\n  // Move old node and its children to new node center\n  oldBorder = oldBorder.map(\n    (p): Point => {\n      return transferPointOnVector(p, { from: oldCenter, to: newCenter });\n    }\n  );\n  for (const id in oldPoints) {\n    oldPoints[id] = transferPointOnVector(oldPoints[id], {\n      from: oldCenter,\n      to: newCenter\n    });\n  }\n\n  // morph children\n  const maxDiameter = Math.max(\n    getVectorLength({\n      from: getBoundingBorders(oldBorder).leftBottom,\n      to: getBoundingBorders(oldBorder).rightTop\n    }),\n    getVectorLength({\n      from: getBoundingBorders(newBorder).leftBottom,\n      to: getBoundingBorders(newBorder).rightTop\n    })\n  );\n\n  const newPoints: Record<string, Point> = {};\n  for (const id in oldPoints) {\n    const oldPoint = oldPoints[id];\n    if (newCenter.x == oldPoint.x && newCenter.y == oldPoint.y) {\n      newPoints[id] = oldPoint;\n      continue;\n    }\n    let centerToPoint = { from: newCenter, to: oldPoints[id] };\n    // enlarge it to guarantee intersect with both newBorder and oldBorder (transferred to newBorder center)\n    centerToPoint = vectorOnNumber(\n      centerToPoint,\n      maxDiameter / getVectorLength(centerToPoint)\n    );\n    let oldBorderIntersection = null;\n    for (const i in oldBorder) {\n      const segment = {\n        from: oldBorder[i],\n        to: oldBorder[(Number(i) + 1) % oldBorder.length]\n      };\n      const p = getVectorIntersection(centerToPoint, segment);\n      if (p != null) {\n        oldBorderIntersection = p;\n        break;\n      }\n    }\n    if (oldBorderIntersection == null) {\n      return [\n        null,\n        NewErrorKV(\n          \"morphChildrenPoints cannot find intersection with oldBorder\",\n          {\n            centerToPoint: centerToPoint,\n            oldBorder: oldBorder\n          }\n        )\n      ];\n    }\n\n    let newBorderIntersection = null;\n    for (const i in newBorder) {\n      const segment = {\n        from: newBorder[i],\n        to: newBorder[(Number(i) + 1) % newBorder.length]\n      };\n      const p = getVectorIntersection(centerToPoint, segment);\n      if (p != null) {\n        newBorderIntersection = p;\n        break;\n      }\n    }\n    if (newBorderIntersection == null) {\n      return [\n        null,\n        NewErrorKV(\n          \"morphChildrenPoints cannot find intersection with newBorder\",\n          {\n            centerToPoint: centerToPoint,\n            newBorder: newBorder\n          }\n        )\n      ];\n    }\n\n    if (\n      oldBorderIntersection.x == newBorderIntersection.x &&\n      oldBorderIntersection.y == newBorderIntersection.y\n    ) {\n      newPoints[id] = oldPoint;\n      continue;\n    }\n\n    const coeff =\n      getVectorLength({ from: newCenter, to: newBorderIntersection }) /\n      getVectorLength({ from: newCenter, to: oldBorderIntersection });\n    newPoints[id] = vectorOnNumber({ from: newCenter, to: oldPoint }, coeff).to;\n  }\n\n  return [newPoints, null];\n}\n\nexport function NewEmptyVector(): Vector {\n  return { from: { x: 0, y: 0 }, to: { x: 0, y: 0 } };\n}\n\nexport function getMaxDiagonal(polygon: Polygon): [Vector, ErrorKV] {\n  if (!polygon || polygon.length < 3) {\n    return [\n      NewEmptyVector(),\n      NewErrorKV(\"getMaxDiagonal: bad polygon\", { polygon })\n    ];\n  }\n\n  const diagonals: Vector[] = [];\n  if (polygon.length == 3) {\n    // triangle does not has diagonals, so me emulate them\n    for (const i in polygon) {\n      const middle = vectorOnNumber(\n        {\n          from: polygon[mod(Number(i) - 1, polygon.length)],\n          to: polygon[mod(Number(i) + 1, polygon.length)]\n        },\n        1 / 2\n      );\n      diagonals.push({ from: polygon[i], to: middle.to });\n    }\n  } else {\n    for (const i in polygon) {\n      for (const j in polygon) {\n        if (\n          Number(j) != mod(Number(i) - 1, polygon.length) &&\n          Number(j) != Number(i) &&\n          Number(j) != mod(Number(i) + 1, polygon.length)\n        ) {\n          diagonals.push({ from: polygon[i], to: polygon[j] });\n        }\n      }\n    }\n  }\n\n  let maxDiagonal = diagonals[0];\n  for (const diag of diagonals) {\n    if (getVectorLength(diag) > getVectorLength(maxDiagonal)) {\n      maxDiagonal = diag;\n    }\n  }\n\n  return [maxDiagonal, null];\n}\n\nexport function convertPosition(\n  type: \"normalize\" | \"denormalize\",\n  position: Point,\n  parentID: string | null,\n  mapNodeLayers: Array<Record<string, MapNode>>\n): [Point | null, ErrorKV] {\n  let convertedPosition: Point;\n  if (parentID) {\n    const [parentMapNode] = findMapNode(parentID, mapNodeLayers);\n    if (!parentMapNode) {\n      return [\n        null,\n        NewErrorKV(\"UPDATE_NODE: Cannot findMapNode\", { id: parentID })\n      ];\n    }\n\n    let morphedPositions: Record<string, Point> | null, err: ErrorKV;\n    if (type === \"denormalize\") {\n      if (!isInside(position, NORMALIZED_BORDER)) {\n        return [\n          null,\n          NewErrorKV(\"convertPosition: position outside NORMALIZED_BORDER\", {\n            normalizedBorder: NORMALIZED_BORDER,\n            position,\n            parentID\n          })\n        ];\n      }\n      [morphedPositions, err] = morphChildrenPoints(\n        NORMALIZED_BORDER,\n        parentMapNode.border,\n        { tmp: position }\n      );\n    } else {\n      if (!isInside(position, parentMapNode.border)) {\n        return [\n          null,\n          NewErrorKV(\"convertPosition: position outside parentMapNode.border\", {\n            \"parentMapNode.border\": parentMapNode.border,\n            \"parentMapNode.center\": parentMapNode.center,\n            position,\n            parentID\n          })\n        ];\n      }\n      [morphedPositions, err] = morphChildrenPoints(\n        parentMapNode.border,\n        NORMALIZED_BORDER,\n        { tmp: position }\n      );\n      if (err !== null) {\n        return [\n          null,\n          NewErrorKV(\"UPDATE_NODE: Cannot morphChildrenPoints\", {\n            type: type,\n            normalizedBorder: NORMALIZED_BORDER,\n            \"parentMapNode.border\": parentMapNode.border,\n            \"dbNode.position\": position\n          })\n        ];\n      }\n      // make sure that after normalization position is strictly inside border\n      if (morphedPositions![\"tmp\"].x < 0) {\n        morphedPositions![\"tmp\"].x = 1;\n      }\n      if (morphedPositions![\"tmp\"].x > api.ST_WIDTH) {\n        morphedPositions![\"tmp\"].x = api.ST_WIDTH - 1;\n      }\n      if (morphedPositions![\"tmp\"].y < 0) {\n        morphedPositions![\"tmp\"].y = 1;\n      }\n      if (morphedPositions![\"tmp\"].y > api.ST_HEIGHT) {\n        morphedPositions![\"tmp\"].y = api.ST_HEIGHT - 1;\n      }\n    }\n    if (err !== null) {\n      return [\n        null,\n        NewErrorKV(\"UPDATE_NODE: Cannot morphChildrenPoints\", {\n          type: type,\n          normalizedBorder: NORMALIZED_BORDER,\n          \"parentMapNode.border\": parentMapNode.border,\n          \"dbNode.position\": position\n        })\n      ];\n    }\n    convertedPosition = morphedPositions![\"tmp\"];\n  } else {\n    if (type === \"denormalize\") {\n      convertedPosition = { x: api.ROOT_CENTER_X, y: api.ROOT_CENTER_Y };\n    } else {\n      convertedPosition = { x: api.ST_WIDTH / 2, y: api.ST_HEIGHT / 2 };\n    }\n  }\n\n  return [convertedPosition, null];\n}\n\n/**\n *\n * @param tree\n * @param rootBorder\n * @param rootPosition\n */\nexport function treeToMapNodeLayers(\n  tree: Tree,\n  rootBorder: Polygon,\n  rootPosition: Point\n): [Array<Record<string, MapNode>> | null, ErrorKV] {\n  if (Object.keys(tree).length == 0) {\n    return [[], null];\n  }\n  const treeLayers: Array<Array<Tree>> = [[tree]];\n  const mapNodeLayers: Array<Record<string, MapNode>> = [\n    {\n      [tree.id]: {\n        id: tree.id,\n        border: rootBorder,\n        title: tree.title,\n        center: rootPosition\n      }\n    }\n  ];\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    const lastTreeLayer = treeLayers[treeLayers.length - 1];\n    const lastMapNodeLayer = mapNodeLayers[treeLayers.length - 1];\n    const newTreeLayer = [];\n    const newMapNodeLayer: Record<string, MapNode> = {};\n    for (const treeNode of lastTreeLayer) {\n      if (!treeNode.children) {\n        return [\n          null,\n          NewErrorKV(\"treeToMapNodeLayers: treeNode with children undefined\", {\n            treeNode\n          })\n        ];\n      }\n      if (!treeNode.children.length) {\n        continue;\n      }\n\n      // check that no two children have the same center\n      const tmpMap = {} as Record<string, string>;\n      let strPos = \"\";\n      for (const i in treeNode.children) {\n        strPos = JSON.stringify(treeNode.children[i].position);\n        if (tmpMap[strPos] && tmpMap[strPos].length > 0) {\n          return [\n            null,\n            NewErrorKV(\"two children has the same center\", {\n              firstId: tmpMap[strPos],\n              secondId: treeNode.children[i].id\n            })\n          ];\n        } else {\n          tmpMap[strPos] = treeNode.children[i].id;\n        }\n      }\n\n      newTreeLayer.push(...treeNode.children);\n      if (!lastMapNodeLayer[treeNode.id]) {\n        return [\n          null,\n          NewErrorKV(\"Cannot find node in mapNodeLayers\", {\n            layer: mapNodeLayers[mapNodeLayers.length - 1],\n            treeNode: treeNode\n          })\n        ];\n      }\n\n      // denormalize positions\n      const treeNodeChildren = clone(treeNode.children) as Array<Tree>;\n      for (const child of treeNodeChildren) {\n        const [denormalizedPosition, err] = convertPosition(\n          \"denormalize\",\n          child.position,\n          treeNode.id,\n          [lastMapNodeLayer]\n        );\n        if (err) {\n          return [null, err];\n        }\n        child.position = denormalizedPosition!;\n      }\n      const [cells, error] = getVoronoiCells(\n        lastMapNodeLayer[treeNode.id].border,\n        treeNodeChildren.map(ch => ({ x: ch.position.x, y: ch.position.y }))\n      );\n      if (error != null) {\n        return [null, error];\n      }\n\n      for (const cell of cells) {\n        for (const child of treeNodeChildren) {\n          if (\n            child.position.x == cell.center.x &&\n            child.position.y == cell.center.y\n          ) {\n            newMapNodeLayer[child.id] = {\n              id: child.id,\n              title: child.title,\n              center: child.position,\n              border: cell.border\n            };\n          }\n        }\n      }\n    }\n\n    if (newTreeLayer.length) {\n      treeLayers.push(newTreeLayer);\n      mapNodeLayers.push(newMapNodeLayer);\n    } else {\n      return [mapNodeLayers, null];\n    }\n  }\n}\n\nexport function mergeMapNodeLayers(\n  recipientLayers: Record<string, MapNode>[],\n  insertedLayers: Record<string, MapNode>[],\n  startFromLevel: number\n): ErrorKV {\n  if (startFromLevel >= recipientLayers.length || startFromLevel < 0) {\n    return NewErrorKV(\n      \"startFromLevel >= recipientLayers.length or startFromLevel < 0\",\n      {\n        startFromLevel,\n        \"recipientLayers.length\": recipientLayers.length\n      }\n    );\n  }\n  let i = startFromLevel;\n  while (i < startFromLevel + insertedLayers.length) {\n    for (const id in insertedLayers[i - startFromLevel]) {\n      recipientLayers[i][id] = insertedLayers[i - startFromLevel][id];\n    }\n    i++;\n  }\n\n  return null;\n}\n","import { clone } from \"@/tools/utils\";\nimport { Commit } from \"vuex\";\nimport api from \"@/api/api\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport { State as UserState } from \"@/store/user\";\n\nexport type NodeContent = {\n  nodeID: string;\n  content: string;\n};\n\n// user private comment\nexport type NodeComment = {\n  nodeID: string;\n  comment: string;\n};\n\nexport interface State {\n  nodeContents: Record<string, NodeContent>;\n  userNodeComments: Record<string, NodeComment>;\n}\n\nexport const mutations = {\n  SET_CONTENTS: \"SET_CONTENTS\",\n  SET_USER_COMMENTS: \"SET_USER_COMMENTS\",\n  SET_NODE_CONTENT: \"SET_NODE_CONTENT\",\n  SET_NODE_COMMENT: \"SET_NODE_COMMENT\"\n};\n\nexport const actions = {\n  getNodeContent: \"getNodeContent\",\n  setNodeContent: \"setNodeContent\",\n  setNodeComment: \"setNodeComment\"\n};\n\nexport const EmptyNodeContent = {\n  nodeID: \"\",\n  content: \"\"\n} as NodeContent;\n\nfunction createContentIfNotExist(\n  nodeContents: Record<string, NodeContent>,\n  nodeID: string\n) {\n  if (!nodeContents[nodeID]) {\n    nodeContents[nodeID] = clone(EmptyNodeContent);\n    nodeContents[nodeID].nodeID = nodeID;\n  }\n}\n\nexport const EmptyNodeComment = {\n  nodeID: \"\",\n  comment: \"\"\n} as NodeComment;\n\nfunction createCommentIfNotExist(\n  userNodeComments: Record<string, NodeComment>,\n  nodeID: string\n) {\n  if (!userNodeComments[nodeID]) {\n    userNodeComments[nodeID] = clone(EmptyNodeComment);\n    userNodeComments[nodeID].nodeID = nodeID;\n  }\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    nodeContents: {} as Record<string, NodeContent>,\n    userNodeComments: {} as Record<string, NodeComment>\n  } as State,\n  actions: {\n    [actions.getNodeContent](\n      { state }: { state: State },\n      nodeID: string\n    ): NodeContent {\n      return state.nodeContents[nodeID];\n    },\n\n    /**\n     * setNodeComment\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.setNodeComment](\n      { commit, rootState }: { commit: Commit; rootState: { user: UserState } },\n      v: { nodeID: string; comment: string }\n    ): Promise<ErrorKV> {\n      // cannot save for unauthorized user\n      if (!rootState.user.user || rootState.user.user.isAnonymous) {\n        return null;\n      }\n\n      // add to DB\n      const err = await api.debouncedUpdate({\n        [`user_data/${rootState.user.user.uid}/comment/${v.nodeID}/nodeID`]: v.nodeID,\n        [`user_data/${rootState.user.user.uid}/comment/${v.nodeID}/comment`]: v.comment\n      });\n      if (err) {\n        return err;\n      }\n\n      // change in local store\n      commit(`${mutations.SET_NODE_COMMENT}`, v);\n\n      return null;\n    },\n\n    /**\n     * setNodeContent\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.setNodeContent](\n      { commit, state }: { commit: Commit; state: State },\n      v: { nodeID: string; content: string }\n    ): Promise<ErrorKV> {\n      // change in local store before adding to DB for comfortable textbox editing experience\n      commit(`${mutations.SET_NODE_CONTENT}`, v);\n\n      // add to DB\n      const err = await api.debouncedUpdate({\n        [`node_content/${v.nodeID}/nodeID`]: v.nodeID,\n        [`node_content/${v.nodeID}/content`]: v.content\n      });\n      if (err) {\n        return err;\n      }\n\n      return null;\n    }\n  },\n  mutations: {\n    /**\n     * SET_CONTENTS\n     * @param state\n     * @param nodeContents\n     */\n    [mutations.SET_CONTENTS](\n      state: State,\n      nodeContents: Record<string, NodeContent>\n    ) {\n      state.nodeContents = nodeContents;\n    },\n\n    /**\n     * SET_USER_CONTENTS\n     * @param state\n     * @param userNodeComments\n     */\n    [mutations.SET_USER_COMMENTS](\n      state: State,\n      userNodeComments: Record<string, NodeComment>\n    ) {\n      state.userNodeComments = userNodeComments;\n    },\n\n    /**\n     * SET_NODE_CONTENT\n     * @param state\n     * @param v\n     */\n    [mutations.SET_NODE_CONTENT](\n      state: State,\n      v: { nodeID: string; content: string }\n    ) {\n      createContentIfNotExist(state.nodeContents, v.nodeID);\n      state.nodeContents[v.nodeID].content = v.content;\n    },\n\n    /**\n     * SET_NODE_COMMENT\n     * @param state\n     * @param v\n     */\n    [mutations.SET_NODE_COMMENT](\n      state: State,\n      v: { nodeID: string; comment: string }\n    ) {\n      createCommentIfNotExist(state.userNodeComments, v.nodeID);\n      state.userNodeComments[v.nodeID].comment = v.comment;\n    }\n  }\n};\n","// FlexSearch for full-text search\n// @ts-ignore\nimport { Worker } from \"flexsearch\";\nconst index = new Worker({\n  language: \"en\",\n  tokenize: \"forward\"\n});\n\nexport function add(id: string, text: string) {\n  index.add(id, text);\n}\nexport function search(text: string): Promise<Array<string>> {\n  return index.search(text);\n}\n","import firebase from \"firebase/compat\";\nimport api from \"@/api/api\";\nimport {\n  mutations as treeMutations,\n  actions as treeActions\n} from \"@/store/tree\";\nimport { mutations as pinMutations } from \"@/store/pin\";\nimport { mutations as preconditionMutations } from \"@/store/precondition\";\nimport {\n  mutations as nodeContentMutations,\n  NodeContent\n} from \"@/store/node_content\";\nimport { store } from \"@/store/index\";\nimport { printError } from \"@/tools/utils\";\nimport { convertDBMapToTree } from \"@/api/helpers\";\nimport { DBMapNode } from \"@/api/types\";\nimport { add as textSearchAdd } from \"@/tools/textsearch\";\n\n/**\n * 1) fetch map\n * 2) subscribe to changes\n * 3) convert to tree and set to internal store\n * @param user\n */\nexport async function initMap(user: firebase.User | null) {\n  const [map, err] = await api.getMap(user);\n  if (map === null || err) {\n    printError(\"fetchMap: cannot api.getMap(user)\", { err });\n  }\n  // create Tree with denormalized positions\n  const [tree, convErr] = convertDBMapToTree(map!);\n  if (convErr !== null) {\n    return [null, convErr];\n  }\n  store.commit(`tree/${treeMutations.SET_TREE}`, tree);\n\n  // subscribe on changes for every node in map\n  // General advice is to listen to specific paths (not root) and dynamically change subscribe/unsubscribe\n  // https://firebase.google.com/docs/database/usage/optimize#efficient-listeners\n  for (const id in map) {\n    subscribeNodeChanges(id)\n  }\n}\n\nexport function unSubscribeNodeChanges(id: string) {\n  api.unsubscribeDBChange(`map/${id}`)\n  api.unsubscribeDBChange(`node_content/${id}`)\n  api.unsubscribeDBChange(`precondition/${id}`)\n  api.unsubscribeDBChange(`node_image/${id}`)\n}\n\nexport function subscribeNodeChanges(id: string) {\n  // subscribe children, name or position change\n  api.subscribeMapNodeChange(id, (dbNode: DBMapNode) =>\n    store.dispatch(`tree/${treeActions.handleMapNodeUpdate}`, dbNode)\n  );\n\n  // subscribe node content change\n  api.subscribeNodeContentChange(\n    id,\n    (v: { nodeID: string; content: string }) => {\n      textSearchAdd(v.nodeID, v.content);\n      store.commit(`nodeContent/${nodeContentMutations.SET_NODE_CONTENT}`, v);\n    }\n  );\n\n  // subscribe on precondition changes for every node\n  api.subscribePreconditionNodeChange(id);\n\n  // subscribe image change\n  api.subscribeNodeImageChange(id)\n}\n\nexport async function fetchPins(user: firebase.User | null) {\n  let [pins, err] = await api.getPins(user);\n  if (pins == null) {\n    if (err) {\n      console.error(\"fetchPins\", err);\n    } else {\n      console.log(\"fetchPins: empty pins\");\n    }\n  }\n\n  if (user && !pins) {\n    [pins, err] = await api.getPins(null);\n    if (pins == null || err) {\n      console.error(err);\n      pins = {};\n    }\n  }\n\n  store.commit(`pin/${pinMutations.SET_PINS}`, pins);\n}\n\nexport async function initPreconditions(user: firebase.User | null) {\n  let [preconditions, err] = await api.getPreconditions(user);\n  if (preconditions == null || err) {\n    console.error(err);\n    preconditions = {};\n  }\n\n  if (user && !preconditions) {\n    [preconditions, err] = await api.getPreconditions(null);\n    if (preconditions == null || err) {\n      console.error(err);\n      preconditions = {};\n    }\n  }\n\n  store.commit(\n    `precondition/${preconditionMutations.SET_PRECONDITIONS}`,\n    preconditions\n  );\n}\n\n/**\n * Fetch all node content and subscribe for content change for each node\n * @param user\n */\nexport async function initNodeContents(user: firebase.User | null) {\n  // fetch node_content from general map\n  const [nodeContent, err] = await api.getNodeContent();\n  if (nodeContent == null || err) {\n    printError(\"fetchNodeContents error\", { err });\n    return;\n  }\n\n  const nodeContents: Record<string, NodeContent> = {};\n  for (const i in nodeContent) {\n    nodeContents[i] = {\n      nodeID: nodeContent[i].nodeID,\n      content: nodeContent[i].content\n    } as NodeContent;\n  }\n\n  store.commit(\n    `nodeContent/${nodeContentMutations.SET_CONTENTS}`,\n    nodeContents\n  );\n\n  if (user) {\n    const [userComments, err] = await api.getUserComments(user);\n    if (err) {\n      printError(\"fetch userComments error\", { err, user });\n      return;\n    }\n    if (userComments === null) {\n      return;\n    }\n\n    // fix in store\n    store.commit(\n      `nodeContent/${nodeContentMutations.SET_USER_COMMENTS}`,\n      userComments\n    );\n  }\n}\n\nexport async function initData(user: firebase.User | null) {\n  await initMap(user);\n  await fetchPins(user);\n  await initPreconditions(user);\n  await initNodeContents(user);\n}\n","import { MapNode, Point, Tree } from \"@/types/graphics\";\nimport {\n  convertPosition,\n  isInside,\n  treeToMapNodeLayers,\n  treeToNodeRecord\n} from \"@/tools/graphics\";\nimport { findMapNode, updatePosition } from \"@/store/tree/helpers\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { DBMapNode } from \"@/api/types\";\nimport { printError, round } from \"@/tools/utils\";\nimport api from \"@/api/api\";\nimport { Commit, Dispatch } from \"vuex\";\nimport {subscribeNodeChanges, unSubscribeNodeChanges} from \"@/store/helpers\";\n\n// Define root border for 2560x1600\nconst ROOT_WIDTH = 2560;\nconst ROOT_HEIGHT = 1600;\nconst cf = 1 / 3;\nconst ROOT_BORDER = [\n  { x: 0, y: cf * ROOT_HEIGHT },\n  { x: 0, y: 2 * cf * ROOT_HEIGHT },\n  { x: (cf / 2.5) * ROOT_WIDTH, y: (1 - cf / 4) * ROOT_HEIGHT },\n  { x: cf * ROOT_WIDTH, y: ROOT_HEIGHT },\n  { x: 2 * cf * ROOT_WIDTH, y: ROOT_HEIGHT },\n  { x: (1 - cf / 2.5) * ROOT_WIDTH, y: (1 - cf / 4) * ROOT_HEIGHT },\n  { x: ROOT_WIDTH, y: 2 * cf * ROOT_HEIGHT },\n  { x: ROOT_WIDTH, y: cf * ROOT_HEIGHT },\n  { x: (1 - cf / 2.5) * ROOT_WIDTH, y: (cf / 4) * ROOT_HEIGHT },\n  { x: 2 * cf * ROOT_WIDTH, y: 0 },\n  { x: cf * ROOT_WIDTH, y: 0 },\n  { x: (cf / 2.5) * ROOT_WIDTH, y: (cf / 4) * ROOT_HEIGHT }\n];\nconst ROOT_CENTER = { x: api.ROOT_CENTER_X, y: api.ROOT_CENTER_Y };\n\n// Scale root border proportionally to fit 2/3 of user browser viewport and move the left\nconst userFitCoefficient = Math.min(\n  api.ROOT_WIDTH / ROOT_WIDTH,\n  api.ROOT_HEIGHT / ROOT_HEIGHT\n);\nfor (const idx in ROOT_BORDER) {\n  ROOT_BORDER[idx].x =\n    userFitCoefficient * ROOT_BORDER[idx].x +\n    api.ROOT_CENTER_X -\n    (userFitCoefficient * ROOT_WIDTH) / 2;\n  ROOT_BORDER[idx].y =\n    userFitCoefficient * ROOT_BORDER[idx].y +\n    api.ROOT_CENTER_Y -\n    (userFitCoefficient * ROOT_HEIGHT) / 2;\n}\n\nexport interface NodeRecordItem {\n  node: Tree;\n  parent: Tree | null;\n}\n\nexport interface State {\n  tree: Tree | null;\n  nodeRecord: Record<string, NodeRecordItem>;\n  mapNodeLayers: Array<Record<string, MapNode>>;\n  selectedNodeId: string | null;\n}\n\nexport const mutations = {\n  SET_SELECTED_NODE_ID: \"SET_SELECTED_NODE_ID\",\n  SET_TREE: \"SET_TREE\",\n  UPDATE_NODE_POSITION: \"UPDATE_NODE_POSITION\",\n  REMOVE_NODE: \"REMOVE_NODE\"\n};\n\nexport const actions = {\n  handleMapNodeUpdate: \"handleMapNodeUpdate\"\n};\n\nexport const store = {\n  namespaced: true,\n  state() {\n    return {\n      tree: null,\n      nodeRecord: {} as Record<string, NodeRecordItem>, // id => NodeRecordItem\n      mapNodeLayers: [] as Array<Record<string, DBMapNode>>,\n      selectedNodeId: null\n    };\n  },\n\n  getters: {\n    selectedNode: (state: State) => {\n      if (!state.selectedNodeId) {\n        return null;\n      }\n      if (!state.nodeRecord[state.selectedNodeId]) {\n        return null;\n      }\n      return state.nodeRecord[state.selectedNodeId].node;\n    }\n  },\n\n  actions: {\n    /**\n     * Update tree and dependant structures on DBNode change\n     *\n     * После добавления нового узла мы не вносим изменения локально, а сохраняем в базу и ждем пока оттуда придет обновление\n     *\n     * Маппинг изменений в виде снэпшотов на изменения в формате store/history выглядит следующим образом.\n     * Мы сравниваем наш узел и пришедший новый снэпшот этого узла\n     *\n     * Если видим удаление child, то это либо перенос, либо удаление узла.\n     * В любом случае мы можем у себя удалить этот узел (мы не удаляем всю информацию, только из дерева - 'fake removal').\n     * Если это перенос, то мы либо получили событие добавления в другой узел\n     * до этого события, либо получим его после. Если получили до, то из этого узла уже должны были его удалить,\n     * так что остается вариант когда мы еще получим событие о добавлении. В этом случаем для нас это будет добавление нового узла.\n     * То есть мы запросим из базы этот узел и вставим его\n     *\n     * Если видим добавление child, то это либо перенос, либо добавление нового узла. Если мы не находим у себя child с таким id,\n     * то это добавление - нам нужно запросить из базы node с таким id и добавить его к себе.\n     * Если в nodeRecord есть такой узел, то это перенос - мы удаляем его из старого родителя и вставляем в новый\n     *\n     * Этими двумя кейсами покрываются события добавления, удаления и переноса.\n     * Событие изменения имени и позиции мапятся тривиально\n     *\n     * @param commit\n     * @param state\n     * @param dispatch\n     * @param dbNode\n     */\n    async [actions.handleMapNodeUpdate](\n      {\n        commit,\n        state,\n      }: { commit: Commit; state: State; dispatch: Dispatch },\n      dbNode: DBMapNode\n    ) {\n      const dbNodeRecord = state.nodeRecord[dbNode.id];\n      if (!dbNodeRecord) {\n        // if it is a new node, we will fetch it from its parent children update event\n        return;\n      }\n\n      const oldDBNode = {\n        id: dbNodeRecord.node.id,\n        parentID: dbNodeRecord.parent ? dbNodeRecord.parent.id : null,\n        name: dbNodeRecord.node.title,\n        children: dbNodeRecord.node.children.map(n => n.id).sort(),\n        position: dbNodeRecord.node.position\n      };\n\n      const newChildren = dbNode.children.filter(\n        x => !oldDBNode.children.includes(x)\n      );\n      const removedChildren = oldDBNode.children.filter(\n        x => !dbNode.children.includes(x)\n      );\n\n      // Add/move of new child\n      if (newChildren.length) {\n        for (const childID of newChildren) {\n          if (state.nodeRecord[childID]) {\n            console.log(\n              \"actions.handleDBUpdate: remove node for cut-and-paste\",\n              state.nodeRecord[childID]\n            );\n            // if we already have this node, then it is cut-and-paste new parent\n            // so we should remove node from old parent\n            const v = {\n              nodeID: childID,\n              returnError: null\n            };\n            commit(mutations.REMOVE_NODE, {\n              nodeID: childID,\n              returnError: null\n            });\n            if (v.returnError) {\n              printError(\"handleDBUpdate: cannot cut node\", {\n                err: v.returnError\n              });\n            }\n          }\n\n          // request node and its children from the server, fill in tree\n          const addedDBNode = await api.getMapNode(childID);\n          console.log(\n            \"actions.handleDBUpdate: add node for cut-and-paste\",\n            addedDBNode\n          );\n\n          const toProcess = [addedDBNode];\n          if (!addedDBNode) {\n            // we cannot find node for addition, remove it from parent\n            dbNode.children = dbNode.children.filter(id => id != childID);\n            printError(\"Cannot find node for addition\", { nodeID: childID });\n            continue;\n          }\n          while (toProcess.length) {\n            const inProcessNode = toProcess.pop();\n            if (!inProcessNode) {\n              continue;\n            }\n            // create new MapNode\n            const treeNode = {\n              id: inProcessNode.id,\n              title: inProcessNode.name,\n              position: inProcessNode.position,\n              children: []\n            } as Tree;\n            if (!state.nodeRecord[inProcessNode.parentID]) {\n              printError(\"Cannot find nodeID in nodeRecord\", {\n                nodeID: inProcessNode.parentID\n              });\n              return;\n            }\n            // make sure we have no duplicates\n            state.nodeRecord[\n              inProcessNode.parentID\n            ].node.children = state.nodeRecord[\n              inProcessNode.parentID\n            ].node.children.filter(n => n.id != treeNode.id);\n            // add child to parent\n            state.nodeRecord[inProcessNode.parentID].node.children.push(\n              treeNode\n            );\n            // add child to nodeRecord\n            state.nodeRecord[treeNode.id] = {\n              parent: state.nodeRecord[inProcessNode.parentID].node,\n              node: treeNode\n            };\n            // subscribe to new node changes\n            subscribeNodeChanges(treeNode.id);\n            for (const childID of inProcessNode.children) {\n              const childNode = await api.getMapNode(childID);\n              if (!childNode) {\n                // we cannot find node for addition, remove it from parent\n                inProcessNode.children = inProcessNode.children.filter(\n                  id => id != childID\n                );\n                printError(\"Cannot find node for addition\", {\n                  nodeID: childID\n                });\n                continue;\n              }\n              toProcess.push(childNode);\n            }\n          }\n        }\n      }\n\n      // Remove of child\n      if (removedChildren.length) {\n        for (const childID of removedChildren) {\n          if (!state.nodeRecord[childID] || !state.nodeRecord[childID].parent) {\n            // node was already removed somewhere\n            continue;\n          }\n          if (\n            state.nodeRecord[childID] &&\n            state.nodeRecord[childID].parent!.id !== dbNode.id\n          ) {\n            // node was already removed from this parent (this is cut-and-paste operation)\n            continue;\n          }\n          console.log(\n            \"actions.handleDBUpdate: removing children\",\n            state.nodeRecord[childID]\n          );\n          const v = { nodeID: childID, returnError: null };\n          commit(mutations.REMOVE_NODE, v);\n          if (v.returnError) {\n            printError(\"actions.handleDBUpdate: cannot remove node\", {\n              err: v.returnError,\n              id: childID\n            });\n          }\n          // unsubscribe from removed node changes\n          unSubscribeNodeChanges(childID);\n        }\n      }\n\n      if (removedChildren.length || newChildren.length) {\n        const [ls, err2] = treeToMapNodeLayers(\n          state.tree!,\n          ROOT_BORDER,\n          ROOT_CENTER\n        );\n        if (err2) {\n          printError(\"Cannot treeToMapNodeLayers\", { err: err2 });\n          return;\n        }\n        state.mapNodeLayers = ls!;\n      }\n\n      // Change of position\n      if (\n        round(dbNode.position.x) !== round(oldDBNode.position.x) ||\n        round(dbNode.position.y) !== round(oldDBNode.position.y)\n      ) {\n        // calculate denormalized position of dbNode\n        const [denormalizedPosition] = convertPosition(\n          \"denormalize\",\n          dbNode.position,\n          dbNodeRecord.parent ? dbNodeRecord.parent.id : null,\n          state.mapNodeLayers\n        );\n        if (oldDBNode.parentID == dbNode.parentID) {\n          // we do not want to process position change due to parent change - it is already processed by ADD_NODE\n          const v = {\n            nodeId: dbNode.id,\n            newCenter: denormalizedPosition,\n            returnError: null\n          };\n          commit(mutations.UPDATE_NODE_POSITION, v);\n          if (v.returnError !== null) {\n            printError(\n              \"actions.handleDBUpdate: cannot update node's position\",\n              { dbNode: dbNode, err: v.returnError }\n            );\n            return;\n          }\n        }\n      }\n\n      // Change of name\n      if (oldDBNode.name !== dbNode.name) {\n        dbNodeRecord.node.title = dbNode.name;\n        const [node] = findMapNode(oldDBNode.id, state.mapNodeLayers);\n        if (!node) {\n          return;\n        }\n        node.title = dbNode.name;\n      }\n    }\n  },\n  mutations: {\n    /**\n     * REMOVE_NODE\n     * @param state\n     * @param v\n     */\n    [mutations.REMOVE_NODE](\n      state: State,\n      v: { nodeID: string; returnError: ErrorKV }\n    ) {\n      if (state.tree === null) {\n        v.returnError = NewErrorKV(\"state.tree === null\", {});\n        return;\n      }\n\n      if (!state.nodeRecord[v.nodeID]) {\n        v.returnError = NewErrorKV(\n          \"REMOVE_NODE: cannot find nodeId in nodeRecord\",\n          { nodeID: v.nodeID, nodeRecord: state.nodeRecord }\n        );\n        return;\n      }\n      const parent = state.nodeRecord[v.nodeID].parent;\n      if (!parent) {\n        v.returnError = NewErrorKV(\"REMOVE_NODE: cannot remove root node\", {\n          nodeId: v.nodeID\n        });\n        return;\n      }\n\n      // remove node and its descendants from nodeRecord\n      const stack = [v.nodeID];\n      while (stack.length) {\n        const id = stack.pop();\n        if (!id) {\n          continue;\n        }\n        stack.push(...state.nodeRecord[id].node.children.map(node => node.id));\n        delete state.nodeRecord[id];\n      }\n\n      // remove from parent's children\n      const ind = parent.children.findIndex(node => node.id === v.nodeID);\n      parent.children.splice(ind, 1);\n    },\n\n    /**\n     * SET_SELECTED_NODE_ID\n     * @param state\n     * @param id\n     */\n    [mutations.SET_SELECTED_NODE_ID](state: State, id: string | null) {\n      state.selectedNodeId = id;\n    },\n\n    /**\n     * SET_TREE\n     * @param state\n     * @param tree\n     */\n    [mutations.SET_TREE](state: State, tree: Tree | null) {\n      if (tree == null) {\n        state.tree = null;\n        state.nodeRecord = {};\n        state.mapNodeLayers = [];\n        return;\n      }\n      state.tree = tree;\n\n      // traverse tree and fill in nodeRecord\n      state.nodeRecord = treeToNodeRecord(tree);\n\n      // fill state.mapNodeLayers\n      const [ls, err] = treeToMapNodeLayers(tree, ROOT_BORDER, ROOT_CENTER);\n      if (ls == null || err != null) {\n        console.error(err);\n        return;\n      }\n      state.mapNodeLayers = ls;\n    },\n\n    /**\n     * UPDATE_NODE_POSITION\n     * @param state\n     * @param v\n     */\n    [mutations.UPDATE_NODE_POSITION](\n      state: State,\n      v: {\n        nodeId: string;\n        newCenter: Point;\n        returnError: ErrorKV; // still waiting for vuex to implement mutation return values https://github.com/vuejs/vuex/issues/1437\n      }\n    ) {\n      // check that new position is inside parent borders\n      const parent = state.nodeRecord[v.nodeId].parent;\n      if (parent !== null) {\n        const [parentMapNode] = findMapNode(parent.id, state.mapNodeLayers);\n        if (!parentMapNode) {\n          v.returnError = NewErrorKV(\n            \"UPDATE_NODE_POSITION: cannot find parent mapNode\",\n            {\n              \"parent.id\": parent.id,\n              \"state.mapNodeLayers\": state.mapNodeLayers\n            }\n          );\n          return;\n        }\n\n        if (!isInside(v.newCenter, parentMapNode.border)) {\n          v.returnError = NewErrorKV(\"!isInside\", {\n            newCenter: v.newCenter,\n            \"parentMapNode.border\": parentMapNode.border\n          });\n          return;\n        }\n      }\n\n      v.returnError = updatePosition(state, {\n        nodeId: v.nodeId,\n        position: v.newCenter\n      });\n    }\n  }\n};\n","import { Point } from \"@/types/graphics\";\n\nexport const mutations = {\n  ADD_CUT_PASTE: \"ADD_CUT_PASTE\",\n  ADD_CREATE: \"ADD_CREATE\",\n  ADD_REMOVE: \"ADD_REMOVE\",\n  ADD_POSITION_CHANGE: \"ADD_POSITION_CHANGE\"\n};\n\nenum changeTypeEnum {\n  CUT_PASTE = \"CUT_PASTE\",\n  CREATE = \"CREATE\",\n  REMOVE = \"REMOVE\",\n  POSITION_CHANGE = \"POSITION_CHANGE\"\n}\n\nconst changeTypes = {\n  CUT_PASTE: \"CUT_PASTE\" as changeTypeEnum.CUT_PASTE,\n  CREATE: \"CREATE\" as changeTypeEnum.CREATE,\n  REMOVE: \"REMOVE\" as changeTypeEnum.REMOVE,\n  POSITION_CHANGE: \"POSITION_CHANGE\" as changeTypeEnum.POSITION_CHANGE\n};\n\nexport interface CHCutPaste {\n  nodeID: string; // object of change\n  oldParentID: string; // old parent\n  newParentID: string; // new parent\n}\n\nexport interface CHCreate {\n  nodeID: string; // object of change\n  parentID: string; // new parent\n}\n\nexport interface CHRemove {\n  nodeID: string; // object of change\n  parentID: string; // parent where object sits (we need it to revert this event)\n}\n\nexport interface CHPositionChange {\n  nodeID: string; // object of change\n  oldPosition: Point; // old position (we need it to revert this event)\n  newPosition: Point; // new position\n}\n\nexport type TreeChangeList = Record<\n  string,\n  {\n    [changeTypeEnum.CUT_PASTE]?: CHCutPaste;\n    [changeTypeEnum.CREATE]?: CHCreate;\n    [changeTypeEnum.REMOVE]?: CHRemove;\n    [changeTypeEnum.POSITION_CHANGE]?: CHPositionChange;\n  }\n>;\n\nexport interface State {\n  // список изменений который отличает текущую мастер ветку\n  // от того мастера с которого мы начали локальные изменения\n  stableChangeList: TreeChangeList;\n  // список локальных изменений\n  localChangeList: TreeChangeList;\n}\n\nexport const store = {\n  namespaced: true,\n  state: {\n    stableChangeList: {},\n    localChangeList: {}\n  },\n  mutations: {\n    [mutations.ADD_CUT_PASTE](state: State, change: CHCutPaste) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      if (state.localChangeList[change.nodeID][changeTypes.CREATE]) {\n        // if user ADDed then MOVEd node then it is simply addition to CUT_PASTE newParentID\n        state.localChangeList[change.nodeID][changeTypes.CREATE]!.parentID =\n          change.newParentID;\n      } else {\n        state.localChangeList[change.nodeID][changeTypes.CUT_PASTE] = change;\n      }\n    },\n    [mutations.ADD_CREATE](state: State, change: CHCreate) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      state.localChangeList[change.nodeID][changeTypes.CREATE] = change;\n    },\n    [mutations.ADD_REMOVE](state: State, change: CHRemove) {\n      // clear changelist for this node because REMOVE vanishes them anyway\n      state.localChangeList[change.nodeID] = {};\n      state.localChangeList[change.nodeID][changeTypes.REMOVE] = change;\n    },\n    [mutations.ADD_POSITION_CHANGE](state: State, change: CHPositionChange) {\n      if (!state.localChangeList[change.nodeID]) {\n        state.localChangeList[change.nodeID] = {};\n      }\n      let firstOldPosition = change.oldPosition;\n      if (state.localChangeList[change.nodeID][changeTypes.POSITION_CHANGE]) {\n        firstOldPosition = state.localChangeList[change.nodeID][\n          changeTypes.POSITION_CHANGE\n        ]!.oldPosition;\n      }\n      state.localChangeList[change.nodeID][changeTypes.POSITION_CHANGE] = {\n        nodeID: change.nodeID,\n        oldPosition: firstOldPosition,\n        newPosition: change.newPosition\n      };\n    }\n  },\n  actions: {}\n};\n","import { Point, Vector } from \"@/types/graphics\";\nimport { addVector, vectorOnNumber } from \"@/tools/graphics\";\nimport { debounce } from \"lodash\";\n\nexport interface State {\n  zoom: number;\n  zoomCenter: Point;\n  pan: Point;\n  debouncedZoom: number;\n  debouncedPan: Point;\n}\n\nexport const mutations = {\n  ADD_ZOOM: \"ADD_ZOOM\",\n  ADD_PAN: \"ADD_PAN\",\n  SET_PAN: \"SET_PAN\",\n  SET_ZOOM_CENTER: \"SET_ZOOM_CENTER\"\n};\n\nconst zoomDebounce = debounce((state, value: number) => {\n  state.debouncedZoom = value;\n}, 100);\n\nconst panDebounce = debounce((state, value: Point) => {\n  state.debouncedPan = value;\n}, 100);\n\nconst ZOOM_SENSITIVITY = 1 / 500;\nconst PAN_SENSITIVITY = 1;\n\nexport const store = {\n  namespaced: true,\n  state: {\n    zoom: 1,\n    pan: { x: 0, y: 0 },\n    debouncedZoom: 1,\n    debouncedPan: { x: 0, y: 0 },\n    zoomCenter: { x: 0, y: 0 }\n  },\n  mutations: {\n    [mutations.SET_ZOOM_CENTER](state: State, center: Point) {\n      state.zoomCenter = center;\n    },\n    [mutations.ADD_ZOOM](state: State, delta: number) {\n      const newZoom = state.zoom * Math.pow(2, delta * ZOOM_SENSITIVITY);\n      if (newZoom < 0.5) {\n        // foolproof from too much zoom\n        return;\n      }\n      state.zoom = newZoom;\n      zoomDebounce(state, state.zoom);\n    },\n    [mutations.ADD_PAN](state: State, delta: Vector) {\n      state.pan = addVector(\n        { from: { x: 0, y: 0 }, to: state.pan },\n        vectorOnNumber(delta, PAN_SENSITIVITY)\n      ).to;\n      panDebounce(state, state.pan);\n    },\n    [mutations.SET_PAN](state: State, point: Point) {\n      state.pan = point;\n      panDebounce(state, state.pan);\n    }\n  }\n};\n","import firebase from \"firebase/compat\";\nimport { Commit } from \"vuex\";\n\nexport interface State {\n  user: firebase.User | null;\n}\n\nexport const mutations = {\n  SET_USER: \"SET_USER\"\n};\nexport const actions = {\n  signIn: \"signIn\",\n  signOut: \"signOut\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    user: null\n  },\n  mutations: {\n    [mutations.SET_USER](state: State, user: firebase.User) {\n      state.user = user;\n    }\n  },\n  actions: {\n    async [actions.signIn]({ commit }: { commit: Commit }) {\n      await firebase\n        .auth()\n        .signInWithPopup(new firebase.auth.GoogleAuthProvider());\n    },\n\n    async [actions.signOut]({ commit }: { commit: Commit }) {\n      await firebase.auth().signOut();\n      commit(mutations.SET_USER, null);\n    }\n  }\n};\n","export interface State {\n  nodeIDs: string[];\n}\n\nexport const mutations = {\n  SET_NODE_IDS: \"SET_NODE_IDS\"\n};\n\nexport const store = {\n  namespaced: true,\n  state: {\n    nodeIDs: []\n  },\n  mutations: {\n    [mutations.SET_NODE_IDS](state: State, nodeIDs: Array<string>) {\n      // show only first 20 results\n      if (nodeIDs.length > 20) {\n        // TODO: show notification that only first 20 results are shown\n        state.nodeIDs = nodeIDs.slice(0, 20);\n      } else {\n        state.nodeIDs = nodeIDs;\n      }\n    }\n  }\n};\n","import {\n  Commit,\n  createStore,\n  Dispatch,\n  Store,\n  useStore as baseUseStore\n} from \"vuex\";\nimport { InjectionKey } from \"vue\";\n\nimport { store as pinStore, State as PinState } from \"./pin\";\n\nimport { store as titleBoxStore, State as TitleBoxState } from \"./title_box\";\n\nimport {\n  store as preconditionStore,\n  State as PreconditionState\n} from \"./precondition\";\n\nimport {\n  store as imageStore,\n  State as ImageState\n} from \"./image\";\n\nimport {\n  store as positionChangePermitsStore,\n  State as positionChangePermitsState\n} from \"./position_change_permits\";\n\nimport {\n  store as treeStore,\n  State as TreeState,\n  mutations as treeMutations\n} from \"./tree\";\n\nimport { store as zoomPanStore, State as ZoomPanState } from \"./zoom_pan\";\n\nimport {\n  store as userStore,\n  State as UserState,\n  mutations as userMutations,\n  actions as userActions\n} from \"./user\";\n\nimport {\n  store as historyStore,\n  State as HistoryState,\n  mutations as historyMutations\n} from \"./history\";\n\nimport {\n  store as nodeContentStore,\n  State as NodeContentState\n} from \"./node_content\";\n\nimport {\n  store as searchResultStore,\n  State as SearchResultState\n} from \"./search_result\";\n\nimport api from \"@/api/api\";\nimport { initData } from \"./helpers\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport {\n  createNewNode,\n  findMapNode,\n  getNewNodeCenter\n} from \"@/store/tree/helpers\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { addVector, convertPosition } from \"@/tools/graphics\";\nimport { debounce } from \"lodash\";\nimport { printError } from \"@/tools/utils\";\nimport firebase from \"firebase/compat\";\n\nexport type State = {\n  // root states\n  editModeOn: boolean;\n\n  // module states\n  titleBox: TitleBoxState;\n  pin: PinState;\n  image: ImageState;\n  precondition: PreconditionState;\n  positionChangePermits: positionChangePermitsState;\n  tree: TreeState;\n  user: UserState;\n  zoomPan: ZoomPanState;\n  history: HistoryState;\n  nodeContent: NodeContentState;\n  searchResult: SearchResultState;\n};\n\nexport const actions = {\n  init: \"init\",\n  updateNodePosition: \"updateNodePosition\",\n  createNode: \"createNode\",\n  cutPasteNode: \"cutPasteNode\",\n  removeNode: \"removeNode\",\n  setEditMode: \"setEditMode\",\n\n  // confirmSignInPopup\n  confirmSignInPopup: \"confirmSignInPopup\"\n};\n\nexport const mutations = {\n  SET_EDIT_MODE: \"SET_EDIT_MODE\",\n};\n\nconst debouncedPositionSet = debounce(\n  (\n    nodeID: string,\n    newCenter: Point,\n    parentID: string,\n    mapNodeLayers: Record<string, MapNode>[]\n  ) => {\n    const [normalizedNewNodeCenter] = convertPosition(\n      \"normalize\",\n      newCenter,\n      parentID,\n      mapNodeLayers\n    );\n\n    api.update({ [`map/${nodeID}/position`]: normalizedNewNodeCenter });\n  },\n  200\n);\n\nexport const key: InjectionKey<Store<State>> = Symbol();\n\nexport const store = createStore<State>({\n  state: {\n    editModeOn: false,\n  } as State,\n  mutations: {\n    [mutations.SET_EDIT_MODE](state: State, val: boolean) {\n      state.editModeOn = val;\n    },\n  },\n  actions: {\n    /**\n     * confirmSignInPopup\n     * @param commit\n     * @param val\n     */\n    async [actions.confirmSignInPopup](\n      { dispatch }: { dispatch: Dispatch; state: State },\n      val: {confirm:  {\n        require(args: {\n          message?: string;\n          target?: EventTarget;\n          group?: string;\n          icon?: string;\n          header?: string;\n          accept?: () => void;\n          reject?: () => void;\n          acceptLabel?: string;\n          rejectLabel?: string;\n          acceptIcon?: string;\n          rejectIcon?: string;\n          blockScroll?: boolean;\n          acceptClass?: string;\n          rejectClass?: string;\n        }): void;\n\n        close(): void;\n      },\n      message: string,\n      }\n    ) {\n      val.confirm.require({\n        message: val.message,\n        header: \"SignIn\",\n        acceptLabel: \"Ok, Sign In\",\n        rejectLabel: \"No, thanks, just watching\",\n        accept: async () => {\n          await dispatch(`user/${userActions.signIn}`);\n        },\n        reject: () => {\n          return;\n        }\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param val\n     */\n    [actions.setEditMode](\n      { commit }: { commit: Commit; state: State },\n      val: boolean\n    ) {\n      commit(mutations.SET_EDIT_MODE, val);\n    },\n\n    /**\n     *\n     * @param commit\n     */\n    async [actions.init]({ commit }: { commit: Commit }) {\n      api.initFirebase();\n      firebase.auth().onAuthStateChanged(user => {\n        if (user && !user.isAnonymous) {\n          api.setPublicUserData(user.uid, user.displayName, null);\n          commit(`user/${userMutations.SET_USER}`, user);\n          initData(user);\n        } else {\n          commit(`user/${userMutations.SET_USER}`, null);\n          initData(null);\n        }\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.createNode](\n      { commit, state }: { commit: Commit; state: State },\n      v: {\n        parentID: string;\n        title: string;\n      }\n    ) {\n      const parent = state.tree.nodeRecord[v.parentID].node;\n      const [newCenter, changedNode, err1] = getNewNodeCenter(\n        parent,\n        state.tree.mapNodeLayers,\n        true\n      );\n      if (err1 !== null) {\n        printError(\"Cannot create new center\", {\n          err: err1,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n\n      const [normalizedPosition, err2] = convertPosition(\n        \"normalize\",\n        newCenter!,\n        v.parentID,\n        state.tree.mapNodeLayers\n      );\n      if (err2) {\n        printError(\"createNode: cannot create new center\", {\n          err: err2,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n      const node = createNewNode(v.title, normalizedPosition!);\n      const newDBNode = {\n        id: node.id,\n        parentID: v.parentID,\n        name: v.title,\n        children: [],\n        position: normalizedPosition\n      };\n      const newKey = api.generateKey();\n      const updateMap: Record<string, any> = {\n        [`map/${newDBNode.id}`]: newDBNode,\n        [`map/${newDBNode.parentID}/children/${newKey}`]: newDBNode.id\n      };\n\n      if (changedNode) {\n        const [normalizedChangedCenter] = convertPosition(\n          \"normalize\",\n          changedNode.position,\n          v.parentID,\n          state.tree.mapNodeLayers\n        );\n        updateMap[`map/${changedNode.id}/position`] = normalizedChangedCenter;\n      }\n\n      await api.update(updateMap);\n\n      commit(`history/${historyMutations.ADD_CREATE}`, {\n        nodeID: node.id,\n        parentID: v.parentID\n      });\n\n      return node.id;\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    async [actions.cutPasteNode](\n      { commit, state }: { commit: Commit; state: State },\n      v: {\n        nodeID: string;\n        parentID: string;\n      }\n    ) {\n      // remove nodeID from oldParent children,\n      // add to newParent children,\n      // recalculate position of node, normalize it and\n      // update DB with these three modifications in one transaction\n      const oldParent = state.tree.nodeRecord[v.nodeID].parent;\n      const newParent = state.tree.nodeRecord[v.parentID].node;\n      const [newCenter, changedNode, err1] = getNewNodeCenter(\n        newParent,\n        state.tree.mapNodeLayers,\n        true\n      );\n      if (err1) {\n        printError(\"cutPasteNode: cannot getNewNodeCenter\", { err: err1 });\n        return;\n      }\n      const [normalizedNewNodeCenter, err2] = convertPosition(\n        \"normalize\",\n        newCenter!,\n        v.parentID,\n        state.tree.mapNodeLayers\n      );\n      if (err2) {\n        printError(\"cutPasteNode: cannot create new center\", {\n          err: err2,\n          parent,\n          \"state.tree.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n        return;\n      }\n      // generate key for new child in list of newParent\n      const newKey = api.generateKey();\n      // search for key of childID in children of oldParent\n      const oldKey = await api.findKeyOfChild(oldParent!.id, v.nodeID);\n      const updateMap = {\n        [`map/${v.nodeID}/parentID`]: newParent!.id,\n        [`map/${oldParent!.id}/children/${oldKey}`]: null, // remove from old parent children\n        [`map/${newParent!.id}/children/${newKey}`]: v.nodeID, // add to children of new parents\n        [`map/${v.nodeID}/position`]: normalizedNewNodeCenter\n      };\n      if (changedNode) {\n        const [normalizedChangedCenter] = convertPosition(\n          \"normalize\",\n          changedNode.position,\n          v.parentID,\n          state.tree.mapNodeLayers\n        );\n        updateMap[`map/${changedNode.id}/position`] = normalizedChangedCenter;\n      }\n      await api.update(updateMap);\n\n      commit(`history/${historyMutations.ADD_CUT_PASTE}`, {\n        nodeID: v.nodeID,\n        parentID: v.parentID\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param nodeID\n     */\n    async [actions.removeNode](\n      { commit, state }: { commit: Commit; state: State },\n      nodeID: string\n    ) {\n      const parent = state.tree.nodeRecord[nodeID].parent;\n      if (!parent) {\n        return;\n      }\n\n      // do main actions on backend (see functions/cmd_remove.js)\n      await api.update({ [`cmd/remove`]: nodeID });\n\n      commit(`history/${historyMutations.ADD_REMOVE}`, {\n        parentNodeID: parent.id,\n        nodeID: nodeID\n      });\n    },\n\n    /**\n     *\n     * @param commit\n     * @param state\n     * @param v\n     */\n    [actions.updateNodePosition](\n      { commit, state }: { commit: Commit; state: State },\n      v: { nodeId: string; delta: Point }\n    ) {\n      if (!state.editModeOn) {\n        return;\n      }\n      const [mapNode] = findMapNode(v.nodeId, state.tree.mapNodeLayers);\n      if (!mapNode) {\n        return NewErrorKV(\"UPDATE_NODE_POSITION: cannot find mapNode\", {\n          \"v.nodeId\": v.nodeId,\n          \"state.mapNodeLayers\": state.tree.mapNodeLayers\n        });\n      }\n      const newCenter = addVector(\n        { from: { x: 0, y: 0 }, to: mapNode.center },\n        { from: { x: 0, y: 0 }, to: v.delta }\n      ).to;\n\n      const args = { nodeId: v.nodeId, newCenter, returnError: null };\n      commit(`tree/${treeMutations.UPDATE_NODE_POSITION}`, args);\n      if (args.returnError === null) {\n        commit(`history/${historyMutations.ADD_POSITION_CHANGE}`, {\n          nodeID: v.nodeId,\n          oldPosition: mapNode.center,\n          newPosition: newCenter\n        });\n\n        // save to DB with debounce\n        debouncedPositionSet(\n          v.nodeId,\n          newCenter,\n          state.tree.nodeRecord[v.nodeId].parent!.id,\n          state.tree.mapNodeLayers\n        );\n      }\n    }\n  },\n  modules: {\n    pin: pinStore,\n    titleBox: titleBoxStore,\n    image: imageStore,\n    precondition: preconditionStore,\n    positionChangePermits: positionChangePermitsStore,\n    tree: treeStore,\n    user: userStore,\n    zoomPan: zoomPanStore,\n    history: historyStore,\n    nodeContent: nodeContentStore,\n    searchResult: searchResultStore\n  }\n});\n\n// define your own `useStore` composition function\nexport function useStore() {\n  return baseUseStore(key);\n}\n","\nimport { defineComponent } from \"vue\";\nimport { useStore, actions } from \"@/store\";\nexport default defineComponent({\n  setup() {\n    const store = useStore();\n    store.dispatch(actions.init);\n  }\n});\n","import { render } from \"./App.vue?vue&type=template&id=8c892ede\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  This section is just for test/emulator cases for now\n  <input id=\"email\" />\n  <input id=\"password\" />\n  <button @click=\"login\">login</button>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport api from \"@/api/api\";\nimport { mutations } from \"@/store/user\";\nimport firebase from \"firebase/compat\";\nimport { useStore } from \"@/store\";\n\nexport default defineComponent({\n  name: \"PasswordLogin\",\n\n  setup() {\n    const store = useStore();\n\n    return {\n      login: async () => {\n        const emailEl = document.getElementById(\"email\") as HTMLInputElement;\n        const passwordEl = document.getElementById(\n          \"password\"\n        ) as HTMLInputElement;\n        await firebase\n          .auth()\n          .signInWithEmailAndPassword(emailEl.value, passwordEl.value);\n      }\n    };\n  }\n});\n</script>\n","\nimport { defineComponent } from \"vue\";\nimport api from \"@/api/api\";\nimport { mutations } from \"@/store/user\";\nimport firebase from \"firebase/compat\";\nimport { useStore } from \"@/store\";\n\nexport default defineComponent({\n  name: \"PasswordLogin\",\n\n  setup() {\n    const store = useStore();\n\n    return {\n      login: async () => {\n        const emailEl = document.getElementById(\"email\") as HTMLInputElement;\n        const passwordEl = document.getElementById(\n          \"password\"\n        ) as HTMLInputElement;\n        await firebase\n          .auth()\n          .signInWithEmailAndPassword(emailEl.value, passwordEl.value);\n      }\n    };\n  }\n});\n","import { render } from \"./PasswordLogin.vue?vue&type=template&id=63c7a1a8\"\nimport script from \"./PasswordLogin.vue?vue&type=script&lang=ts\"\nexport * from \"./PasswordLogin.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <ConfirmDialog></ConfirmDialog>\n  <Toast position=\"bottom-left\">\n    <template #icon=\"slotProps\">\n      <div class=\"p-toast-message-icon\">\n        <span :class=\"slotProps.class\"></span>\n      </div>\n    </template>\n    <template #message=\"slotProps\">\n      <div class=\"p-toast-message-text\">\n        <span class=\"p-toast-summary\">{{slotProps.message.summary}}</span>\n        <div class=\"p-toast-detail\" v-html=\"slotProps.message.detail\" />\n      </div>\n    </template>\n  </Toast>\n  <NodeContent\n    :clickedTitleId=\"clickedTitleId\"\n    @select-precondition-is-on=\"setSelectPreconditionON\"\n    @select-precondition-is-off=\"setSelectPreconditionOFF\"\n    :show=\"!editModeOn\"\n    :selectedNodeId=\"selectedNodeId\"\n  />\n  <Menu />\n  <Map\n    :layers=\"visibleZoomedPanedLayers\"\n    :selectedNodeId=\"selectedNodeId\"\n    :selectedNodePreconditionIds=\"selectedNodePreconditionIds\"\n    :pin-nodes=\"pinNodes\"\n    :searchResultPinNodes=\"searchResultPinNodes\"\n    :searchResultNodeIDs=\"searchResultNodeIDs\"\n    @title-dragging=\"nodeDragging\"\n    @title-click=\"titleClick\"\n    @title-over=\"titleOver\"\n    @title-leave=\"titleLeave\"\n    @dragging-background=\"mapDragging\"\n    @wheel=\"zoom\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref, watch } from \"vue\";\nimport Map from \"@/components/map/Map.vue\";\nimport NodeContent from \"@/components/node_content/Index.vue\";\nimport ConfirmDialog from \"primevue/confirmdialog\";\nimport Toast from \"primevue/toast\";\nimport {\n  EventClickNode,\n  EventDraggingBackground,\n  EventDraggingNode,\n  EventWheel\n} from \"@/components/map/Map\";\nimport Menu from \"@/components/menu/Index.vue\";\nimport { useStore } from \"@/store\";\nimport { useRouter, useRoute, onBeforeRouteUpdate } from \"vue-router\";\nimport { mutations as treeMutations, NodeRecordItem } from \"@/store/tree\";\nimport { mutations as zoomPanMutations } from \"@/store/zoom_pan\";\nimport { actions } from \"@/store/\";\nimport {\n  filterNodesAndLayers,\n  findCentralNode,\n  zoomAndPanPoint,\n  zoomAnPanLayers\n} from \"@/views/Home\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { actions as positionChangePermitsActions } from \"@/store/position_change_permits\";\n\nexport default defineComponent({\n  name: \"Home\",\n\n  components: {\n    Map,\n    Menu,\n    NodeContent,\n    ConfirmDialog,\n    Toast\n  },\n\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const route = useRoute();\n    const treeState = store.state.tree;\n    const zoomPanState = store.state.zoomPan;\n    const pinState = store.state.pin;\n    const searchResultState = store.state.searchResult;\n    const clickedTitleId = ref(\"-1\");\n    let selectPreconditionIsOn = false;\n    let titleOver = false;\n\n    // Set node from URL as selected\n    watch(\n      () => route.params.id,\n      () => {\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      { immediate: true }\n    );\n\n    /**\n     * From mapNodeLayers method updateLayers determines visibleLayers and nodes\n     * that will be shown to user (which is always just a small part of all nodes of the map)\n     * @param centralNodeId\n     * @param mapNodeLayers\n     * @param nodeRecord\n     */\n    const updateLayers = (\n      centralNodeId: string,\n      mapNodeLayers: Array<Record<string, MapNode>>,\n      nodeRecord: Record<string, NodeRecordItem>\n    ): Array<Record<number, MapNode>> => {\n      // Вычленяем слои и узлы которые мы хотим показывать учитывая что текущий видимый узел это centralNodeId\n      const [filteredLayers, err] = filterNodesAndLayers(\n        mapNodeLayers,\n        nodeRecord,\n        centralNodeId\n      );\n      if (err) {\n        printError(\"Home.vue: error in filterNodesAndLayers:\", { err });\n        return [];\n      }\n      return filteredLayers.reverse();\n    };\n\n    const centralNodeId = ref<string | null>(null);\n    // visibleLayers consists only from user visible nodes and visibleLayers of all (which is treeState.mapNodeLayers)\n    const visibleLayers = ref<Array<Record<string, MapNode>>>([]);\n\n    // Ugly hack to determine first load of page\n    let isFirstPageLoad = true;\n    onBeforeRouteUpdate(async (to, from) => {\n      isFirstPageLoad = false;\n    });\n    // If this is isFirstPageLoad then pan map to node in URL\n    watch(\n      () => [treeState.mapNodeLayers],\n      () => {\n        if (\n          isFirstPageLoad &&\n          route.params.id.length > 0 &&\n          treeState.mapNodeLayers.length > 0\n        ) {\n          const [firstNode] = findMapNode(\n            route.params.id as string,\n            treeState.mapNodeLayers\n          );\n          if (firstNode != null) {\n            store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n              x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n              y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n            });\n          }\n        }\n      }\n    );\n\n    // Determine which nodes to show based on current pan and zoom\n    watch(\n      () => [\n        treeState.mapNodeLayers,\n        zoomPanState.debouncedZoom,\n        zoomPanState.debouncedPan\n      ],\n      () => {\n        const [newCentralNodeId, err] = findCentralNode(\n          treeState.mapNodeLayers,\n          treeState.nodeRecord,\n          { width: window.innerWidth, height: window.innerHeight },\n          zoomPanState.debouncedZoom,\n          zoomPanState.pan,\n          zoomPanState.zoomCenter\n        );\n        if (err != null) {\n          printError(\"filterNodesAndLayers: error in findCurrentNode\", { err });\n        }\n\n        centralNodeId.value = newCentralNodeId;\n        visibleLayers.value = updateLayers(\n          newCentralNodeId,\n          treeState.mapNodeLayers,\n          treeState.nodeRecord\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    const visibleZoomedPanedLayers = ref<Array<Record<string, MapNode>>>([]);\n    watch(\n      () => [\n        zoomPanState.pan.x,\n        zoomPanState.pan.y,\n        zoomPanState.zoom,\n        visibleLayers\n      ],\n      () => {\n        // visibleLayers это всегда слои с zoom=1 и pan={0, 0} состоящий из только видимых прямо сейчас элементов.\n        // Мы применяем к этому объекту текущий zoomPanState но сам эталон не трогаем, поэтому здесь clone\n        // Это не дорогая операция так как visibleLayers всегда содержит небольшое кол-во элементов\n        // видимых только прямо сейчас\n        const layersToZoomAndPan = clone(visibleLayers.value);\n        visibleZoomedPanedLayers.value = zoomAnPanLayers(\n          layersToZoomAndPan,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      /**\n       * pinNodes\n       */\n      pinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const pinNodeIDs = pinState.pinsReverse[centralNodeId.value];\n        if (!pinNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = pinNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                pinNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const pinMapNodes = findMapNodes(pinNodeIDs, treeState.mapNodeLayers);\n        const result = [];\n        for (const pinMapNode of pinMapNodes) {\n          const cl = clone(pinMapNode);\n          cl.center = zoomAndPanPoint(\n            pinMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      /**\n       * searchResultNodeIDs\n       */\n      searchResultNodeIDs: computed(() => {\n        return searchResultState.nodeIDs;\n      }),\n\n      /**\n       * searchResultPinNodes\n       */\n      searchResultPinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const searchResultNodeIDs = clone(searchResultState.nodeIDs);\n        if (!searchResultNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = searchResultNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                searchResultNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const searchResultMapNodes = findMapNodes(\n          searchResultNodeIDs,\n          treeState.mapNodeLayers\n        );\n        const result = [];\n        for (const searchResultMapNode of searchResultMapNodes) {\n          const cl = clone(searchResultMapNode);\n          cl.center = zoomAndPanPoint(\n            searchResultMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNodeId: computed(() => treeState.selectedNodeId),\n      selectedNodePreconditionIds: computed(() =>\n        treeState.selectedNodeId\n          ? store.state.precondition.preconditions[treeState.selectedNodeId]\n          : []\n      ),\n      visibleZoomedPanedLayers: visibleZoomedPanedLayers,\n      nodeDragging: async (e: EventDraggingNode) => {\n        const hasDragPermit = await store.dispatch(\n          `positionChangePermits/${positionChangePermitsActions.CheckNodeID}`,\n          e.id\n        );\n        if (!hasDragPermit) {\n          return;\n        }\n        await store.dispatch(`${actions.updateNodePosition}`, {\n          nodeId: e.id,\n          delta: {\n            x: e.delta.x / zoomPanState.zoom,\n            y: e.delta.y / zoomPanState.zoom\n          }\n        });\n      },\n      setSelectPreconditionON: () => {\n        selectPreconditionIsOn = true;\n      },\n      setSelectPreconditionOFF: () => {\n        selectPreconditionIsOn = false;\n      },\n      clickedTitleId,\n      titleClick: (e: EventClickNode) => {\n        if (!selectPreconditionIsOn) {\n          router.push({ name: \"node\", params: { id: e.id } });\n        } else {\n          clickedTitleId.value = e.id;\n        }\n      },\n      titleOver: (e: EventClickNode) => {\n        titleOver = true;\n        store.commit(`tree/${treeMutations.SET_SELECTED_NODE_ID}`, e.id);\n      },\n      titleLeave: (e: EventClickNode) => {\n        titleOver = false;\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      mapDragging: (event: EventDraggingBackground) => {\n        if (store.state.editModeOn && titleOver) {\n          // to prevent pan while node position editing ( = title dragging in edit mode)\n          return;\n        }\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, event);\n      },\n      zoom: (event: EventWheel) => {\n        // initial value of center (when root.border == viewport)\n        const initial = {\n          x: (event.center.x - zoomPanState.pan.x) / zoomPanState.zoom,\n          y: (event.center.y - zoomPanState.pan.y) / zoomPanState.zoom\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_ZOOM}`, -1 * event.delta);\n        const after = {\n          x: initial.x * zoomPanState.zoom + zoomPanState.pan.x,\n          y: initial.y * zoomPanState.zoom + zoomPanState.pan.y\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, {\n          from: after,\n          to: event.center\n        });\n        store.commit(\n          `zoomPan/${zoomPanMutations.SET_ZOOM_CENTER}`,\n          event.center\n        );\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    :width=\"svgWidth\"\n    :height=\"svgHeight\"\n    :id=\"mapID\"\n    style=\"touch-action: none;\"\n  >\n    <MapLayer\n      v-for=\"(layer, index) of layers\"\n      :key=\"index\"\n      :layer-id=\"index\"\n      :map-nodes=\"layer\"\n      :border-color=\"borderColor(index)\"\n      :font-color=\"fontColor(index)\"\n      :font-size=\"fontSize(index)\"\n      :font-opacity=\"fontOpacity(index)\"\n      :selectedNodeId=\"selectedNodeId\"\n      :selectedNodePreconditionIds=\"selectedNodePreconditionIds\"\n      :searchResultNodeIDs=\"searchResultNodeIDs\"\n      :map-id=\"mapID\"\n      @title-dragging=\"draggingNode\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PreconditionLayer\n      :selectedNodeId=\"selectedNodeId\"\n      :visibleTitleIds=\"visibleTitleIds\"\n      :layer-id=\"`precondition`\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PinLayer\n      :pinNodes=\"pinNodes\"\n      :layer-id=\"`pinNodes`\"\n      color=\"pink\"\n      :font-size=\"8\"\n      font-weight=\"normal\"\n      text-decoration=\"none\"\n      :selectedNodeId=\"selectedNodeId\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n    <PinLayer\n      :pinNodes=\"searchResultPinNodes\"\n      :layer-id=\"`searchResultPinNodes`\"\n      color=\"red\"\n      :font-size=\"10\"\n      font-weight=\"bold\"\n      text-decoration=\"underline\"\n      :selectedNodeId=\"selectedNodeId\"\n      @title-click=\"titleClick\"\n      @title-over=\"titleOver\"\n      @title-leave=\"titleLeave\"\n    />\n  </svg>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, PropType } from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport MapLayer from \"@/components/map_layer/MapLayer.vue\";\nimport {\n  EventClickNode,\n  EventDraggingNode\n} from \"@/components/map_layer/MapLayer\";\nimport pan from \"./MapPan\";\nimport PinLayer from \"@/components/pin_layer/PinLayer.vue\";\nimport { printError } from \"@/tools/utils\";\nimport PreconditionLayer from \"@/components/precondition_layer/PreconditionLayer.vue\";\n\nconst mapID = \"mapID\";\n\nexport default defineComponent({\n  name: \"Map\",\n  emits: [\n    \"title-dragging\",\n    \"title-click\",\n    \"title-over\",\n    \"title-leave\",\n    \"dragging-background\",\n    \"wheel\"\n  ],\n  components: {\n    PreconditionLayer,\n    PinLayer,\n    MapLayer\n  },\n  props: {\n    layers: Object as PropType<Array<Record<string, MapNode>>>,\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    pinNodes: Object as PropType<MapNode[]>,\n    searchResultPinNodes: Object as PropType<MapNode[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n  setup(props, ctx) {\n    onMounted(() => {\n      const map = document.getElementById(mapID);\n      if (!map) {\n        printError(\"Map.vue: cannot find map id for event listener\", {});\n        return;\n      }\n\n      map.addEventListener(\"mousedown\", event => {\n        pan.mouseDown();\n      });\n      map.addEventListener(\"mouseup\", event => {\n        pan.mouseUp();\n      });\n      map.addEventListener(\"mousemove\", event => {\n        pan.mouseMove(ctx.emit, {\n          from: {\n            x: event.clientX - event.movementX,\n            y: event.clientY - event.movementY\n          },\n          to: { x: event.clientX, y: event.clientY }\n        });\n      });\n\n      // zoom with mouse wheel\n      map.addEventListener(\n        \"wheel\",\n        event => {\n          ctx.emit(\"wheel\", {\n            delta: event.deltaY,\n            center: { x: event.clientX, y: event.clientY }\n          });\n        },\n        { passive: true }\n      );\n\n      let prevDist = Infinity;\n      const prevPoint = { x: Infinity, y: Infinity };\n      map.addEventListener(\n        \"touchstart\",\n        event => {\n          pan.mouseDown();\n        },\n        { passive: true }\n      );\n      map.addEventListener(\"touchend\", event => {\n        prevDist = Infinity;\n        prevPoint.x = Infinity;\n        prevPoint.y = Infinity;\n        pan.mouseUp();\n      });\n\n      // mobile zoom\n      map.addEventListener(\n        \"touchmove\",\n        e => {\n          if (e.touches.length === 1) {\n            if (prevPoint.x != Infinity && prevPoint.y != Infinity) {\n              pan.mouseMove(ctx.emit, {\n                from: prevPoint,\n                to: { x: e.touches[0].clientX, y: e.touches[0].clientY }\n              });\n            }\n            prevPoint.x = e.touches[0].clientX;\n            prevPoint.y = e.touches[0].clientY;\n          } else if (e.touches.length === 2) {\n            let delta = 0;\n            const dist = Math.hypot(\n              e.touches[0].pageX - e.touches[1].pageX,\n              e.touches[0].pageY - e.touches[1].pageY\n            );\n            if (prevDist !== Infinity) {\n              delta = prevDist - dist;\n            }\n            prevDist = dist;\n\n            ctx.emit(\"wheel\", {\n              delta: delta,\n              center: {\n                x: (e.touches[0].pageX - e.touches[1].pageX) / 2,\n                y: (e.touches[0].pageY - e.touches[1].pageY) / 2\n              }\n            });\n          }\n        },\n        { passive: true }\n      );\n    });\n\n    return {\n      svgWidth: window.innerWidth,\n      // 0.99 because if svg == innerHeight then browser vertical scroll bar appears\n      svgHeight: 0.99 * window.innerHeight,\n      visibleTitleIds: computed(() => {\n        if (!props.layers) {\n          return [];\n        }\n        const ids = [];\n        for (const layer of props.layers) {\n          for (const idx in layer) {\n            if (layer[idx].title != \"\") {\n              ids.push(idx);\n            }\n          }\n        }\n        return ids;\n      }),\n      draggingNode: (e: EventDraggingNode) => {\n        ctx.emit(\"title-dragging\", {\n          id: e.nodeId,\n          delta: e.delta\n        });\n      },\n      titleClick: (e: EventClickNode) => {\n        ctx.emit(\"title-click\", { id: e.id });\n      },\n      titleOver: (e: EventClickNode) => {\n        ctx.emit(\"title-over\", { id: e.id });\n      },\n      titleLeave: (e: EventClickNode) => {\n        ctx.emit(\"title-leave\", { id: e.id });\n      },\n      mapID: mapID,\n      fontSize: (index: number): number => {\n        let size = 0;\n        const levelSizes: Record<number, number> = {\n          0: 6,\n          1: 11,\n          2: 21,\n          3: 28\n        };\n        if (props.layers!.length >= 4) {\n          size = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          size = levelSizes[index + 1];\n        }\n        return size;\n      },\n      fontOpacity: (index: number): number => {\n        let val = 0;\n        const levelSizes: Record<number, number> = {\n          0: 1,\n          1: 1,\n          2: 0.2,\n          3: 1\n        };\n        if (props.layers!.length >= 4) {\n          val = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          val = levelSizes[index + 1];\n        }\n        return val;\n      },\n      fontColor: (index: number): string => {\n        if (props.layers!.length >= 4) {\n          return `rgb(${200 - 100 * index},${200 - 100 * index},${200 -\n            100 * index})`;\n        }\n        if (props.layers!.length == 3) {\n          return `rgb(${200 - 100 * (index + 1)},${200 -\n            100 * (index + 1)},${200 - 100 * (index + 1)})`;\n        }\n        return \"\";\n      },\n      borderColor: (index: number): string => {\n        let color = 0;\n        const levelColors: Record<number, number> = {\n          0: 240,\n          1: 200,\n          2: 100,\n          3: 90\n        };\n        if (props.layers!.length >= 4) {\n          color = levelColors[index];\n        }\n        if (props.layers!.length == 3) {\n          color = levelColors[index + 1];\n        }\n        return `rgb(${color},${color},${color})`;\n      }\n    };\n  }\n});\n</script>\n\n<style scoped></style>\n","<template>\n  <polygon\n    v-for=\"(mapNode, i) of mapNodes\"\n    :key=\"i\"\n    :stroke=\"borderColor\"\n    :fill=\"polygonFill(selectedNodeId, mapNode.id, selectedNodePreconditionIds)\"\n    :fill-opacity=\"\n      polygonFillOpacity(\n        selectedNodeId,\n        mapNode.id,\n        selectedNodePreconditionIds\n      )\n    \"\n    stroke-width=\"2\"\n    :points=\"polygonToPath(mapNode.border)\"\n    pointer-events=\"none\"\n  />\n  <!--    <circle-->\n  <!--      v-for=\"mapNode of mapNodes\"-->\n  <!--      :key=\"mapNode.id\"-->\n  <!--      :cx=\"mapNode.center.x\"-->\n  <!--      :cy=\"mapNode.center.y\"-->\n  <!--      r=\"10\"-->\n  <!--      stroke=\"black\"-->\n  <!--      stroke-width=\"1\"-->\n  <!--      fill=\"red\"-->\n  <!--    />-->\n  <!--  <SVGTextBox> component shows unpredictable behaviour here and I didn't dig the reason so just used copy of SVGTextBox here -->\n  <text\n    v-for=\"mapNode of mapNodes\"\n    :id=\"`${TITLE_PREFIX}${mapNode.id}`\"\n    :key=\"mapNode.id\"\n    font-family=\"Roboto\"\n    :font-size=\"fontSize\"\n    :font-weight=\"textWeight(mapNode.id, selectedNodeId)\"\n    :fill=\"textColor(mapNode.id, selectedNodeId)\"\n    :fill-opacity=\"fontOpacity\"\n    :text-decoration=\"textDecoration(mapNode.id)\"\n    class=\"text\"\n  >\n    <tspan\n      v-for=\"(line, i) of splitLines(mapNode.title, 20)\"\n      :key=\"i\"\n      :x=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.x : 0\"\n      :y=\"\n        titleBox[mapNode.id]\n          ? titleBox[mapNode.id].position.y + i * fontSize\n          : 0\n      \"\n      alignment-baseline=\"hanging\"\n    >\n      {{ line }}\n    </tspan>\n  </text>\n  <!-- Add rectangle to change cursor to pointer when hover on text -->\n  <rect\n    v-for=\"mapNode of mapNodes\"\n    :key=\"mapNode.id\"\n    :x=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.x : 0\"\n    :y=\"titleBox[mapNode.id] ? titleBox[mapNode.id].position.y : 0\"\n    :width=\"titleBox[mapNode.id] ? titleBox[mapNode.id].bbox.width : 0\"\n    :height=\"titleBox[mapNode.id] ? titleBox[mapNode.id].bbox.height : 0\"\n    fill=\"transparent\"\n    stroke-width=\"0\"\n    @mouseover=\"titleOver(mapNode.id)\"\n    @mouseleave=\"titleLeave(mapNode.id)\"\n    @click=\"titleClick(mapNode.id)\"\n    @mousedown=\"titleMouseDown(mapNode.id)\"\n    stroke=\"pink\"\n    cursor=\"pointer\"\n    pointer-events=\"fill\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport {\n  defineComponent,\n  PropType,\n  toRef,\n  onMounted,\n  onUnmounted,\n  computed\n} from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport {\n  polygonToPath,\n  polygonFill,\n  polygonFillOpacity\n} from \"@/tools/graphics\";\nimport {\n  setTitleBoxes,\n  MouseDownInfo,\n  mouseMoveListener,\n  mouseUpListener\n} from \"@/components/map_layer/MapLayer\";\nimport { printError } from \"@/tools/utils\";\nimport { splitLines } from \"@/components/SVGTextBox\";\nimport { useStore } from \"@/store\";\nimport { TitleBox, mutations as titleBoxMutations } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"title_\";\n\nexport default defineComponent({\n  name: \"MapLayer\",\n  emits: [\n    \"title-over\",\n    \"title-leave\",\n    \"title-click\",\n    \"title-drop\",\n    \"title-dragging\"\n  ],\n  props: {\n    layerId: {\n      type: Number\n    },\n    mapId: {\n      type: String,\n      required: true\n    },\n    mapNodes: {\n      type: Object as PropType<Record<string, MapNode>>,\n      required: true\n    },\n    borderColor: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontColor: {\n      type: String,\n      required: true\n    },\n    fontOpacity: {\n      type: Number,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n\n  setup(props, ctx) {\n    const mapNodes = toRef(props, \"mapNodes\");\n\n    const store = useStore();\n    const layerID = \"map_\" + props.layerId;\n    const titleBox = computed(() => {\n      return store.state.titleBox.layerMap[layerID];\n    });\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"center\",\n      mapNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    /**\n     * Send event on titleBox click, drag and drop\n     */\n    const titleMouseDownInfo: MouseDownInfo = {\n      nodeId: null,\n      dragStart: false\n    };\n    const mouseMove = (event: MouseEvent) =>\n      mouseMoveListener(ctx.emit, event, titleMouseDownInfo);\n    const mouseUp = () => mouseUpListener(ctx.emit, titleMouseDownInfo);\n    onMounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.addEventListener(\"mousemove\", mouseMove);\n      map.addEventListener(\"mouseup\", mouseUp);\n    });\n    onUnmounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.removeEventListener(\"mousemove\", mouseMove);\n      map.removeEventListener(\"mouseup\", mouseUp);\n    });\n\n    const searchResultNodeIDsMap = computed(() => {\n      const map = {} as Record<string, boolean>;\n      if (!props.searchResultNodeIDs) {\n        return map;\n      }\n      for (const id of props.searchResultNodeIDs) {\n        map[id] = true;\n      }\n      return map;\n    });\n\n    return {\n      TITLE_PREFIX,\n      titleBox,\n      textColor: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"#ffa500\";\n        }\n        if (\n          props.selectedNodePreconditionIds &&\n          props.selectedNodePreconditionIds?.indexOf(nodeID) != -1\n        ) {\n          return \"#ffa500\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"red\";\n        }\n\n        return props.fontColor;\n      },\n      textWeight: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"bold\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"bold\";\n        }\n\n        return \"normal\";\n      },\n      textDecoration: (nodeID: string) => {\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"underline\";\n        }\n\n        return \"none\";\n      },\n      titleClick: (nodeID: string) => {\n        ctx.emit(\"title-click\", {\n          id: nodeID\n        });\n      },\n      titleOver: (nodeID: string) => {\n        ctx.emit(\"title-over\", {\n          id: nodeID\n        });\n      },\n      titleLeave: (nodeID: string) => {\n        ctx.emit(\"title-leave\", {\n          id: nodeID\n        });\n      },\n      titleMouseDown: (id: string) => {\n        titleMouseDownInfo.nodeId = id;\n        titleMouseDownInfo.dragStart = false;\n      }\n    };\n  },\n\n  methods: {\n    splitLines,\n    polygonToPath,\n    polygonFill,\n    polygonFillOpacity\n  }\n});\n</script>\n\n<style scoped>\n.text {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n</style>\n","import { MapNode, Point } from \"@/types/graphics\";\nimport { nextTick, Ref, watch } from \"vue\";\n\nexport type EventClickNode = {\n  id: string;\n};\n\nexport type EventDraggingNode = {\n  nodeId: string;\n  delta: Point;\n};\n\nexport type MouseDownInfo = {\n  nodeId: string | null;\n  dragStart: boolean;\n};\n\ntype emitDragging = (\n  event: \"title-dragging\",\n  args: { nodeId: string; delta: Point }\n) => void;\ntype emitDrop = (event: \"title-drop\", args: { id: string }) => void;\n\ntype TitleBox = {\n  position: Point;\n  bbox: {\n    width: number;\n    height: number;\n  };\n};\n\nexport const mouseMoveListener = (\n  emit: emitDragging,\n  event: MouseEvent,\n  mouseDownInfo: MouseDownInfo\n) => {\n  if (mouseDownInfo.nodeId) {\n    mouseDownInfo.dragStart = true;\n    emit(\"title-dragging\", {\n      nodeId: mouseDownInfo.nodeId,\n      delta: {\n        x: event.movementX,\n        y: event.movementY\n      }\n    });\n  }\n};\n\nexport const mouseUpListener = (\n  emit: emitDrop,\n  mouseDownInfo: MouseDownInfo\n) => {\n  if (mouseDownInfo.nodeId) {\n    if (mouseDownInfo.dragStart) {\n      emit(\"title-drop\", { id: mouseDownInfo.nodeId });\n    }\n    mouseDownInfo.dragStart = false;\n    mouseDownInfo.nodeId = null;\n  }\n};\n\nexport const nodeToTitleBox = (\n  nodes: Record<string, MapNode>\n): Record<string, TitleBox> => {\n  const titleBox: Record<string, TitleBox> = {};\n  for (const i in nodes) {\n    const node = nodes[i];\n    titleBox[node.id] = {\n      position: node.center,\n      bbox: {\n        width: 0,\n        height: 0\n      }\n    };\n  }\n\n  return titleBox;\n};\n\nconst updateTitleBox = async (\n  titleIdPrefix: string,\n  position: \"center\" | \"left\",\n  mapNodes: Record<string, MapNode>\n): Promise<Record<string, TitleBox>> => {\n  const titleBox = {} as Record<string, TitleBox>;\n\n  // Code that will run only after the entire view has been rendered\n  await nextTick(() => {\n    // fill new ones\n    for (const i in mapNodes) {\n      const node = mapNodes[i];\n      const dom = document.getElementById(`${titleIdPrefix}${node.id}`);\n      if (dom == null) {\n        continue;\n      }\n      if (position == \"center\") {\n        titleBox[node.id] = {\n          position: {\n            x: node.center.x - dom.getBoundingClientRect().width / 2,\n            y: node.center.y - dom.getBoundingClientRect().height / 2\n          },\n          bbox: {\n            width: dom.getBoundingClientRect().width,\n            height: dom.getBoundingClientRect().height\n          }\n        };\n      } else if (position == \"left\") {\n        titleBox[node.id] = {\n          position: {\n            x: node.center.x - dom.getBoundingClientRect().width,\n            y: node.center.y - dom.getBoundingClientRect().height / 2\n          },\n          bbox: {\n            width: dom.getBoundingClientRect().width,\n            height: dom.getBoundingClientRect().height\n          }\n        };\n      }\n    }\n  });\n\n  return titleBox;\n};\n\nexport const setTitleBoxes = (\n  titleIdPrefix: string,\n  position: \"center\" | \"left\",\n  mapNodes: Ref<Record<string, MapNode>>,\n  cb: (titleBoxMap: Record<string, TitleBox>) => void\n) => {\n  cb(nodeToTitleBox(mapNodes.value));\n  /**\n   * Update titleBox on every prop change after DOM rerender\n   */\n  watch(\n    mapNodes,\n    async mps => {\n      return updateTitleBox(titleIdPrefix, position, mps).then(titleBoxMap =>\n        cb(titleBoxMap)\n      );\n    },\n    {\n      immediate: true\n    }\n  );\n};\n","export function splitLines(text: string, maxCharNum: number): string[] {\n  if (maxCharNum <= 0) {\n    return [];\n  }\n  if (text == \"\") {\n    return [];\n  }\n  const words = text.split(\" \");\n  const lines: string[] = [];\n  let currLine: string[] = [];\n  while (words.length) {\n    if (currLine.join(\" \").length > maxCharNum) {\n      const nextLine: string[] = [];\n      if (currLine.length > 1) {\n        nextLine.push(currLine.pop()!);\n      }\n      lines.push(currLine.join(\" \"));\n      currLine = nextLine;\n    } else {\n      currLine.push(words.shift()!);\n    }\n  }\n\n  if (currLine.join(\" \").length > maxCharNum) {\n    const nextLine: string[] = [];\n    if (currLine.length > 1) {\n      nextLine.push(currLine.pop()!);\n    }\n    lines.push(currLine.join(\" \"));\n    currLine = nextLine;\n  }\n  if (currLine.length) {\n    lines.push(currLine.join(\" \"));\n  }\n  return lines;\n}\n","\nimport {\n  defineComponent,\n  PropType,\n  toRef,\n  onMounted,\n  onUnmounted,\n  computed\n} from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport {\n  polygonToPath,\n  polygonFill,\n  polygonFillOpacity\n} from \"@/tools/graphics\";\nimport {\n  setTitleBoxes,\n  MouseDownInfo,\n  mouseMoveListener,\n  mouseUpListener\n} from \"@/components/map_layer/MapLayer\";\nimport { printError } from \"@/tools/utils\";\nimport { splitLines } from \"@/components/SVGTextBox\";\nimport { useStore } from \"@/store\";\nimport { TitleBox, mutations as titleBoxMutations } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"title_\";\n\nexport default defineComponent({\n  name: \"MapLayer\",\n  emits: [\n    \"title-over\",\n    \"title-leave\",\n    \"title-click\",\n    \"title-drop\",\n    \"title-dragging\"\n  ],\n  props: {\n    layerId: {\n      type: Number\n    },\n    mapId: {\n      type: String,\n      required: true\n    },\n    mapNodes: {\n      type: Object as PropType<Record<string, MapNode>>,\n      required: true\n    },\n    borderColor: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontColor: {\n      type: String,\n      required: true\n    },\n    fontOpacity: {\n      type: Number,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n\n  setup(props, ctx) {\n    const mapNodes = toRef(props, \"mapNodes\");\n\n    const store = useStore();\n    const layerID = \"map_\" + props.layerId;\n    const titleBox = computed(() => {\n      return store.state.titleBox.layerMap[layerID];\n    });\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"center\",\n      mapNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    /**\n     * Send event on titleBox click, drag and drop\n     */\n    const titleMouseDownInfo: MouseDownInfo = {\n      nodeId: null,\n      dragStart: false\n    };\n    const mouseMove = (event: MouseEvent) =>\n      mouseMoveListener(ctx.emit, event, titleMouseDownInfo);\n    const mouseUp = () => mouseUpListener(ctx.emit, titleMouseDownInfo);\n    onMounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.addEventListener(\"mousemove\", mouseMove);\n      map.addEventListener(\"mouseup\", mouseUp);\n    });\n    onUnmounted(() => {\n      const map = document.getElementById(props.mapId);\n      if (!map) {\n        printError(\"MapLayer.vue: cannot find map id for event listener\", {});\n        return;\n      }\n      map.removeEventListener(\"mousemove\", mouseMove);\n      map.removeEventListener(\"mouseup\", mouseUp);\n    });\n\n    const searchResultNodeIDsMap = computed(() => {\n      const map = {} as Record<string, boolean>;\n      if (!props.searchResultNodeIDs) {\n        return map;\n      }\n      for (const id of props.searchResultNodeIDs) {\n        map[id] = true;\n      }\n      return map;\n    });\n\n    return {\n      TITLE_PREFIX,\n      titleBox,\n      textColor: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"#ffa500\";\n        }\n        if (\n          props.selectedNodePreconditionIds &&\n          props.selectedNodePreconditionIds?.indexOf(nodeID) != -1\n        ) {\n          return \"#ffa500\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"red\";\n        }\n\n        return props.fontColor;\n      },\n      textWeight: (nodeID: string, selectedNodeId: string) => {\n        if (selectedNodeId && selectedNodeId == nodeID) {\n          return \"bold\";\n        }\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"bold\";\n        }\n\n        return \"normal\";\n      },\n      textDecoration: (nodeID: string) => {\n        if (searchResultNodeIDsMap.value[nodeID]) {\n          return \"underline\";\n        }\n\n        return \"none\";\n      },\n      titleClick: (nodeID: string) => {\n        ctx.emit(\"title-click\", {\n          id: nodeID\n        });\n      },\n      titleOver: (nodeID: string) => {\n        ctx.emit(\"title-over\", {\n          id: nodeID\n        });\n      },\n      titleLeave: (nodeID: string) => {\n        ctx.emit(\"title-leave\", {\n          id: nodeID\n        });\n      },\n      titleMouseDown: (id: string) => {\n        titleMouseDownInfo.nodeId = id;\n        titleMouseDownInfo.dragStart = false;\n      }\n    };\n  },\n\n  methods: {\n    splitLines,\n    polygonToPath,\n    polygonFill,\n    polygonFillOpacity\n  }\n});\n","import { render } from \"./MapLayer.vue?vue&type=template&id=59d7967e&scoped=true\"\nimport script from \"./MapLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./MapLayer.vue?vue&type=script&lang=ts\"\n\nimport \"./MapLayer.vue?vue&type=style&index=0&id=59d7967e&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-59d7967e\"\n\nexport default script","import { Vector } from \"@/types/graphics\";\n\nconst mouseDownBg = {\n  on: false\n};\n\nconst mouseDown = () => {\n  mouseDownBg.on = true;\n};\nconst mouseUp = () => {\n  mouseDownBg.on = false;\n};\n\nconst mouseMove = (\n  emit: (name: \"dragging-background\", o: any) => void,\n  vector: Vector\n) => {\n  if (!mouseDownBg.on) {\n    return;\n  }\n  emit(\"dragging-background\", vector);\n};\n\nexport default {\n  mouseDown,\n  mouseUp,\n  mouseMove\n};\n","<template>\n  <!--  <circle-->\n  <!--    v-for=\"node of pinNodes\"-->\n  <!--    :key=\"node.id\"-->\n  <!--    :cx=\"node.center.x\"-->\n  <!--    :cy=\"node.center.y\"-->\n  <!--    r=\"10\"-->\n  <!--    stroke=\"black\"-->\n  <!--    stroke-width=\"1\"-->\n  <!--    fill=\"red\"-->\n  <!--  />-->\n  <PinMarker\n    v-for=\"node of visiblePinNodes\"\n    :key=\"node.id\"\n    :x=\"node.center.x\"\n    :y=\"node.center.y\"\n    :color=\"color\"\n  />\n  <SVGTextBox\n    v-for=\"node of visiblePinNodes\"\n    :text=\"node.title\"\n    :id=\"`${TITLE_PREFIX}${node.id}`\"\n    :key=\"node.id\"\n    :useLineBreak=\"true\"\n    :x=\"titleXY[node.id].x\"\n    :y=\"titleXY[node.id].y\"\n    :line-height=\"8\"\n    :max-char-per-line=\"10\"\n    font-family=\"Roboto\"\n    :font-size=\"fontSize\"\n    :font-weight=\"fontWeight\"\n    :color=\"color\"\n    :text-decoration=\"textDecoration\"\n  />\n  <rect\n    v-for=\"node of pinNodes\"\n    :key=\"node.id\"\n    :x=\"titleXY[node.id].x\"\n    :y=\"titleXY[node.id].y\"\n    :width=\"titleBox[node.id] ? titleBox[node.id].bbox.width : 0\"\n    :height=\"titleBox[node.id] ? titleBox[node.id].bbox.height : 0\"\n    cursor=\"pointer\"\n    fill=\"transparent\"\n    @click=\"titleBoxClick(node.id)\"\n    @mouseover=\"titleOver(node.id)\"\n    @mouseleave=\"titleLeave(node.id)\"\n    stroke-width=\"0\"\n    stroke=\"pink\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from \"vue\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport PinMarker from \"@/components/pin_layer/PinMarker.vue\";\nimport {\n  WIDTH as PIN_MARKER_WIDTH,\n  HEIGHT as PIN_MARKER_HEIGHT\n} from \"@/components/pin_layer/PinMarker.vue\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { useStore } from \"@/store\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"pin_title_\";\n\nexport default defineComponent({\n  name: \"PinLayer\",\n  components: { SVGTextBox, PinMarker },\n  emits: [\"title-click\", \"title-over\", \"title-leave\"],\n  props: {\n    layerId: String,\n    pinNodes: {\n      type: Object as PropType<MapNode[]>,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    color: {\n      type: String\n    },\n    fontWeight: {\n      type: String\n    },\n    fontSize: {\n      type: Number\n    },\n    textDecoration: {\n      type: String\n    }\n  },\n  setup(props, ctx) {\n    const allPinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        result[node.id] = node;\n      }\n      return result;\n    });\n    const visiblePinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        if (node.id != props.selectedNodeId) {\n          result[node.id] = node;\n        }\n      }\n      return result;\n    });\n\n    const store = useStore();\n    const layerID = \"pin_\" + props.layerId;\n    const titleBox = computed(() => store.state.titleBox.layerMap[layerID]);\n    // watch pin nodes and set its title boxes to titleBox store\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      allPinNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    return {\n      TITLE_PREFIX,\n      PIN_MARKER_HEIGHT,\n      PIN_MARKER_WIDTH,\n      visiblePinNodes,\n      titleBox,\n      titleXY: computed(() => {\n        const alignedXY: Record<string, Point> = {};\n        for (const i in allPinNodes.value) {\n          const node = allPinNodes.value[i];\n          alignedXY[node.id] = {\n            x: titleBox.value[node.id] ? titleBox.value[node.id].position.x : 0,\n            y: titleBox.value[node.id] ? titleBox.value[node.id].position.y : 0\n          };\n        }\n        return alignedXY;\n      }),\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <g :transform=\"`translate(${x - WIDTH / 2} ${y - HEIGHT}) scale(0.05 0.05)`\">\n    <path\n      :fill=\"`${color}`\"\n      d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n        C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n        c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\n\nexport const WIDTH = 18;\nexport const HEIGHT = 26;\n\nexport default defineComponent({\n  name: \"PinMarker\",\n  props: {\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    return {\n      WIDTH,\n      HEIGHT\n    };\n  }\n});\n</script>\n","\nimport { defineComponent } from \"vue\";\n\nexport const WIDTH = 18;\nexport const HEIGHT = 26;\n\nexport default defineComponent({\n  name: \"PinMarker\",\n  props: {\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    return {\n      WIDTH,\n      HEIGHT\n    };\n  }\n});\n","import { render } from \"./PinMarker.vue?vue&type=template&id=d238f9c2\"\nimport script from \"./PinMarker.vue?vue&type=script&lang=ts\"\nexport * from \"./PinMarker.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <text\n    :id=\"id\"\n    :font-family=\"fontFamily\"\n    :font-size=\"fontSize\"\n    :font-weight=\"fontWeight\"\n    :fill=\"color\"\n    class=\"text\"\n  >\n    <tspan\n      v-for=\"(line, i) of lines\"\n      :key=\"i\"\n      :x=\"x\"\n      :y=\"y > 0 ? y + i * lineHeight : 0\"\n      alignment-baseline=\"hanging\"\n    >\n      {{ line }}\n    </tspan>\n  </text>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { splitLines } from \"@/components/SVGTextBox\";\n\nexport default defineComponent({\n  name: \"SVGTextBox\",\n  props: {\n    id: {\n      type: String,\n      required: true\n    },\n    useLineBreak: {\n      type: Boolean,\n      required: true\n    },\n    text: {\n      type: String,\n      required: true\n    },\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    lineHeight: {\n      type: Number,\n      required: true\n    },\n    maxCharPerLine: {\n      type: Number,\n      required: true\n    },\n    fontFamily: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontWeight: {\n      type: String,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let lines = [];\n    if (props.useLineBreak) {\n      lines = splitLines(props.text, props.maxCharPerLine);\n    } else {\n      lines = [props.text];\n    }\n    return {\n      lines\n    };\n  }\n});\n</script>\n\n<style scoped>\n.text {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n</style>\n","\nimport { defineComponent } from \"vue\";\nimport { splitLines } from \"@/components/SVGTextBox\";\n\nexport default defineComponent({\n  name: \"SVGTextBox\",\n  props: {\n    id: {\n      type: String,\n      required: true\n    },\n    useLineBreak: {\n      type: Boolean,\n      required: true\n    },\n    text: {\n      type: String,\n      required: true\n    },\n    x: {\n      type: Number,\n      required: true\n    },\n    y: {\n      type: Number,\n      required: true\n    },\n    lineHeight: {\n      type: Number,\n      required: true\n    },\n    maxCharPerLine: {\n      type: Number,\n      required: true\n    },\n    fontFamily: {\n      type: String,\n      required: true\n    },\n    fontSize: {\n      type: Number,\n      required: true\n    },\n    fontWeight: {\n      type: String,\n      required: true\n    },\n    color: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let lines = [];\n    if (props.useLineBreak) {\n      lines = splitLines(props.text, props.maxCharPerLine);\n    } else {\n      lines = [props.text];\n    }\n    return {\n      lines\n    };\n  }\n});\n","import { render } from \"./SVGTextBox.vue?vue&type=template&id=3400d8a7&scoped=true\"\nimport script from \"./SVGTextBox.vue?vue&type=script&lang=ts\"\nexport * from \"./SVGTextBox.vue?vue&type=script&lang=ts\"\n\nimport \"./SVGTextBox.vue?vue&type=style&index=0&id=3400d8a7&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-3400d8a7\"\n\nexport default script","\nimport { computed, defineComponent, PropType } from \"vue\";\nimport { MapNode, Point } from \"@/types/graphics\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport PinMarker from \"@/components/pin_layer/PinMarker.vue\";\nimport {\n  WIDTH as PIN_MARKER_WIDTH,\n  HEIGHT as PIN_MARKER_HEIGHT\n} from \"@/components/pin_layer/PinMarker.vue\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { useStore } from \"@/store\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"pin_title_\";\n\nexport default defineComponent({\n  name: \"PinLayer\",\n  components: { SVGTextBox, PinMarker },\n  emits: [\"title-click\", \"title-over\", \"title-leave\"],\n  props: {\n    layerId: String,\n    pinNodes: {\n      type: Object as PropType<MapNode[]>,\n      required: true\n    },\n    selectedNodeId: {\n      type: String,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    color: {\n      type: String\n    },\n    fontWeight: {\n      type: String\n    },\n    fontSize: {\n      type: Number\n    },\n    textDecoration: {\n      type: String\n    }\n  },\n  setup(props, ctx) {\n    const allPinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        result[node.id] = node;\n      }\n      return result;\n    });\n    const visiblePinNodes = computed(() => {\n      const result: Record<string, MapNode> = {};\n      for (const node of props.pinNodes) {\n        if (node.id != props.selectedNodeId) {\n          result[node.id] = node;\n        }\n      }\n      return result;\n    });\n\n    const store = useStore();\n    const layerID = \"pin_\" + props.layerId;\n    const titleBox = computed(() => store.state.titleBox.layerMap[layerID]);\n    // watch pin nodes and set its title boxes to titleBox store\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      allPinNodes,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    return {\n      TITLE_PREFIX,\n      PIN_MARKER_HEIGHT,\n      PIN_MARKER_WIDTH,\n      visiblePinNodes,\n      titleBox,\n      titleXY: computed(() => {\n        const alignedXY: Record<string, Point> = {};\n        for (const i in allPinNodes.value) {\n          const node = allPinNodes.value[i];\n          alignedXY[node.id] = {\n            x: titleBox.value[node.id] ? titleBox.value[node.id].position.x : 0,\n            y: titleBox.value[node.id] ? titleBox.value[node.id].position.y : 0\n          };\n        }\n        return alignedXY;\n      }),\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n","import { render } from \"./PinLayer.vue?vue&type=template&id=4510c475\"\nimport script from \"./PinLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PinLayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <defs>\n    <marker\n      id=\"preconditionArrowHead\"\n      markerWidth=\"6\"\n      markerHeight=\"7\"\n      refX=\"3\"\n      refY=\"3.5\"\n      orient=\"auto\"\n    >\n      <polygon fill=\"#aae3b9\" stroke=\"#aae3b9\" points=\"0 0, 6 3.5, 0 7\" />\n    </marker>\n  </defs>\n  <PreconditionArrow\n    v-for=\"precondition of preconditions\"\n    :key=\"precondition.id\"\n    markerId=\"preconditionArrow\"\n    :from=\"precondition.center\"\n    :to=\"selectedNode ? selectedNode.center : null\"\n    color=\"#aae3b9\"\n  />\n  <SVGTextBox\n    v-for=\"node of visibleTitleNodes\"\n    :text=\"node.title\"\n    :id=\"`${TITLE_PREFIX}${node.id}`\"\n    :key=\"node.id\"\n    :useLineBreak=\"true\"\n    :x=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.x\n        : 0\n    \"\n    :y=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.y\n        : 0\n    \"\n    :line-height=\"8\"\n    :max-char-per-line=\"10\"\n    font-family=\"Roboto\"\n    :font-size=\"8\"\n    font-weight=\"normal\"\n    color=\"#ffa500\"\n  />\n  <rect\n    v-for=\"node of visibleTitleNodes\"\n    :key=\"node.id\"\n    :x=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.x\n        : 0\n    \"\n    :y=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].position.y\n        : 0\n    \"\n    :width=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].bbox.width\n        : 0\n    \"\n    :height=\"\n      visibleTitleNodeBoxes[node.id]\n        ? visibleTitleNodeBoxes[node.id].bbox.height\n        : 0\n    \"\n    cursor=\"pointer\"\n    fill=\"transparent\"\n    @click=\"titleBoxClick(node.id)\"\n    @mouseover=\"titleBoxOver(node.id)\"\n    @mouseleave=\"titleBoxLeave(node.id)\"\n    stroke-width=\"0\"\n    stroke=\"pink\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, ref, watchEffect } from \"vue\";\nimport PreconditionArrow from \"@/components/precondition_layer/PreconditionArrow.vue\";\nimport { useStore } from \"@/store\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\nimport { zoomAndPanPoint } from \"@/views/Home\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"precondition_title_\";\n\nexport default defineComponent({\n  name: \"PreconditionLayer\",\n  emits: [\"title-over\", \"title-leave\", \"title-click\"],\n  components: { SVGTextBox, PreconditionArrow },\n  props: {\n    layerId: String,\n    selectedNodeId: String,\n    visibleTitleIds: Object as PropType<Array<string>> // all visible titles on page\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const zoomPanState = store.state.zoomPan;\n\n    /**\n     * compute selectedNode\n     */\n    const selectedNode = computed(() => {\n      if (props.selectedNodeId && store.state.tree.mapNodeLayers) {\n        const [mapNode] = findMapNode(\n          props.selectedNodeId,\n          store.state.tree.mapNodeLayers\n        );\n        if (!mapNode) {\n          return null;\n        }\n        const zoomedPannedSelectedNode = clone(mapNode);\n        zoomedPannedSelectedNode.center = zoomAndPanPoint(\n          zoomedPannedSelectedNode.center,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n        return zoomedPannedSelectedNode;\n      } else {\n        return null;\n      }\n    });\n\n    /**\n     * compute selectedNodePreconditions\n     */\n    const preconditions = ref<Record<string, MapNode>>({});\n    const extraPreconditionTitles = ref<Record<string, MapNode>>({});\n\n    const layerID = \"precondition\";\n    const visibleTitleNodeBoxes = computed(\n      () => store.state.titleBox.layerMap[layerID]\n    );\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      extraPreconditionTitles,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    watchEffect(() => {\n      preconditions.value = {};\n      // some precondition nodes may be not visible on current layout\n      // so collect these extra titles into extraPreconditionTitles and show them\n      extraPreconditionTitles.value = {};\n      if (\n        props.selectedNodeId &&\n        store.state.precondition.preconditions[props.selectedNodeId] &&\n        store.state.tree.mapNodeLayers\n      ) {\n        const nodes = clone(\n          findMapNodes(\n            store.state.precondition.preconditions[props.selectedNodeId],\n            store.state.tree.mapNodeLayers\n          )\n        );\n        for (const node of nodes) {\n          node.center = zoomAndPanPoint(\n            node.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          preconditions.value[node.id] = node;\n        }\n      }\n      for (const id in preconditions.value) {\n        if (props.visibleTitleIds?.indexOf(id) == -1) {\n          extraPreconditionTitles.value[id] = preconditions.value[id];\n        }\n      }\n      if (\n        props.selectedNodeId &&\n        selectedNode.value &&\n        store.state.tree.mapNodeLayers &&\n        props.visibleTitleIds?.indexOf(props.selectedNodeId) == -1\n      ) {\n        extraPreconditionTitles.value[props.selectedNodeId] = selectedNode.value;\n      }\n    });\n\n    return {\n      TITLE_PREFIX,\n      selectedNode,\n      preconditions,\n      visibleTitleNodes: extraPreconditionTitles,\n      visibleTitleNodeBoxes,\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleBoxOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleBoxLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <line\n    v-if=\"from && to\"\n    :x1=\"from.x\"\n    :y1=\"from.y\"\n    :x2=\"to.x\"\n    :y2=\"to.y\"\n    :stroke=\"color\"\n    stroke-width=\"1\"\n    marker-end=\"url(#preconditionArrowHead)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from \"vue\";\nimport { Point } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"PreconditionArrow\",\n  props: {\n    markerId: String,\n    color: String,\n    from: Object as PropType<Point>,\n    to: Object as PropType<Point> || null\n  }\n});\n</script>\n","\nimport { defineComponent, PropType } from \"vue\";\nimport { Point } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"PreconditionArrow\",\n  props: {\n    markerId: String,\n    color: String,\n    from: Object as PropType<Point>,\n    to: Object as PropType<Point> || null\n  }\n});\n","import { render } from \"./PreconditionArrow.vue?vue&type=template&id=005525a2\"\nimport script from \"./PreconditionArrow.vue?vue&type=script&lang=ts\"\nexport * from \"./PreconditionArrow.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { MapNode, Point, Polygon, Viewport } from \"@/types/graphics\";\nimport { area, getVectorLength, isInside } from \"@/tools/graphics\";\nimport { ErrorKV } from \"@/types/errorkv\";\nimport NewErrorKV from \"@/tools/errorkv\";\nimport { NodeRecordItem } from \"@/store/tree\";\nimport { findMapNode } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\n\nconst MIN_VISIBLE_NUM_IN_LAYER = 3;\n\nexport function zoomAndPanPoint(p: Point, zoom: number, pan: Point): Point {\n  return { x: p.x * zoom + pan.x, y: p.y * zoom + pan.y };\n}\n\nexport function zoomAndPanPolygon(\n  p: Polygon,\n  zoom: number,\n  pan: Point\n): Polygon {\n  return p.map(point => zoomAndPanPoint(point, zoom, pan));\n}\n\n/**\n * CentralNode вычисляется следующим образом.\n * Начинаем смотреть с самого верхнего слоя.\n * Для каждого узла слоя применяем zoomFactor, затем pan\n * Потом смотрим находится ли zoomCenter внутри него. Если да, то это претендент на currentNode (назовем его N).\n * Мы берем его полную площадь и умножаем на 2.\n * Если получившееся значение ≤ площади экрана, то мы считаем что currentNode это parent узла N\n * Если больше то повторяем итерацию но только с детьми N.\n * @param layers\n * @param nodeRecord\n * @param viewport\n * @param zoomFactor\n * @param pan\n * @param zoomCenter\n */\nexport function findCentralNode(\n  layers: Array<Record<string, MapNode>>,\n  nodeRecord: Record<string, NodeRecordItem>,\n  viewport: Viewport,\n  zoomFactor: number,\n  pan: Point,\n  zoomCenter: Point\n): [string, ErrorKV] {\n  if (!layers || layers.length == 0) {\n    return [\"\", null];\n  }\n\n  let underCursorNodeId = null;\n  const viewportArea = viewport.width * viewport.height;\n  let nodesToCheck = layers[0];\n  while (Object.keys(nodesToCheck).length) {\n    underCursorNodeId = \"\";\n\n    for (const nodeId in nodesToCheck) {\n      const borderToCheck = zoomAndPanPolygon(\n        nodesToCheck[nodeId].border,\n        zoomFactor,\n        pan\n      );\n      if (isInside(zoomCenter, borderToCheck)) {\n        underCursorNodeId = nodeId;\n        break;\n      }\n    }\n\n    if (underCursorNodeId === \"\") {\n      // if zoomCenter is outside take the closest node\n      let minDist = Infinity;\n      for (const nodeId in nodesToCheck) {\n        const nodeCenter = zoomAndPanPoint(\n          nodesToCheck[nodeId].center,\n          zoomFactor,\n          pan\n        );\n        const dist = getVectorLength({ from: nodeCenter, to: zoomCenter });\n        if (dist < minDist) {\n          minDist = dist;\n          underCursorNodeId = nodeId;\n        }\n      }\n    }\n\n    const underCursorNodeArea = area(\n      zoomAndPanPolygon(nodesToCheck[underCursorNodeId].border, zoomFactor, pan)\n    );\n    if (\n      Math.floor(underCursorNodeArea) <=\n      Math.floor(viewportArea / MIN_VISIBLE_NUM_IN_LAYER)\n    ) {\n      if (nodeRecord[underCursorNodeId].parent == null) {\n        return [underCursorNodeId, null];\n      }\n      return [nodeRecord[underCursorNodeId].parent!.id, null];\n    } else {\n      nodesToCheck = {};\n      if (!nodeRecord[underCursorNodeId]) {\n        return [\n          \"\",\n          NewErrorKV(\n            \"findCurrentNode: cannot find underCursorNodeId in nodeRecord\",\n            { maxIntersectNodeId: underCursorNodeId, nodeRecord }\n          )\n        ];\n      }\n      for (const child of nodeRecord[underCursorNodeId].node.children) {\n        const [mapNode] = findMapNode(child.id, layers);\n        if (mapNode == null) {\n          return [\n            \"\",\n            NewErrorKV(\"filterNodesAndLayers: Cannot find node in layers\", {\n              \"child.id\": child.id,\n              layers: layers\n            })\n          ];\n        }\n        nodesToCheck[child.id] = mapNode;\n      }\n\n      if (Object.keys(nodesToCheck).length === 0) {\n        return [underCursorNodeId, null];\n      }\n    }\n  }\n\n  return [\"\", NewErrorKV(\"filterNodesAndLayers: unknown error\", {})];\n}\n\n/**\n * Мы показываем слой в котором находится currentNode (без названий) плюс еще 3.\n * Причем полноценно мы показываем только подузлы currentNode.\n * Узлы слоя currentNode отображаются только если у них тот же parent что и у\n * currentNode. Плюс подузлы НЕ ИЗ currentNode мы отображаем только одного следующего слоя.\n * @param layers\n * @param nodeRecord\n * @param currentNodeId\n */\nexport function filterNodesAndLayers(\n  layers: Array<Record<string, MapNode>>,\n  nodeRecord: Record<string, NodeRecordItem>,\n  currentNodeId: string\n): [Array<Record<number, MapNode>>, ErrorKV] {\n  if (!layers || !layers.length) {\n    return [[], null];\n  }\n  const resultLayers = [];\n\n  // узнаем какой слой у currentNode\n  const [currentNode, level] = findMapNode(currentNodeId, layers);\n  if (currentNode == null || level == null) {\n    return [\n      [],\n      NewErrorKV(\"filterNodesAndLayers-currentNode: error in findMapNode\", {\n        currentNodeId,\n        layers\n      })\n    ];\n  }\n\n  // убираем из этого слоя все кроме детей currentNode.parent\n  const upperLayer: Record<string, MapNode> = {};\n  if (nodeRecord[currentNode.id].parent == null) {\n    upperLayer[currentNode.id] = clone(currentNode);\n  } else {\n    for (const child of nodeRecord[currentNode.id].parent!.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-upperLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            level,\n            layers: [layers[level]]\n          })\n        ];\n      }\n      upperLayer[child.id] = clone(mapNode);\n      upperLayer[child.id].title = \"\";\n    }\n  }\n  resultLayers.push(upperLayer);\n\n  // следующий слой это дети всех узлов из upperLayer, но дети всех кроме currentNode не имеют названий\n  const firstLayer: Record<string, MapNode> = {};\n  for (const nodeId in upperLayer) {\n    for (const child of nodeRecord[nodeId].node.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level + 1]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-firstLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            layers: [layers[level + 1]]\n          })\n        ];\n      }\n      if (nodeId != currentNodeId) {\n        firstLayer[child.id] = clone(mapNode);\n        firstLayer[child.id].title = \"\";\n      } else {\n        firstLayer[child.id] = clone(mapNode);\n      }\n    }\n  }\n\n  if (Object.keys(firstLayer).length > 0) {\n    resultLayers.push(firstLayer);\n  }\n\n  // следующий слой это дети детей currentNode\n  const secondLayer: Record<string, MapNode> = {};\n  //for (const childId in firstLayer) {\n  for (const child of nodeRecord[currentNodeId].node.children) {\n    for (const childOfChild of nodeRecord[child.id].node.children) {\n      const [mapNode, l] = findMapNode(childOfChild.id, [layers[level + 2]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-secondLayer: error in findMapNode\", {\n            \"child.id\": child.id,\n            layers: [layers[level + 2]]\n          })\n        ];\n      }\n      secondLayer[childOfChild.id] = clone(mapNode);\n    }\n  }\n\n  if (Object.keys(secondLayer).length > 0) {\n    resultLayers.push(secondLayer);\n  }\n\n  // следующий это дети узлов из secondLayer и у них нет названий\n  const thirdLayer: Record<string, MapNode> = {};\n  for (const nodeId in secondLayer) {\n    for (const child of nodeRecord[nodeId].node.children) {\n      const [mapNode, l] = findMapNode(child.id, [layers[level + 3]]);\n      if (mapNode == null || l === null) {\n        return [\n          [],\n          NewErrorKV(\"filterNodesAndLayers-thirdLayer:cannot findMapNode\", {\n            \"child.id\": child.id,\n            level: level + 3,\n            layers: [layers[level + 3]]\n          })\n        ];\n      }\n      thirdLayer[child.id] = clone(mapNode);\n      thirdLayer[child.id].title = \"\";\n    }\n  }\n\n  if (Object.keys(thirdLayer).length > 0) {\n    resultLayers.push(thirdLayer);\n  }\n\n  return [resultLayers, null];\n}\n\nexport function zoomAnPanLayers(\n  layers: Array<Record<number, MapNode>>,\n  zoom: number,\n  pan: Point\n): Array<Record<number, MapNode>> {\n  if (!layers || layers.length == 0) {\n    return [];\n  }\n  for (const layer of layers) {\n    for (const id in layer) {\n      const node = layer[id];\n      node.center = zoomAndPanPoint(node.center, zoom, pan);\n      node.border = zoomAndPanPolygon(node.border, zoom, pan);\n    }\n  }\n\n  return layers;\n}\n","\nimport { computed, defineComponent, PropType, ref, watchEffect } from \"vue\";\nimport PreconditionArrow from \"@/components/precondition_layer/PreconditionArrow.vue\";\nimport { useStore } from \"@/store\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { clone } from \"@/tools/utils\";\nimport { zoomAndPanPoint } from \"@/views/Home\";\nimport SVGTextBox from \"@/components/SVGTextBox.vue\";\nimport { setTitleBoxes } from \"@/components/map_layer/MapLayer\";\nimport { mutations as titleBoxMutations, TitleBox } from \"@/store/title_box\";\n\nconst TITLE_PREFIX = \"precondition_title_\";\n\nexport default defineComponent({\n  name: \"PreconditionLayer\",\n  emits: [\"title-over\", \"title-leave\", \"title-click\"],\n  components: { SVGTextBox, PreconditionArrow },\n  props: {\n    layerId: String,\n    selectedNodeId: String,\n    visibleTitleIds: Object as PropType<Array<string>> // all visible titles on page\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const zoomPanState = store.state.zoomPan;\n\n    /**\n     * compute selectedNode\n     */\n    const selectedNode = computed(() => {\n      if (props.selectedNodeId && store.state.tree.mapNodeLayers) {\n        const [mapNode] = findMapNode(\n          props.selectedNodeId,\n          store.state.tree.mapNodeLayers\n        );\n        if (!mapNode) {\n          return null;\n        }\n        const zoomedPannedSelectedNode = clone(mapNode);\n        zoomedPannedSelectedNode.center = zoomAndPanPoint(\n          zoomedPannedSelectedNode.center,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n        return zoomedPannedSelectedNode;\n      } else {\n        return null;\n      }\n    });\n\n    /**\n     * compute selectedNodePreconditions\n     */\n    const preconditions = ref<Record<string, MapNode>>({});\n    const extraPreconditionTitles = ref<Record<string, MapNode>>({});\n\n    const layerID = \"precondition\";\n    const visibleTitleNodeBoxes = computed(\n      () => store.state.titleBox.layerMap[layerID]\n    );\n    setTitleBoxes(\n      TITLE_PREFIX,\n      \"left\",\n      extraPreconditionTitles,\n      (titleBoxMap: Record<string, TitleBox>) => {\n        store.commit(`titleBox/${titleBoxMutations.SET_MAP}`, {\n          layerName: layerID,\n          titleBoxMap\n        });\n      }\n    );\n\n    watchEffect(() => {\n      preconditions.value = {};\n      // some precondition nodes may be not visible on current layout\n      // so collect these extra titles into extraPreconditionTitles and show them\n      extraPreconditionTitles.value = {};\n      if (\n        props.selectedNodeId &&\n        store.state.precondition.preconditions[props.selectedNodeId] &&\n        store.state.tree.mapNodeLayers\n      ) {\n        const nodes = clone(\n          findMapNodes(\n            store.state.precondition.preconditions[props.selectedNodeId],\n            store.state.tree.mapNodeLayers\n          )\n        );\n        for (const node of nodes) {\n          node.center = zoomAndPanPoint(\n            node.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          preconditions.value[node.id] = node;\n        }\n      }\n      for (const id in preconditions.value) {\n        if (props.visibleTitleIds?.indexOf(id) == -1) {\n          extraPreconditionTitles.value[id] = preconditions.value[id];\n        }\n      }\n      if (\n        props.selectedNodeId &&\n        selectedNode.value &&\n        store.state.tree.mapNodeLayers &&\n        props.visibleTitleIds?.indexOf(props.selectedNodeId) == -1\n      ) {\n        extraPreconditionTitles.value[props.selectedNodeId] = selectedNode.value;\n      }\n    });\n\n    return {\n      TITLE_PREFIX,\n      selectedNode,\n      preconditions,\n      visibleTitleNodes: extraPreconditionTitles,\n      visibleTitleNodeBoxes,\n      titleBoxClick: (nodeId: string) => {\n        ctx.emit(\"title-click\", { id: nodeId });\n      },\n      titleBoxOver: (nodeId: string) => {\n        ctx.emit(\"title-over\", { id: nodeId });\n      },\n      titleBoxLeave: (nodeId: string) => {\n        ctx.emit(\"title-leave\", { id: nodeId });\n      }\n    };\n  }\n});\n","import { render } from \"./PreconditionLayer.vue?vue&type=template&id=16932f4f\"\nimport script from \"./PreconditionLayer.vue?vue&type=script&lang=ts\"\nexport * from \"./PreconditionLayer.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, onMounted, PropType } from \"vue\";\nimport { MapNode } from \"@/types/graphics\";\nimport MapLayer from \"@/components/map_layer/MapLayer.vue\";\nimport {\n  EventClickNode,\n  EventDraggingNode\n} from \"@/components/map_layer/MapLayer\";\nimport pan from \"./MapPan\";\nimport PinLayer from \"@/components/pin_layer/PinLayer.vue\";\nimport { printError } from \"@/tools/utils\";\nimport PreconditionLayer from \"@/components/precondition_layer/PreconditionLayer.vue\";\n\nconst mapID = \"mapID\";\n\nexport default defineComponent({\n  name: \"Map\",\n  emits: [\n    \"title-dragging\",\n    \"title-click\",\n    \"title-over\",\n    \"title-leave\",\n    \"dragging-background\",\n    \"wheel\"\n  ],\n  components: {\n    PreconditionLayer,\n    PinLayer,\n    MapLayer\n  },\n  props: {\n    layers: Object as PropType<Array<Record<string, MapNode>>>,\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    selectedNodePreconditionIds: Object as PropType<string[]>,\n    pinNodes: Object as PropType<MapNode[]>,\n    searchResultPinNodes: Object as PropType<MapNode[]>,\n    searchResultNodeIDs: Object as PropType<string[]>\n  },\n  setup(props, ctx) {\n    onMounted(() => {\n      const map = document.getElementById(mapID);\n      if (!map) {\n        printError(\"Map.vue: cannot find map id for event listener\", {});\n        return;\n      }\n\n      map.addEventListener(\"mousedown\", event => {\n        pan.mouseDown();\n      });\n      map.addEventListener(\"mouseup\", event => {\n        pan.mouseUp();\n      });\n      map.addEventListener(\"mousemove\", event => {\n        pan.mouseMove(ctx.emit, {\n          from: {\n            x: event.clientX - event.movementX,\n            y: event.clientY - event.movementY\n          },\n          to: { x: event.clientX, y: event.clientY }\n        });\n      });\n\n      // zoom with mouse wheel\n      map.addEventListener(\n        \"wheel\",\n        event => {\n          ctx.emit(\"wheel\", {\n            delta: event.deltaY,\n            center: { x: event.clientX, y: event.clientY }\n          });\n        },\n        { passive: true }\n      );\n\n      let prevDist = Infinity;\n      const prevPoint = { x: Infinity, y: Infinity };\n      map.addEventListener(\n        \"touchstart\",\n        event => {\n          pan.mouseDown();\n        },\n        { passive: true }\n      );\n      map.addEventListener(\"touchend\", event => {\n        prevDist = Infinity;\n        prevPoint.x = Infinity;\n        prevPoint.y = Infinity;\n        pan.mouseUp();\n      });\n\n      // mobile zoom\n      map.addEventListener(\n        \"touchmove\",\n        e => {\n          if (e.touches.length === 1) {\n            if (prevPoint.x != Infinity && prevPoint.y != Infinity) {\n              pan.mouseMove(ctx.emit, {\n                from: prevPoint,\n                to: { x: e.touches[0].clientX, y: e.touches[0].clientY }\n              });\n            }\n            prevPoint.x = e.touches[0].clientX;\n            prevPoint.y = e.touches[0].clientY;\n          } else if (e.touches.length === 2) {\n            let delta = 0;\n            const dist = Math.hypot(\n              e.touches[0].pageX - e.touches[1].pageX,\n              e.touches[0].pageY - e.touches[1].pageY\n            );\n            if (prevDist !== Infinity) {\n              delta = prevDist - dist;\n            }\n            prevDist = dist;\n\n            ctx.emit(\"wheel\", {\n              delta: delta,\n              center: {\n                x: (e.touches[0].pageX - e.touches[1].pageX) / 2,\n                y: (e.touches[0].pageY - e.touches[1].pageY) / 2\n              }\n            });\n          }\n        },\n        { passive: true }\n      );\n    });\n\n    return {\n      svgWidth: window.innerWidth,\n      // 0.99 because if svg == innerHeight then browser vertical scroll bar appears\n      svgHeight: 0.99 * window.innerHeight,\n      visibleTitleIds: computed(() => {\n        if (!props.layers) {\n          return [];\n        }\n        const ids = [];\n        for (const layer of props.layers) {\n          for (const idx in layer) {\n            if (layer[idx].title != \"\") {\n              ids.push(idx);\n            }\n          }\n        }\n        return ids;\n      }),\n      draggingNode: (e: EventDraggingNode) => {\n        ctx.emit(\"title-dragging\", {\n          id: e.nodeId,\n          delta: e.delta\n        });\n      },\n      titleClick: (e: EventClickNode) => {\n        ctx.emit(\"title-click\", { id: e.id });\n      },\n      titleOver: (e: EventClickNode) => {\n        ctx.emit(\"title-over\", { id: e.id });\n      },\n      titleLeave: (e: EventClickNode) => {\n        ctx.emit(\"title-leave\", { id: e.id });\n      },\n      mapID: mapID,\n      fontSize: (index: number): number => {\n        let size = 0;\n        const levelSizes: Record<number, number> = {\n          0: 6,\n          1: 11,\n          2: 21,\n          3: 28\n        };\n        if (props.layers!.length >= 4) {\n          size = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          size = levelSizes[index + 1];\n        }\n        return size;\n      },\n      fontOpacity: (index: number): number => {\n        let val = 0;\n        const levelSizes: Record<number, number> = {\n          0: 1,\n          1: 1,\n          2: 0.2,\n          3: 1\n        };\n        if (props.layers!.length >= 4) {\n          val = levelSizes[index];\n        }\n        if (props.layers!.length == 3) {\n          val = levelSizes[index + 1];\n        }\n        return val;\n      },\n      fontColor: (index: number): string => {\n        if (props.layers!.length >= 4) {\n          return `rgb(${200 - 100 * index},${200 - 100 * index},${200 -\n            100 * index})`;\n        }\n        if (props.layers!.length == 3) {\n          return `rgb(${200 - 100 * (index + 1)},${200 -\n            100 * (index + 1)},${200 - 100 * (index + 1)})`;\n        }\n        return \"\";\n      },\n      borderColor: (index: number): string => {\n        let color = 0;\n        const levelColors: Record<number, number> = {\n          0: 240,\n          1: 200,\n          2: 100,\n          3: 90\n        };\n        if (props.layers!.length >= 4) {\n          color = levelColors[index];\n        }\n        if (props.layers!.length == 3) {\n          color = levelColors[index + 1];\n        }\n        return `rgb(${color},${color},${color})`;\n      }\n    };\n  }\n});\n","import { render } from \"./Map.vue?vue&type=template&id=33972798\"\nimport script from \"./Map.vue?vue&type=script&lang=ts\"\nexport * from \"./Map.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div v-if=\"show && selectedNode\" class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <!-- Image -->\n      <TitleImage\n        :nodeID=\"selectedNodeContent ? selectedNodeContent.nodeID : ''\"\n      />\n\n      <!-- Content -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 240px\"></div>\n        </div>\n        <div class=\"p-col-10\">\n          <Title\n            :content=\"selectedNodeContent ? selectedNode.title : ''\"\n            @content-changed=\"changeNodeTitle($event)\"\n          />\n        </div>\n        <div class=\"p-col-2\">\n          <PinButton />\n        </div>\n        <div class=\"p-col-12\">\n          <Markdown\n            :content=\"selectedNodeContent ? selectedNodeContent.content : ''\"\n            :rows=\"20\"\n            @content-changed=\"changeContent($event)\"\n          />\n        </div>\n      </div>\n\n      <!-- Comment -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12 p-md-12\">\n          <TextArea\n            id=\"comment\"\n            placeholder=\"Your notes (visible only to you)\"\n            :autoResize=\"true\"\n            rows=\"2\"\n            :value=\"selectedNodeComment\"\n            @update:modelValue=\"changeComment($event)\"\n            v-on:keydown=\"checkAuthorized\"\n          />\n        </div>\n      </div>\n\n      <!-- Preconditions section -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-10 section\">\n          based on\n        </div>\n        <div class=\"p-col-2\">\n          <AddBasedOnButton\n            :clickedTitleId=\"clickedTitleId\"\n            @select-precondition-is-on=\"$emit('select-precondition-is-on')\"\n            @select-precondition-is-off=\"$emit('select-precondition-is-off')\"\n          />\n        </div>\n      </div>\n      <SectionPreconditions\n        v-if=\"selectedNodeContent\"\n        :node-id=\"selectedNode.id\"\n      />\n\n      <!-- 'Basis for' section -->\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-10 section\">\n          basis for\n        </div>\n      </div>\n      <SectionUsedBy v-if=\"selectedNodeContent\" :node-id=\"selectedNode.id\" />\n\n      <!-- ChangeLog section -->\n      <ChangeLog :node-id=\"selectedNode.id\" />\n    </div>\n  </div>\n  <div v-else-if=\"editModeOn\" class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 60px;\"></div>\n        </div>\n        <div class=\"p-col-12\">\n          <div class=\"title\">\n            Map edit mode is on\n          </div>\n        </div>\n        <div class=\"p-col-12 list\">\n          In this mode you can change map structure but cannot edit contents of individual nodes. To return back to content editing push \"edit map\" button again.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n              alt=\"logo\"\n              src=\"../../assets/images/add-off.svg\"\n              style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To add new node 1) select parent node on map and then 2) click \"add\" button in upper menu.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/remove-off.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To remove node 1) select it on map and 2) click \"delete\" button in upper menu.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/cut.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          To move node 1) select it on map, then 2) press \"cut\" button, then 3) select its new parent and 4) press \"paste\" button.\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/log.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          You can use \"log\" to see log of map edits and revert or complain any unfortunate edit.\n        </div>\n        <div class=\"p-col-12 list\">\n            After add, paste or remove you can drag node title and its neighbours to adjust node centers position.\n        </div>\n      </div>\n    </div>\n  </div>\n  <div v-else class=\"wrapper\">\n    <div class=\"p-fluid\">\n      <div class=\"p-field p-grid\">\n        <div class=\"p-col-12\">\n          <div style=\"height: 60px;\"></div>\n        </div>\n        <div class=\"p-col-12\">\n          <div class=\"title\">\n            Welcome to new way of knowledge crowdsourcing!\n          </div>\n        </div>\n        <div class=\"p-col-12\">\n          <iframe\n            width=\"100%\"\n            height=\"225px\"\n            src=\"https://www.youtube.com/embed/4S9sDyooxf4?si=u4z2DkDwNTsVdMBH\"\n            title=\"YouTube video player\"\n            frameborder=\"0\"\n            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\n            allowfullscreen\n          ></iframe>\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/sign-in.svg\"\n            style=\"width: 25px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Sign in to edit map\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/goal.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Keep description focused and simple but profound (i - snippet with\n          example of formula and image markdown)\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/plugin.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Use <b>\"based on\"</b> to link nodes that are necessary for solid\n          understanding of your description\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/pin-on-map.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Pin nodes that you are focused on\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/action.svg\"\n            style=\"width: 30px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Not only description, if you know actions one can take to push\n          knowledge further (vacancies, crowdsourcing etc) - add it!\n        </div>\n        <div class=\"p-col-1 icon\">\n          <img\n            alt=\"logo\"\n            src=\"../../assets/images/talk.svg\"\n            style=\"width: 20px\"\n          />\n        </div>\n        <div class=\"p-col-11 list\">\n          Talk to your coauthors to make description better in\n          <a\n            target=\"_blank\"\n            href=\"https://discord.com/channels/1171118046543347782/1171118047587745953\"\n            >chat</a\n          >\n        </div>\n        <div class=\"p-col-12 list\">\n          <i\n            >If you thank we need more rules or change these ones, feel free to\n            discuss them in community chat</i\n          >\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { actions, useStore } from \"@/store\";\nimport { actions as nodeContentActions } from \"@/store/node_content\";\nimport { computed, defineComponent } from \"vue\";\nimport TextArea from \"primevue/textarea\";\nimport SectionPreconditions from \"./Preconditions.vue\";\nimport SectionUsedBy from \"./UsedBy.vue\";\nimport { Tree } from \"@/types/graphics\";\nimport { EmptyNodeContent, NodeContent } from \"@/store/node_content\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { useConfirm } from \"primevue/useconfirm\";\nimport api from \"@/api/api\";\nimport Markdown from \"./Markdown.vue\";\nimport ChangeLog from \"./ChangeLog.vue\";\nimport PinButton from \"./PinButton.vue\";\nimport Title from \"@/components/node_content/Title.vue\";\nimport AddBasedOnButton from \"@/components/node_content/AddBasedOnButton.vue\";\nimport TitleImage from \"@/components/node_content/TitleImage.vue\";\n\nexport default defineComponent({\n  name: \"NodeContent\",\n  components: {\n    TitleImage,\n    AddBasedOnButton,\n    Title,\n    SectionUsedBy,\n    Markdown,\n    TextArea,\n    SectionPreconditions,\n    ChangeLog,\n    PinButton\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    show: {\n      type: Boolean,\n      required: true\n    },\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const tree = store.state.tree;\n\n    const selectedNode = computed<Tree | null>(() =>\n      props.selectedNodeId && tree.nodeRecord[props.selectedNodeId]\n        ? tree.nodeRecord[props.selectedNodeId].node\n        : null\n    );\n\n    const selectedNodeContent = computed<NodeContent | null>(() => {\n      if (\n        props.selectedNodeId &&\n        store.state.nodeContent.nodeContents[props.selectedNodeId]\n      ) {\n        return store.state.nodeContent.nodeContents[props.selectedNodeId];\n      }\n      const newContent = clone(EmptyNodeContent);\n      newContent.nodeID = props.selectedNodeId;\n      return newContent;\n    });\n\n    const selectedNodeComment = computed<string>(() =>\n      props.selectedNodeId &&\n      store.state.nodeContent.userNodeComments[props.selectedNodeId]\n        ? store.state.nodeContent.userNodeComments[props.selectedNodeId].comment\n        : \"\"\n    );\n\n    return {\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNode,\n      selectedNodeContent,\n      checkAuthorized: async (e: Event) => {\n        if (!store.state.user.user || store.state.user.user.isAnonymous) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to add comments and edit content\"});\n          e.preventDefault();\n        }\n      },\n      selectedNodeComment,\n      changeNodeTitle: async (value: string) => {\n        if (!selectedNode.value || !selectedNode.value.id) {\n          return;\n        }\n        const err = await api.debouncedUpdate({\n          [`map/${selectedNode.value.id}/name`]: value\n        });\n\n        if (err) {\n          printError(err.error.message, err.kv);\n        }\n      },\n      changeContent: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeContent}`,\n          {\n            nodeID: selectedNode.value!.id,\n            content: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      },\n      changeComment: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeComment}`,\n          {\n            nodeID: selectedNode.value!.id,\n            comment: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      }\n    };\n  }\n});\n</script>\n\n<style scoped>\n.wrapper {\n  position: absolute;\n  width: 30%;\n  height: 100%;\n  padding: 24px;\n  overflow-y: scroll;\n  background-color: rgba(255, 255, 255, 1);\n  font-family: Roboto, Arial, sans-serif;\n  color: rgb(73, 80, 87);\n\n  border-right: 1px solid rgb(218, 220, 224);\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\n  clip-path: inset(0px -5px 0px 0px);\n}\n.title {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1.375rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  line-height: 1.75rem;\n  color: #202124;\n  margin-bottom: 20px;\n}\n.list {\n  font-family: Roboto, Arial, sans-serif;\n  font-size: 0.875rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  padding-left: 20px;\n  margin-bottom: 10px;\n  margin-top: 10px;\n}\n.icon {\n  margin-top: 9px;\n}\n.section {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1rem;\n  font-weight: 500;\n  letter-spacing: 0;\n  line-height: 1.5rem;\n}\n</style>\n","<template>\n  <div\n    v-for=\"precondition of preconditions\"\n    class=\"p-grid\"\n    :key=\"precondition.id\"\n  >\n    <div class=\"p-col-12\">\n      <div class=\"p-grid\">\n        <div :class=\"`p-col-10 ${$style.title}`\">\n          <a :href=\"precondition.id\">{{ precondition.title }}</a>\n        </div>\n        <div class=\"p-col-2\">\n          <RemoveIcon @click=\"remove(precondition.id)\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport {actions, useStore} from \"@/store\";\nimport api from \"@/api/api\";\nimport { Tree } from \"@/types/graphics\";\nimport RemoveIcon from \"@/components/node_content/RemoveIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\nimport {mutations as preconditionMutations} from \"@/store/precondition\";\n\nexport default defineComponent({\n  name: \"Preconditions\",\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    RemoveIcon\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const preconditions = ref<Array<Tree>>([]);\n    watchEffect(() => {\n      preconditions.value = [];\n      if (\n        props.nodeId &&\n        store.state.precondition.preconditions[props.nodeId]\n      ) {\n        for (const id of store.state.precondition.preconditions[props.nodeId]) {\n          preconditions.value.push(store.state.tree.nodeRecord[id].node);\n        }\n      }\n    });\n\n    return {\n      preconditions,\n      remove: async (id: string) => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n\n        store.commit(`precondition/${preconditionMutations.REMOVE_PRECONDITION}`, {\n          nodeID: props.nodeId,\n          preconditionID: id,\n        });\n        api.savePreconditions(store.state.user.user, {\n          nodeId: props.nodeId,\n          preconditionIds: store.state.precondition.preconditions[props.nodeId]\n        });\n      }\n    };\n  }\n});\n</script>\n\n<style module>\n.title {\n  margin-top: 7px;\n}\n</style>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"mouseOver\" class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/remove-on.svg\"\n      />\n    </div>\n    <div v-else class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/remove-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"RemoveIcon\",\n  setup() {\n    const mouseOver = ref(false);\n    return {\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.custom {\n  margin-left: 15px;\n}\n</style>\n","import { render } from \"./RemoveIcon.vue?vue&type=template&id=fb1a5bf4&scoped=true\"\nimport script from \"./RemoveIcon.vue?vue&type=script&lang=js\"\nexport * from \"./RemoveIcon.vue?vue&type=script&lang=js\"\n\nimport \"./RemoveIcon.vue?vue&type=style&index=0&id=fb1a5bf4&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-fb1a5bf4\"\n\nexport default script","\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport {actions, useStore} from \"@/store\";\nimport api from \"@/api/api\";\nimport { Tree } from \"@/types/graphics\";\nimport RemoveIcon from \"@/components/node_content/RemoveIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\nimport {mutations as preconditionMutations} from \"@/store/precondition\";\n\nexport default defineComponent({\n  name: \"Preconditions\",\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    RemoveIcon\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const preconditions = ref<Array<Tree>>([]);\n    watchEffect(() => {\n      preconditions.value = [];\n      if (\n        props.nodeId &&\n        store.state.precondition.preconditions[props.nodeId]\n      ) {\n        for (const id of store.state.precondition.preconditions[props.nodeId]) {\n          preconditions.value.push(store.state.tree.nodeRecord[id].node);\n        }\n      }\n    });\n\n    return {\n      preconditions,\n      remove: async (id: string) => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n\n        store.commit(`precondition/${preconditionMutations.REMOVE_PRECONDITION}`, {\n          nodeID: props.nodeId,\n          preconditionID: id,\n        });\n        api.savePreconditions(store.state.user.user, {\n          nodeId: props.nodeId,\n          preconditionIds: store.state.precondition.preconditions[props.nodeId]\n        });\n      }\n    };\n  }\n});\n","import { render } from \"./Preconditions.vue?vue&type=template&id=28fa73e4\"\nimport script from \"./Preconditions.vue?vue&type=script&lang=ts\"\nexport * from \"./Preconditions.vue?vue&type=script&lang=ts\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Preconditions.vue?vue&type=style&index=0&id=28fa73e4&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <div v-for=\"usedByNode of usedBy\" class=\"p-grid\" :key=\"usedByNode.id\">\n    <div class=\"p-col-12\">\n      <div class=\"p-grid\">\n        <div class=\"p-col-11\">\n          <a :href=\"usedByNode.id\">{{ usedByNode.title }}</a>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport { useStore } from \"@/store\";\nimport { Tree } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"UsedBy\",\n  props: {\n    nodeId: String\n  },\n  setup(props) {\n    const store = useStore();\n    const usedBy = ref<Array<Tree>>([]);\n    watchEffect(() => {\n      usedBy.value = [];\n      if (props.nodeId && store.state.precondition.reverseIndex[props.nodeId]) {\n        for (const id of store.state.precondition.reverseIndex[props.nodeId]) {\n          if (!store.state.tree.nodeRecord[id]) {\n            console.log(\"UsedBy: cannot find id in nodeRecord\", id);\n          } else {\n            usedBy.value.push(store.state.tree.nodeRecord[id].node);\n          }\n        }\n      }\n    });\n\n    return {\n      usedBy\n    };\n  }\n});\n</script>\n","\nimport { ref, watchEffect, defineComponent } from \"vue\";\nimport { useStore } from \"@/store\";\nimport { Tree } from \"@/types/graphics\";\n\nexport default defineComponent({\n  name: \"UsedBy\",\n  props: {\n    nodeId: String\n  },\n  setup(props) {\n    const store = useStore();\n    const usedBy = ref<Array<Tree>>([]);\n    watchEffect(() => {\n      usedBy.value = [];\n      if (props.nodeId && store.state.precondition.reverseIndex[props.nodeId]) {\n        for (const id of store.state.precondition.reverseIndex[props.nodeId]) {\n          if (!store.state.tree.nodeRecord[id]) {\n            console.log(\"UsedBy: cannot find id in nodeRecord\", id);\n          } else {\n            usedBy.value.push(store.state.tree.nodeRecord[id].node);\n          }\n        }\n      }\n    });\n\n    return {\n      usedBy\n    };\n  }\n});\n","import { render } from \"./UsedBy.vue?vue&type=template&id=4685b46b\"\nimport script from \"./UsedBy.vue?vue&type=script&lang=ts\"\nexport * from \"./UsedBy.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <p v-if=\"isAuthorized\"\n    v-show=\"!editOn\"\n    v-html=\"renderedContent\"\n    @click=\"setEditOn(true)\"\n    class=\"renderedContent\"\n  />\n  <p v-else\n    v-html=\"renderedContent\"\n    class=\"renderedContent\"\n  />\n  <textarea\n    class=\"rawContent p-inputtextarea p-inputtext p-component p-inputtextarea-resizable\"\n    style=\"display: none\"\n    ref=\"txtarea\"\n    :rows=\"rows\"\n    :value=\"content\"\n    @input=\"changeContent($event.target.value)\"\n    @focusout=\"setEditOn(false)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref } from \"vue\";\nimport MarkdownIt from \"markdown-it\";\nimport {useStore} from \"@/store\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst mdContainer = require('markdown-it-container'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd.use(mdKatex, { output: \"html\" })\n  .use(mdImsize)\n  .use(mdContainer, \"warning\", {\n    validate: function(params: any) {\n      console.log(\"validate\", params.trim(), params.trim() == \"warning\");\n      return params.trim().match(/^warning$/);\n    },\n    render: function(tokens: any, idx: any) {\n      const m = tokens[idx].info.trim().match(/^warning(.*)$/);\n      if (tokens[idx].nesting === 1) {\n        // opening tag\n        return (\n          '<div style=\"background-color: #c6f68d; padding: 8px;\">' +\n          md.utils.escapeHtml(m[1]) +\n          \"\\n\"\n        );\n      } else {\n        // closing tag\n        return \"</div>\\n\";\n      }\n    }\n  });\n\nexport default {\n  name: \"Markdown\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    },\n    rows: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const store = useStore();\n    const renderedContent = computed(() => {\n      return md.render(props.content);\n    });\n    const editOn = ref(false);\n\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n</script>\n\n<style scoped>\n@import \"../../../node_modules/katex/dist/katex.min.css\";\n.renderedContent {\n  color: rgb(32, 33, 36);\n  font-family: Roboto, Arial, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  letter-spacing: normal;\n  line-height: 20px;\n  margin-right: 4px;\n  text-align: left;\n  text-wrap: wrap;\n  overflow-y: scroll;\n  height: 300px;\n}\n.rawContent {\n  overflow-y: scroll;\n  height: 100%;\n}\n</style>\n","\nimport { computed, ref } from \"vue\";\nimport MarkdownIt from \"markdown-it\";\nimport {useStore} from \"@/store\";\nconst mdKatex = require('markdown-it-katex'); // eslint-disable-line\nconst mdImsize = require('markdown-it-imsize'); // eslint-disable-line\nconst mdContainer = require('markdown-it-container'); // eslint-disable-line\nconst md = new MarkdownIt();\nmd.use(mdKatex, { output: \"html\" })\n  .use(mdImsize)\n  .use(mdContainer, \"warning\", {\n    validate: function(params: any) {\n      console.log(\"validate\", params.trim(), params.trim() == \"warning\");\n      return params.trim().match(/^warning$/);\n    },\n    render: function(tokens: any, idx: any) {\n      const m = tokens[idx].info.trim().match(/^warning(.*)$/);\n      if (tokens[idx].nesting === 1) {\n        // opening tag\n        return (\n          '<div style=\"background-color: #c6f68d; padding: 8px;\">' +\n          md.utils.escapeHtml(m[1]) +\n          \"\\n\"\n        );\n      } else {\n        // closing tag\n        return \"</div>\\n\";\n      }\n    }\n  });\n\nexport default {\n  name: \"Markdown\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    },\n    rows: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const store = useStore();\n    const renderedContent = computed(() => {\n      return md.render(props.content);\n    });\n    const editOn = ref(false);\n\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n","import { render } from \"./Markdown.vue?vue&type=template&id=14a19a31&scoped=true\"\nimport script from \"./Markdown.vue?vue&type=script&lang=ts\"\nexport * from \"./Markdown.vue?vue&type=script&lang=ts\"\n\nimport \"./Markdown.vue?vue&type=style&index=0&id=14a19a31&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-14a19a31\"\n\nexport default script","<template>\n  <ChangeLogComplain\n    :show=\"complainModalVisible\"\n    :complainChangeLink=\"complainChangeLink\"\n    @hide=\"complainModalVisible = false\"\n  />\n  <Fieldset\n    legend=\"change log\"\n    :toggleable=\"true\"\n    :collapsed=\"collapsed\"\n    @update:collapsed=\"toggle($event)\"\n    :pt=\"{\n      legend: { class: 'bg-primary' }\n    }\"\n  >\n    <div v-if=\"!isAuthorized\">\n      Sign in to see node change log\n    </div>\n    <div v-else class=\"m-0\">\n      <Card v-for=\"(event, i) of changes\" :key=\"i\" class=\"mt-3\">\n        <template #title>\n          {{ new Date(event.timestamp).toLocaleDateString() }}\n          {{ new Date(event.timestamp).toLocaleTimeString() }} /\n          {{ event.action }} change\n        </template>\n        <template #subtitle>\n          {{\n            !!event.userDisplayName\n              ? event.userDisplayName\n              : `user id ${event.userID}`\n          }}\n          / <a href=\"#\" @click=\"showComplain(event.changeLogID)\">Complain</a>\n        </template>\n        <template #content v-if=\"event.action == ActionType.Name\">\n          {{ event.newName }}\n        </template>\n        <template #content v-else-if=\"event.action == ActionType.Content\">\n          <Markdown :content=\"event.newContent\" :rows=\"10\" />\n        </template>\n        <template #content v-else-if=\"event.action == ActionType.Precondition\">\n          <div v-html=\"getContent(event)\" />\n        </template>\n      </Card>\n    </div>\n  </Fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Fieldset from \"primevue/fieldset\";\nimport Card from \"primevue/card\";\nimport { subscribeChangeLogEnriched, GetNodeUrl } from \"@/api/change_log\";\nimport { computed, reactive, ref, watch, defineComponent } from \"vue\";\nimport {\n  ActionType,\n  ChangeLogEnriched,\n  ChangeLogNodePrecondition\n} from \"@/store/change_log\";\nimport { useStore } from \"@/store\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default defineComponent({\n  name: \"ChangeLog\",\n  computed: {\n    ActionType() {\n      return ActionType;\n    }\n  },\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Markdown,\n    ChangeLogComplain,\n    Fieldset,\n    Card\n  },\n  setup(props) {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const collapsed = ref(true);\n    const changes = reactive([]) as Array<ChangeLogEnriched>;\n    let unsubscribe = () => {\n      /**/\n    };\n    watch(\n      () => [props.nodeId, collapsed.value],\n      async (newArgs, oldArgs) => {\n        if (newArgs[0] != oldArgs[0]) {\n          collapsed.value = true;\n        }\n        unsubscribe();\n        unsubscribe = () => {\n          /**/\n        };\n        if (collapsed.value == false) {\n          unsubscribe = await subscribeChangeLogEnriched(\n            [ActionType.Name, ActionType.Content, ActionType.Precondition],\n            [props.nodeId],\n            changeLogs => {\n              changes.splice(0, changes.length, ...changeLogs);\n            }\n          );\n        }\n      }\n    );\n    return {\n      changes,\n      collapsed,\n      toggle: (event: boolean) => {\n        collapsed.value = event;\n      },\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      getContent: (event: ChangeLogEnriched) => {\n        event = event as ChangeLogNodePrecondition;\n        const removed = [];\n        for (const cd of event.removed) {\n          removed.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n        const added = [];\n        for (const cd of event.added) {\n          added.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n\n        let result = \"\";\n        if (removed.length > 0) {\n          result += `removed: ${removed.join(\", \")}`;\n        }\n        if (added.length > 0) {\n          result += `<br> added: ${added.join(\", \")}`;\n        }\n        return result;\n      },\n      complainModalVisible,\n      complainChangeLink,\n      isAuthorized\n    };\n  }\n});\n</script>\n","export enum ActionType {\n  Remove = \"remove\",\n  ParentID = \"parentID\",\n  Precondition = \"precondition\",\n  Content = \"content\",\n  Name = \"name\"\n}\n\nexport type Node = {\n  id: string;\n  idPath: string;\n  name: string;\n};\n\nexport type ChangeLog = {\n  changeLogID: string;\n  nodeID: string;\n  userID: string;\n  timestamp: number;\n  action: ActionType;\n  attributes: {\n    value: any;\n    valueBefore: any;\n    valueAfter: any;\n    added: any;\n    removed: any;\n    parentNodeID: any;\n  };\n};\n\nexport type ChangeLogNodePrecondition = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  removed: Array<Node>;\n  added: Array<Node>;\n};\n\nexport type ChangeLogNodeContent = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  node: Node;\n\n  newContent: string;\n};\n\nexport type ChangeLogNodeName = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  node: Node;\n\n  newName: string;\n};\n\nexport type ChangeLogNodeParent = {\n  changeLogID: string;\n\n  timestamp: number;\n  action: ActionType;\n\n  userID: string;\n  userDisplayName: string;\n\n  parentNodeBefore: Node;\n  parentNodeAfter: Node | null;\n  node: Node;\n\n  isRemoved: boolean;\n  isAdded: boolean;\n};\n\nexport type ChangeLogEnriched =\n  | ChangeLogNodeContent\n  | ChangeLogNodeName\n  | ChangeLogNodePrecondition\n  | ChangeLogNodeParent;\n","import { ActionType, ChangeLog, ChangeLogEnriched } from \"@/store/change_log\";\nimport { QueryFilterConstraint } from \"@firebase/firestore\";\nimport {\n  and,\n  collection,\n  getFirestore,\n  onSnapshot,\n  orderBy,\n  query,\n  where\n} from \"firebase/firestore\";\nimport firebase from \"firebase/compat\";\n\n/**\n * TODO: add limit\n * @param actions\n * @param nodeIDs\n * @param cb\n */\nexport async function subscribeChangeLog(\n  actions: Array<ActionType>,\n  nodeIDs: Array<string>,\n  cb: (changeLogs: Array<ChangeLog>) => void\n) {\n  const andConditions = [] as Array<QueryFilterConstraint>;\n  if (nodeIDs.length) {\n    andConditions.push(where(\"node_id\", \"in\", nodeIDs));\n  }\n  if (actions.length) {\n    andConditions.push(where(\"action\", \"in\", actions));\n  }\n  const q = query(\n    collection(getFirestore(), \"changes\"),\n    and(...andConditions),\n    orderBy(\"timestamp\", \"desc\")\n  );\n\n  return onSnapshot(q, snapshot => {\n    const changeLogs = [] as Array<ChangeLog>;\n    snapshot.forEach(doc => {\n      changeLogs.push({\n        changeLogID: doc.id,\n        nodeID: doc.get(\"node_id\"),\n        userID: doc.get(\"user_id\"),\n        timestamp: doc.get(\"timestamp\"),\n        action: doc.get(\"action\"),\n        attributes: {\n          value: doc.get(\"attributes.value\"),\n          valueBefore: doc.get(\"attributes.valueBefore\"),\n          valueAfter: doc.get(\"attributes.valueAfter\"),\n          added: doc.get(\"attributes.added\"),\n          removed: doc.get(\"attributes.removed\"),\n          parentNodeID: doc.get(\"attributes.parentNodeID\"),\n        }\n      });\n    });\n    cb(changeLogs);\n  });\n}\n\n/**\n * @param nodeID\n */\nexport async function getNodeName(\n  nodeID: string\n): Promise<Record<string, string>> {\n  const nodeName = {} as Record<string, string>;\n  const pr = await firebase\n    .database()\n    .ref(`map/${nodeID}/name`)\n    .get();\n  if (pr.exists()) {\n    nodeName[`map/${nodeID}`] = pr.val();\n  } else {\n    const prTrash = await firebase\n      .database()\n      .ref(`trash/${nodeID}/map/name`)\n      .get();\n    if (prTrash.exists()) {\n      nodeName[`trash/${nodeID}`] = prTrash.val();\n    }\n  }\n\n  return nodeName;\n}\n\n/**\n * @param userID\n */\nexport async function getUserDisplayName(\n  userID: string\n): Promise<Record<string, string>> {\n  const userName = {} as Record<string, string>;\n  const pr = await firebase\n    .database()\n    .ref(`public_user_data/${userID}/displayName`)\n    .get();\n  if (pr.exists()) {\n    userName[`${userID}`] = pr.val();\n  }\n  return userName;\n}\n\nexport async function getUserDisplayNames(\n  userIDs: Array<string>\n): Promise<Record<string, string>> {\n  const fetches = [];\n  for (const userID of userIDs) {\n    fetches.push(getUserDisplayName(userID));\n  }\n  const responses = await Promise.all(fetches);\n  const result = {} as Record<string, string>;\n  for (const response of responses) {\n    result[Object.keys(response)[0]] = Object.values(response)[0];\n  }\n  return result;\n}\n\n// Note: realtime database charges for bandwidth and does not have batch fetch for multiple paths\n// If someday we switch to Firestore this must be implemented in other way\nexport async function getNodeNames(\n  nodeIDs: Array<string>\n): Promise<Record<string, string>> {\n  const fetches = [];\n  for (const nodeID of nodeIDs) {\n    fetches.push(getNodeName(nodeID));\n  }\n  const responses = await Promise.all(fetches);\n  const result = {} as Record<string, string>;\n  for (const response of responses) {\n    result[Object.keys(response)[0]] = Object.values(response)[0];\n  }\n  return result;\n}\n\nfunction getPathFromNodeName(\n  nodeID: string | null,\n  nodeNames: Record<string, string>\n): string {\n  if (nodeID == null) {\n    return \"\";\n  }\n  let nodePath = \"\";\n  if (nodeNames[`map/${nodeID}`] != null) {\n    nodePath = `map/${nodeID}`;\n  } else if (nodeNames[`trash/${nodeID}`] != null) {\n    nodePath = `trash/${nodeID}`;\n  }\n  return nodePath;\n}\n\n/**\n * Same as subscribeChangeLog but enriched with username\n * @param actions\n * @param nodeIDs\n * @param cb\n */\nexport async function subscribeChangeLogEnriched(\n  actions: Array<ActionType>,\n  nodeIDs: Array<string>,\n  cb: (changeLogsEnriched: Array<ChangeLogEnriched>) => void\n) {\n  return subscribeChangeLog(\n    actions,\n    nodeIDs,\n    (changeLogs: Array<ChangeLog>) => {\n      // collect userIDs to request names\n      // and nodeIDs to request node names\n      const userNames = {} as Record<string, string>;\n      const nodeNames = {} as Record<string, string>;\n      for (const changeLog of changeLogs) {\n        userNames[changeLog.userID] = \"\";\n        nodeNames[changeLog.nodeID] = \"\";\n        if (changeLog.action == ActionType.ParentID) {\n          if (changeLog.attributes.valueBefore != null) {\n            nodeNames[changeLog.attributes.valueBefore] = \"\";\n          }\n          if (changeLog.attributes.valueAfter != null) {\n            nodeNames[changeLog.attributes.valueAfter] = \"\";\n          }\n        }\n        if (changeLog.action == ActionType.Precondition) {\n          if (changeLog.attributes.removed != null) {\n            for (const id of changeLog.attributes.removed) {\n              nodeNames[id] = \"\";\n            }\n          }\n          if (changeLog.attributes.added != null) {\n            for (const id of changeLog.attributes.added) {\n              nodeNames[id] = \"\";\n            }\n          }\n        }\n      }\n      // fetch node and user names\n      const nodeIDs = [];\n      for (const nodeID in nodeNames) {\n        nodeIDs.push(nodeID);\n      }\n      const userIDs = [];\n      for (const userID in userNames) {\n        userIDs.push(userID);\n      }\n      Promise.all([getNodeNames(nodeIDs), getUserDisplayNames(userIDs)]).then(\n        resp => {\n          const nodeNames = resp[0];\n          const userNames = resp[1];\n          const changeLogsEnriched = [] as Array<ChangeLogEnriched>;\n          changeLogs.forEach(log => {\n            const nodePath = getPathFromNodeName(log.nodeID, nodeNames);\n            if (log.action == ActionType.Name) {\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                newName: log.attributes.value\n              });\n            } else if (log.action == ActionType.Content) {\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                newContent: log.attributes.value\n              });\n            } else if (log.action == ActionType.Precondition) {\n              const removed = [];\n              if (log.attributes.removed) {\n                for (const id of log.attributes.removed) {\n                  removed.push({\n                    id: id,\n                    idPath: getPathFromNodeName(id, nodeNames),\n                    name: nodeNames[getPathFromNodeName(id, nodeNames)]\n                  });\n                }\n              }\n              const added = [];\n              if (log.attributes.added) {\n                for (const id of log.attributes.added) {\n                  added.push({\n                    id: id,\n                    idPath: getPathFromNodeName(id, nodeNames),\n                    name: nodeNames[getPathFromNodeName(id, nodeNames)]\n                  });\n                }\n              }\n\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                removed,\n                added\n              });\n            } else if (log.action == ActionType.ParentID && log.attributes.valueAfter !== null) {\n              const beforePath = getPathFromNodeName(\n                log.attributes.valueBefore,\n                nodeNames\n              );\n              const afterPath = getPathFromNodeName(\n                log.attributes.valueAfter,\n                nodeNames\n              );\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                parentNodeBefore: {\n                  id: log.attributes.valueBefore,\n                  idPath: beforePath,\n                  name: nodeNames[beforePath]\n                },\n\n                parentNodeAfter: {\n                  id: log.attributes.valueAfter,\n                  idPath: afterPath,\n                  name: nodeNames[afterPath]\n                },\n\n                isRemoved: false,\n                isAdded: log.attributes.valueBefore == null\n              });\n            } else if (log.action == ActionType.Remove) {\n              const beforePath = getPathFromNodeName(\n                log.attributes.parentNodeID,\n                nodeNames\n              );\n              changeLogsEnriched.push({\n                changeLogID: log.changeLogID,\n\n                timestamp: log.timestamp,\n                action: log.action,\n\n                userID: log.userID,\n                userDisplayName: userNames[log.userID],\n\n                node: {\n                  id: log.nodeID,\n                  idPath: nodePath,\n                  name: nodeNames[nodePath]\n                },\n\n                parentNodeBefore: {\n                  id: log.attributes.parentNodeID,\n                  idPath: beforePath,\n                  name: nodeNames[beforePath]\n                },\n\n                parentNodeAfter: null,\n\n                isRemoved: true,\n                isAdded: false\n              });\n            }\n          });\n          cb(changeLogsEnriched);\n        }\n      );\n    }\n  );\n}\n\nexport function IsNodeInTrash(nodeIDPath: string): boolean {\n  return nodeIDPath.startsWith(\"trash\")\n}\n\nexport function GetNodeUrl(\n  nodeIDPath: string,\n  nodeID: string,\n  nodeName: string\n): string {\n  if (IsNodeInTrash(nodeIDPath)) {\n    return `<a target=\"_blank\" href=\"/node_description/${nodeID}\">${nodeName}</a>`;\n  } else {\n    return `<a target=\"_blank\" href=\"/${nodeID}\">${nodeName}</a>`;\n  }\n}\n","<template>\n  <Dialog\n    v-model:visible=\"complainModalVisible\"\n    @hide=\"$emit('hide')\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{\n          `Please use our discord channel to complain about inappropriate changes`\n        }}\n      </h3>\n    </template>\n    <h3>\n      <a\n        target=\"_blank\"\n        href=\"https://discord.com/channels/1171118046543347782/1196694554791915600\"\n        >Discord edit-complains channel</a\n      >\n    </h3>\n    <p>\n      You can use the following text:\n    </p>\n    <code>\n      Hi, I think I found changes that was inappropriate because ... <br />\n      Here is the changes I am talking about {{ complainChangeLink }} <br />\n      This is the ...st time I found inappropriate changes from this user.\n      <br />\n    </code>\n    <template #footer> </template>\n  </Dialog>\n</template>\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport { ref, watch, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"ChangeLogComplain\",\n  props: {\n    show: Boolean,\n    complainChangeLink: String\n  },\n  components: {\n    Dialog\n  },\n  emits: [\"hide\"],\n  setup(props) {\n    const complainModalVisible = ref(false);\n    watch(\n      () => [props.show],\n      async (newArgs, oldArgs) => {\n        complainModalVisible.value = newArgs[0];\n      }\n    );\n    return {\n      complainModalVisible\n    };\n  }\n});\n</script>\n","\nimport Dialog from \"primevue/dialog\";\nimport { ref, watch, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"ChangeLogComplain\",\n  props: {\n    show: Boolean,\n    complainChangeLink: String\n  },\n  components: {\n    Dialog\n  },\n  emits: [\"hide\"],\n  setup(props) {\n    const complainModalVisible = ref(false);\n    watch(\n      () => [props.show],\n      async (newArgs, oldArgs) => {\n        complainModalVisible.value = newArgs[0];\n      }\n    );\n    return {\n      complainModalVisible\n    };\n  }\n});\n","import { render } from \"./ChangeLogComplain.vue?vue&type=template&id=0a57cd10\"\nimport script from \"./ChangeLogComplain.vue?vue&type=script&lang=ts\"\nexport * from \"./ChangeLogComplain.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport Fieldset from \"primevue/fieldset\";\nimport Card from \"primevue/card\";\nimport { subscribeChangeLogEnriched, GetNodeUrl } from \"@/api/change_log\";\nimport { computed, reactive, ref, watch, defineComponent } from \"vue\";\nimport {\n  ActionType,\n  ChangeLogEnriched,\n  ChangeLogNodePrecondition\n} from \"@/store/change_log\";\nimport { useStore } from \"@/store\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default defineComponent({\n  name: \"ChangeLog\",\n  computed: {\n    ActionType() {\n      return ActionType;\n    }\n  },\n  props: {\n    nodeId: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    Markdown,\n    ChangeLogComplain,\n    Fieldset,\n    Card\n  },\n  setup(props) {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const collapsed = ref(true);\n    const changes = reactive([]) as Array<ChangeLogEnriched>;\n    let unsubscribe = () => {\n      /**/\n    };\n    watch(\n      () => [props.nodeId, collapsed.value],\n      async (newArgs, oldArgs) => {\n        if (newArgs[0] != oldArgs[0]) {\n          collapsed.value = true;\n        }\n        unsubscribe();\n        unsubscribe = () => {\n          /**/\n        };\n        if (collapsed.value == false) {\n          unsubscribe = await subscribeChangeLogEnriched(\n            [ActionType.Name, ActionType.Content, ActionType.Precondition],\n            [props.nodeId],\n            changeLogs => {\n              changes.splice(0, changes.length, ...changeLogs);\n            }\n          );\n        }\n      }\n    );\n    return {\n      changes,\n      collapsed,\n      toggle: (event: boolean) => {\n        collapsed.value = event;\n      },\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      getContent: (event: ChangeLogEnriched) => {\n        event = event as ChangeLogNodePrecondition;\n        const removed = [];\n        for (const cd of event.removed) {\n          removed.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n        const added = [];\n        for (const cd of event.added) {\n          added.push(GetNodeUrl(cd.idPath, cd.id, cd.name));\n        }\n\n        let result = \"\";\n        if (removed.length > 0) {\n          result += `removed: ${removed.join(\", \")}`;\n        }\n        if (added.length > 0) {\n          result += `<br> added: ${added.join(\", \")}`;\n        }\n        return result;\n      },\n      complainModalVisible,\n      complainChangeLink,\n      isAuthorized\n    };\n  }\n});\n","import { render } from \"./ChangeLog.vue?vue&type=template&id=1f629591\"\nimport script from \"./ChangeLog.vue?vue&type=script&lang=ts\"\nexport * from \"./ChangeLog.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <PinIcon @click=\"clickPin\">pin</PinIcon>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{ `Choose parent from which pin will be visible` }}\n      </h3>\n    </template>\n\n    <Listbox v-model=\"selectedParent\" :options=\"parents\" optionLabel=\"title\" />\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport Listbox from \"primevue/listbox\";\nimport {actions, useStore} from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { actions as pinActions } from \"@/store/pin\";\nimport api from \"@/api/api\";\nimport PinIcon from \"@/components/node_content/PinIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\n\nexport default {\n  name: \"PinButton\",\n  components: {\n    PinIcon,\n    Dialog,\n    Button,\n    Listbox\n  },\n  setup() {\n    const store = useStore();\n    const confirm = useConfirm();\n    const treeState = store.state.tree;\n    const addDialogVisible = ref(false);\n    const selectedParent = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const newNodeTitle = ref(\"\");\n    const parents = computed(() => {\n      const selectedNodeParents = [];\n      let currentParent = treeState.nodeRecord[treeState.selectedNodeId].parent;\n      while (treeState.nodeRecord[currentParent.id].parent) {\n        selectedNodeParents.push({\n          title: currentParent.title,\n          id: currentParent.id\n        });\n        currentParent = treeState.nodeRecord[currentParent.id].parent;\n      }\n      selectedNodeParents.push({ title: \"root\", id: 0 });\n      return selectedNodeParents;\n    });\n\n    return {\n      clickPin: async () => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to pin nodes\"});\n          return\n        }\n        if (\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n        ) {\n          store.dispatch(\n            `pin/${pinActions.RemovePin}`,\n            store.state.tree.selectedNodeId\n          );\n          api.savePins(store.state.user.user, store.state.pin.pins);\n        } else {\n          addDialogVisible.value = !addDialogVisible.value;\n        }\n      },\n      selectedParent,\n      parents,\n      add: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`pin/${pinActions.AddPin}`, {\n          parentId: selectedParent.value.id,\n          nodeId: selectedNode.value.id\n        });\n        api.savePins(store.state.user.user, store.state.pin.pins);\n        selectedParent.value = null;\n      },\n      cancelAdd: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible,\n      newNodeTitle\n    };\n  }\n};\n</script>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"isPinned || mouseOver\" class=\"pin\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/pin-on.svg\"\n      />\n    </div>\n    <div v-else class=\"pin\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/pin-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from \"@/store\";\nimport { computed, ref } from \"vue\";\n\nexport default {\n  name: \"PinIcon\",\n  setup() {\n    const store = useStore();\n    const mouseOver = ref(false);\n    return {\n      isPinned: computed(\n        () =>\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n      ),\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.pin {\n  margin-top: 15px;\n  margin-left: 15px;\n}\n</style>\n","import { render } from \"./PinIcon.vue?vue&type=template&id=5b15f4ff&scoped=true\"\nimport script from \"./PinIcon.vue?vue&type=script&lang=js\"\nexport * from \"./PinIcon.vue?vue&type=script&lang=js\"\n\nimport \"./PinIcon.vue?vue&type=style&index=0&id=5b15f4ff&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-5b15f4ff\"\n\nexport default script","import { render } from \"./PinButton.vue?vue&type=template&id=b6319360\"\nimport script from \"./PinButton.vue?vue&type=script&lang=js\"\nexport * from \"./PinButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <p\n    v-show=\"!editOn\"\n    v-html=\"renderedContent\"\n    @click=\"setEditOn(true)\"\n    class=\"title\"\n  />\n  <textarea\n    class=\"title rawTitle p-inputtextarea p-inputtext p-component p-inputtextarea-resizable\"\n    style=\"display: none\"\n    ref=\"txtarea\"\n    rows=\"1\"\n    :value=\"content\"\n    @input=\"changeContent($event.target.value)\"\n    @focusout=\"setEditOn(false)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { computed, ref } from \"vue\";\nimport {useStore} from \"@/store\";\n\nexport default {\n  name: \"Title\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const renderedContent = computed(() => {\n      return props.content;\n    });\n    const editOn = ref(false);\n    const store = useStore();\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        if (!store.state.user ||\n            !store.state.user.user ||\n            store.state.user.user.isAnonymous) {\n          return\n        }\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n</script>\n\n<style scoped>\n.title {\n  font-family: \"Google Sans\", Roboto, Arial, sans-serif;\n  font-size: 1.375rem;\n  font-weight: 400;\n  letter-spacing: 0;\n  line-height: 1.75rem;\n}\n.rawTitle {\n  margin-top: 10px;\n}\n</style>\n","\nimport { computed, ref } from \"vue\";\nimport {useStore} from \"@/store\";\n\nexport default {\n  name: \"Title\",\n  emits: [\"content-changed\"],\n  props: {\n    content: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props: any, ctx: any) {\n    const renderedContent = computed(() => {\n      return props.content;\n    });\n    const editOn = ref(false);\n    const store = useStore();\n    const txtarea = ref<HTMLDivElement | null>(null);\n\n    return {\n      editOn,\n      txtarea,\n      setEditOn: (val: boolean) => {\n        if (!store.state.user ||\n            !store.state.user.user ||\n            store.state.user.user.isAnonymous) {\n          return\n        }\n        editOn.value = val;\n        if (val && txtarea.value) {\n          txtarea.value.style.display = \"block\";\n          txtarea.value.focus();\n        }\n        if (!val && txtarea.value) {\n          txtarea.value.style.display = \"none\";\n        }\n      },\n      renderedContent,\n      changeContent: (value: string) => {\n        ctx.emit(\"content-changed\", value);\n      }\n    };\n  }\n};\n","import { render } from \"./Title.vue?vue&type=template&id=00857be5&scoped=true\"\nimport script from \"./Title.vue?vue&type=script&lang=ts\"\nexport * from \"./Title.vue?vue&type=script&lang=ts\"\n\nimport \"./Title.vue?vue&type=style&index=0&id=00857be5&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-00857be5\"\n\nexport default script","<template>\n  <AddBasedOnIcon @click=\"showAddBanner\" />\n  <Dialog\n    v-model:visible=\"addBannerVisible\"\n    :dismissableMask=\"false\"\n    :closable=\"true\"\n    :modal=\"false\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        Set \"{{\n          preconditionNode.title\n            ? preconditionNode.title\n            : selectedNode\n            ? selectedNode.title\n            : \"\"\n        }}\" as precondition for \"{{ targetNode ? targetNode.title : \"\" }}\"\n      </h3>\n    </template>\n\n    <template #footer>\n      <Button\n        label=\"Cancel\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Done\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport {actions, useStore} from \"@/store\";\nimport { computed, ref, watch } from \"vue\";\nimport api from \"@/api/api\";\nimport AddBasedOnIcon from \"@/components/node_content/AddBasedOnIcon.vue\";\nimport {useConfirm} from \"primevue/useconfirm\";\n\nexport default {\n  name: \"AddBasedOnButton\",\n  components: {\n    Dialog,\n    Button,\n    AddBasedOnIcon\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props, ctx) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const addBannerVisible = ref(false);\n    const targetNode = ref({}); // node where precondition must be added\n    const preconditionNode = ref({}); // node where precondition must be added\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]); // current selected node\n\n    watch(\n      () => props.clickedTitleId,\n      () => {\n        if (\n          props.clickedTitleId !== \"-1\" &&\n          store.state.tree.nodeRecord[props.clickedTitleId]\n        ) {\n          preconditionNode.value =\n            store.state.tree.nodeRecord[props.clickedTitleId].node;\n        }\n      },\n      { immediate: true }\n    );\n\n    return {\n      showAddBanner: async () => {\n        if (!(store.state.user && store.state.user.user && !store.state.user.user.isAnonymous)) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to added node prerequisites\"});\n          return\n        }\n        ctx.emit(\"select-precondition-is-on\");\n        targetNode.value = store.getters[\"tree/selectedNode\"];\n        addBannerVisible.value = !addBannerVisible.value;\n      },\n      add: () => {\n        let preconditionsIDs = [];\n        if (store.state.precondition.preconditions[targetNode.value.id]) {\n          preconditionsIDs =\n            store.state.precondition.preconditions[targetNode.value.id];\n        }\n        preconditionsIDs.push(preconditionNode.value.id);\n\n        api.savePreconditions(store.state.user.user, {\n          nodeId: targetNode.value.id,\n          preconditionIds: preconditionsIDs\n        });\n        ctx.emit(\"select-precondition-is-off\");\n        addBannerVisible.value = false;\n        preconditionNode.value = {};\n      },\n      cancelAdd: () => {\n        addBannerVisible.value = false;\n        preconditionNode.value = {};\n        ctx.emit(\"select-precondition-is-off\");\n      },\n      addBannerVisible,\n      targetNode,\n      preconditionNode,\n      selectedNode\n    };\n  }\n};\n</script>\n","<template>\n  <div\n    style=\"cursor: pointer;\"\n    @mouseenter=\"mouseOver = true\"\n    @mouseleave=\"mouseOver = false\"\n  >\n    <div v-if=\"mouseOver\" class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-off\"\n        src=\"../../assets/images/add-on.svg\"\n      />\n    </div>\n    <div v-else class=\"custom\">\n      <img\n        style=\"height: 35px\"\n        alt=\"pin-on\"\n        src=\"../../assets/images/add-off.svg\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"AddBasedOnIcon\",\n  setup() {\n    const mouseOver = ref(false);\n    return {\n      mouseOver\n    };\n  }\n};\n</script>\n\n<style scoped>\n.custom {\n  margin-left: 15px;\n}\n</style>\n","import { render } from \"./AddBasedOnIcon.vue?vue&type=template&id=2494d1ac&scoped=true\"\nimport script from \"./AddBasedOnIcon.vue?vue&type=script&lang=js\"\nexport * from \"./AddBasedOnIcon.vue?vue&type=script&lang=js\"\n\nimport \"./AddBasedOnIcon.vue?vue&type=style&index=0&id=2494d1ac&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-2494d1ac\"\n\nexport default script","import { render } from \"./AddBasedOnButton.vue?vue&type=template&id=049d9794\"\nimport script from \"./AddBasedOnButton.vue?vue&type=script&lang=js\"\nexport * from \"./AddBasedOnButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <img v-if=\"isAuthorized\"\n    style=\"position: absolute; left:0; top:0; width: 100%; height: 240px; cursor: pointer;\"\n    alt=\"welcome\"\n    :src=\"defaultImageURL\"\n    @click=\"toggleAddDialog\"\n  />\n  <img v-else\n       style=\"position: absolute; left:0; top:0; width: 100%; height: 240px;\"\n       alt=\"welcome\"\n       :src=\"defaultImageURL\"\n  />\n  <input\n    type=\"file\"\n    ref=\"input\"\n    style=\"display: none\"\n    @change=\"onInputChange\"\n    accept=\"image/*\"\n  />\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <div style=\"width: 100%; padding-right:10px;\">\n        Upload new one or choose from the list\n      </div>\n    </template>\n    <Button rounded @click=\"triggerUpload\">upload</Button>\n\n    <Card v-for=\"(item, i) of items\" :key=\"i\" class=\"mt-3\">\n      <template #content>\n        <img alt=\"image\" :src=\"item.url\" style=\"width:300px;\" />\n        <div>\n          <Button\n            rounded\n            @click=\"setAsDefault(item.url)\"\n            style=\"margin-right: 50px;\"\n            >set as default</Button\n          >\n          <Button rounded @click=\"copyURL(item.url)\">copy URL</Button>\n        </div>\n      </template>\n    </Card>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport Button from \"primevue/button\";\nimport {computed, defineComponent, ref, watchEffect} from \"vue\";\nimport { useStore } from \"@/store\";\nimport firebase from \"firebase/compat\";\nimport { useToast } from \"primevue/usetoast\";\n\nexport default defineComponent({\n  name: \"TitleImage\",\n  components: {\n    Button,\n    Card,\n    Dialog\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const toast = useToast();\n    const store = useStore();\n    const addDialogVisible = ref(false);\n    const input = ref();\n    const defaultURL = \"https://cdn.scimap.org/images/default.jpg\";\n    const items = ref([] as Array<{\n      name: string;\n      url: string;\n    }>);\n    const uploadProgress = ref(0);\n    const defaultImageURL = ref(defaultURL);\n    const dbNodeImgPath = computed(() => `/node_image/${props.nodeID}`);\n    watchEffect(\n        () => {\n          const images = store.state.image.images[props.nodeID]\n          items.value = []\n          items.value.push({\n            name: \"default\",\n            url: defaultURL\n          })\n          for (const key in images) {\n            if (key == \"default\") {\n              defaultImageURL.value =  images[key].url;\n              continue;\n            }\n            items.value.push({\n              name: images[key].name,\n              url: process.env.VUE_APP_IS_EMULATOR === \"true\" ? images[key].url : 'https://cdn.scimap.org'+images[key].path\n            });\n          }\n        }\n    )\n    return {\n      items,\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      defaultImageURL,\n      setAsDefault: async (url: string) => {\n        await firebase\n          .database()\n          .ref(`${dbNodeImgPath.value}`)\n          .update({\n            default: {\n              url,\n              name: \"\"\n            }\n          });\n      },\n      copyURL: async (url: string) => {\n        await navigator.clipboard.writeText(url);\n      },\n      toggleAddDialog: () => {\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      addDialogVisible,\n      input,\n      triggerUpload: () => {\n        input.value.click();\n      },\n      onInputChange: (event: {\n        target: {\n          files: Array<File>;\n        };\n      }) => {\n        if (\n          !store.state.user ||\n          !store.state.user.user ||\n          store.state.user.user.isAnonymous ||\n          props.nodeID.length == 0\n        ) {\n          return;\n        }\n        uploadProgress.value = 0;\n        const imgFile = event.target.files[0] as File;\n        if (imgFile.size > 1_000_000) {\n          console.log(\"cannot upload file > 1Mb\");\n          toast.add({\n            severity: \"info\",\n            summary: \"Sorry\",\n            detail: \"Cannot upload file > 1Mb\",\n            life: 3000\n          });\n          return;\n        }\n        const name = imgFile.name;\n        const ext =\n          name.substring(name.lastIndexOf(\".\") + 1, name.length) || name;\n        const fileName = new Date().getTime();\n        const filePath = `/user/${store.state.user.user.uid}/image/${fileName}.${ext}`\n        const storageRef = firebase\n          .storage()\n          .ref(filePath)\n          .put(imgFile);\n        storageRef.on(\n          \"state_changed\",\n          snapshot => {\n            uploadProgress.value =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          },\n          error => {\n            console.log(error.message);\n          },\n          () => {\n            uploadProgress.value = 100;\n            storageRef.snapshot.ref.getDownloadURL().then(url => {\n              let parsedURL = {} as URL\n              try {\n                parsedURL = new URL(url);\n              } catch (error) {\n                console.log(error);\n                return\n              }\n              // removed token=... from url\n              const preparedURL = parsedURL.protocol+'//'+parsedURL.hostname+(parsedURL.port == '' ? '' : ':'+parsedURL.port)+parsedURL.pathname+'?alt=media';\n              firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${fileName}`)\n                .update({\n                  name,\n                  path: filePath,\n                  url: preparedURL,\n                });\n            });\n          }\n        );\n      }\n    };\n  }\n});\n</script>\n","\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport Button from \"primevue/button\";\nimport {computed, defineComponent, ref, watchEffect} from \"vue\";\nimport { useStore } from \"@/store\";\nimport firebase from \"firebase/compat\";\nimport { useToast } from \"primevue/usetoast\";\n\nexport default defineComponent({\n  name: \"TitleImage\",\n  components: {\n    Button,\n    Card,\n    Dialog\n  },\n  props: {\n    nodeID: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const toast = useToast();\n    const store = useStore();\n    const addDialogVisible = ref(false);\n    const input = ref();\n    const defaultURL = \"https://cdn.scimap.org/images/default.jpg\";\n    const items = ref([] as Array<{\n      name: string;\n      url: string;\n    }>);\n    const uploadProgress = ref(0);\n    const defaultImageURL = ref(defaultURL);\n    const dbNodeImgPath = computed(() => `/node_image/${props.nodeID}`);\n    watchEffect(\n        () => {\n          const images = store.state.image.images[props.nodeID]\n          items.value = []\n          items.value.push({\n            name: \"default\",\n            url: defaultURL\n          })\n          for (const key in images) {\n            if (key == \"default\") {\n              defaultImageURL.value =  images[key].url;\n              continue;\n            }\n            items.value.push({\n              name: images[key].name,\n              url: process.env.VUE_APP_IS_EMULATOR === \"true\" ? images[key].url : 'https://cdn.scimap.org'+images[key].path\n            });\n          }\n        }\n    )\n    return {\n      items,\n      isAuthorized: computed(()=>store.state.user && store.state.user.user && !store.state.user.user.isAnonymous),\n      defaultImageURL,\n      setAsDefault: async (url: string) => {\n        await firebase\n          .database()\n          .ref(`${dbNodeImgPath.value}`)\n          .update({\n            default: {\n              url,\n              name: \"\"\n            }\n          });\n      },\n      copyURL: async (url: string) => {\n        await navigator.clipboard.writeText(url);\n      },\n      toggleAddDialog: () => {\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      addDialogVisible,\n      input,\n      triggerUpload: () => {\n        input.value.click();\n      },\n      onInputChange: (event: {\n        target: {\n          files: Array<File>;\n        };\n      }) => {\n        if (\n          !store.state.user ||\n          !store.state.user.user ||\n          store.state.user.user.isAnonymous ||\n          props.nodeID.length == 0\n        ) {\n          return;\n        }\n        uploadProgress.value = 0;\n        const imgFile = event.target.files[0] as File;\n        if (imgFile.size > 1_000_000) {\n          console.log(\"cannot upload file > 1Mb\");\n          toast.add({\n            severity: \"info\",\n            summary: \"Sorry\",\n            detail: \"Cannot upload file > 1Mb\",\n            life: 3000\n          });\n          return;\n        }\n        const name = imgFile.name;\n        const ext =\n          name.substring(name.lastIndexOf(\".\") + 1, name.length) || name;\n        const fileName = new Date().getTime();\n        const filePath = `/user/${store.state.user.user.uid}/image/${fileName}.${ext}`\n        const storageRef = firebase\n          .storage()\n          .ref(filePath)\n          .put(imgFile);\n        storageRef.on(\n          \"state_changed\",\n          snapshot => {\n            uploadProgress.value =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          },\n          error => {\n            console.log(error.message);\n          },\n          () => {\n            uploadProgress.value = 100;\n            storageRef.snapshot.ref.getDownloadURL().then(url => {\n              let parsedURL = {} as URL\n              try {\n                parsedURL = new URL(url);\n              } catch (error) {\n                console.log(error);\n                return\n              }\n              // removed token=... from url\n              const preparedURL = parsedURL.protocol+'//'+parsedURL.hostname+(parsedURL.port == '' ? '' : ':'+parsedURL.port)+parsedURL.pathname+'?alt=media';\n              firebase\n                .database()\n                .ref(`${dbNodeImgPath.value}/${fileName}`)\n                .update({\n                  name,\n                  path: filePath,\n                  url: preparedURL,\n                });\n            });\n          }\n        );\n      }\n    };\n  }\n});\n","import { render } from \"./TitleImage.vue?vue&type=template&id=ac7cd7b2\"\nimport script from \"./TitleImage.vue?vue&type=script&lang=ts\"\nexport * from \"./TitleImage.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { actions, useStore } from \"@/store\";\nimport { actions as nodeContentActions } from \"@/store/node_content\";\nimport { computed, defineComponent } from \"vue\";\nimport TextArea from \"primevue/textarea\";\nimport SectionPreconditions from \"./Preconditions.vue\";\nimport SectionUsedBy from \"./UsedBy.vue\";\nimport { Tree } from \"@/types/graphics\";\nimport { EmptyNodeContent, NodeContent } from \"@/store/node_content\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { useConfirm } from \"primevue/useconfirm\";\nimport api from \"@/api/api\";\nimport Markdown from \"./Markdown.vue\";\nimport ChangeLog from \"./ChangeLog.vue\";\nimport PinButton from \"./PinButton.vue\";\nimport Title from \"@/components/node_content/Title.vue\";\nimport AddBasedOnButton from \"@/components/node_content/AddBasedOnButton.vue\";\nimport TitleImage from \"@/components/node_content/TitleImage.vue\";\n\nexport default defineComponent({\n  name: \"NodeContent\",\n  components: {\n    TitleImage,\n    AddBasedOnButton,\n    Title,\n    SectionUsedBy,\n    Markdown,\n    TextArea,\n    SectionPreconditions,\n    ChangeLog,\n    PinButton\n  },\n  emits: [\"select-precondition-is-on\", \"select-precondition-is-off\"],\n  props: {\n    show: {\n      type: Boolean,\n      required: true\n    },\n    selectedNodeId: {\n      type: String || null,\n      validator: (prop: string | null) =>\n        typeof prop === \"string\" || prop === null,\n      required: true\n    },\n    clickedTitleId: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const store = useStore();\n    const confirm = useConfirm();\n    const tree = store.state.tree;\n\n    const selectedNode = computed<Tree | null>(() =>\n      props.selectedNodeId && tree.nodeRecord[props.selectedNodeId]\n        ? tree.nodeRecord[props.selectedNodeId].node\n        : null\n    );\n\n    const selectedNodeContent = computed<NodeContent | null>(() => {\n      if (\n        props.selectedNodeId &&\n        store.state.nodeContent.nodeContents[props.selectedNodeId]\n      ) {\n        return store.state.nodeContent.nodeContents[props.selectedNodeId];\n      }\n      const newContent = clone(EmptyNodeContent);\n      newContent.nodeID = props.selectedNodeId;\n      return newContent;\n    });\n\n    const selectedNodeComment = computed<string>(() =>\n      props.selectedNodeId &&\n      store.state.nodeContent.userNodeComments[props.selectedNodeId]\n        ? store.state.nodeContent.userNodeComments[props.selectedNodeId].comment\n        : \"\"\n    );\n\n    return {\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNode,\n      selectedNodeContent,\n      checkAuthorized: async (e: Event) => {\n        if (!store.state.user.user || store.state.user.user.isAnonymous) {\n          await store.dispatch(`${actions.confirmSignInPopup}`, {confirm, message:\"Please authorize to add comments and edit content\"});\n          e.preventDefault();\n        }\n      },\n      selectedNodeComment,\n      changeNodeTitle: async (value: string) => {\n        if (!selectedNode.value || !selectedNode.value.id) {\n          return;\n        }\n        const err = await api.debouncedUpdate({\n          [`map/${selectedNode.value.id}/name`]: value\n        });\n\n        if (err) {\n          printError(err.error.message, err.kv);\n        }\n      },\n      changeContent: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeContent}`,\n          {\n            nodeID: selectedNode.value!.id,\n            content: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      },\n      changeComment: async (value: string) => {\n        const err = await store.dispatch(\n          `nodeContent/${nodeContentActions.setNodeComment}`,\n          {\n            nodeID: selectedNode.value!.id,\n            comment: value\n          }\n        );\n\n        if (err) {\n          printError(err, {});\n        }\n      }\n    };\n  }\n});\n","import { render } from \"./Index.vue?vue&type=template&id=17638f3a&scoped=true\"\nimport script from \"./Index.vue?vue&type=script&lang=ts\"\nexport * from \"./Index.vue?vue&type=script&lang=ts\"\n\nimport \"./Index.vue?vue&type=style&index=0&id=17638f3a&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-17638f3a\"\n\nexport default script","<template>\n  <div :class=\"$style.textSearch\">\n    <TextSearch />\n  </div>\n  <div :class=\"$style.wrapper\">\n    <div v-if=\"email\" style=\"width:100%\">\n      <div style=\"position: absolute; right: 2rem;\">\n        <MenuButton @click=\"toggleUserMenu\">\n          <img\n            alt=\"user\"\n            src=\"../../assets/images/user.svg\"\n            style=\"width: 20px\"\n          />\n        </MenuButton>\n        <PrimeMenu ref=\"menu\" id=\"overlay_menu\" :model=\"items\" :popup=\"true\" />\n      </div>\n      <div style=\"position: absolute; right: 6.1rem;\">\n        <Feedback />\n      </div>\n      <EditMode style=\"position: absolute; right: 12.5rem;\" />\n      <div\n          v-if=\"editModeOn\"\n          style=\"position: absolute; right: 20.6rem;\"\n      >\n        <MapChangeLog />\n      </div>\n      <div v-if=\"editModeOn\" style=\"position: absolute; right: 26.6rem;\">\n        <AddNode />\n      </div>\n      <div v-if=\"editModeOn\" style=\"position: absolute; right: 32.6rem;\">\n        <RemoveNode />\n      </div>\n      <div\n        v-if=\"editModeOn\"\n        style=\"position: absolute; right: 39.6rem;\"\n      >\n        <CutPaste />\n      </div>\n    </div>\n    <div v-else>\n      <Button\n        @click=\"signIn\"\n        style=\"position: absolute; right: 2rem;\"\n        rounded\n        size=\"small\"\n        icon=\"pi pi-sign-in\"\n        label=\"sign in\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { actions as userActions } from \"@/store/user\";\nimport AddNode from \"./AddNode\";\nimport RemoveNode from \"./RemoveNode\";\nimport EditMode from \"./EditMode\";\nimport CutPaste from \"@/components/menu/CutPaste\";\nimport Feedback from \"@/components/menu/Feedback\";\nimport TextSearch from \"@/components/menu/Textsearch\";\nimport MapChangeLog from \"@/components/menu/MapChangeLog\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport PrimeMenu from \"primevue/menu\";\nimport Button from \"primevue/button\";\n\nexport default {\n  name: \"Menu\",\n  components: {\n    Button,\n    PrimeMenu,\n    MenuButton,\n    Feedback,\n    CutPaste,\n    AddNode,\n    RemoveNode,\n    EditMode,\n    TextSearch,\n    MapChangeLog\n  },\n  setup() {\n    const store = useStore();\n    const user = store.state.user;\n    const menu = ref();\n\n    // user info\n    const userPhotoURL = computed(() =>\n      user.user && user.user.photoURL\n        ? user.user.photoURL\n        : \"../../assets/images/user.svg\"\n    );\n    const email = computed(() => (user.user ? user.user.email : null));\n    const items = computed(() => {\n      return [\n        {\n          label: email.value,\n          items: [\n            {\n              label: \"sign out\",\n              icon: \"pi pi-sign-out\",\n              command: () => {\n                store.dispatch(`user/${userActions.signOut}`);\n              }\n            }\n          ]\n        }\n      ];\n    });\n    return {\n      email,\n      userPhotoURL,\n      editModeOn: computed(() => store.state.editModeOn),\n      isNodeSelected: computed(() => store.state.tree.selectedNodeId),\n      isPinned: computed(\n        () =>\n          store.state.pin.pins[store.state.tree.selectedNodeId] !== undefined\n      ),\n      // SignIn\n      signIn: () => store.dispatch(`user/${userActions.signIn}`),\n      // User Menu\n      menu,\n      toggleUserMenu: event => {\n        menu.value.toggle(event);\n      },\n      items\n    };\n  }\n};\n</script>\n\n<style module>\n.wrapper {\n  position: fixed;\n  display: flex;\n  top: 0;\n  right: 0;\n  padding: 8px;\n  background-color: rgba(255, 255, 255, 0.2);\n  width: 70%;\n}\n.textSearch {\n  position: fixed;\n  display: flex;\n  top: 0;\n  left: 0;\n  width: 30%;\n  padding: 15px 20px;\n  background: linear-gradient(rgba(120, 120, 120, 0.4), rgba(120, 120, 120, 0));\n}\n</style>\n","<template>\n  <MenuButton @click=\"toggleAddDialog\">\n    <img alt=\"icon\" src=\"../../assets/images/add-off.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">add</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        {{\n          selectedNodeTitle\n            ? `Add subsection to ${selectedNodeTitle}`\n            : `Add section`\n        }}\n      </h3>\n    </template>\n\n    <Input type=\"text\" v-model=\"newNodeTitle\" />\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancelAdd\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"add\" />\n    </template>\n  </Dialog>\n</template>\n\n<script>\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport Input from \"primevue/inputtext\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"AddNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button,\n    Input\n  },\n  setup() {\n    const store = useStore();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const newNodeTitle = ref(\"\");\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      add: async () => {\n        const newNodeID = await store.dispatch(`${actions.createNode}`, {\n          parentID: selectedNode.value ? selectedNode.value.id : 0,\n          title: newNodeTitle.value\n        });\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          [\n            newNodeID,\n            ...store.state.tree.nodeRecord[\n              selectedNode.value.id\n            ].node.children.map(node => node.id)\n          ]\n        );\n        newNodeTitle.value = \"\";\n        addDialogVisible.value = false;\n      },\n      cancelAdd: () => {\n        newNodeTitle.value = \"\";\n        addDialogVisible.value = false;\n      },\n      addDialogVisible,\n      newNodeTitle\n    };\n  }\n};\n</script>\n","<template>\n  <Button\n    size=\"small\"\n    rounded\n    @mouseenter=\"mouseover = true\"\n    @mouseleave=\"mouseover = false\"\n    :style=\"\n      (mouseover\n        ? `background-color: #03dbfc; `\n        : bgColor\n        ? `background-color: ${bgColor};`\n        : `background-color: white;`) + `color: black; border-color:#3B6BF9;`\n    \"\n  >\n    <slot></slot>\n  </Button>\n</template>\n\n<script>\nimport Button from \"primevue/button\";\nimport { ref, defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"MenuButton\",\n  components: {\n    Button\n  },\n  props: {\n    bgColor: String\n  },\n  setup() {\n    const mouseover = ref(false);\n    return {\n      mouseover\n    };\n  }\n});\n</script>\n","import { render } from \"./MenuButton.vue?vue&type=template&id=4db6f65c\"\nimport script from \"./MenuButton.vue?vue&type=script&lang=js\"\nexport * from \"./MenuButton.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./AddNode.vue?vue&type=template&id=294721ad\"\nimport script from \"./AddNode.vue?vue&type=script&lang=js\"\nexport * from \"./AddNode.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton @click=\"toggleDialog\" :disabled=\"!selectedNodeTitle\">\n    <img alt=\"icon\" src=\"../../assets/images/remove-off.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">delete</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n  >\n    <template #header>\n      <h3>\n        {{ `Remove \"${selectedNodeTitle}\" and all its descendants?` }}\n      </h3>\n    </template>\n\n    <template #footer>\n      <Button\n        label=\"No\"\n        icon=\"pi pi-times\"\n        class=\"p-button-text\"\n        @click=\"cancel\"\n      />\n      <Button label=\"Yes\" icon=\"pi pi-check\" @click=\"remove\" />\n    </template>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport {mutations as treeMutations} from \"@/store/tree\";\nimport {useToast} from \"primevue/usetoast\";\nimport {getArrayDiff, idToLink} from \"../helpers\";\n\nexport default {\n  name: \"RemoveNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button\n  },\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleDialog: () => {\n        const nodeID = selectedNode.value.id\n\n        // collect all children IDs recursively\n        let stack = [nodeID];\n        const allChildrenIDs = [];\n        while (stack.length>0) {\n          const id = stack.pop()\n          allChildrenIDs.push(id)\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // collect all nodes where nodeID or its children were set as preconditions for nodes outside allChildrenIDs\n        stack = [nodeID];\n        const usedByNodes = {} as Record<string, Array<string>>;\n        while (stack.length>0) {\n          const id = stack.pop()\n          const [added, removed] = getArrayDiff(allChildrenIDs, store.state.precondition.reverseIndex[id])\n          if (store.state.precondition.reverseIndex[id] && added.length>0\n          ) {\n            usedByNodes[id] = added\n          }\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // show deny message\n        if (Object.keys(usedByNodes).length > 0) {\n          const nr = store.state.tree.nodeRecord\n          let detailText = ''\n          for (const id in usedByNodes) {\n            detailText += `<div>- remove ${idToLink(id, nr)} from 'based on' of ${usedByNodes[id].map((id)=>idToLink(id, nr)).join(', ')}</div>`\n          }\n          toast.add({\n            severity: \"info\",\n            summary: \"Cannot remove node until some other nodes use it or its children in their 'based on'\",\n            detail: \"If you are sure you want to remove it, please: \"+detailText,\n            life: 30000\n          });\n\n          return\n        }\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      remove: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`${actions.removeNode}`, selectedNode.value.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          store.state.tree.nodeRecord[\n            selectedNode.value.id\n          ].parent!.children.map(node => node.id)\n        );\n        // switch selectedNodeId to parent of removed node\n        store.commit(\n            `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n            store.state.tree.nodeRecord[\n                selectedNode.value.id\n                ].parent!.id\n        );\n      },\n      cancel: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible\n    };\n  }\n};\n</script>\n","import {NodeRecordItem} from \"@/store/tree\";\n\nexport function idToLink(id: string, nodeRecord: Record<string, NodeRecordItem>): string {\n  return `<a href='/${id}'>${nodeRecord[id] ? nodeRecord[id].node.title : 'undefined'}</a>`\n}\n\nexport function getArrayDiff(beforeArr: Array<string>, afterArr: Array<string>) {\n  const beforeMap = {} as Record<string, boolean>\n  for (const idx in beforeArr) {\n    beforeMap[beforeArr[idx]] = true\n  }\n  const afterMap = {} as Record<string, boolean>\n  for (const idx in afterArr) {\n    afterMap[afterArr[idx]] = true\n  }\n  const added = []\n  for (const id in afterMap) {\n    if (!beforeMap[id]) {\n      added.push(id)\n    }\n  }\n  const removed = []\n  for (const id in beforeMap) {\n    if (!afterMap[id]) {\n      removed.push(id)\n    }\n  }\n\n  return [added, removed]\n}\n","\nimport Dialog from \"primevue/dialog\";\nimport Button from \"primevue/button\";\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport {mutations as treeMutations} from \"@/store/tree\";\nimport {useToast} from \"primevue/usetoast\";\nimport {getArrayDiff, idToLink} from \"../helpers\";\n\nexport default {\n  name: \"RemoveNode\",\n  components: {\n    MenuButton,\n    Dialog,\n    Button\n  },\n  setup() {\n    const store = useStore();\n    const toast = useToast();\n    const addDialogVisible = ref(false);\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n\n    return {\n      selectedNodeTitle: computed(() =>\n        selectedNode.value ? selectedNode.value.title : \"\"\n      ),\n      toggleDialog: () => {\n        const nodeID = selectedNode.value.id\n\n        // collect all children IDs recursively\n        let stack = [nodeID];\n        const allChildrenIDs = [];\n        while (stack.length>0) {\n          const id = stack.pop()\n          allChildrenIDs.push(id)\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // collect all nodes where nodeID or its children were set as preconditions for nodes outside allChildrenIDs\n        stack = [nodeID];\n        const usedByNodes = {} as Record<string, Array<string>>;\n        while (stack.length>0) {\n          const id = stack.pop()\n          const [added, removed] = getArrayDiff(allChildrenIDs, store.state.precondition.reverseIndex[id])\n          if (store.state.precondition.reverseIndex[id] && added.length>0\n          ) {\n            usedByNodes[id] = added\n          }\n          stack.push(...store.state.tree.nodeRecord[id].node.children.map((node)=>node.id))\n        }\n\n        // show deny message\n        if (Object.keys(usedByNodes).length > 0) {\n          const nr = store.state.tree.nodeRecord\n          let detailText = ''\n          for (const id in usedByNodes) {\n            detailText += `<div>- remove ${idToLink(id, nr)} from 'based on' of ${usedByNodes[id].map((id)=>idToLink(id, nr)).join(', ')}</div>`\n          }\n          toast.add({\n            severity: \"info\",\n            summary: \"Cannot remove node until some other nodes use it or its children in their 'based on'\",\n            detail: \"If you are sure you want to remove it, please: \"+detailText,\n            life: 30000\n          });\n\n          return\n        }\n        addDialogVisible.value = !addDialogVisible.value\n      },\n      remove: () => {\n        addDialogVisible.value = false;\n        store.dispatch(`${actions.removeNode}`, selectedNode.value.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          store.state.tree.nodeRecord[\n            selectedNode.value.id\n          ].parent!.children.map(node => node.id)\n        );\n        // switch selectedNodeId to parent of removed node\n        store.commit(\n            `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n            store.state.tree.nodeRecord[\n                selectedNode.value.id\n                ].parent!.id\n        );\n      },\n      cancel: () => {\n        addDialogVisible.value = false;\n      },\n      addDialogVisible\n    };\n  }\n};\n","import { render } from \"./RemoveNode.vue?vue&type=template&id=09e0cfb6\"\nimport script from \"./RemoveNode.vue?vue&type=script&lang=ts\"\nexport * from \"./RemoveNode.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <div>\n    <MenuButton v-if=\"!editModeOn\" @click=\"on\" style=\"height:35px\">\n      <img\n        alt=\"icon\"\n        src=\"../../assets/images/switch-on.svg\"\n        style=\"width: 20px\"\n      />\n      <span class=\"p-ml-2\">edit map</span>\n    </MenuButton>\n    <MenuButton v-if=\"editModeOn\" @click=\"off\" style=\"height:35px;\">\n      <img\n        alt=\"icon\"\n        src=\"../../assets/images/switch-off.svg\"\n        style=\"width: 20px\"\n      />\n      <span class=\"p-ml-2\">edit map</span>\n    </MenuButton>\n  </div>\n</template>\n\n<script>\nimport { actions, useStore } from \"@/store\";\nimport { computed } from \"vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"EditMode\",\n  components: {\n    MenuButton\n  },\n  setup() {\n    const store = useStore();\n\n    return {\n      editModeOn: computed(() => store.state.editModeOn),\n      on: () => {\n        store.dispatch(`${actions.setEditMode}`, true);\n      },\n      off: () => {\n        store.dispatch(`${actions.setEditMode}`, false);\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./EditMode.vue?vue&type=template&id=45be9c8c\"\nimport script from \"./EditMode.vue?vue&type=script&lang=js\"\nexport * from \"./EditMode.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton v-if=\"cutNodeID == null\" @click=\"cut\" :disabled=\"!selectedNode\">\n    <img alt=\"icon\" src=\"../../assets/images/cut.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">cut</span>\n  </MenuButton>\n  <MenuButton v-if=\"cutNodeID != null\" @click=\"paste\">\n    <img alt=\"icon\" src=\"../../assets/images/paste.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">paste</span>\n  </MenuButton>\n</template>\n\n<script>\nimport { useStore, actions } from \"@/store\";\nimport { computed, ref } from \"vue\";\nimport { mutations as positionChangePermitMutations } from \"@/store/position_change_permits\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"CutPaste\",\n  components: { MenuButton },\n  setup() {\n    const store = useStore();\n    const selectedNode = computed(() => store.getters[\"tree/selectedNode\"]);\n    const cutNodeID = ref(null);\n\n    return {\n      selectedNode,\n      cutNodeID,\n      cut: () => {\n        cutNodeID.value = selectedNode.value.id;\n      },\n      paste: () => {\n        // permit to move children of both new and old parents\n        const oldParentChildrenID = store.state.tree.nodeRecord[\n          cutNodeID.value\n        ].parent.children.map(node => node.id);\n        const newParentChildrenID = store.state.tree.nodeRecord[\n          selectedNode.value.id\n        ].node.children.map(node => node.id);\n        store.commit(\n          `positionChangePermits/${positionChangePermitMutations.ADD_NODES}`,\n          [...oldParentChildrenID, ...newParentChildrenID]\n        );\n\n        // do cut and paste of node\n        store.dispatch(`${actions.cutPasteNode}`, {\n          nodeID: cutNodeID.value,\n          parentID: selectedNode.value.id\n        });\n\n        cutNodeID.value = null;\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./CutPaste.vue?vue&type=template&id=44f29dda\"\nimport script from \"./CutPaste.vue?vue&type=script&lang=js\"\nexport * from \"./CutPaste.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <MenuButton @click=\"send\">\n    <img alt=\"icon\" src=\"../../assets/images/chat.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">chat</span>\n  </MenuButton>\n</template>\n\n<script>\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\n\nexport default {\n  name: \"Feedback\",\n  components: {\n    MenuButton\n  },\n  setup() {\n    return {\n      send: () => {\n        window.open(\n          \"https://discord.com/channels/1171118046543347782/1171118047105396749\",\n          \"_blank\"\n        );\n      }\n    };\n  }\n};\n</script>\n","import { render } from \"./Feedback.vue?vue&type=template&id=60cc13ba\"\nimport script from \"./Feedback.vue?vue&type=script&lang=js\"\nexport * from \"./Feedback.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <span class=\"p-input-icon-right\" style=\"width: 100%\">\n    <i class=\"pi pi-times\" style=\"right: 1.2rem;\" @click=\"clearBox\" />\n    <InputText\n      :class=\"$style['searchBox']\"\n      placeholder=\"Search SciMap\"\n      v-model=\"value\"\n      @update:modelValue=\"doSearch($event)\"\n    />\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport InputText from \"primevue/inputtext\";\nimport { search } from \"@/tools/textsearch\";\nimport { mutations as searchMutations } from \"@/store/search_result\";\nimport { useStore } from \"@/store\";\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"TextSearch\",\n  components: {\n    InputText\n  },\n\n  setup() {\n    const value = ref(\"\");\n    const store = useStore();\n    return {\n      doSearch: async (value: string) => {\n        const res = await search(value);\n        store.commit(`searchResult/${searchMutations.SET_NODE_IDS}`, res);\n        return res;\n      },\n      value,\n      clearBox: () => {\n        value.value = \"\";\n      }\n    };\n  }\n};\n</script>\n\n<style module>\n.searchBox {\n  border-radius: 2rem !important;\n  padding: 0.8rem 2rem !important;\n  width: 100%;\n}\n</style>\n","\nimport InputText from \"primevue/inputtext\";\nimport { search } from \"@/tools/textsearch\";\nimport { mutations as searchMutations } from \"@/store/search_result\";\nimport { useStore } from \"@/store\";\nimport { ref } from \"vue\";\n\nexport default {\n  name: \"TextSearch\",\n  components: {\n    InputText\n  },\n\n  setup() {\n    const value = ref(\"\");\n    const store = useStore();\n    return {\n      doSearch: async (value: string) => {\n        const res = await search(value);\n        store.commit(`searchResult/${searchMutations.SET_NODE_IDS}`, res);\n        return res;\n      },\n      value,\n      clearBox: () => {\n        value.value = \"\";\n      }\n    };\n  }\n};\n","import { render } from \"./Textsearch.vue?vue&type=template&id=e144fd9c\"\nimport script from \"./Textsearch.vue?vue&type=script&lang=ts\"\nexport * from \"./Textsearch.vue?vue&type=script&lang=ts\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Textsearch.vue?vue&type=style&index=0&id=e144fd9c&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <ChangeLogComplain\n    :show=\"complainModalVisible\"\n    :complainChangeLink=\"complainChangeLink\"\n    @hide=\"complainModalVisible = false\"\n  />\n  <MenuButton @click=\"toggleAddDialog\">\n    <img alt=\"icon\" src=\"../../assets/images/log.svg\" style=\"width: 20px\" />\n    <span class=\"p-ml-2\">log</span>\n  </MenuButton>\n  <Dialog\n    v-model:visible=\"addDialogVisible\"\n    :dismissableMask=\"true\"\n    :closable=\"true\"\n    :modal=\"true\"\n    :closeOnEscape=\"true\"\n    @mousedown.stop\n  >\n    <template #header>\n      <h3>\n        Map change log\n      </h3>\n    </template>\n    <Card v-for=\"(event, i) of changes\" :key=\"i\" class=\"mt-3\">\n      <template #title>\n        <div class=\"p-grid\">\n          <div class=\"p-col-1\">\n            <img alt=\"add_icon\" v-if=\"event.isAdded\" src=\"../../assets/images/add-off.svg\"  style=\"width: 20px\"/>\n            <img alt=\"add_icon\" v-else-if=\"event.isRemoved\" src=\"../../assets/images/remove-off.svg\"  style=\"width: 20px\"/>\n            <img alt=\"add_icon\" v-else src=\"../../assets/images/move.svg\"  style=\"width: 20px\"/>\n          </div>\n          <div class=\"p-col-6\">\n            {{ new Date(event.timestamp).toLocaleDateString() }}\n            {{ new Date(event.timestamp).toLocaleTimeString() }}\n          </div>\n          <div class=\"p-col-5\">\n            <RestoreNode :clicked-title-id=\"``\" :event=\"event\" />\n          </div>\n        </div>\n      </template>\n      <template #subtitle>\n        {{ event.userDisplayName }} /\n        <a href=\"#\" @click=\"showComplain(event.changeLogID)\">Complain</a>\n      </template>\n      <template #content>\n        <div v-html=\"getActionDescription(event)\"></div>\n      </template>\n    </Card>\n  </Dialog>\n</template>\n\n<script lang=\"ts\">\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport {defineComponent, reactive, ref} from \"vue\";\nimport {ActionType, ChangeLogNodeParent} from \"@/store/change_log\";\nimport {GetNodeUrl, subscribeChangeLogEnriched} from \"@/api/change_log\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport RestoreNode from \"@/components/menu/RestoreNode.vue\";\n\nexport default defineComponent({\n  name: \"MapChangeLog\",\n  components: {\n    RestoreNode,\n    MenuButton,\n    ChangeLogComplain,\n    Card,\n    Dialog\n  },\n  setup() {\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const addDialogVisible = ref(false);\n    const changes = reactive([]) as Array<ChangeLogNodeParent>;\n    subscribeChangeLogEnriched([ActionType.ParentID, ActionType.Remove], [], changeLogs => {\n      changes.splice(\n        0,\n        changes.length,\n        ...(changeLogs as Array<ChangeLogNodeParent>)\n      );\n    });\n\n    return {\n      complainChangeLink,\n      complainModalVisible,\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      addDialogVisible,\n      changes,\n      getActionDescription: (event: ChangeLogNodeParent): string => {\n        if (event.isAdded) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was added to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isRemoved) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was removed from ${GetNodeUrl(\n            event.parentNodeBefore.idPath,\n            event.parentNodeBefore.id,\n            event.parentNodeBefore.name\n          )}`;\n        }\n\n        return `node ${GetNodeUrl(\n          event.node.idPath,\n          event.node.id,\n          event.node.name\n        )} was moved from ${GetNodeUrl(\n          event.parentNodeBefore.idPath,\n          event.parentNodeBefore.id,\n          event.parentNodeBefore.name\n        )} to ${GetNodeUrl(\n          event.parentNodeAfter!.idPath,\n          event.parentNodeAfter!.id,\n          event.parentNodeAfter!.name\n        )}`;\n      }\n    };\n  }\n});\n</script>\n","<template>\n  <img\n      alt=\"add_icon\"\n      v-if=\"event.isRemoved && IsNodeInTrash(event.node.idPath)\"\n      src=\"../../assets/images/revert.svg\"\n      style=\"width: 30px; cursor: pointer;\"\n      @click=\"revertRemove(event)\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport {defineComponent, PropType} from \"vue\";\nimport {ChangeLogNodeParent} from \"@/store/change_log\";\nimport {IsNodeInTrash} from \"@/api/change_log\";\nimport { Queue } from '@datastructures-js/queue';\nimport api from \"@/api/api\";\n\nexport default defineComponent({\n  name: \"RestoreNode\",\n  emits: [\"select-restore-parent-is-on\", \"select-restore-parent-is-off\"],\n  props: {\n    event: {\n      type: Object as PropType<ChangeLogNodeParent>,\n      required: true,\n    },\n    clickedTitleId: {\n      type: String,\n    },\n  },\n  setup() {\n    const restoreNodeWithChildren = async (nodeID: string, parentNodeID: string) => {\n      const queue = new Queue<string>();\n      const updateMap = {} as Record<string, any>\n      updateMap[`map/${parentNodeID}/children/${api.generateKey()}`] = nodeID\n      queue.push(nodeID)\n      while (!queue.isEmpty()) {\n        const nodeID = queue.pop()\n        const mapNode = await api.getTrashNode(nodeID, \"map\")\n        if (!mapNode) {\n          console.error(\"restoreNodeWithChildren: cannot find node in trash\", nodeID)\n          continue\n        }\n        const nodeContentNode = await api.getTrashNode(nodeID, \"node_content\")\n        const preconditionNode = await api.getTrashNode(nodeID, \"precondition\")\n        const nodeImage = await api.getTrashNode(nodeID, \"node_image\")\n        updateMap[`map/${mapNode?.id}`] = mapNode\n        updateMap[`node_content/${mapNode?.id}`] = nodeContentNode\n        updateMap[`precondition/${mapNode?.id}`] = preconditionNode\n        updateMap[`node_image/${mapNode?.id}`] = nodeImage\n        if (mapNode?.children) {\n          for (const idx in mapNode?.children) {\n            queue.push(mapNode?.children[idx])\n          }\n        }\n      }\n      console.log(updateMap)\n      return await api.update(updateMap);\n    }\n    return {\n      IsNodeInTrash,\n      revertRemove: async (event: ChangeLogNodeParent) => {\n        if (!event.isRemoved) {\n          return\n        }\n\n        if (!IsNodeInTrash(event.parentNodeBefore.idPath) && IsNodeInTrash(event.node.idPath)) {\n          await restoreNodeWithChildren(event.node.id, event.parentNodeBefore.id)\n        }\n      },\n    }\n  }\n})\n</script>\n","\nimport {defineComponent, PropType} from \"vue\";\nimport {ChangeLogNodeParent} from \"@/store/change_log\";\nimport {IsNodeInTrash} from \"@/api/change_log\";\nimport { Queue } from '@datastructures-js/queue';\nimport api from \"@/api/api\";\n\nexport default defineComponent({\n  name: \"RestoreNode\",\n  emits: [\"select-restore-parent-is-on\", \"select-restore-parent-is-off\"],\n  props: {\n    event: {\n      type: Object as PropType<ChangeLogNodeParent>,\n      required: true,\n    },\n    clickedTitleId: {\n      type: String,\n    },\n  },\n  setup() {\n    const restoreNodeWithChildren = async (nodeID: string, parentNodeID: string) => {\n      const queue = new Queue<string>();\n      const updateMap = {} as Record<string, any>\n      updateMap[`map/${parentNodeID}/children/${api.generateKey()}`] = nodeID\n      queue.push(nodeID)\n      while (!queue.isEmpty()) {\n        const nodeID = queue.pop()\n        const mapNode = await api.getTrashNode(nodeID, \"map\")\n        if (!mapNode) {\n          console.error(\"restoreNodeWithChildren: cannot find node in trash\", nodeID)\n          continue\n        }\n        const nodeContentNode = await api.getTrashNode(nodeID, \"node_content\")\n        const preconditionNode = await api.getTrashNode(nodeID, \"precondition\")\n        const nodeImage = await api.getTrashNode(nodeID, \"node_image\")\n        updateMap[`map/${mapNode?.id}`] = mapNode\n        updateMap[`node_content/${mapNode?.id}`] = nodeContentNode\n        updateMap[`precondition/${mapNode?.id}`] = preconditionNode\n        updateMap[`node_image/${mapNode?.id}`] = nodeImage\n        if (mapNode?.children) {\n          for (const idx in mapNode?.children) {\n            queue.push(mapNode?.children[idx])\n          }\n        }\n      }\n      console.log(updateMap)\n      return await api.update(updateMap);\n    }\n    return {\n      IsNodeInTrash,\n      revertRemove: async (event: ChangeLogNodeParent) => {\n        if (!event.isRemoved) {\n          return\n        }\n\n        if (!IsNodeInTrash(event.parentNodeBefore.idPath) && IsNodeInTrash(event.node.idPath)) {\n          await restoreNodeWithChildren(event.node.id, event.parentNodeBefore.id)\n        }\n      },\n    }\n  }\n})\n","import { render } from \"./RestoreNode.vue?vue&type=template&id=f874053e\"\nimport script from \"./RestoreNode.vue?vue&type=script&lang=ts\"\nexport * from \"./RestoreNode.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport Dialog from \"primevue/dialog\";\nimport Card from \"primevue/card\";\nimport {defineComponent, reactive, ref} from \"vue\";\nimport {ActionType, ChangeLogNodeParent} from \"@/store/change_log\";\nimport {GetNodeUrl, subscribeChangeLogEnriched} from \"@/api/change_log\";\nimport ChangeLogComplain from \"@/components/node_content/ChangeLogComplain.vue\";\nimport MenuButton from \"@/components/menu/MenuButton.vue\";\nimport RestoreNode from \"@/components/menu/RestoreNode.vue\";\n\nexport default defineComponent({\n  name: \"MapChangeLog\",\n  components: {\n    RestoreNode,\n    MenuButton,\n    ChangeLogComplain,\n    Card,\n    Dialog\n  },\n  setup() {\n    const complainChangeLink = ref(\"\");\n    const complainModalVisible = ref(false);\n    const addDialogVisible = ref(false);\n    const changes = reactive([]) as Array<ChangeLogNodeParent>;\n    subscribeChangeLogEnriched([ActionType.ParentID, ActionType.Remove], [], changeLogs => {\n      changes.splice(\n        0,\n        changes.length,\n        ...(changeLogs as Array<ChangeLogNodeParent>)\n      );\n    });\n\n    return {\n      complainChangeLink,\n      complainModalVisible,\n      showComplain: (id: string) => {\n        complainModalVisible.value = true;\n        complainChangeLink.value = \"https://scimap.org/change/\" + id;\n      },\n      toggleAddDialog: () => (addDialogVisible.value = !addDialogVisible.value),\n      addDialogVisible,\n      changes,\n      getActionDescription: (event: ChangeLogNodeParent): string => {\n        if (event.isAdded) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was added to ${GetNodeUrl(\n            event.parentNodeAfter!.idPath,\n            event.parentNodeAfter!.id,\n            event.parentNodeAfter!.name\n          )}`;\n        }\n        if (event.isRemoved) {\n          return `node ${GetNodeUrl(\n            event.node.idPath,\n            event.node.id,\n            event.node.name\n          )} was removed from ${GetNodeUrl(\n            event.parentNodeBefore.idPath,\n            event.parentNodeBefore.id,\n            event.parentNodeBefore.name\n          )}`;\n        }\n\n        return `node ${GetNodeUrl(\n          event.node.idPath,\n          event.node.id,\n          event.node.name\n        )} was moved from ${GetNodeUrl(\n          event.parentNodeBefore.idPath,\n          event.parentNodeBefore.id,\n          event.parentNodeBefore.name\n        )} to ${GetNodeUrl(\n          event.parentNodeAfter!.idPath,\n          event.parentNodeAfter!.id,\n          event.parentNodeAfter!.name\n        )}`;\n      }\n    };\n  }\n});\n","import { render } from \"./MapChangeLog.vue?vue&type=template&id=bbf8e01a\"\nimport script from \"./MapChangeLog.vue?vue&type=script&lang=ts\"\nexport * from \"./MapChangeLog.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { render } from \"./Index.vue?vue&type=template&id=19114622\"\nimport script from \"./Index.vue?vue&type=script&lang=js\"\nexport * from \"./Index.vue?vue&type=script&lang=js\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./Index.vue?vue&type=style&index=0&id=19114622&module=true&lang=css\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","\nimport { computed, defineComponent, ref, watch } from \"vue\";\nimport Map from \"@/components/map/Map.vue\";\nimport NodeContent from \"@/components/node_content/Index.vue\";\nimport ConfirmDialog from \"primevue/confirmdialog\";\nimport Toast from \"primevue/toast\";\nimport {\n  EventClickNode,\n  EventDraggingBackground,\n  EventDraggingNode,\n  EventWheel\n} from \"@/components/map/Map\";\nimport Menu from \"@/components/menu/Index.vue\";\nimport { useStore } from \"@/store\";\nimport { useRouter, useRoute, onBeforeRouteUpdate } from \"vue-router\";\nimport { mutations as treeMutations, NodeRecordItem } from \"@/store/tree\";\nimport { mutations as zoomPanMutations } from \"@/store/zoom_pan\";\nimport { actions } from \"@/store/\";\nimport {\n  filterNodesAndLayers,\n  findCentralNode,\n  zoomAndPanPoint,\n  zoomAnPanLayers\n} from \"@/views/Home\";\nimport { clone, printError } from \"@/tools/utils\";\nimport { MapNode } from \"@/types/graphics\";\nimport { findMapNode, findMapNodes } from \"@/store/tree/helpers\";\nimport { actions as positionChangePermitsActions } from \"@/store/position_change_permits\";\n\nexport default defineComponent({\n  name: \"Home\",\n\n  components: {\n    Map,\n    Menu,\n    NodeContent,\n    ConfirmDialog,\n    Toast\n  },\n\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const route = useRoute();\n    const treeState = store.state.tree;\n    const zoomPanState = store.state.zoomPan;\n    const pinState = store.state.pin;\n    const searchResultState = store.state.searchResult;\n    const clickedTitleId = ref(\"-1\");\n    let selectPreconditionIsOn = false;\n    let titleOver = false;\n\n    // Set node from URL as selected\n    watch(\n      () => route.params.id,\n      () => {\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      { immediate: true }\n    );\n\n    /**\n     * From mapNodeLayers method updateLayers determines visibleLayers and nodes\n     * that will be shown to user (which is always just a small part of all nodes of the map)\n     * @param centralNodeId\n     * @param mapNodeLayers\n     * @param nodeRecord\n     */\n    const updateLayers = (\n      centralNodeId: string,\n      mapNodeLayers: Array<Record<string, MapNode>>,\n      nodeRecord: Record<string, NodeRecordItem>\n    ): Array<Record<number, MapNode>> => {\n      // Вычленяем слои и узлы которые мы хотим показывать учитывая что текущий видимый узел это centralNodeId\n      const [filteredLayers, err] = filterNodesAndLayers(\n        mapNodeLayers,\n        nodeRecord,\n        centralNodeId\n      );\n      if (err) {\n        printError(\"Home.vue: error in filterNodesAndLayers:\", { err });\n        return [];\n      }\n      return filteredLayers.reverse();\n    };\n\n    const centralNodeId = ref<string | null>(null);\n    // visibleLayers consists only from user visible nodes and visibleLayers of all (which is treeState.mapNodeLayers)\n    const visibleLayers = ref<Array<Record<string, MapNode>>>([]);\n\n    // Ugly hack to determine first load of page\n    let isFirstPageLoad = true;\n    onBeforeRouteUpdate(async (to, from) => {\n      isFirstPageLoad = false;\n    });\n    // If this is isFirstPageLoad then pan map to node in URL\n    watch(\n      () => [treeState.mapNodeLayers],\n      () => {\n        if (\n          isFirstPageLoad &&\n          route.params.id.length > 0 &&\n          treeState.mapNodeLayers.length > 0\n        ) {\n          const [firstNode] = findMapNode(\n            route.params.id as string,\n            treeState.mapNodeLayers\n          );\n          if (firstNode != null) {\n            store.commit(`zoomPan/${zoomPanMutations.SET_PAN}`, {\n              x: -firstNode.center.x + treeState.mapNodeLayers[0][\"0\"].center.x,\n              y: -firstNode.center.y + treeState.mapNodeLayers[0][\"0\"].center.y\n            });\n          }\n        }\n      }\n    );\n\n    // Determine which nodes to show based on current pan and zoom\n    watch(\n      () => [\n        treeState.mapNodeLayers,\n        zoomPanState.debouncedZoom,\n        zoomPanState.debouncedPan\n      ],\n      () => {\n        const [newCentralNodeId, err] = findCentralNode(\n          treeState.mapNodeLayers,\n          treeState.nodeRecord,\n          { width: window.innerWidth, height: window.innerHeight },\n          zoomPanState.debouncedZoom,\n          zoomPanState.pan,\n          zoomPanState.zoomCenter\n        );\n        if (err != null) {\n          printError(\"filterNodesAndLayers: error in findCurrentNode\", { err });\n        }\n\n        centralNodeId.value = newCentralNodeId;\n        visibleLayers.value = updateLayers(\n          newCentralNodeId,\n          treeState.mapNodeLayers,\n          treeState.nodeRecord\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    const visibleZoomedPanedLayers = ref<Array<Record<string, MapNode>>>([]);\n    watch(\n      () => [\n        zoomPanState.pan.x,\n        zoomPanState.pan.y,\n        zoomPanState.zoom,\n        visibleLayers\n      ],\n      () => {\n        // visibleLayers это всегда слои с zoom=1 и pan={0, 0} состоящий из только видимых прямо сейчас элементов.\n        // Мы применяем к этому объекту текущий zoomPanState но сам эталон не трогаем, поэтому здесь clone\n        // Это не дорогая операция так как visibleLayers всегда содержит небольшое кол-во элементов\n        // видимых только прямо сейчас\n        const layersToZoomAndPan = clone(visibleLayers.value);\n        visibleZoomedPanedLayers.value = zoomAnPanLayers(\n          layersToZoomAndPan,\n          zoomPanState.zoom,\n          zoomPanState.pan\n        );\n      },\n      { immediate: true, deep: true }\n    );\n\n    return {\n      /**\n       * pinNodes\n       */\n      pinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const pinNodeIDs = pinState.pinsReverse[centralNodeId.value];\n        if (!pinNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = pinNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                pinNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const pinMapNodes = findMapNodes(pinNodeIDs, treeState.mapNodeLayers);\n        const result = [];\n        for (const pinMapNode of pinMapNodes) {\n          const cl = clone(pinMapNode);\n          cl.center = zoomAndPanPoint(\n            pinMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      /**\n       * searchResultNodeIDs\n       */\n      searchResultNodeIDs: computed(() => {\n        return searchResultState.nodeIDs;\n      }),\n\n      /**\n       * searchResultPinNodes\n       */\n      searchResultPinNodes: computed(() => {\n        if (centralNodeId.value == null) {\n          return [];\n        }\n        const searchResultNodeIDs = clone(searchResultState.nodeIDs);\n        if (!searchResultNodeIDs) {\n          return [];\n        }\n\n        // remove pins that already exists on visibleLayers\n        for (const layer of visibleLayers.value) {\n          for (const nodeID in layer) {\n            const node = layer[nodeID];\n            if (node.title != \"\") {\n              const ind = searchResultNodeIDs.indexOf(node.id);\n              if (ind != -1) {\n                searchResultNodeIDs.splice(ind, 1);\n              }\n            }\n          }\n        }\n\n        const searchResultMapNodes = findMapNodes(\n          searchResultNodeIDs,\n          treeState.mapNodeLayers\n        );\n        const result = [];\n        for (const searchResultMapNode of searchResultMapNodes) {\n          const cl = clone(searchResultMapNode);\n          cl.center = zoomAndPanPoint(\n            searchResultMapNode.center,\n            zoomPanState.zoom,\n            zoomPanState.pan\n          );\n          result.push(cl);\n        }\n\n        return result;\n      }),\n\n      editModeOn: computed(() => store.state.editModeOn),\n      selectedNodeId: computed(() => treeState.selectedNodeId),\n      selectedNodePreconditionIds: computed(() =>\n        treeState.selectedNodeId\n          ? store.state.precondition.preconditions[treeState.selectedNodeId]\n          : []\n      ),\n      visibleZoomedPanedLayers: visibleZoomedPanedLayers,\n      nodeDragging: async (e: EventDraggingNode) => {\n        const hasDragPermit = await store.dispatch(\n          `positionChangePermits/${positionChangePermitsActions.CheckNodeID}`,\n          e.id\n        );\n        if (!hasDragPermit) {\n          return;\n        }\n        await store.dispatch(`${actions.updateNodePosition}`, {\n          nodeId: e.id,\n          delta: {\n            x: e.delta.x / zoomPanState.zoom,\n            y: e.delta.y / zoomPanState.zoom\n          }\n        });\n      },\n      setSelectPreconditionON: () => {\n        selectPreconditionIsOn = true;\n      },\n      setSelectPreconditionOFF: () => {\n        selectPreconditionIsOn = false;\n      },\n      clickedTitleId,\n      titleClick: (e: EventClickNode) => {\n        if (!selectPreconditionIsOn) {\n          router.push({ name: \"node\", params: { id: e.id } });\n        } else {\n          clickedTitleId.value = e.id;\n        }\n      },\n      titleOver: (e: EventClickNode) => {\n        titleOver = true;\n        store.commit(`tree/${treeMutations.SET_SELECTED_NODE_ID}`, e.id);\n      },\n      titleLeave: (e: EventClickNode) => {\n        titleOver = false;\n        store.commit(\n          `tree/${treeMutations.SET_SELECTED_NODE_ID}`,\n          route.params.id\n        );\n      },\n      mapDragging: (event: EventDraggingBackground) => {\n        if (store.state.editModeOn && titleOver) {\n          // to prevent pan while node position editing ( = title dragging in edit mode)\n          return;\n        }\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, event);\n      },\n      zoom: (event: EventWheel) => {\n        // initial value of center (when root.border == viewport)\n        const initial = {\n          x: (event.center.x - zoomPanState.pan.x) / zoomPanState.zoom,\n          y: (event.center.y - zoomPanState.pan.y) / zoomPanState.zoom\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_ZOOM}`, -1 * event.delta);\n        const after = {\n          x: initial.x * zoomPanState.zoom + zoomPanState.pan.x,\n          y: initial.y * zoomPanState.zoom + zoomPanState.pan.y\n        };\n        store.commit(`zoomPan/${zoomPanMutations.ADD_PAN}`, {\n          from: after,\n          to: event.center\n        });\n        store.commit(\n          `zoomPan/${zoomPanMutations.SET_ZOOM_CENTER}`,\n          event.center\n        );\n      }\n    };\n  }\n});\n","import { render } from \"./Home.vue?vue&type=template&id=56fbfcb5\"\nimport script from \"./Home.vue?vue&type=script&lang=ts\"\nexport * from \"./Home.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1 v-if=\"!isAuthorized\">Only authorized users can view changes</h1>\n  <div v-else>\n    <div><b>id:</b> {{ route.params.id }}</div>\n    <div>\n      <b>timestamp:</b>\n      {{ new Date(change[\"timestamp\"]).toLocaleDateString() }}\n      {{ new Date(change[\"timestamp\"]).toLocaleTimeString() }}\n    </div>\n    <div><b>action:</b> {{ change[\"action\"] }}</div>\n    <div><b>node_id:</b> {{ change[\"node_id\"] }}</div>\n    <div><b>user_id:</b> {{ change[\"user_id\"] }}</div>\n    <b>value:</b>\n    <Markdown\n      v-if=\"['content', 'name'].indexOf(change['action']) != -1\"\n      :content=\"change['attributes']['value']\"\n      :rows=\"20\"\n    />\n    <div v-else>{{ JSON.stringify(change[\"attributes\"]) }}</div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport { doc, getDoc, getFirestore } from \"firebase/firestore\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default {\n  name: \"Change\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const change = ref({});\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = doc(\n            getFirestore(),\n            \"changes\",\n            route.params.id as string\n          );\n          const docSnap = await getDoc(docRef);\n\n          if (docSnap.exists()) {\n            change.value = docSnap.data();\n          }\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized,\n      route,\n      change\n    };\n  }\n};\n</script>\n","\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport { doc, getDoc, getFirestore } from \"firebase/firestore\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\n\nexport default {\n  name: \"Change\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const change = ref({});\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = doc(\n            getFirestore(),\n            \"changes\",\n            route.params.id as string\n          );\n          const docSnap = await getDoc(docRef);\n\n          if (docSnap.exists()) {\n            change.value = docSnap.data();\n          }\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized,\n      route,\n      change\n    };\n  }\n};\n","import { render } from \"./Change.vue?vue&type=template&id=14f8614f\"\nimport script from \"./Change.vue?vue&type=script&lang=ts\"\nexport * from \"./Change.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1 v-if=\"!isAuthorized\">Only authorized users can view node profile</h1>\n  <div v-else>\n    <div><b>id:</b> {{ route.params.id }}</div>\n    <div><b>is removed from map:</b> {{ node[\"is_in_trash\"] }}</div>\n    <div>\n      <b>parent_id:</b>\n      <a target=\"_blank\" :href=\"node['map']['parentID']\">{{\n        node[\"map\"][\"parentID\"]\n      }}</a>\n    </div>\n    <div><b>name:</b> {{ node[\"map\"][\"name\"] }}</div>\n    <b>content:</b>\n    <Markdown\n      :content=\"node['node_content'] ? node['node_content']['content'] : ''\"\n      :rows=\"20\"\n    />\n    <div>\n      <b>precondition:</b>\n      <div v-for=\"id of node['precondition']\" :key=\"id\">\n        <a target=\"_blank\" :href=\"id\">{{ id }}</a>\n      </div>\n    </div>\n    <div>\n      <b>children:</b>\n      <div v-for=\"id of node['map']['children']\" :key=\"id\">\n        <a target=\"_blank\" :href=\"id\">{{ id }}</a>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\nimport firebase from \"firebase/compat\";\n\nexport default {\n  name: \"NodeDescription\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const node = ref({} as any);\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = firebase\n            .database()\n            .ref(`/map/${route.params.id}`)\n            .once(\"value\", data => {\n              if (data.exists()) {\n                // not in /trash, try to get from /map, /node_content, /precondition\n                node.value[\"is_in_trash\"] = false;\n\n                // map\n                node.value[\"map\"] = data.val();\n\n                // node_content\n                firebase\n                    .database()\n                    .ref(`/node_content/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"node_content\"] = data.val();\n                      }\n                    });\n\n                // precondition\n                firebase\n                    .database()\n                    .ref(`/precondition/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"precondition\"] = data.val();\n                      }\n                    });\n              } else {\n                firebase\n                    .database()\n                    .ref(`/trash/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value = data.val();\n                        node.value[\"is_in_trash\"] = true;\n                      }\n                    });\n              }\n            });\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized: isAuthorized,\n      route,\n      node\n    };\n  }\n};\n</script>\n","\nimport { useRoute } from \"vue-router\";\nimport { useStore } from \"@/store\";\nimport { computed, watch, ref } from \"vue\";\nimport Markdown from \"@/components/node_content/Markdown.vue\";\nimport firebase from \"firebase/compat\";\n\nexport default {\n  name: \"NodeDescription\",\n  components: { Markdown },\n\n  setup() {\n    const store = useStore();\n    const isAuthorized = computed(\n      () => store.state.user.user && !store.state.user.user.isAnonymous\n    );\n    const route = useRoute();\n    const node = ref({} as any);\n\n    watch(\n      () => isAuthorized.value,\n      async () => {\n        if (isAuthorized.value) {\n          // fetch change from firestore\n          const docRef = firebase\n            .database()\n            .ref(`/map/${route.params.id}`)\n            .once(\"value\", data => {\n              if (data.exists()) {\n                // not in /trash, try to get from /map, /node_content, /precondition\n                node.value[\"is_in_trash\"] = false;\n\n                // map\n                node.value[\"map\"] = data.val();\n\n                // node_content\n                firebase\n                    .database()\n                    .ref(`/node_content/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"node_content\"] = data.val();\n                      }\n                    });\n\n                // precondition\n                firebase\n                    .database()\n                    .ref(`/precondition/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value[\"precondition\"] = data.val();\n                      }\n                    });\n              } else {\n                firebase\n                    .database()\n                    .ref(`/trash/${route.params.id}`)\n                    .once(\"value\", data => {\n                      if (data.exists()) {\n                        node.value = data.val();\n                        node.value[\"is_in_trash\"] = true;\n                      }\n                    });\n              }\n            });\n        }\n      },\n      {\n        immediate: true\n      }\n    );\n\n    return {\n      isAuthorized: isAuthorized,\n      route,\n      node\n    };\n  }\n};\n","import { render } from \"./NodeDescription.vue?vue&type=template&id=1c35b6c0\"\nimport script from \"./NodeDescription.vue?vue&type=script&lang=ts\"\nexport * from \"./NodeDescription.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n  <h1>Oops, it looks like the page you're looking for doesn't exist.</h1>\n</template>\n","import { render } from \"./NotFound.vue?vue&type=template&id=600d9e34\"\nconst script = {}\nscript.render = render\n\nexport default script","import { createRouter, createWebHistory, RouteRecordRaw } from \"vue-router\";\nimport PasswordLogin from \"../views/PasswordLogin.vue\";\nimport Home from \"../views/Home.vue\";\nimport Change from \"../views/Change.vue\";\nimport NodeDescription from \"../views/NodeDescription.vue\";\nimport NotFound from \"../views/NotFound.vue\";\n\nconst routes: Array<RouteRecordRaw> = [\n  {\n    path: \"/passwordLogin\",\n    component: PasswordLogin\n  },\n  {\n    path: \"/node_description/:id?\",\n    name: \"node_description\",\n    component: NodeDescription\n  },\n  {\n    path: \"/change/:id?\",\n    name: \"change\",\n    component: Change\n  },\n  {\n    path: \"/:id?\",\n    name: \"node\",\n    component: Home\n  },\n  {\n    path: \"/:catchAll(.*)\",\n    component: NotFound\n  }\n];\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\nexport default router;\n","import { createApp } from \"vue\";\nimport App from \"./App.vue\";\nimport PrimeVue from \"primevue/config\";\nimport ConfirmationService from \"primevue/confirmationservice\";\nimport ToastService from \"primevue/toastservice\";\nimport router from \"./router\";\nimport { store, key } from \"./store\";\n// primevue ui stuff\nimport \"primevue/resources/themes/aura-light-green/theme.css\"; //theme\nimport \"primevue/resources/primevue.min.css\"; //core css\nimport \"primeicons/primeicons.css\"; //icons\nimport \"primeflex/primeflex.css\";\n\ncreateApp(App)\n  .use(store, key)\n  .use(router)\n  .use(PrimeVue)\n  .use(ConfirmationService)\n  .use(ToastService)\n  .mount(\"#app\");\n","var map = {\n\t\"./bmp\": \"0dcc\",\n\t\"./bmp.js\": \"0dcc\",\n\t\"./gif\": \"c416\",\n\t\"./gif.js\": \"c416\",\n\t\"./jpg\": \"135b\",\n\t\"./jpg.js\": \"135b\",\n\t\"./png\": \"e9ef\",\n\t\"./png.js\": \"e9ef\",\n\t\"./psd\": \"520c\",\n\t\"./psd.js\": \"520c\",\n\t\"./svg\": \"b0bf\",\n\t\"./svg.js\": \"b0bf\",\n\t\"./tiff\": \"f270\",\n\t\"./tiff.js\": \"f270\",\n\t\"./webp\": \"cf1e\",\n\t\"./webp.js\": \"cf1e\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"cd50\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MapLayer.vue?vue&type=style&index=0&id=59d7967e&scoped=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/pin-on-map.3e21aea9.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"Index_wrapper_1nXRC\",\"textSearch\":\"Index_textSearch_1a-zf\"};","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Preconditions.vue?vue&type=style&index=0&id=28fa73e4&module=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-0-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-0-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-0-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Preconditions.vue?vue&type=style&index=0&id=28fa73e4&module=true&lang=css\"","module.exports = __webpack_public_path__ + \"img/move.bbe00c47.svg\";","module.exports = __webpack_public_path__ + \"img/add-off.32a0c20b.svg\";"],"sourceRoot":""}